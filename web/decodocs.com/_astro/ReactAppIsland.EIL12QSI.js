import{u as ei,j as u,l as pr,H as gr,a as mo,b as mr,c as br,d as yr,e as bo,f as yo,g as xr,h as xo,i as wo,k as vo,m as Ao,n as So,o as Mi,p as Eo,q as js,r as wr,s as vr,t as Ar,v as Co,w as Sr,x as Er,y as To,z as _o,A as ko,G as ji}from"./DecoDocsLogo.DFIwD7DX.js";import{a as Po,g as Ro,r as S,R as Fi}from"./index.DeO6U63H.js";import{i as Do,C as No,r as wn,g as Lo,F as Io,x as Fs,e as Mo,T as jo,m as Fo,H as Cr,M as Oo,N as Bo}from"./index.esm.DAC6xlWs.js";import{s as Tr,a as Uo,f as Ho,b as $o,c as zo,_ as Oi}from"./authStore.xMxrgvGQ.js";import{GoogleAuthProvider as _r,OAuthProvider as _s,linkWithPopup as kr,EmailAuthProvider as Pr,linkWithCredential as Rr,signOut as Wo}from"./index.esm.BpoIeuRg.js";var Vt={},vn;function Go(){if(vn)return Vt;vn=1;var o=Vt&&Vt.__createBinding||(Object.create?(function(n,r,a,l){l===void 0&&(l=a);var c=Object.getOwnPropertyDescriptor(r,a);(!c||("get"in c?!r.__esModule:c.writable||c.configurable))&&(c={enumerable:!0,get:function(){return r[a]}}),Object.defineProperty(n,l,c)}):(function(n,r,a,l){l===void 0&&(l=a),n[l]=r[a]})),t=Vt&&Vt.__setModuleDefault||(Object.create?(function(n,r){Object.defineProperty(n,"default",{enumerable:!0,value:r})}):function(n,r){n.default=r}),e=Vt&&Vt.__importStar||(function(){var n=function(r){return n=Object.getOwnPropertyNames||function(a){var l=[];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(l[l.length]=c);return l},n(r)};return function(r){if(r&&r.__esModule)return r;var a={};if(r!=null)for(var l=n(r),c=0;c<l.length;c++)l[c]!=="default"&&o(a,r,l[c]);return t(a,r),a}})();Object.defineProperty(Vt,"__esModule",{value:!0});var s=e(Po()),i=function(n){var r=n.className,a=n.flagClassName,l=n.textClassName,c=(0,s.useState)(!1),h=c[0],d=c[1];return s.default.createElement("div",{className:r,onMouseEnter:function(){return d(!0)},onMouseLeave:function(){return d(!1)},onFocusCapture:function(){return d(!0)},onBlurCapture:function(){return d(!1)},style:{position:"absolute",left:0,top:0,right:0,background:"#000",display:"flex",justifyContent:"center",padding:"5px",zIndex:1e4,fontFamily:"arial"}},s.default.createElement("a",{href:"https://u24.gov.ua",target:"_blank",rel:"noopener noreferrer",title:"Donate to support freedom.",style:{display:"flex",alignItems:"center",textDecoration:"none"}},s.default.createElement("div",{role:"img","aria-label":"Flag of Ukraine",className:a,style:{height:"25px",marginRight:"10px"}},s.default.createElement("div",{style:{width:"40px",height:"12.5px",background:"#005BBB"}}),s.default.createElement("div",{style:{width:"40px",height:"12.5px",background:"#FFD500"}})),s.default.createElement("div",{className:l,style:{color:"white",fontSize:"12px",lineHeight:"25px"}},"Donate to support freedom.")),s.default.createElement("a",{href:"https://www.npmjs.com/package/react-support-ukraine-banner",target:"_blank",rel:"noopener noreferrer","aria-label":"Get the same banner on npm",title:"Get the same: react-support-ukraine-banner",style:{position:"absolute",right:"10px",top:0,height:"100%",display:"flex",alignItems:"center",fontSize:"12px",lineHeight:"25px",color:h?"#fff":"#000",transition:"color 150ms ease",cursor:"pointer",textDecoration:"none"}},"Get the same"))};return Vt.default=i,Vt}var Vo=Go();const Xo=Ro(Vo);/**
 * react-router v7.13.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var An="popstate";function Yo(o={}){function t(s,i){let{pathname:n,search:r,hash:a}=s.location;return xi("",{pathname:n,search:r,hash:a},i.state&&i.state.usr||null,i.state&&i.state.key||"default")}function e(s,i){return typeof i=="string"?i:Qe(i)}return Ko(t,e,null,o)}function et(o,t){if(o===!1||o===null||typeof o>"u")throw new Error(t)}function $t(o,t){if(!o){typeof console<"u"&&console.warn(t);try{throw new Error(t)}catch{}}}function qo(){return Math.random().toString(36).substring(2,10)}function Sn(o,t){return{usr:o.state,key:o.key,idx:t}}function xi(o,t,e=null,s){return{pathname:typeof o=="string"?o:o.pathname,search:"",hash:"",...typeof t=="string"?Ne(t):t,state:e,key:t&&t.key||s||qo()}}function Qe({pathname:o="/",search:t="",hash:e=""}){return t&&t!=="?"&&(o+=t.charAt(0)==="?"?t:"?"+t),e&&e!=="#"&&(o+=e.charAt(0)==="#"?e:"#"+e),o}function Ne(o){let t={};if(o){let e=o.indexOf("#");e>=0&&(t.hash=o.substring(e),o=o.substring(0,e));let s=o.indexOf("?");s>=0&&(t.search=o.substring(s),o=o.substring(0,s)),o&&(t.pathname=o)}return t}function Ko(o,t,e,s={}){let{window:i=document.defaultView,v5Compat:n=!1}=s,r=i.history,a="POP",l=null,c=h();c==null&&(c=0,r.replaceState({...r.state,idx:c},""));function h(){return(r.state||{idx:null}).idx}function d(){a="POP";let m=h(),y=m==null?null:m-c;c=m,l&&l({action:a,location:g.location,delta:y})}function f(m,y){a="PUSH";let x=xi(g.location,m,y);c=h()+1;let w=Sn(x,c),v=g.createHref(x);try{r.pushState(w,"",v)}catch(A){if(A instanceof DOMException&&A.name==="DataCloneError")throw A;i.location.assign(v)}n&&l&&l({action:a,location:g.location,delta:1})}function p(m,y){a="REPLACE";let x=xi(g.location,m,y);c=h();let w=Sn(x,c),v=g.createHref(x);r.replaceState(w,"",v),n&&l&&l({action:a,location:g.location,delta:0})}function b(m){return Jo(m)}let g={get action(){return a},get location(){return o(i,r)},listen(m){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(An,d),l=m,()=>{i.removeEventListener(An,d),l=null}},createHref(m){return t(i,m)},createURL:b,encodeLocation(m){let y=b(m);return{pathname:y.pathname,search:y.search,hash:y.hash}},push:f,replace:p,go(m){return r.go(m)}};return g}function Jo(o,t=!1){let e="http://localhost";typeof window<"u"&&(e=window.location.origin!=="null"?window.location.origin:window.location.href),et(e,"No window.location.(origin|href) available to create URL");let s=typeof o=="string"?o:Qe(o);return s=s.replace(/ $/,"%20"),!t&&s.startsWith("//")&&(s=e+s),new URL(s,e)}function Dr(o,t,e="/"){return Qo(o,t,e,!1)}function Qo(o,t,e,s){let i=typeof t=="string"?Ne(t):t,n=ie(i.pathname||"/",e);if(n==null)return null;let r=Nr(o);Zo(r);let a=null;for(let l=0;a==null&&l<r.length;++l){let c=hl(n);a=ll(r[l],c,s)}return a}function Nr(o,t=[],e=[],s="",i=!1){let n=(r,a,l=i,c)=>{let h={relativePath:c===void 0?r.path||"":c,caseSensitive:r.caseSensitive===!0,childrenIndex:a,route:r};if(h.relativePath.startsWith("/")){if(!h.relativePath.startsWith(s)&&l)return;et(h.relativePath.startsWith(s),`Absolute route path "${h.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),h.relativePath=h.relativePath.slice(s.length)}let d=se([s,h.relativePath]),f=e.concat(h);r.children&&r.children.length>0&&(et(r.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${d}".`),Nr(r.children,t,f,d,l)),!(r.path==null&&!r.index)&&t.push({path:d,score:al(d,r.index),routesMeta:f})};return o.forEach((r,a)=>{if(r.path===""||!r.path?.includes("?"))n(r,a);else for(let l of Lr(r.path))n(r,a,!0,l)}),t}function Lr(o){let t=o.split("/");if(t.length===0)return[];let[e,...s]=t,i=e.endsWith("?"),n=e.replace(/\?$/,"");if(s.length===0)return i?[n,""]:[n];let r=Lr(s.join("/")),a=[];return a.push(...r.map(l=>l===""?n:[n,l].join("/"))),i&&a.push(...r),a.map(l=>o.startsWith("/")&&l===""?"/":l)}function Zo(o){o.sort((t,e)=>t.score!==e.score?e.score-t.score:ol(t.routesMeta.map(s=>s.childrenIndex),e.routesMeta.map(s=>s.childrenIndex)))}var tl=/^:[\w-]+$/,el=3,sl=2,il=1,nl=10,rl=-2,En=o=>o==="*";function al(o,t){let e=o.split("/"),s=e.length;return e.some(En)&&(s+=rl),t&&(s+=sl),e.filter(i=>!En(i)).reduce((i,n)=>i+(tl.test(n)?el:n===""?il:nl),s)}function ol(o,t){return o.length===t.length&&o.slice(0,-1).every((s,i)=>s===t[i])?o[o.length-1]-t[t.length-1]:0}function ll(o,t,e=!1){let{routesMeta:s}=o,i={},n="/",r=[];for(let a=0;a<s.length;++a){let l=s[a],c=a===s.length-1,h=n==="/"?t:t.slice(n.length)||"/",d=ks({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},h),f=l.route;if(!d&&c&&e&&!s[s.length-1].route.index&&(d=ks({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},h)),!d)return null;Object.assign(i,d.params),r.push({params:i,pathname:se([n,d.pathname]),pathnameBase:pl(se([n,d.pathnameBase])),route:f}),d.pathnameBase!=="/"&&(n=se([n,d.pathnameBase]))}return r}function ks(o,t){typeof o=="string"&&(o={path:o,caseSensitive:!1,end:!0});let[e,s]=cl(o.path,o.caseSensitive,o.end),i=t.match(e);if(!i)return null;let n=i[0],r=n.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:s.reduce((c,{paramName:h,isOptional:d},f)=>{if(h==="*"){let b=a[f]||"";r=n.slice(0,n.length-b.length).replace(/(.)\/+$/,"$1")}const p=a[f];return d&&!p?c[h]=void 0:c[h]=(p||"").replace(/%2F/g,"/"),c},{}),pathname:n,pathnameBase:r,pattern:o}}function cl(o,t=!1,e=!0){$t(o==="*"||!o.endsWith("*")||o.endsWith("/*"),`Route path "${o}" will be treated as if it were "${o.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${o.replace(/\*$/,"/*")}".`);let s=[],i="^"+o.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(r,a,l)=>(s.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return o.endsWith("*")?(s.push({paramName:"*"}),i+=o==="*"||o==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):e?i+="\\/*$":o!==""&&o!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),s]}function hl(o){try{return o.split("/").map(t=>decodeURIComponent(t).replace(/\//g,"%2F")).join("/")}catch(t){return $t(!1,`The URL path "${o}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${t}).`),o}}function ie(o,t){if(t==="/")return o;if(!o.toLowerCase().startsWith(t.toLowerCase()))return null;let e=t.endsWith("/")?t.length-1:t.length,s=o.charAt(e);return s&&s!=="/"?null:o.slice(e)||"/"}var dl=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function ul(o,t="/"){let{pathname:e,search:s="",hash:i=""}=typeof o=="string"?Ne(o):o,n;return e?(e=e.replace(/\/\/+/g,"/"),e.startsWith("/")?n=Cn(e.substring(1),"/"):n=Cn(e,t)):n=t,{pathname:n,search:gl(s),hash:ml(i)}}function Cn(o,t){let e=t.replace(/\/+$/,"").split("/");return o.split("/").forEach(i=>{i===".."?e.length>1&&e.pop():i!=="."&&e.push(i)}),e.length>1?e.join("/"):"/"}function si(o,t,e,s){return`Cannot include a '${o}' character in a manually specified \`to.${t}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${e}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function fl(o){return o.filter((t,e)=>e===0||t.route.path&&t.route.path.length>0)}function Bi(o){let t=fl(o);return t.map((e,s)=>s===t.length-1?e.pathname:e.pathnameBase)}function Ui(o,t,e,s=!1){let i;typeof o=="string"?i=Ne(o):(i={...o},et(!i.pathname||!i.pathname.includes("?"),si("?","pathname","search",i)),et(!i.pathname||!i.pathname.includes("#"),si("#","pathname","hash",i)),et(!i.search||!i.search.includes("#"),si("#","search","hash",i)));let n=o===""||i.pathname==="",r=n?"/":i.pathname,a;if(r==null)a=e;else{let d=t.length-1;if(!s&&r.startsWith("..")){let f=r.split("/");for(;f[0]==="..";)f.shift(),d-=1;i.pathname=f.join("/")}a=d>=0?t[d]:"/"}let l=ul(i,a),c=r&&r!=="/"&&r.endsWith("/"),h=(n||r===".")&&e.endsWith("/");return!l.pathname.endsWith("/")&&(c||h)&&(l.pathname+="/"),l}var se=o=>o.join("/").replace(/\/\/+/g,"/"),pl=o=>o.replace(/\/+$/,"").replace(/^\/*/,"/"),gl=o=>!o||o==="?"?"":o.startsWith("?")?o:"?"+o,ml=o=>!o||o==="#"?"":o.startsWith("#")?o:"#"+o,bl=class{constructor(o,t,e,s=!1){this.status=o,this.statusText=t||"",this.internal=s,e instanceof Error?(this.data=e.toString(),this.error=e):this.data=e}};function yl(o){return o!=null&&typeof o.status=="number"&&typeof o.statusText=="string"&&typeof o.internal=="boolean"&&"data"in o}function xl(o){return o.map(t=>t.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Ir=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Mr(o,t){let e=o;if(typeof e!="string"||!dl.test(e))return{absoluteURL:void 0,isExternal:!1,to:e};let s=e,i=!1;if(Ir)try{let n=new URL(window.location.href),r=e.startsWith("//")?new URL(n.protocol+e):new URL(e),a=ie(r.pathname,t);r.origin===n.origin&&a!=null?e=a+r.search+r.hash:i=!0}catch{$t(!1,`<Link to="${e}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:s,isExternal:i,to:e}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var jr=["POST","PUT","PATCH","DELETE"];new Set(jr);var wl=["GET",...jr];new Set(wl);var Le=S.createContext(null);Le.displayName="DataRouter";var Os=S.createContext(null);Os.displayName="DataRouterState";var vl=S.createContext(!1),Fr=S.createContext({isTransitioning:!1});Fr.displayName="ViewTransition";var Al=S.createContext(new Map);Al.displayName="Fetchers";var Sl=S.createContext(null);Sl.displayName="Await";var Mt=S.createContext(null);Mt.displayName="Navigation";var ns=S.createContext(null);ns.displayName="Location";var Wt=S.createContext({outlet:null,matches:[],isDataRoute:!1});Wt.displayName="Route";var Hi=S.createContext(null);Hi.displayName="RouteError";var Or="REACT_ROUTER_ERROR",El="REDIRECT",Cl="ROUTE_ERROR_RESPONSE";function Tl(o){if(o.startsWith(`${Or}:${El}:{`))try{let t=JSON.parse(o.slice(28));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.location=="string"&&typeof t.reloadDocument=="boolean"&&typeof t.replace=="boolean")return t}catch{}}function _l(o){if(o.startsWith(`${Or}:${Cl}:{`))try{let t=JSON.parse(o.slice(40));if(typeof t=="object"&&t&&typeof t.status=="number"&&typeof t.statusText=="string")return new bl(t.status,t.statusText,t.data)}catch{}}function kl(o,{relative:t}={}){et(Ie(),"useHref() may be used only in the context of a <Router> component.");let{basename:e,navigator:s}=S.useContext(Mt),{hash:i,pathname:n,search:r}=rs(o,{relative:t}),a=n;return e!=="/"&&(a=n==="/"?e:se([e,n])),s.createHref({pathname:a,search:r,hash:i})}function Ie(){return S.useContext(ns)!=null}function At(){return et(Ie(),"useLocation() may be used only in the context of a <Router> component."),S.useContext(ns).location}var Br="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Ur(o){S.useContext(Mt).static||S.useLayoutEffect(o)}function le(){let{isDataRoute:o}=S.useContext(Wt);return o?Hl():Pl()}function Pl(){et(Ie(),"useNavigate() may be used only in the context of a <Router> component.");let o=S.useContext(Le),{basename:t,navigator:e}=S.useContext(Mt),{matches:s}=S.useContext(Wt),{pathname:i}=At(),n=JSON.stringify(Bi(s)),r=S.useRef(!1);return Ur(()=>{r.current=!0}),S.useCallback((l,c={})=>{if($t(r.current,Br),!r.current)return;if(typeof l=="number"){e.go(l);return}let h=Ui(l,JSON.parse(n),i,c.relative==="path");o==null&&t!=="/"&&(h.pathname=h.pathname==="/"?t:se([t,h.pathname])),(c.replace?e.replace:e.push)(h,c.state,c)},[t,e,n,i,o])}S.createContext(null);function Hr(){let{matches:o}=S.useContext(Wt),t=o[o.length-1];return t?t.params:{}}function rs(o,{relative:t}={}){let{matches:e}=S.useContext(Wt),{pathname:s}=At(),i=JSON.stringify(Bi(e));return S.useMemo(()=>Ui(o,JSON.parse(i),s,t==="path"),[o,i,s,t])}function Rl(o,t){return $r(o,t)}function $r(o,t,e,s,i){et(Ie(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:n}=S.useContext(Mt),{matches:r}=S.useContext(Wt),a=r[r.length-1],l=a?a.params:{},c=a?a.pathname:"/",h=a?a.pathnameBase:"/",d=a&&a.route;{let x=d&&d.path||"";Wr(c,!d||x.endsWith("*")||x.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${x}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${x}"> to <Route path="${x==="/"?"*":`${x}/*`}">.`)}let f=At(),p;if(t){let x=typeof t=="string"?Ne(t):t;et(h==="/"||x.pathname?.startsWith(h),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${h}" but pathname "${x.pathname}" was given in the \`location\` prop.`),p=x}else p=f;let b=p.pathname||"/",g=b;if(h!=="/"){let x=h.replace(/^\//,"").split("/");g="/"+b.replace(/^\//,"").split("/").slice(x.length).join("/")}let m=Dr(o,{pathname:g});$t(d||m!=null,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),$t(m==null||m[m.length-1].route.element!==void 0||m[m.length-1].route.Component!==void 0||m[m.length-1].route.lazy!==void 0,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let y=Ml(m&&m.map(x=>Object.assign({},x,{params:Object.assign({},l,x.params),pathname:se([h,n.encodeLocation?n.encodeLocation(x.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:x.pathname]),pathnameBase:x.pathnameBase==="/"?h:se([h,n.encodeLocation?n.encodeLocation(x.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:x.pathnameBase])})),r,e,s,i);return t&&y?S.createElement(ns.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...p},navigationType:"POP"}},y):y}function Dl(){let o=Ul(),t=yl(o)?`${o.status} ${o.statusText}`:o instanceof Error?o.message:JSON.stringify(o),e=o instanceof Error?o.stack:null,s="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:s},n={padding:"2px 4px",backgroundColor:s},r=null;return console.error("Error handled by React Router default ErrorBoundary:",o),r=S.createElement(S.Fragment,null,S.createElement("p",null,"ðŸ’¿ Hey developer ðŸ‘‹"),S.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",S.createElement("code",{style:n},"ErrorBoundary")," or"," ",S.createElement("code",{style:n},"errorElement")," prop on your route.")),S.createElement(S.Fragment,null,S.createElement("h2",null,"Unexpected Application Error!"),S.createElement("h3",{style:{fontStyle:"italic"}},t),e?S.createElement("pre",{style:i},e):null,r)}var Nl=S.createElement(Dl,null),zr=class extends S.Component{constructor(o){super(o),this.state={location:o.location,revalidation:o.revalidation,error:o.error}}static getDerivedStateFromError(o){return{error:o}}static getDerivedStateFromProps(o,t){return t.location!==o.location||t.revalidation!=="idle"&&o.revalidation==="idle"?{error:o.error,location:o.location,revalidation:o.revalidation}:{error:o.error!==void 0?o.error:t.error,location:t.location,revalidation:o.revalidation||t.revalidation}}componentDidCatch(o,t){this.props.onError?this.props.onError(o,t):console.error("React Router caught the following error during render",o)}render(){let o=this.state.error;if(this.context&&typeof o=="object"&&o&&"digest"in o&&typeof o.digest=="string"){const e=_l(o.digest);e&&(o=e)}let t=o!==void 0?S.createElement(Wt.Provider,{value:this.props.routeContext},S.createElement(Hi.Provider,{value:o,children:this.props.component})):this.props.children;return this.context?S.createElement(Ll,{error:o},t):t}};zr.contextType=vl;var ii=new WeakMap;function Ll({children:o,error:t}){let{basename:e}=S.useContext(Mt);if(typeof t=="object"&&t&&"digest"in t&&typeof t.digest=="string"){let s=Tl(t.digest);if(s){let i=ii.get(t);if(i)throw i;let n=Mr(s.location,e);if(Ir&&!ii.get(t))if(n.isExternal||s.reloadDocument)window.location.href=n.absoluteURL||n.to;else{const r=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(n.to,{replace:s.replace}));throw ii.set(t,r),r}return S.createElement("meta",{httpEquiv:"refresh",content:`0;url=${n.absoluteURL||n.to}`})}}return o}function Il({routeContext:o,match:t,children:e}){let s=S.useContext(Le);return s&&s.static&&s.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=t.route.id),S.createElement(Wt.Provider,{value:o},e)}function Ml(o,t=[],e=null,s=null,i=null){if(o==null){if(!e)return null;if(e.errors)o=e.matches;else if(t.length===0&&!e.initialized&&e.matches.length>0)o=e.matches;else return null}let n=o,r=e?.errors;if(r!=null){let h=n.findIndex(d=>d.route.id&&r?.[d.route.id]!==void 0);et(h>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(r).join(",")}`),n=n.slice(0,Math.min(n.length,h+1))}let a=!1,l=-1;if(e)for(let h=0;h<n.length;h++){let d=n[h];if((d.route.HydrateFallback||d.route.hydrateFallbackElement)&&(l=h),d.route.id){let{loaderData:f,errors:p}=e,b=d.route.loader&&!f.hasOwnProperty(d.route.id)&&(!p||p[d.route.id]===void 0);if(d.route.lazy||b){a=!0,l>=0?n=n.slice(0,l+1):n=[n[0]];break}}}let c=e&&s?(h,d)=>{s(h,{location:e.location,params:e.matches?.[0]?.params??{},unstable_pattern:xl(e.matches),errorInfo:d})}:void 0;return n.reduceRight((h,d,f)=>{let p,b=!1,g=null,m=null;e&&(p=r&&d.route.id?r[d.route.id]:void 0,g=d.route.errorElement||Nl,a&&(l<0&&f===0?(Wr("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),b=!0,m=null):l===f&&(b=!0,m=d.route.hydrateFallbackElement||null)));let y=t.concat(n.slice(0,f+1)),x=()=>{let w;return p?w=g:b?w=m:d.route.Component?w=S.createElement(d.route.Component,null):d.route.element?w=d.route.element:w=h,S.createElement(Il,{match:d,routeContext:{outlet:h,matches:y,isDataRoute:e!=null},children:w})};return e&&(d.route.ErrorBoundary||d.route.errorElement||f===0)?S.createElement(zr,{location:e.location,revalidation:e.revalidation,component:g,error:p,children:x(),routeContext:{outlet:null,matches:y,isDataRoute:!0},onError:c}):x()},null)}function $i(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function jl(o){let t=S.useContext(Le);return et(t,$i(o)),t}function Fl(o){let t=S.useContext(Os);return et(t,$i(o)),t}function Ol(o){let t=S.useContext(Wt);return et(t,$i(o)),t}function zi(o){let t=Ol(o),e=t.matches[t.matches.length-1];return et(e.route.id,`${o} can only be used on routes that contain a unique "id"`),e.route.id}function Bl(){return zi("useRouteId")}function Ul(){let o=S.useContext(Hi),t=Fl("useRouteError"),e=zi("useRouteError");return o!==void 0?o:t.errors?.[e]}function Hl(){let{router:o}=jl("useNavigate"),t=zi("useNavigate"),e=S.useRef(!1);return Ur(()=>{e.current=!0}),S.useCallback(async(i,n={})=>{$t(e.current,Br),e.current&&(typeof i=="number"?await o.navigate(i):await o.navigate(i,{fromRouteId:t,...n}))},[o,t])}var Tn={};function Wr(o,t,e){!t&&!Tn[o]&&(Tn[o]=!0,$t(!1,e))}S.memo($l);function $l({routes:o,future:t,state:e,onError:s}){return $r(o,void 0,e,s,t)}function wi({to:o,replace:t,state:e,relative:s}){et(Ie(),"<Navigate> may be used only in the context of a <Router> component.");let{static:i}=S.useContext(Mt);$t(!i,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:n}=S.useContext(Wt),{pathname:r}=At(),a=le(),l=Ui(o,Bi(n),r,s==="path"),c=JSON.stringify(l);return S.useEffect(()=>{a(JSON.parse(c),{replace:t,state:e,relative:s})},[a,c,s,t,e]),null}function wt(o){et(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function zl({basename:o="/",children:t=null,location:e,navigationType:s="POP",navigator:i,static:n=!1,unstable_useTransitions:r}){et(!Ie(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=o.replace(/^\/*/,"/"),l=S.useMemo(()=>({basename:a,navigator:i,static:n,unstable_useTransitions:r,future:{}}),[a,i,n,r]);typeof e=="string"&&(e=Ne(e));let{pathname:c="/",search:h="",hash:d="",state:f=null,key:p="default"}=e,b=S.useMemo(()=>{let g=ie(c,a);return g==null?null:{location:{pathname:g,search:h,hash:d,state:f,key:p},navigationType:s}},[a,c,h,d,f,p,s]);return $t(b!=null,`<Router basename="${a}"> is not able to match the URL "${c}${h}${d}" because it does not start with the basename, so the <Router> won't render anything.`),b==null?null:S.createElement(Mt.Provider,{value:l},S.createElement(ns.Provider,{children:t,value:b}))}function Wl({children:o,location:t}){return Rl(vi(o),t)}function vi(o,t=[]){let e=[];return S.Children.forEach(o,(s,i)=>{if(!S.isValidElement(s))return;let n=[...t,i];if(s.type===S.Fragment){e.push.apply(e,vi(s.props.children,n));return}et(s.type===wt,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),et(!s.props.index||!s.props.children,"An index route cannot have child routes.");let r={id:s.props.id||n.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,middleware:s.props.middleware,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(r.children=vi(s.props.children,n)),e.push(r)}),e}var Cs="get",Ts="application/x-www-form-urlencoded";function Bs(o){return typeof HTMLElement<"u"&&o instanceof HTMLElement}function Gl(o){return Bs(o)&&o.tagName.toLowerCase()==="button"}function Vl(o){return Bs(o)&&o.tagName.toLowerCase()==="form"}function Xl(o){return Bs(o)&&o.tagName.toLowerCase()==="input"}function Yl(o){return!!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)}function ql(o,t){return o.button===0&&(!t||t==="_self")&&!Yl(o)}var gs=null;function Kl(){if(gs===null)try{new FormData(document.createElement("form"),0),gs=!1}catch{gs=!0}return gs}var Jl=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function ni(o){return o!=null&&!Jl.has(o)?($t(!1,`"${o}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${Ts}"`),null):o}function Ql(o,t){let e,s,i,n,r;if(Vl(o)){let a=o.getAttribute("action");s=a?ie(a,t):null,e=o.getAttribute("method")||Cs,i=ni(o.getAttribute("enctype"))||Ts,n=new FormData(o)}else if(Gl(o)||Xl(o)&&(o.type==="submit"||o.type==="image")){let a=o.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=o.getAttribute("formaction")||a.getAttribute("action");if(s=l?ie(l,t):null,e=o.getAttribute("formmethod")||a.getAttribute("method")||Cs,i=ni(o.getAttribute("formenctype"))||ni(a.getAttribute("enctype"))||Ts,n=new FormData(a,o),!Kl()){let{name:c,type:h,value:d}=o;if(h==="image"){let f=c?`${c}.`:"";n.append(`${f}x`,"0"),n.append(`${f}y`,"0")}else c&&n.append(c,d)}}else{if(Bs(o))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');e=Cs,s=null,i=Ts,r=o}return n&&i==="text/plain"&&(r=n,n=void 0),{action:s,method:e.toLowerCase(),encType:i,formData:n,body:r}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Wi(o,t){if(o===!1||o===null||typeof o>"u")throw new Error(t)}function Zl(o,t,e,s){let i=typeof o=="string"?new URL(o,typeof window>"u"?"server://singlefetch/":window.location.origin):o;return e?i.pathname.endsWith("/")?i.pathname=`${i.pathname}_.${s}`:i.pathname=`${i.pathname}.${s}`:i.pathname==="/"?i.pathname=`_root.${s}`:t&&ie(i.pathname,t)==="/"?i.pathname=`${t.replace(/\/$/,"")}/_root.${s}`:i.pathname=`${i.pathname.replace(/\/$/,"")}.${s}`,i}async function tc(o,t){if(o.id in t)return t[o.id];try{let e=await import(o.module);return t[o.id]=e,e}catch(e){return console.error(`Error loading route module \`${o.module}\`, reloading page...`),console.error(e),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function ec(o){return o==null?!1:o.href==null?o.rel==="preload"&&typeof o.imageSrcSet=="string"&&typeof o.imageSizes=="string":typeof o.rel=="string"&&typeof o.href=="string"}async function sc(o,t,e){let s=await Promise.all(o.map(async i=>{let n=t.routes[i.route.id];if(n){let r=await tc(n,e);return r.links?r.links():[]}return[]}));return ac(s.flat(1).filter(ec).filter(i=>i.rel==="stylesheet"||i.rel==="preload").map(i=>i.rel==="stylesheet"?{...i,rel:"prefetch",as:"style"}:{...i,rel:"prefetch"}))}function _n(o,t,e,s,i,n){let r=(l,c)=>e[c]?l.route.id!==e[c].route.id:!0,a=(l,c)=>e[c].pathname!==l.pathname||e[c].route.path?.endsWith("*")&&e[c].params["*"]!==l.params["*"];return n==="assets"?t.filter((l,c)=>r(l,c)||a(l,c)):n==="data"?t.filter((l,c)=>{let h=s.routes[l.route.id];if(!h||!h.hasLoader)return!1;if(r(l,c)||a(l,c))return!0;if(l.route.shouldRevalidate){let d=l.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:e[0]?.params||{},nextUrl:new URL(o,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof d=="boolean")return d}return!0}):[]}function ic(o,t,{includeHydrateFallback:e}={}){return nc(o.map(s=>{let i=t.routes[s.route.id];if(!i)return[];let n=[i.module];return i.clientActionModule&&(n=n.concat(i.clientActionModule)),i.clientLoaderModule&&(n=n.concat(i.clientLoaderModule)),e&&i.hydrateFallbackModule&&(n=n.concat(i.hydrateFallbackModule)),i.imports&&(n=n.concat(i.imports)),n}).flat(1))}function nc(o){return[...new Set(o)]}function rc(o){let t={},e=Object.keys(o).sort();for(let s of e)t[s]=o[s];return t}function ac(o,t){let e=new Set;return new Set(t),o.reduce((s,i)=>{let n=JSON.stringify(rc(i));return e.has(n)||(e.add(n),s.push({key:n,link:i})),s},[])}function Gr(){let o=S.useContext(Le);return Wi(o,"You must render this element inside a <DataRouterContext.Provider> element"),o}function oc(){let o=S.useContext(Os);return Wi(o,"You must render this element inside a <DataRouterStateContext.Provider> element"),o}var Gi=S.createContext(void 0);Gi.displayName="FrameworkContext";function Vr(){let o=S.useContext(Gi);return Wi(o,"You must render this element inside a <HydratedRouter> element"),o}function lc(o,t){let e=S.useContext(Gi),[s,i]=S.useState(!1),[n,r]=S.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:c,onMouseLeave:h,onTouchStart:d}=t,f=S.useRef(null);S.useEffect(()=>{if(o==="render"&&r(!0),o==="viewport"){let g=y=>{y.forEach(x=>{r(x.isIntersecting)})},m=new IntersectionObserver(g,{threshold:.5});return f.current&&m.observe(f.current),()=>{m.disconnect()}}},[o]),S.useEffect(()=>{if(s){let g=setTimeout(()=>{r(!0)},100);return()=>{clearTimeout(g)}}},[s]);let p=()=>{i(!0)},b=()=>{i(!1),r(!1)};return e?o!=="intent"?[n,f,{}]:[n,f,{onFocus:Ue(a,p),onBlur:Ue(l,b),onMouseEnter:Ue(c,p),onMouseLeave:Ue(h,b),onTouchStart:Ue(d,p)}]:[!1,f,{}]}function Ue(o,t){return e=>{o&&o(e),e.defaultPrevented||t(e)}}function cc({page:o,...t}){let{router:e}=Gr(),s=S.useMemo(()=>Dr(e.routes,o,e.basename),[e.routes,o,e.basename]);return s?S.createElement(dc,{page:o,matches:s,...t}):null}function hc(o){let{manifest:t,routeModules:e}=Vr(),[s,i]=S.useState([]);return S.useEffect(()=>{let n=!1;return sc(o,t,e).then(r=>{n||i(r)}),()=>{n=!0}},[o,t,e]),s}function dc({page:o,matches:t,...e}){let s=At(),{future:i,manifest:n,routeModules:r}=Vr(),{basename:a}=Gr(),{loaderData:l,matches:c}=oc(),h=S.useMemo(()=>_n(o,t,c,n,s,"data"),[o,t,c,n,s]),d=S.useMemo(()=>_n(o,t,c,n,s,"assets"),[o,t,c,n,s]),f=S.useMemo(()=>{if(o===s.pathname+s.search+s.hash)return[];let g=new Set,m=!1;if(t.forEach(x=>{let w=n.routes[x.route.id];!w||!w.hasLoader||(!h.some(v=>v.route.id===x.route.id)&&x.route.id in l&&r[x.route.id]?.shouldRevalidate||w.hasClientLoader?m=!0:g.add(x.route.id))}),g.size===0)return[];let y=Zl(o,a,i.unstable_trailingSlashAwareDataRequests,"data");return m&&g.size>0&&y.searchParams.set("_routes",t.filter(x=>g.has(x.route.id)).map(x=>x.route.id).join(",")),[y.pathname+y.search]},[a,i.unstable_trailingSlashAwareDataRequests,l,s,n,h,t,o,r]),p=S.useMemo(()=>ic(d,n),[d,n]),b=hc(d);return S.createElement(S.Fragment,null,f.map(g=>S.createElement("link",{key:g,rel:"prefetch",as:"fetch",href:g,...e})),p.map(g=>S.createElement("link",{key:g,rel:"modulepreload",href:g,...e})),b.map(({key:g,link:m})=>S.createElement("link",{key:g,nonce:e.nonce,...m,crossOrigin:m.crossOrigin??e.crossOrigin})))}function uc(...o){return t=>{o.forEach(e=>{typeof e=="function"?e(t):e!=null&&(e.current=t)})}}var fc=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{fc&&(window.__reactRouterVersion="7.13.0")}catch{}function pc({basename:o,children:t,unstable_useTransitions:e,window:s}){let i=S.useRef();i.current==null&&(i.current=Yo({window:s,v5Compat:!0}));let n=i.current,[r,a]=S.useState({action:n.action,location:n.location}),l=S.useCallback(c=>{e===!1?a(c):S.startTransition(()=>a(c))},[e]);return S.useLayoutEffect(()=>n.listen(l),[n,l]),S.createElement(zl,{basename:o,children:t,location:r.location,navigationType:r.action,navigator:n,unstable_useTransitions:e})}var Xr=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ht=S.forwardRef(function({onClick:t,discover:e="render",prefetch:s="none",relative:i,reloadDocument:n,replace:r,state:a,target:l,to:c,preventScrollReset:h,viewTransition:d,unstable_defaultShouldRevalidate:f,...p},b){let{basename:g,unstable_useTransitions:m}=S.useContext(Mt),y=typeof c=="string"&&Xr.test(c),x=Mr(c,g);c=x.to;let w=kl(c,{relative:i}),[v,A,E]=lc(s,p),C=yc(c,{replace:r,state:a,target:l,preventScrollReset:h,relative:i,viewTransition:d,unstable_defaultShouldRevalidate:f,unstable_useTransitions:m});function P(_){t&&t(_),_.defaultPrevented||C(_)}let T=S.createElement("a",{...p,...E,href:x.absoluteURL||w,onClick:x.isExternal||n?t:P,ref:uc(b,A),target:l,"data-discover":!y&&e==="render"?"true":void 0});return v&&!y?S.createElement(S.Fragment,null,T,S.createElement(cc,{page:w})):T});ht.displayName="Link";var gc=S.forwardRef(function({"aria-current":t="page",caseSensitive:e=!1,className:s="",end:i=!1,style:n,to:r,viewTransition:a,children:l,...c},h){let d=rs(r,{relative:c.relative}),f=At(),p=S.useContext(Os),{navigator:b,basename:g}=S.useContext(Mt),m=p!=null&&Sc(d)&&a===!0,y=b.encodeLocation?b.encodeLocation(d).pathname:d.pathname,x=f.pathname,w=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;e||(x=x.toLowerCase(),w=w?w.toLowerCase():null,y=y.toLowerCase()),w&&g&&(w=ie(w,g)||w);const v=y!=="/"&&y.endsWith("/")?y.length-1:y.length;let A=x===y||!i&&x.startsWith(y)&&x.charAt(v)==="/",E=w!=null&&(w===y||!i&&w.startsWith(y)&&w.charAt(y.length)==="/"),C={isActive:A,isPending:E,isTransitioning:m},P=A?t:void 0,T;typeof s=="function"?T=s(C):T=[s,A?"active":null,E?"pending":null,m?"transitioning":null].filter(Boolean).join(" ");let _=typeof n=="function"?n(C):n;return S.createElement(ht,{...c,"aria-current":P,className:T,ref:h,style:_,to:r,viewTransition:a},typeof l=="function"?l(C):l)});gc.displayName="NavLink";var mc=S.forwardRef(({discover:o="render",fetcherKey:t,navigate:e,reloadDocument:s,replace:i,state:n,method:r=Cs,action:a,onSubmit:l,relative:c,preventScrollReset:h,viewTransition:d,unstable_defaultShouldRevalidate:f,...p},b)=>{let{unstable_useTransitions:g}=S.useContext(Mt),m=vc(),y=Ac(a,{relative:c}),x=r.toLowerCase()==="get"?"get":"post",w=typeof a=="string"&&Xr.test(a),v=A=>{if(l&&l(A),A.defaultPrevented)return;A.preventDefault();let E=A.nativeEvent.submitter,C=E?.getAttribute("formmethod")||r,P=()=>m(E||A.currentTarget,{fetcherKey:t,method:C,navigate:e,replace:i,state:n,relative:c,preventScrollReset:h,viewTransition:d,unstable_defaultShouldRevalidate:f});g&&e!==!1?S.startTransition(()=>P()):P()};return S.createElement("form",{ref:b,method:x,action:y,onSubmit:s?l:v,...p,"data-discover":!w&&o==="render"?"true":void 0})});mc.displayName="Form";function bc(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Yr(o){let t=S.useContext(Le);return et(t,bc(o)),t}function yc(o,{target:t,replace:e,state:s,preventScrollReset:i,relative:n,viewTransition:r,unstable_defaultShouldRevalidate:a,unstable_useTransitions:l}={}){let c=le(),h=At(),d=rs(o,{relative:n});return S.useCallback(f=>{if(ql(f,t)){f.preventDefault();let p=e!==void 0?e:Qe(h)===Qe(d),b=()=>c(o,{replace:p,state:s,preventScrollReset:i,relative:n,viewTransition:r,unstable_defaultShouldRevalidate:a});l?S.startTransition(()=>b()):b()}},[h,c,d,e,s,t,o,i,n,r,a,l])}var xc=0,wc=()=>`__${String(++xc)}__`;function vc(){let{router:o}=Yr("useSubmit"),{basename:t}=S.useContext(Mt),e=Bl(),s=o.fetch,i=o.navigate;return S.useCallback(async(n,r={})=>{let{action:a,method:l,encType:c,formData:h,body:d}=Ql(n,t);if(r.navigate===!1){let f=r.fetcherKey||wc();await s(f,e,r.action||a,{unstable_defaultShouldRevalidate:r.unstable_defaultShouldRevalidate,preventScrollReset:r.preventScrollReset,formData:h,body:d,formMethod:r.method||l,formEncType:r.encType||c,flushSync:r.flushSync})}else await i(r.action||a,{unstable_defaultShouldRevalidate:r.unstable_defaultShouldRevalidate,preventScrollReset:r.preventScrollReset,formData:h,body:d,formMethod:r.method||l,formEncType:r.encType||c,replace:r.replace,state:r.state,fromRouteId:e,flushSync:r.flushSync,viewTransition:r.viewTransition})},[s,i,t,e])}function Ac(o,{relative:t}={}){let{basename:e}=S.useContext(Mt),s=S.useContext(Wt);et(s,"useFormAction must be used inside a RouteContext");let[i]=s.matches.slice(-1),n={...rs(o||".",{relative:t})},r=At();if(o==null){n.search=r.search;let a=new URLSearchParams(n.search),l=a.getAll("index");if(l.some(h=>h==="")){a.delete("index"),l.filter(d=>d).forEach(d=>a.append("index",d));let h=a.toString();n.search=h?`?${h}`:""}}return(!o||o===".")&&i.route.index&&(n.search=n.search?n.search.replace(/^\?/,"?index&"):"?index"),e!=="/"&&(n.pathname=n.pathname==="/"?e:se([e,n.pathname])),Qe(n)}function Sc(o,{relative:t}={}){let e=S.useContext(Fr);et(e!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=Yr("useViewTransitionState"),i=rs(o,{relative:t});if(!e.isTransitioning)return!1;let n=ie(e.currentLocation.pathname,s)||e.currentLocation.pathname,r=ie(e.nextLocation.pathname,s)||e.nextLocation.pathname;return ks(i.pathname,r)!=null||ks(i.pathname,n)!=null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ec="type.googleapis.com/google.protobuf.Int64Value",Cc="type.googleapis.com/google.protobuf.UInt64Value";function qr(o,t){const e={};for(const s in o)o.hasOwnProperty(s)&&(e[s]=t(o[s]));return e}function Ps(o){if(o==null)return null;if(o instanceof Number&&(o=o.valueOf()),typeof o=="number"&&isFinite(o)||o===!0||o===!1||Object.prototype.toString.call(o)==="[object String]")return o;if(o instanceof Date)return o.toISOString();if(Array.isArray(o))return o.map(t=>Ps(t));if(typeof o=="function"||typeof o=="object")return qr(o,t=>Ps(t));throw new Error("Data cannot be encoded in JSON: "+o)}function Re(o){if(o==null)return o;if(o["@type"])switch(o["@type"]){case Ec:case Cc:{const t=Number(o.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+o);return t}default:throw new Error("Data cannot be decoded from JSON: "+o)}return Array.isArray(o)?o.map(t=>Re(t)):typeof o=="function"||typeof o=="object"?qr(o,t=>Re(t)):o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vi="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kn={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Et extends Io{constructor(t,e,s){super(`${Vi}/${t}`,e||""),this.details=s,Object.setPrototypeOf(this,Et.prototype)}}function Tc(o){if(o>=200&&o<300)return"ok";switch(o){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function Rs(o,t){let e=Tc(o),s=e,i;try{const n=t&&t.error;if(n){const r=n.status;if(typeof r=="string"){if(!kn[r])return new Et("internal","internal");e=kn[r],s=r}const a=n.message;typeof a=="string"&&(s=a),i=n.details,i!==void 0&&(i=Re(i))}}catch{}return e==="ok"?null:new Et(e,s,i)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _c{constructor(t,e,s,i){this.app=t,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,Lo(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.auth=e.getImmediate({optional:!0}),this.messaging=s.getImmediate({optional:!0}),this.auth||e.get().then(n=>this.auth=n,()=>{}),this.messaging||s.get().then(n=>this.messaging=n,()=>{}),this.appCheck||i?.get().then(n=>this.appCheck=n,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(t){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const e=t?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return e.error?null:e.token}return null}async getContext(t){const e=await this.getAuthToken(),s=await this.getMessagingToken(),i=await this.getAppCheckToken(t);return{authToken:e,messagingToken:s,appCheckToken:i}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ai="us-central1",kc=/^data: (.*?)(?:\n|$)/;function Pc(o){let t=null;return{promise:new Promise((e,s)=>{t=setTimeout(()=>{s(new Et("deadline-exceeded","deadline-exceeded"))},o)}),cancel:()=>{t&&clearTimeout(t)}}}class Rc{constructor(t,e,s,i,n=Ai,r=(...a)=>fetch(...a)){this.app=t,this.fetchImpl=r,this.emulatorOrigin=null,this.contextProvider=new _c(t,e,s,i),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{const a=new URL(n);this.customDomain=a.origin+(a.pathname==="/"?"":a.pathname),this.region=Ai}catch{this.customDomain=null,this.region=n}}_delete(){return this.deleteService()}_url(t){const e=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${e}/${this.region}/${t}`:this.customDomain!==null?`${this.customDomain}/${t}`:`https://${this.region}-${e}.cloudfunctions.net/${t}`}}function Dc(o,t,e){const s=Cr(t);o.emulatorOrigin=`http${s?"s":""}://${t}:${e}`,s&&(Oo(o.emulatorOrigin+"/backends"),Bo("Functions",!0))}function Nc(o,t,e){const s=i=>Mc(o,t,i,e||{});return s.stream=(i,n)=>jc(o,t,i,n),s}function Lc(o,t,e){const s=i=>Qr(o,t,i,e||{});return s.stream=(i,n)=>Zr(o,t,i,n||{}),s}function Kr(o){return o.emulatorOrigin&&Cr(o.emulatorOrigin)?"include":void 0}async function Ic(o,t,e,s,i){e["Content-Type"]="application/json";let n;try{n=await s(o,{method:"POST",body:JSON.stringify(t),headers:e,credentials:Kr(i)})}catch{return{status:0,json:null}}let r=null;try{r=await n.json()}catch{}return{status:n.status,json:r}}async function Jr(o,t){const e={},s=await o.contextProvider.getContext(t.limitedUseAppCheckTokens);return s.authToken&&(e.Authorization="Bearer "+s.authToken),s.messagingToken&&(e["Firebase-Instance-ID-Token"]=s.messagingToken),s.appCheckToken!==null&&(e["X-Firebase-AppCheck"]=s.appCheckToken),e}function Mc(o,t,e,s){const i=o._url(t);return Qr(o,i,e,s)}async function Qr(o,t,e,s){e=Ps(e);const i={data:e},n=await Jr(o,s),r=s.timeout||7e4,a=Pc(r),l=await Promise.race([Ic(t,i,n,o.fetchImpl,o),a.promise,o.cancelAllRequests]);if(a.cancel(),!l)throw new Et("cancelled","Firebase Functions instance was deleted.");const c=Rs(l.status,l.json);if(c)throw c;if(!l.json)throw new Et("internal","Response is not valid JSON object.");let h=l.json.data;if(typeof h>"u"&&(h=l.json.result),typeof h>"u")throw new Et("internal","Response is missing data field.");return{data:Re(h)}}function jc(o,t,e,s){const i=o._url(t);return Zr(o,i,e,s||{})}async function Zr(o,t,e,s){e=Ps(e);const i={data:e},n=await Jr(o,s);n["Content-Type"]="application/json",n.Accept="text/event-stream";let r;try{r=await o.fetchImpl(t,{method:"POST",body:JSON.stringify(i),headers:n,signal:s?.signal,credentials:Kr(o)})}catch(f){if(f instanceof Error&&f.name==="AbortError"){const b=new Et("cancelled","Request was cancelled.");return{data:Promise.reject(b),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(b)}}}}}}const p=Rs(0,null);return{data:Promise.reject(p),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(p)}}}}}}let a,l;const c=new Promise((f,p)=>{a=f,l=p});s?.signal?.addEventListener("abort",()=>{const f=new Et("cancelled","Request was cancelled.");l(f)});const h=r.body.getReader(),d=Fc(h,a,l,s?.signal);return{stream:{[Symbol.asyncIterator](){const f=d.getReader();return{async next(){const{value:p,done:b}=await f.read();return{value:p,done:b}},async return(){return await f.cancel(),{done:!0,value:void 0}}}}},data:c}}function Fc(o,t,e,s){const i=(r,a)=>{const l=r.match(kc);if(!l)return;const c=l[1];try{const h=JSON.parse(c);if("result"in h){t(Re(h.result));return}if("message"in h){a.enqueue(Re(h.message));return}if("error"in h){const d=Rs(0,h);a.error(d),e(d);return}}catch(h){if(h instanceof Et){a.error(h),e(h);return}}},n=new TextDecoder;return new ReadableStream({start(r){let a="";return l();async function l(){if(s?.aborted){const c=new Et("cancelled","Request was cancelled");return r.error(c),e(c),Promise.resolve()}try{const{value:c,done:h}=await o.read();if(h){a.trim()&&i(a.trim(),r),r.close();return}if(s?.aborted){const f=new Et("cancelled","Request was cancelled");r.error(f),e(f),await o.cancel();return}a+=n.decode(c,{stream:!0});const d=a.split(`
`);a=d.pop()||"";for(const f of d)f.trim()&&i(f.trim(),r);return l()}catch(c){const h=c instanceof Et?c:Rs(0,null);r.error(h),e(h)}}},cancel(){return o.cancel()}})}const Pn="@firebase/functions",Rn="0.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Oc="auth-internal",Bc="app-check-internal",Uc="messaging-internal";function Hc(o){const t=(e,{instanceIdentifier:s})=>{const i=e.getProvider("app").getImmediate(),n=e.getProvider(Oc),r=e.getProvider(Uc),a=e.getProvider(Bc);return new Rc(i,n,r,a,s)};Do(new No(Vi,t,"PUBLIC").setMultipleInstances(!0)),wn(Pn,Rn,o),wn(Pn,Rn,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ta(o=Fo(),t=Ai){const s=Mo(Fs(o),Vi).getImmediate({identifier:t}),i=jo("functions");return i&&ea(s,...i),s}function ea(o,t,e){Dc(Fs(o),t,e)}function Ut(o,t,e){return Nc(Fs(o),t,e)}function $c(o,t,e){return Lc(Fs(o),t,e)}Hc();const sa=Object.freeze(Object.defineProperty({__proto__:null,FunctionsError:Et,connectFunctionsEmulator:ea,getFunctions:ta,httpsCallable:Ut,httpsCallableFromURL:$c},Symbol.toStringTag,{value:"Module"})),zc=({children:o})=>(S.useEffect(()=>{Tr()},[]),o),ce=()=>{const o=ei(Uo),t=ei(Ho),e=ei($o);return S.useEffect(()=>{Tr()},[]),{authState:o,app:t,auth:e,...zo}},ri={product:[{label:"How it works",href:"#how-it-works"},{label:"Use cases",href:"#use-cases"},{label:"Pricing",href:"/pricing"},{label:"Open viewer",href:"/view"}],company:[{label:"About",href:"/about"},{label:"Contact",href:"/contact"}],legal:[{label:"Privacy",href:"/privacy"},{label:"Terms",href:"/terms"}]},Wc="0.1.0+be9dd71-2026-02-16T12:17:25.675Z",ai=({href:o,children:t})=>{const e=typeof o=="string"&&/^https?:\/\//.test(o),s=typeof o=="string"&&o.startsWith("#");return e?u.jsx("a",{className:"text-slate-600 no-underline hover:text-slate-900 hover:underline",href:o,children:t}):s?u.jsx(ht,{className:"text-slate-600 no-underline hover:text-slate-900 hover:underline",to:{pathname:"/",hash:o},children:t}):u.jsx(ht,{className:"text-slate-600 no-underline hover:text-slate-900 hover:underline",to:o,children:t})},Gc=()=>{const t=At().pathname==="/";return u.jsx("footer",{className:"border-t border-slate-200 bg-white px-6 py-12",children:u.jsxs("div",{className:"mx-auto grid w-full max-w-6xl gap-10 md:grid-cols-[1.2fr_0.8fr_0.8fr_0.8fr]",children:[u.jsxs("div",{className:"flex flex-col gap-4",children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("img",{src:pr,alt:"DecoDocs",className:"h-10 w-10"}),u.jsxs("div",{children:[u.jsx("p",{className:"text-base font-semibold text-slate-900",children:"DecoDocs"}),u.jsx("p",{className:"text-xs text-slate-500",children:"Understand documents before you sign"})]})]}),u.jsx("p",{className:"text-sm text-slate-600",children:"Privacy-first document understanding by Snap Sign Pty Ltd."}),u.jsxs("p",{className:"text-xs text-slate-500",children:["Â© ",new Date().getFullYear()," Snap Sign Pty Ltd. All rights reserved."]}),u.jsxs("p",{className:"text-xs text-slate-400",children:["Version: ",Wc]})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Product"}),u.jsx("ul",{className:"mt-4 space-y-3 text-sm text-slate-600 list-none p-0 m-0",children:ri.product.map(e=>u.jsx("li",{className:"m-0",children:t&&typeof e.href=="string"&&e.href.startsWith("#")?u.jsx("a",{className:"text-slate-600 no-underline hover:text-slate-900 hover:underline",href:e.href,children:e.label}):u.jsx(ai,{href:e.href,children:e.label})},e.label))})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Company"}),u.jsx("ul",{className:"mt-4 space-y-3 text-sm text-slate-600 list-none p-0 m-0",children:ri.company.map(e=>u.jsx("li",{className:"m-0",children:u.jsx(ai,{href:e.href,children:e.label})},e.label))})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Legal"}),u.jsx("ul",{className:"mt-4 space-y-3 text-sm text-slate-600 list-none p-0 m-0",children:ri.legal.map(e=>u.jsx("li",{className:"m-0",children:u.jsx(ai,{href:e.href,children:e.label})},e.label))})]})]})})},Dn={primary:"bg-slate-900 text-white border border-transparent hover:bg-slate-800 shadow-lg shadow-slate-900/20",secondary:"bg-white text-slate-900 border border-slate-200 hover:bg-slate-50 shadow-sm",outline:"bg-transparent text-slate-600 border border-slate-200 hover:border-slate-300 hover:text-slate-900",ghost:"bg-transparent text-slate-600 border border-transparent hover:bg-slate-100 hover:text-slate-900"},Nn={sm:"px-4 py-2 text-sm",md:"px-6 py-3 text-sm",lg:"px-8 py-4 text-base"},Vc=({variant:o="primary",size:t="md",className:e="",href:s,to:i,onClick:n,children:r,type:a="button",...l})=>{const c="inline-flex items-center justify-center font-bold rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none",h=Dn[o]||Dn.primary,d=Nn[t]||Nn.md,f=`${c} ${h} ${d} ${e}`;return i?u.jsx(ht,{to:i,className:f,...l,children:r}):s?u.jsx("a",{href:s,className:f,...l,children:r}):u.jsx("button",{type:a,onClick:n,className:f,...l,children:r})},Ln=[{label:"How it works",href:"#how-it-works"},{label:"Features",href:"#features"},{label:"Use cases",href:"#use-cases"},{label:"Pricing",to:"/pricing"}],Xc=({variant:o="marketing",onOpenPdf:t,children:e})=>{const s=At(),{authState:i}=ce(),[n,r]=S.useState(!1),a=o==="app",l=s.pathname==="/"||s.pathname==="/app",c=s.pathname==="/sign-in"||s.pathname==="/sign-up",h=i?.status==="authenticated";S.useEffect(()=>{r(!1)},[s.pathname,s.hash]);const d=c?s.pathname==="/sign-in"?{label:"Sign Up",to:"/sign-up"}:{label:"Sign In",to:"/sign-in"}:t?{label:"Open PDF",onClick:t}:h?{label:"Profile",to:"/profile"}:{label:"Sign In",to:"/sign-in"},f=c?null:t?h?{label:"Profile",to:"/profile",variant:"outline"}:{label:"Sign In",to:"/sign-in",variant:"outline"}:null,p=()=>r(y=>!y),b=()=>r(!1),g=y=>{const x="hover:text-slate-900 transition-colors no-underline text-slate-600";return y.href&&y.href.startsWith("#")?l?u.jsx("a",{className:x,href:y.href,onClick:b,children:y.label}):u.jsx(ht,{className:x,to:{pathname:"/",hash:y.href},onClick:b,children:y.label}):u.jsx(ht,{className:x,to:y.to,onClick:b,children:y.label})},m=(y,x="")=>{if(!y)return null;const{label:w,to:v,onClick:A,variant:E="primary"}=y,C=A?()=>{b(),A()}:void 0;return u.jsx(Vc,{variant:E,size:"sm",to:v,onClick:C,className:x,children:w})};return u.jsxs("header",{className:"sticky top-0 z-30 w-full border-b border-white/40 bg-white/70 backdrop-blur-xl",children:[u.jsxs("div",{className:`mx-auto flex w-full items-center justify-between px-6 ${a?"h-14 py-2":"max-w-6xl py-4"}`,children:[u.jsxs(ht,{to:"/",className:"flex items-center gap-3 text-lg font-bold tracking-tight text-slate-900 no-underline",children:[u.jsx("img",{src:pr,alt:"DecoDocs",className:"h-9 w-9"}),!a&&"DecoDocs"]}),!a&&u.jsx("nav",{className:"hidden items-center gap-8 text-sm font-semibold text-slate-600 md:flex",children:Ln.map(y=>u.jsx("span",{children:g(y)},y.label))}),u.jsxs("div",{className:"flex items-center gap-3",children:[!a&&u.jsxs("div",{className:"hidden items-center gap-3 md:flex",children:[m(f,"bg-white/50"),m(d)]}),a&&u.jsxs("div",{id:"header-app-actions",className:"flex items-center gap-2",children:[u.jsxs(ht,{to:"/pricing",className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-bold text-amber-700 bg-amber-50 hover:bg-amber-100 rounded-full transition-colors no-underline border border-amber-200/60",children:[u.jsx(gr,{className:"w-3.5 h-3.5"}),"Upgrade"]}),u.jsx(ht,{to:"/profile",className:"flex items-center justify-center w-8 h-8 rounded-full bg-slate-100 hover:bg-slate-200 transition-colors border border-slate-200/60",title:i?.user?.email||"Profile",children:i?.user?.photoURL?u.jsx("img",{src:i.user.photoURL,alt:"",className:"w-8 h-8 rounded-full object-cover"}):u.jsx(mo,{className:"w-4 h-4 text-slate-500"})})]}),!a&&u.jsxs("button",{type:"button",className:"inline-flex items-center justify-center rounded-full border border-slate-200 bg-white/80 p-2 text-slate-700 shadow-sm transition hover:border-slate-300 md:hidden","aria-expanded":n,"aria-controls":"site-mobile-menu",onClick:p,children:[u.jsx("span",{className:"sr-only",children:"Toggle menu"}),n?u.jsxs("svg",{"aria-hidden":"true",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:[u.jsx("path",{d:"M5 5L15 15",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round"}),u.jsx("path",{d:"M15 5L5 15",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round"})]}):u.jsxs("svg",{"aria-hidden":"true",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:[u.jsx("path",{d:"M3 5H17",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round"}),u.jsx("path",{d:"M3 10H17",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round"}),u.jsx("path",{d:"M3 15H17",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round"})]})]})]})]}),!a&&u.jsx("div",{id:"site-mobile-menu",className:`md:hidden ${n?"block":"hidden"}`,children:u.jsxs("div",{className:"px-6 pb-4 pt-2",children:[u.jsx("div",{className:"flex flex-col gap-3 text-sm font-semibold text-slate-700",children:Ln.map(y=>u.jsx("span",{children:g(y)},y.label))}),u.jsxs("div",{className:"mt-4 flex flex-col gap-3",children:[m(f,"w-full justify-center bg-white/60"),m(d,"w-full justify-center")]})]})}),e]})},Ht=({children:o,showHeader:t=!1,showFooter:e=!0,variant:s="marketing"})=>{const i=s==="app";return u.jsxs("div",{className:`min-h-screen bg-[#f7f6f2] text-slate-900 flex flex-col ${i?"h-screen overflow-hidden":""}`,children:[t&&u.jsx(Xc,{variant:s}),u.jsx("main",{className:"flex-1 flex flex-col min-h-0",children:o}),e?u.jsx(Gc,{}):null]})},ia=({onFileSelect:o,onEdit:t,pageNumber:e,numPages:s,pageScale:i,onPreviousPage:n,onNextPage:r,onZoomIn:a,onZoomOut:l,fileInputRef:c})=>u.jsxs("div",{id:"viewer-page-controls",className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-2 bg-slate-800/85 backdrop-blur-md px-3 py-1.5 rounded-full shadow-lg border border-white/10 z-30 text-white text-xs",children:[u.jsx("button",{onClick:()=>c.current?.click(),className:"p-1 bg-transparent text-slate-300 hover:text-white hover:bg-white/10 rounded-full transition-colors",title:"Open PDF",children:u.jsx(mr,{className:"w-3.5 h-3.5"})}),u.jsx("div",{className:"w-px h-3.5 bg-white/20"}),u.jsx("button",{onClick:n,disabled:e<=1,className:"p-0.5 bg-transparent rounded-full hover:bg-white/10 disabled:opacity-30 transition-colors text-white",children:u.jsx(br,{className:"w-3.5 h-3.5"})}),u.jsxs("span",{className:"font-medium text-white min-w-[3ch] text-center select-none tabular-nums",children:[e," ",u.jsxs("span",{className:"text-slate-400",children:["/ ",s||"-"]})]}),u.jsx("button",{onClick:r,disabled:e>=s,className:"p-0.5 bg-transparent rounded-full hover:bg-white/10 disabled:opacity-30 transition-colors text-white",children:u.jsx(yr,{className:"w-3.5 h-3.5"})}),u.jsx("div",{className:"w-px h-3.5 bg-white/20"}),u.jsx("button",{onClick:l,className:"p-0.5 bg-transparent text-slate-300 hover:text-white hover:bg-white/10 rounded-full transition-colors",title:"Zoom Out",children:u.jsx(bo,{className:"w-3.5 h-3.5"})}),u.jsxs("span",{className:"font-medium text-slate-400 w-8 text-center select-none tabular-nums",children:[Math.round(i*100),"%"]}),u.jsx("button",{onClick:a,className:"p-0.5 bg-transparent text-slate-300 hover:text-white hover:bg-white/10 rounded-full transition-colors",title:"Zoom In",children:u.jsx(yo,{className:"w-3.5 h-3.5"})}),u.jsx("input",{type:"file",ref:c,accept:".pdf",onChange:o,className:"hidden"})]}),Yc=(o,t)=>{const e=S.useRef(null),s=S.useRef(null),i=S.useRef(null),n=h=>{alert(`Clause: ${h.text}

${h.details||"No details available."}`)},r=h=>{alert(`Risk: ${h.description}

${h.explanation||"No explanation available."}`)},a=S.useCallback(async(h,d)=>{if(s.current){s.current.innerHTML="";try{const p=(await h.getTextContent()).items,b=d.transform;for(const g of p){const m=document.createElement("span");m.textContent=g.str,m.style.position="absolute",m.style.color="transparent",m.style.whiteSpace="pre",m.style.fontSize=`${g.height}px`,m.style.fontFamily="sans-serif",m.style.lineHeight="1";const y=b[0]*g.transform[4]+b[2]*g.transform[5]+b[4],x=b[1]*g.transform[4]+b[3]*g.transform[5]+b[5];m.style.left=`${y}px`,m.style.top=`${x}px`,m.style.width=`${g.width*b[0]}px`,m.style.height=`${g.height*b[3]}px`,s.current.appendChild(m)}}catch(f){console.error("Error rendering text layer:",f)}}},[]),l=S.useCallback((h,d,f,p,b)=>{i.current&&(i.current.innerHTML="",f.filter(g=>g.pageNum===h).forEach(g=>{const m=document.createElement("div");m.className="highlight-overlay",m.style.position="absolute",m.style.backgroundColor="rgba(255, 255, 0, 0.3)",m.style.border="1px solid rgba(255, 255, 0, 0.5)",m.style.left=`${g.x}px`,m.style.top=`${g.y}px`,m.style.width=`${g.width}px`,m.style.height=`${g.height}px`,m.style.pointerEvents="none",m.dataset.page=h,i.current.appendChild(m)}),p.filter(g=>g.pageNum===h).forEach(g=>{const m=document.createElement("div");m.className="clause-marker",m.style.position="absolute",m.style.left=`${g.x}px`,m.style.top=`${g.y}px`,m.style.width="20px",m.style.height="20px",m.style.borderRadius="50%",m.style.backgroundColor="rgba(0, 123, 255, 0.7)",m.style.cursor="pointer",m.style.zIndex="10",m.title=g.text,m.onclick=()=>n(g),i.current.appendChild(m)}),b.filter(g=>g.pageNum===h).forEach(g=>{const m=document.createElement("div");m.className="risk-badge",m.style.position="absolute",m.style.left=`${g.x}px`,m.style.top=`${g.y}px`,m.style.padding="2px 6px",m.style.borderRadius="10px",m.style.fontSize="12px",m.style.fontWeight="bold",m.style.color="white",m.style.backgroundColor=g.level==="high"?"#dc3545":g.level==="medium"?"#fd7e14":"#ffc107",m.style.cursor="pointer",m.style.zIndex="10",m.title=g.description,m.onclick=()=>r(g),m.textContent=g.level.toUpperCase(),i.current.appendChild(m)}))},[]),c=S.useCallback(async(h,d=[],f=[],p=[])=>{if(!(!o||!e.current))try{const b=await o.getPage(h),g=e.current,m=g.getContext("2d"),y=t,x=b.getViewport({scale:y});g.height=x.height,g.width=x.width,m.clearRect(0,0,g.width,g.height);const w={canvasContext:m,viewport:x};await b.render(w).promise,await a(b,x),l(h,x,d,f,p)}catch(b){console.error("Error rendering page:",b)}},[o,t,a,l]);return{canvasRef:e,textLayerRef:s,annotationsRef:i,renderPage:c}},qc=({pdfDoc:o,pageNum:t,scale:e,highlights:s=[],clauseMarkers:i=[],riskBadges:n=[],id:r,children:a})=>{const{canvasRef:l,textLayerRef:c,annotationsRef:h,renderPage:d}=Yc(o,e);return S.useEffect(()=>{o&&t&&d(t,s,i,n)},[o,t,e,s,i,n,d]),u.jsxs("div",{id:r,className:"relative bg-white shadow-lg mb-8 transition-transform origin-top",style:{width:"fit-content",height:"fit-content"},children:[u.jsx("canvas",{ref:l,className:"block"}),u.jsx("div",{ref:c,className:"absolute top-0 left-0 w-full h-full overflow-hidden opacity-0 leading-none"}),u.jsx("div",{ref:h,className:"absolute top-0 left-0 w-full h-full pointer-events-none"}),a]})},na=({pdfDoc:o,numPages:t,pageScale:e,isLoading:s,loadingMessage:i,onPageVisible:n,highlights:r=[],clauseMarkers:a=[],riskBadges:l=[],renderPageOverlay:c})=>{const h=S.useRef(null);return S.useEffect(()=>{if(!o||!h.current||!n)return;const d=new IntersectionObserver(p=>{p.forEach(b=>{if(b.isIntersecting){const g=parseInt(b.target.getAttribute("data-page-num"),10);n(g)}})},{root:h.current,threshold:.5});return h.current.querySelectorAll(".page-wrapper").forEach(p=>d.observe(p)),()=>d.disconnect()},[o,t,n]),s?u.jsx("div",{className:"flex-1 flex items-center justify-center border border-dashed border-gray-300 rounded bg-gray-50 text-gray-600 h-full",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"w-10 h-10 border-4 border-gray-200 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),u.jsx("p",{children:i||"Loading PDF..."})]})}):o?u.jsx("div",{className:"flex flex-col items-center gap-8 py-8 w-full",children:Array.from({length:t},(d,f)=>f+1).map(d=>u.jsx("div",{className:"page-wrapper","data-page-num":d,children:u.jsx(qc,{id:`pdf-page-${d}`,pdfDoc:o,pageNum:d,scale:e,highlights:r,clauseMarkers:a,riskBadges:l,children:c?c(d):null})},d))}):null},ra=({onFileSelect:o})=>{const[t,e]=S.useState(!1),s=S.useRef(null),i=a=>{a.preventDefault(),e(!0)},n=a=>{a.preventDefault(),e(!1)},r=a=>{a.preventDefault(),e(!1),a.dataTransfer.files&&a.dataTransfer.files.length>0&&o({target:{files:a.dataTransfer.files}})};return u.jsxs("div",{className:`flex flex-col items-center justify-center w-full max-w-2xl mx-auto h-96 border-2 border-dashed rounded-3xl transition-all duration-300 ${t?"border-blue-500 bg-blue-50/50 scale-105 shadow-xl":"border-slate-300 bg-white/50 hover:border-blue-400 hover:bg-slate-50"}`,onDragOver:i,onDragLeave:n,onDrop:r,children:[u.jsx("div",{className:`p-6 rounded-full mb-6 transition-colors ${t?"bg-blue-100 text-blue-600":"bg-slate-100 text-slate-400"}`,children:u.jsx(xr,{className:"w-16 h-16"})}),u.jsx("h3",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Upload a PDF to start"}),u.jsx("p",{className:"text-slate-500 mb-8 text-center max-w-md px-4",children:"Drag and drop your file here, or click the button below to browse your computer."}),u.jsxs("button",{onClick:()=>s.current?.click(),className:"px-8 py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg shadow-blue-600/20 transition-all hover:-translate-y-1 active:translate-y-0 flex items-center gap-3",children:[u.jsx(xo,{className:"w-6 h-6"}),"Choose File"]}),u.jsx("input",{type:"file",ref:s,onChange:o,accept:".pdf",className:"hidden"})]})},Kc=({pdfDoc:o,pageNum:t,onClick:e,isActive:s})=>{const i=S.useRef(null);return S.useEffect(()=>{if(!o||!i.current)return;(async()=>{try{const r=await o.getPage(t),a=r.getViewport({scale:.15}),l=i.current,c=l.getContext("2d");l.height=a.height,l.width=a.width,await r.render({canvasContext:c,viewport:a}).promise}catch{}})()},[o,t]),u.jsxs("button",{id:`thumb-${t}`,onClick:e,className:`flex flex-col items-center gap-1 w-full rounded-md p-1 transition-all ${s?"bg-blue-50 ring-1 ring-blue-400":"hover:bg-slate-100"}`,children:[u.jsx("div",{className:"shadow-sm bg-white rounded-sm overflow-hidden",children:u.jsx("canvas",{ref:i,className:"block w-16 h-auto"})}),u.jsx("span",{className:`text-[10px] tabular-nums ${s?"text-blue-600 font-semibold":"text-slate-400"}`,children:t})]})},aa=({pdfDoc:o,numPages:t,currentPage:e,onPageClick:s})=>!o||!t?null:u.jsx("div",{id:"viewer-thumbnails",className:"w-24 bg-white/80 backdrop-blur-sm border-r border-slate-200/60 h-full overflow-y-auto py-2 px-1.5 flex flex-col gap-1",children:Array.from({length:t},(i,n)=>n+1).map(i=>u.jsx(Kc,{pdfDoc:o,pageNum:i,isActive:e===i,onClick:()=>s(i)},i))}),Jc=({risk:o})=>{const t=s=>{switch(s){case"high":return"bg-red-600";case"medium":return"bg-orange-500";case"low":return"bg-yellow-500";default:return"bg-gray-500"}},e=s=>{switch(s){case"high":return"border-l-red-600";case"medium":return"border-l-orange-500";case"low":return"border-l-yellow-500";default:return"border-l-gray-500"}};return u.jsxs("div",{className:`mb-3 border border-gray-300 rounded overflow-hidden ${e(o.riskLevel)}`,children:[u.jsxs("div",{className:"flex justify-between items-center p-2.5 bg-gray-50",children:[u.jsx("h6",{className:"m-0 text-gray-700 font-semibold",children:o.clause}),u.jsx("span",{className:`px-2 py-0.5 rounded-xl text-xs font-bold text-white ${t(o.riskLevel)}`,children:o.riskLevel.toUpperCase()})]}),u.jsxs("div",{className:"p-2.5 bg-white",children:[u.jsxs("p",{className:"mb-2",children:[u.jsx("strong",{children:"Risk:"})," ",o.description]}),u.jsxs("p",{className:"m-0",children:[u.jsx("strong",{children:"Plain Language:"})," ",o.explanation]})]})]})},Qc=({analysis:o})=>{const t=o?._meta||{status:o?"success":"idle"};if(!o||t.status==="idle")return u.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md mt-2.5",children:[u.jsx("h4",{className:"mt-0 text-gray-800 border-b border-gray-300 pb-2",children:"Analysis Results"}),u.jsx("p",{className:"text-gray-700 m-0",children:"No analysis yet. Run â€œType-specific analysis (recommended)â€ to see results here."})]});if(t.status==="loading")return u.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md mt-2.5",children:[u.jsx("h4",{className:"mt-0 text-gray-800 border-b border-gray-300 pb-2",children:"Analysis Results"}),u.jsxs("div",{className:"flex items-center gap-3 text-gray-700",children:[u.jsx("div",{className:"w-5 h-5 border-2 border-gray-200 border-t-blue-500 rounded-full animate-spin"}),u.jsx("div",{children:t.message||"Analyzingâ€¦"})]})]});if(t.status==="error")return u.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md mt-2.5",children:[u.jsx("h4",{className:"mt-0 text-gray-800 border-b border-gray-300 pb-2",children:"Analysis Results"}),u.jsxs("div",{className:"rounded border border-red-200 bg-red-50 p-3 text-sm text-red-900",children:[u.jsx("div",{className:"font-semibold",children:"Analysis failed"}),u.jsx("div",{className:"mt-1",children:t.message||"Request failed."})]})]});const e=typeof o.summary=="string"&&o.summary.trim().length>0,s=Array.isArray(o.risks)&&o.risks.length>0,i=Array.isArray(o.recommendations)&&o.recommendations.length>0;return u.jsxs("div",{className:"bg-white rounded-lg p-4 shadow-md mt-2.5",children:[u.jsx("h4",{className:"mt-0 text-gray-800 border-b border-gray-300 pb-2",children:"Analysis Results"}),!e&&!o.typeSpecific?u.jsx("p",{className:"text-gray-700 m-0",children:"No results were returned yet."}):null,e&&u.jsxs("div",{className:"mb-4",children:[u.jsx("h5",{className:"mt-0 text-gray-700 font-semibold mb-2",children:"Document Summary"}),u.jsx("p",{className:"text-gray-700",children:o.summary})]}),s&&u.jsxs("div",{className:"mb-4",children:[u.jsx("h5",{className:"mt-0 text-gray-700 font-semibold mb-2",children:"Identified Risks"}),o.risks.map(n=>u.jsx(Jc,{risk:n},n.id))]}),o.typeSpecific&&u.jsxs("div",{className:"mb-4",children:[u.jsx("h5",{className:"mt-0 text-gray-700 font-semibold mb-2",children:"Type-specific (beta)"}),u.jsxs("div",{className:"text-gray-700",style:{whiteSpace:"pre-wrap"},children:[u.jsxs("div",{children:[u.jsx("strong",{children:"effectiveTypeId:"})," ",o.typeSpecific.effectiveTypeId||"â€”"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"validationSlug:"})," ",o.typeSpecific.validationSlug||"â€”"]}),u.jsxs("div",{children:[u.jsx("strong",{children:"validationTitle:"})," ",o.typeSpecific.validationTitle||"â€”"]}),o.typeSpecific.result?.plainExplanation?u.jsxs("div",{style:{marginTop:8},children:[u.jsx("strong",{children:"explanation:"}),u.jsx("div",{children:o.typeSpecific.result.plainExplanation})]}):null,o.typeSpecific.usage?u.jsxs("div",{style:{marginTop:8},children:[u.jsx("strong",{children:"usage:"}),u.jsxs("div",{children:["estimatedTokens: ",o.typeSpecific.usage.estimatedTokens??"â€”"," Â· ","remainingTokens: ",o.typeSpecific.usage.remainingTokens??"â€”"]})]}):null,o.typeSpecific.ok===!1&&(o.typeSpecific.code||o.typeSpecific.requiredTier)?u.jsxs("div",{style:{marginTop:8,color:"#991b1b"},children:[u.jsx("strong",{children:"blocked:"})," ",o.typeSpecific.code||"â€”",o.typeSpecific.requiredTier?` (required: ${o.typeSpecific.requiredTier})`:""]}):null,o.typeSpecific.result?.checks?.length?u.jsxs("div",{style:{marginTop:8},children:[u.jsx("strong",{children:"checks:"}),u.jsx("ul",{className:"list-none p-0",style:{marginTop:6},children:o.typeSpecific.result.checks.map(n=>u.jsx("li",{className:"mb-2 p-2 border border-gray-200 rounded",children:u.jsxs("div",{children:[u.jsxs("strong",{children:[n.ok?"OK":"FAIL",":"]})," ",n.message]})},n.id))})]}):null,o.typeSpecific.result?.extracted&&Object.keys(o.typeSpecific.result.extracted).length?u.jsxs("div",{style:{marginTop:8},children:[u.jsx("strong",{children:"extracted:"}),u.jsx("pre",{style:{marginTop:6,background:"#f8fafc",border:"1px solid #e2e8f0",padding:10,borderRadius:10,overflow:"auto"},children:JSON.stringify(o.typeSpecific.result.extracted,null,2)})]}):null,o.typeSpecific.message?u.jsxs("div",{style:{marginTop:8},children:[u.jsx("strong",{children:"message:"}),u.jsx("div",{children:o.typeSpecific.message})]}):null]})]}),i&&u.jsxs("div",{children:[u.jsx("h5",{className:"mt-0 text-gray-700 font-semibold mb-2",children:"Recommendations"}),u.jsx("ul",{className:"list-none p-0",children:o.recommendations.map((n,r)=>u.jsx("li",{className:"mb-4 p-2.5 border border-gray-300 rounded",children:u.jsx("div",{className:"text-gray-700",children:n})},r))})]})]})},Zc=({isOpen:o,onToggle:t,onAnalyzeDocument:e,onAnalyzeByType:s,onExplainSelection:i,onHighlightRisks:n,onTranslateToPlainEnglish:r,isLoading:a,isAuthenticated:l,hasDocument:c,selectedDocument:h,analysisResults:d})=>{const[f,p]=S.useState("tools");Fi.useEffect(()=>{h&&d[h.id]&&p("results")},[d,h]);const b=!c||!l||a;return o?u.jsxs("div",{className:"w-[350px] bg-white border-l border-slate-200 flex flex-col h-full shadow-xl transition-all relative z-20",children:[u.jsxs("div",{className:"h-14 border-b border-slate-200 flex items-center justify-between px-4 bg-slate-50/50",children:[u.jsxs("h3",{className:"font-semibold text-slate-800 flex items-center gap-2",children:[u.jsx(gr,{className:"text-purple-600"}),"AI Assistant"]}),u.jsx("button",{onClick:t,className:"p-1 hover:bg-slate-200 rounded",children:u.jsx(yr,{className:"w-5 h-5 text-slate-500"})})]}),u.jsxs("div",{className:"flex border-b border-slate-200",children:[u.jsx("button",{onClick:()=>p("tools"),className:`flex-1 py-3 text-sm font-medium transition-colors ${f==="tools"?"text-purple-600 border-b-2 border-purple-600 bg-purple-50/50":"text-slate-600 hover:bg-slate-50"}`,children:"Tools"}),u.jsx("button",{onClick:()=>p("results"),disabled:!h||!d[h.id],className:`flex-1 py-3 text-sm font-medium transition-colors ${f==="results"?"text-purple-600 border-b-2 border-purple-600 bg-purple-50/50":"text-slate-600 hover:bg-slate-50 disabled:opacity-50 disabled:cursor-not-allowed"}`,children:"Results"})]}),u.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:f==="tools"?u.jsxs("div",{className:"flex flex-col gap-3",children:[!c&&u.jsx("div",{className:"p-4 bg-slate-50 rounded-lg border border-slate-100 text-center text-sm text-slate-500",children:"Open a document to use AI tools"}),c&&!l&&u.jsx("div",{className:"p-4 bg-amber-50 rounded-lg border border-amber-100 text-sm text-amber-800",children:"Sign in to use AI features."}),u.jsx(oi,{icon:wo,label:"Deep Analysis",sublabel:"Identify risks, obligations & summary",onClick:()=>{s(),p("results")},disabled:b,primary:!0}),u.jsx("div",{className:"h-px bg-slate-100 my-2"}),u.jsx(oi,{icon:vo,label:"Highlight Risks",onClick:n,disabled:b}),u.jsx(oi,{icon:Ao,label:"Plain English",onClick:r,disabled:b})]}):u.jsx("div",{className:"prose prose-sm",children:h&&d[h.id]?u.jsx(Qc,{analysis:d[h.id]}):u.jsx("div",{className:"text-center text-slate-500 mt-10",children:"No analysis results yet. Run a tool to see output here."})})})]}):u.jsx("button",{onClick:t,className:"absolute right-0 top-1/2 -translate-y-1/2 bg-white border border-slate-200 rounded-l-lg p-2 shadow-md hover:bg-slate-50 z-20",title:"Open AI Sidebar",children:u.jsx(br,{className:"w-5 h-5 text-slate-600"})})},oi=({icon:o,label:t,sublabel:e,onClick:s,disabled:i,primary:n})=>u.jsxs("button",{onClick:s,disabled:i,className:`w-full flex items-start gap-3 p-3 rounded-xl border text-left transition-all ${n?"bg-slate-900 border-slate-900 text-white hover:bg-slate-800 shadow-md":"bg-white border-slate-200 text-slate-700 hover:border-slate-300 hover:bg-slate-50"} ${i?"opacity-50 cursor-not-allowed":""}`,children:[u.jsx("div",{className:`p-2 rounded-lg ${n?"bg-white/10":"bg-slate-100"} shrink-0`,children:u.jsx(o,{className:`w-5 h-5 ${n?"text-white":"text-slate-600"}`})}),u.jsxs("div",{children:[u.jsx("div",{className:"font-semibold text-sm",children:t}),e&&u.jsx("div",{className:`text-xs mt-0.5 ${n?"text-slate-300":"text-slate-500"}`,children:e})]})]}),Si=[{id:"dancing-script",label:"Dancing Script",family:"'Dancing Script', cursive"},{id:"great-vibes",label:"Great Vibes",family:"'Great Vibes', cursive"},{id:"allura",label:"Allura",family:"'Allura', cursive"},{id:"parisienne",label:"Parisienne",family:"'Parisienne', cursive"},{id:"sacramento",label:"Sacramento",family:"'Sacramento', cursive"},{id:"alex-brush",label:"Alex Brush",family:"'Alex Brush', cursive"}];let In=!1;function th(){if(In)return;In=!0;const o=Si.map(e=>e.label.replace(/ /g,"+")).join("&family="),t=document.createElement("link");t.rel="stylesheet",t.href=`https://fonts.googleapis.com/css2?family=${o}&display=swap`,document.head.appendChild(t)}function eh({displayName:o,font:t}){return{version:1,kind:"type",displayName:o,fontId:t.id,fontFamily:t.family,createdAt:new Date().toISOString()}}const sh=({onResult:o})=>{const t=S.useRef(null),[e,s]=S.useState(!1),[i,n]=S.useState(!1),r=()=>t.current?.getContext("2d"),a=S.useCallback(f=>{const p=r();if(!p)return;s(!0);const b=t.current.getBoundingClientRect(),g=(f.clientX??f.touches?.[0]?.clientX)-b.left,m=(f.clientY??f.touches?.[0]?.clientY)-b.top;p.beginPath(),p.moveTo(g,m)},[]),l=S.useCallback(f=>{if(!e)return;const p=r();if(!p)return;f.preventDefault();const b=t.current.getBoundingClientRect(),g=(f.clientX??f.touches?.[0]?.clientX)-b.left,m=(f.clientY??f.touches?.[0]?.clientY)-b.top;p.lineTo(g,m),p.stroke(),n(!0)},[e]),c=S.useCallback(()=>{s(!1)},[]),h=()=>{const f=r();f&&(f.clearRect(0,0,t.current.width,t.current.height),n(!1),o(null))},d=()=>{if(!i)return;const f=t.current.toDataURL("image/png");o({mode:"draw",dataUrl:f,width:200,height:60,persistence:{kind:"ephemeral-data-url",canPersist:!1,reason:"free-tier-no-server-storage"}})};return S.useEffect(()=>{const f=r();f&&(f.strokeStyle="#1e293b",f.lineWidth=2.5,f.lineCap="round",f.lineJoin="round")},[]),u.jsxs("div",{className:"flex flex-col gap-3",children:[u.jsxs("div",{className:"relative border border-slate-200 rounded-lg bg-white overflow-hidden",children:[u.jsx("canvas",{ref:t,width:440,height:140,className:"w-full cursor-crosshair touch-none",onMouseDown:a,onMouseMove:l,onMouseUp:c,onMouseLeave:c,onTouchStart:a,onTouchMove:l,onTouchEnd:c}),!i&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-slate-300 text-sm pointer-events-none select-none",children:"Draw your signature here"}),u.jsx("div",{className:"absolute bottom-8 left-4 right-4 border-b border-dashed border-slate-200 pointer-events-none"})]}),u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("button",{onClick:h,className:"flex items-center gap-1 px-3 py-1.5 text-xs text-slate-500 hover:text-red-600 hover:bg-red-50 rounded-md transition-colors",children:[u.jsx(wr,{className:"w-3.5 h-3.5"})," Clear"]}),u.jsx("button",{onClick:d,disabled:!i,className:"flex items-center gap-1.5 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-200 disabled:text-slate-400 text-white text-sm font-semibold rounded-lg transition-colors",children:"Adopt signature"})]})]})},ih=({onResult:o})=>{const[t,e]=S.useState(""),[s,i]=S.useState(Si[0]);S.useEffect(()=>{th()},[]);const n=()=>{if(!t.trim())return;const r=t.trim();o({mode:"type",text:r,fontFamily:s.family,fontId:s.id,width:200,height:50,persistence:{kind:"candidate-profile",canPersist:!0,target:"firestore-signature-profiles"},profileDraft:eh({displayName:r,font:s})})};return u.jsxs("div",{className:"flex flex-col gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:"Your name"}),u.jsx("input",{type:"text",value:t,onChange:r=>e(r.target.value),placeholder:"Full name",className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent",autoFocus:!0})]}),u.jsx("div",{className:"border border-slate-200 rounded-lg bg-white p-6 min-h-[90px] flex items-center justify-center",children:t.trim()?u.jsx("span",{className:"text-3xl text-slate-800 select-none",style:{fontFamily:s.family},children:t}):u.jsx("span",{className:"text-slate-300 text-sm",children:"Preview"})}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-2",children:"Style"}),u.jsx("div",{className:"grid grid-cols-3 gap-2",children:Si.map(r=>u.jsxs("button",{onClick:()=>i(r),className:`px-3 py-2.5 rounded-lg border text-left transition-all ${s.id===r.id?"border-blue-500 bg-blue-50 ring-1 ring-blue-400":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"}`,children:[u.jsx("span",{className:"text-lg text-slate-700 block truncate",style:{fontFamily:r.family},children:t.trim()||"Signature"}),u.jsx("span",{className:"text-[10px] text-slate-400 mt-0.5 block",children:r.label})]},r.id))})]}),u.jsx("div",{className:"flex justify-end",children:u.jsx("button",{onClick:n,disabled:!t.trim(),className:"flex items-center gap-1.5 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-200 disabled:text-slate-400 text-white text-sm font-semibold rounded-lg transition-colors",children:"Adopt signature"})})]})},nh=({onResult:o})=>{const[t,e]=S.useState(null),[s,i]=S.useState(null),n=S.useRef(null),r=c=>{const h=c.target.files?.[0];if(!h||!h.type.startsWith("image/"))return;const d=new FileReader;d.onload=()=>{e(d.result),i({fileName:h.name,mimeType:h.type||null,sizeBytes:h.size||null})},d.readAsDataURL(h)},a=()=>{t&&o({mode:"upload",dataUrl:t,width:200,height:60,uploadMeta:s,persistence:{kind:"ephemeral-data-url",canPersist:!1,reason:"free-tier-no-server-storage"}})},l=()=>{e(null),i(null),n.current&&(n.current.value=""),o(null)};return u.jsxs("div",{className:"flex flex-col gap-3",children:[t?u.jsx("div",{className:"border border-slate-200 rounded-lg bg-white p-4 flex items-center justify-center min-h-[140px]",children:u.jsx("img",{src:t,alt:"Signature",className:"max-h-[120px] max-w-full object-contain"})}):u.jsxs("button",{onClick:()=>n.current?.click(),className:"border-2 border-dashed border-slate-300 rounded-lg bg-slate-50 hover:bg-slate-100 p-8 flex flex-col items-center gap-2 transition-colors cursor-pointer",children:[u.jsx(js,{className:"w-8 h-8 text-slate-400"}),u.jsx("span",{className:"text-sm text-slate-500",children:"Click to upload signature image"}),u.jsx("span",{className:"text-[10px] text-slate-400",children:"PNG, JPG, or SVG â€” transparent background recommended"})]}),u.jsx("input",{ref:n,type:"file",accept:"image/*",onChange:r,className:"hidden"}),u.jsxs("div",{className:"flex items-center justify-between",children:[t&&u.jsxs("button",{onClick:l,className:"flex items-center gap-1 px-3 py-1.5 text-xs text-slate-500 hover:text-red-600 hover:bg-red-50 rounded-md transition-colors",children:[u.jsx(wr,{className:"w-3.5 h-3.5"})," Remove"]}),u.jsx("div",{className:"flex-1"}),u.jsx("button",{onClick:a,disabled:!t,className:"flex items-center gap-1.5 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-200 disabled:text-slate-400 text-white text-sm font-semibold rounded-lg transition-colors",children:"Adopt signature"})]})]})},rh=[{id:"draw",label:"Draw",icon:Mi},{id:"type",label:"Type",icon:Eo},{id:"upload",label:"Upload",icon:js}],ah=({open:o,onClose:t,onAdopt:e,savedSignatures:s=[]})=>{const[i,n]=S.useState("draw");if(!o)return null;const r=a=>{a&&(e(a),t())};return u.jsx("div",{id:"signature-modal-backdrop",className:"fixed inset-0 bg-slate-900/40 flex items-center justify-center z-[2000] p-4",onClick:t,children:u.jsxs("div",{id:"signature-modal",className:"bg-white rounded-2xl border border-slate-200 shadow-2xl w-full max-w-[520px] max-h-[90vh] overflow-y-auto",onClick:a=>a.stopPropagation(),children:[u.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-slate-100",children:[u.jsx("h2",{className:"text-base font-bold text-slate-900",children:"Create your signature"}),u.jsx("button",{onClick:t,className:"p-1.5 rounded-lg text-slate-400 hover:text-slate-600 hover:bg-slate-100 transition-colors",children:u.jsx(So,{className:"w-5 h-5"})})]}),u.jsx("div",{className:"mx-5 mt-4 rounded-lg border border-amber-200 bg-amber-50 px-3 py-2 text-[11px] leading-relaxed text-amber-800",children:"Self-sign only in this version. No multi-party recipients, signee roles, or signing order are supported."}),u.jsx("div",{className:"flex border-b border-slate-100",children:rh.map(a=>{const l=a.icon,c=i===a.id;return u.jsxs("button",{onClick:()=>n(a.id),className:`flex-1 flex items-center justify-center gap-1.5 py-3 text-sm font-medium transition-colors ${c?"text-blue-600 border-b-2 border-blue-600":"text-slate-400 hover:text-slate-600"}`,children:[u.jsx(l,{className:"w-4 h-4"}),a.label]},a.id)})}),u.jsxs("div",{className:"p-5",children:[i==="draw"&&u.jsx(sh,{onResult:r}),i==="type"&&u.jsx(ih,{onResult:r}),i==="upload"&&u.jsx(nh,{onResult:r})]}),u.jsx("div",{className:"px-5 pb-4 text-[11px] text-slate-400 leading-snug",children:"Consent: By adopting this signature, you confirm this is for your own self-sign use and that you are authorized to create and apply it."})]})})},st={UNREADABLE:"UNREADABLE",GENERAL:"GENERAL",BUSINESS_LEGAL:"BUSINESS_LEGAL"},oh=[{id:"unreadable_broken",label:"Unreadable / broken file",category:st.UNREADABLE,synonyms:["corrupt","broken","invalid pdf","cannot open","damaged"]},{id:"unreadable_encrypted",label:"Password-protected / encrypted",category:st.UNREADABLE,synonyms:["encrypted","password","protected"]},{id:"unreadable_empty",label:"Empty / blank document",category:st.UNREADABLE,synonyms:["blank","empty","no text"]},{id:"general_letter",label:"Letter (general / personal)",category:st.GENERAL,synonyms:["letter","correspondence","personal letter"]},{id:"general_police_letter",label:"Police letter / notice",category:st.GENERAL,synonyms:["police","notice","infringement","fine","offence"]},{id:"general_presentation",label:"Presentation / pitch deck",category:st.GENERAL,synonyms:["deck","slides","presentation","pitch"]},{id:"general_marketing",label:"Flyer / advertisement / marketing",category:st.GENERAL,synonyms:["flyer","ad","advertisement","brochure","marketing"]},{id:"general_book",label:"Book / long-form text",category:st.GENERAL,synonyms:["book","chapter","novel","story","longform"]},{id:"general_notes",label:"Notes / diary / journal",category:st.GENERAL,synonyms:["notes","diary","journal","private notes"]},{id:"general_schedule",label:"Schedule / timetable",category:st.GENERAL,synonyms:["schedule","timetable","calendar","rota"]},{id:"general_sop_procedure",label:"SOP / procedure",category:st.GENERAL,synonyms:["sop","procedure","runbook","work instruction","instructions","guide"],validationSlug:"sop-procedure"},{id:"general_resume_cv",label:"Resume / CV",category:st.GENERAL,synonyms:["resume","cv","curriculum vitae","work experience","education","skills"]},{id:"legal_job_offer",label:"Job offer / offer letter",category:st.BUSINESS_LEGAL,synonyms:["offer letter","job offer","employment offer","compensation","salary","starting date"],validationSlug:"job-offer"},{id:"legal_contract_generic",label:"Contract / agreement (general)",category:st.BUSINESS_LEGAL,synonyms:["agreement","contract","terms","conditions"]},{id:"legal_employment_contract",label:"Employment contract",category:st.BUSINESS_LEGAL,synonyms:["employment","employee","employer","salary","position"]},{id:"legal_nda",label:"NDA / confidentiality agreement",category:st.BUSINESS_LEGAL,synonyms:["nda","non-disclosure","confidentiality"]},{id:"legal_lease_residential",label:"Residential lease / tenancy agreement",category:st.BUSINESS_LEGAL,synonyms:["lease","tenancy","rent","bond","landlord","tenant"]},{id:"legal_lease_commercial",label:"Commercial lease",category:st.BUSINESS_LEGAL,synonyms:["commercial lease","premises","outgoings"]},{id:"business_invoice",label:"Invoice",category:st.BUSINESS_LEGAL,synonyms:["invoice","tax invoice","payment due"],validationSlug:"invoice"},{id:"business_purchase_order",label:"Purchase order",category:st.BUSINESS_LEGAL,synonyms:["purchase order","po","order"]},{id:"policy_privacy",label:"Privacy policy",category:st.BUSINESS_LEGAL,synonyms:["privacy policy","personal information","data collection"],validationSlug:"company-policy"},{id:"policy_terms",label:"Terms of service / website terms",category:st.BUSINESS_LEGAL,synonyms:["terms of service","terms","conditions","website terms"]}];function oa(){const[o,t]=S.useState(null);S.useEffect(()=>{let n=!1;return(async()=>{try{const a=await fetch("/classifications/document-types.index.json",{cache:"force-cache"});if(!a.ok)throw new Error(`Failed to load document types: ${a.status}`);const l=await a.json(),c=Array.isArray(l?.types)?l.types:null;if(c)for(const h of c)"validationSlug"in h||(h.validationSlug=null);if(!c)throw new Error("Invalid document-types.index.json");n||t(c)}catch{n||t(null)}})(),()=>{n=!0}},[]);const e=S.useMemo(()=>Array.isArray(o)&&o.length?o:oh,[o]),s=S.useMemo(()=>n=>{const r=String(n||"").trim().toLowerCase();if(!r)return e;const a=l=>{const c=String(l.label||"").toLowerCase(),h=Array.isArray(l.synonyms)?l.synonyms.join(" ").toLowerCase():"";if(c.includes(r))return 100;if(h.includes(r))return 80;const d=r.split(/\s+/).filter(Boolean);return d.length&&d.every(f=>c.includes(f)||h.includes(f))?60:0};return e.map(l=>({t:l,s:a(l)})).filter(l=>l.s>0).sort((l,c)=>c.s-l.s).map(l=>l.t)},[e]);return{types:e,find:s,categories:st,source:Array.isArray(o)&&o.length?"remote":"bundled"}}const lh=(o,t)=>o===t.BUSINESS_LEGAL?"Business & legal":o===t.GENERAL?"General documents":o===t.UNREADABLE?"Unreadable / special cases":"Other";function ch({open:o,onClose:t,detectedType:e,onPick:s}){const[i,n]=S.useState(""),[r,a]=S.useState(0),l=S.useRef(null),{types:c,find:h,categories:d,source:f}=oa();S.useEffect(()=>{o&&(n(""),a(0),setTimeout(()=>l.current?.focus(),0))},[o]);const p=S.useMemo(()=>{const x=h(i);return i?x.slice(0,30):c.slice(0,25)},[i,h,c]),b=S.useMemo(()=>{const x=new Map;for(const w of p){const v=w.category;x.has(v)||x.set(v,[]),x.get(v).push(w)}return Array.from(x.entries())},[p]),g=S.useMemo(()=>p,[p]),m=x=>{const w=g[x];w&&s?.(w)},y=x=>{if(x.key==="Escape"){t?.();return}if(x.key==="ArrowDown"){x.preventDefault(),a(w=>Math.min(w+1,g.length-1));return}if(x.key==="ArrowUp"){x.preventDefault(),a(w=>Math.max(w-1,0));return}x.key==="Enter"&&(x.preventDefault(),m(r))};return o?u.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(15, 23, 42, 0.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2500,padding:16},onClick:()=>t?.(),children:u.jsxs("div",{style:{background:"#fff",borderRadius:14,border:"1px solid #e2e8f0",maxWidth:760,width:"100%",padding:18,boxShadow:"0 10px 30px rgba(0,0,0,0.2)"},onClick:x=>x.stopPropagation(),onKeyDown:y,children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"flex-start"},children:[u.jsxs("div",{children:[u.jsx("div",{style:{fontWeight:900,fontSize:16,color:"#0f172a"},children:"Change document type"}),u.jsx("div",{style:{marginTop:6,color:"#475569",lineHeight:1.4},children:"We use this to decide which actions/checks to show. You can override the AI classification."}),e&&u.jsxs("div",{style:{marginTop:8,color:"#64748b",fontSize:13},children:["Detected: ",u.jsx("strong",{children:e.label})]})]}),u.jsx("button",{type:"button",onClick:()=>t?.(),style:{background:"none",border:"none",fontSize:22,cursor:"pointer",color:"#0f172a",padding:0,lineHeight:1},"aria-label":"Close",children:"Ã—"})]}),u.jsx("input",{ref:l,value:i,onChange:x=>{n(x.target.value),a(0)},placeholder:"Start typing (e.g. lease, invoice, police letter)â€¦",style:{marginTop:14,width:"100%",padding:12,borderRadius:12,border:"1px solid #e2e8f0"}}),u.jsxs("div",{style:{marginTop:14,maxHeight:360,overflow:"auto"},children:[b.map(([x,w])=>u.jsxs("div",{style:{marginBottom:14},children:[u.jsxs("div",{style:{fontWeight:900,color:"#0f172a",fontSize:13,marginBottom:8},children:[lh(x,d),u.jsxs("span",{style:{marginLeft:8,color:"#94a3b8",fontWeight:800},children:["(",f,")"]})]}),u.jsx("div",{style:{display:"grid",gap:8},children:w.map(v=>{const A=g.findIndex(C=>C.id===v.id),E=A===r;return u.jsxs("button",{type:"button",onClick:()=>s?.(v),onMouseEnter:()=>a(A),style:{textAlign:"left",padding:"10px 12px",borderRadius:12,border:"1px solid "+(E?"#0f172a":"#e2e8f0"),background:E?"#f8fafc":"#fff",cursor:"pointer"},children:[u.jsx("div",{style:{fontWeight:900,color:"#0f172a"},children:v.label}),u.jsx("div",{style:{color:"#64748b",fontSize:12,marginTop:2},children:v.id})]},v.id)})})]},x)),!b.length&&u.jsx("div",{style:{color:"#64748b"},children:"No matches."})]})]})}):null}function hh(o){const[t,e]=S.useState({status:"idle",spec:null,error:null});return S.useEffect(()=>{if(!o){e({status:"idle",spec:null,error:null});return}let s=!1;return(async()=>{e({status:"loading",spec:null,error:null});try{const n=await fetch(`/classifications/validation/${o}.json`,{cache:"force-cache"});if(!n.ok)throw new Error(`Failed to load validation spec: ${n.status}`);const r=await n.json();s||e({status:"ready",spec:r,error:null})}catch(n){s||e({status:"error",spec:null,error:n})}})(),()=>{s=!0}},[o]),t}const St=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Ei=[.001,0,0,.001,0,0],li=1.35,Dt={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},ee={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Ze="pdfjs_internal_editor_",z={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},V={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},la={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Ci={TRIANGLES:1,LATTICE:2},ft={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Ke={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},lt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Ae={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},as={ERRORS:0,WARNINGS:1,INFOS:5},De={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},He={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},ca={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Us=as.WARNINGS;function dh(o){Number.isInteger(o)&&(Us=o)}function uh(){return Us}function Hs(o){Us>=as.INFOS&&console.info(`Info: ${o}`)}function $(o){Us>=as.WARNINGS&&console.warn(`Warning: ${o}`)}function Q(o){throw new Error(o)}function J(o,t){o||Q(t)}function fh(o){switch(o?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function Xi(o,t=null,e=null){if(!o)return null;if(e&&typeof o=="string"&&(e.addDefaultProtocol&&o.startsWith("www.")&&o.match(/\./g)?.length>=2&&(o=`http://${o}`),e.tryConvertEncoding))try{o=xh(o)}catch{}const s=t?URL.parse(o,t):URL.parse(o);return fh(s)?s:null}function Yi(o,t,e=!1){const s=URL.parse(o);return s?(s.hash=t,s.href):e&&Xi(o,"http://example.com")?o.split("#",1)[0]+`${t?`#${t}`:""}`:""}function H(o,t,e,s=!1){return Object.defineProperty(o,t,{value:e,enumerable:!s,configurable:!0,writable:!1}),e}const be=(function(){function t(e,s){this.message=e,this.name=s}return t.prototype=new Error,t.constructor=t,t})();class Mn extends be{constructor(t,e){super(t,"PasswordException"),this.code=e}}class ci extends be{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class Ds extends be{constructor(t){super(t,"InvalidPDFException")}}class ts extends be{constructor(t,e,s){super(t,"ResponseException"),this.status=e,this.missing=s}}class ph extends be{constructor(t){super(t,"FormatError")}}class ne extends be{constructor(t){super(t,"AbortException")}}function gh(o){(typeof o!="object"||o?.length===void 0)&&Q("Invalid argument for bytesToString");const t=o.length,e=8192;if(t<e)return String.fromCharCode.apply(null,o);const s=[];for(let i=0;i<t;i+=e){const n=Math.min(i+e,t),r=o.subarray(i,n);s.push(String.fromCharCode.apply(null,r))}return s.join("")}function $s(o){typeof o!="string"&&Q("Invalid argument for stringToBytes");const t=o.length,e=new Uint8Array(t);for(let s=0;s<t;++s)e[s]=o.charCodeAt(s)&255;return e}function mh(o){return String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,o&255)}function bh(){const o=new Uint8Array(4);return o[0]=1,new Uint32Array(o.buffer,0,1)[0]===1}function yh(){try{return new Function(""),!0}catch{return!1}}class ut{static get isLittleEndian(){return H(this,"isLittleEndian",bh())}static get isEvalSupported(){return H(this,"isEvalSupported",yh())}static get isOffscreenCanvasSupported(){return H(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return H(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return H(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return H(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return H(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){return H(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const hi=Array.from(Array(256).keys(),o=>o.toString(16).padStart(2,"0"));class N{static makeHexColor(t,e,s){return`#${hi[t]}${hi[e]}${hi[s]}`}static domMatrixToTransform(t){return[t.a,t.b,t.c,t.d,t.e,t.f]}static scaleMinMax(t,e){let s;t[0]?(t[0]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[3],e[3]*=t[3]):(s=e[0],e[0]=e[1],e[1]=s,s=e[2],e[2]=e[3],e[3]=s,t[1]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static multiplyByDOMMatrix(t,e){return[t[0]*e.a+t[2]*e.b,t[1]*e.a+t[3]*e.b,t[0]*e.c+t[2]*e.d,t[1]*e.c+t[3]*e.d,t[0]*e.e+t[2]*e.f+t[4],t[1]*e.e+t[3]*e.f+t[5]]}static applyTransform(t,e,s=0){const i=t[s],n=t[s+1];t[s]=i*e[0]+n*e[2]+e[4],t[s+1]=i*e[1]+n*e[3]+e[5]}static applyTransformToBezier(t,e,s=0){const i=e[0],n=e[1],r=e[2],a=e[3],l=e[4],c=e[5];for(let h=0;h<6;h+=2){const d=t[s+h],f=t[s+h+1];t[s+h]=d*i+f*r+l,t[s+h+1]=d*n+f*a+c}}static applyInverseTransform(t,e){const s=t[0],i=t[1],n=e[0]*e[3]-e[1]*e[2];t[0]=(s*e[3]-i*e[2]+e[2]*e[5]-e[4]*e[3])/n,t[1]=(-s*e[1]+i*e[0]+e[4]*e[1]-e[5]*e[0])/n}static axialAlignedBoundingBox(t,e,s){const i=e[0],n=e[1],r=e[2],a=e[3],l=e[4],c=e[5],h=t[0],d=t[1],f=t[2],p=t[3];let b=i*h+l,g=b,m=i*f+l,y=m,x=a*d+c,w=x,v=a*p+c,A=v;if(n!==0||r!==0){const E=n*h,C=n*f,P=r*d,T=r*p;b+=P,y+=P,m+=T,g+=T,x+=E,A+=E,v+=C,w+=C}s[0]=Math.min(s[0],b,m,g,y),s[1]=Math.min(s[1],x,v,w,A),s[2]=Math.max(s[2],b,m,g,y),s[3]=Math.max(s[3],x,v,w,A)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const s=t[0],i=t[1],n=t[2],r=t[3],a=s**2+i**2,l=s*n+i*r,c=n**2+r**2,h=(a+c)/2,d=Math.sqrt(h**2-(a*c-l**2));e[0]=Math.sqrt(h+d||1),e[1]=Math.sqrt(h-d||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const s=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),i=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(s>i)return null;const n=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),r=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return n>r?null:[s,n,i,r]}static pointBoundingBox(t,e,s){s[0]=Math.min(s[0],t),s[1]=Math.min(s[1],e),s[2]=Math.max(s[2],t),s[3]=Math.max(s[3],e)}static rectBoundingBox(t,e,s,i,n){n[0]=Math.min(n[0],t,s),n[1]=Math.min(n[1],e,i),n[2]=Math.max(n[2],t,s),n[3]=Math.max(n[3],e,i)}static#t(t,e,s,i,n,r,a,l,c,h){if(c<=0||c>=1)return;const d=1-c,f=c*c,p=f*c,b=d*(d*(d*t+3*c*e)+3*f*s)+p*i,g=d*(d*(d*n+3*c*r)+3*f*a)+p*l;h[0]=Math.min(h[0],b),h[1]=Math.min(h[1],g),h[2]=Math.max(h[2],b),h[3]=Math.max(h[3],g)}static#e(t,e,s,i,n,r,a,l,c,h,d,f){if(Math.abs(c)<1e-12){Math.abs(h)>=1e-12&&this.#t(t,e,s,i,n,r,a,l,-d/h,f);return}const p=h**2-4*d*c;if(p<0)return;const b=Math.sqrt(p),g=2*c;this.#t(t,e,s,i,n,r,a,l,(-h+b)/g,f),this.#t(t,e,s,i,n,r,a,l,(-h-b)/g,f)}static bezierBoundingBox(t,e,s,i,n,r,a,l,c){c[0]=Math.min(c[0],t,a),c[1]=Math.min(c[1],e,l),c[2]=Math.max(c[2],t,a),c[3]=Math.max(c[3],e,l),this.#e(t,s,n,a,e,i,r,l,3*(-t+3*(s-n)+a),6*(t-2*s+n),3*(s-t),c),this.#e(t,s,n,a,e,i,r,l,3*(-e+3*(i-r)+l),6*(e-2*i+r),3*(i-e),c)}}function xh(o){return decodeURIComponent(escape(o))}let di=null,jn=null;function ha(o){return di||(di=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,jn=new Map([["ï¬…","Å¿t"]])),o.replaceAll(di,(t,e,s)=>e?e.normalize("NFKC"):jn.get(s))}function qi(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const o=new Uint8Array(32);return crypto.getRandomValues(o),gh(o)}const Ee="pdfjs_internal_id_";function wh(o,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[s,i,...n]=e;if(!o(s)&&!Number.isInteger(s)||!t(i))return!1;const r=n.length;let a=!0;switch(i.name){case"XYZ":if(r<2||r>3)return!1;break;case"Fit":case"FitB":return r===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(r>1)return!1;break;case"FitR":if(r!==4)return!1;a=!1;break;default:return!1}for(const l of n)if(!(typeof l=="number"||a&&l===null))return!1;return!0}function xt(o,t,e){return Math.min(Math.max(o,t),e)}typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(o){return o.reduce((t,e)=>t+e,0)});class es{static textContent(t){const e=[],s={items:e,styles:Object.create(null)};function i(n){if(!n)return;let r=null;const a=n.name;if(a==="#text")r=n.value;else if(es.shouldBuildText(a))n?.attributes?.textContent?r=n.attributes.textContent:n.value&&(r=n.value);else return;if(r!==null&&e.push({str:r}),!!n.children)for(const l of n.children)i(l)}return i(t),s}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}class Ki{static setupStorage(t,e,s,i,n){const r=i.getValue(e,{value:null});switch(s.name){case"textarea":if(r.value!==null&&(t.textContent=r.value),n==="print")break;t.addEventListener("input",a=>{i.setValue(e,{value:a.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(r.value===s.attributes.xfaOn?t.setAttribute("checked",!0):r.value===s.attributes.xfaOff&&t.removeAttribute("checked"),n==="print")break;t.addEventListener("change",a=>{i.setValue(e,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&t.setAttribute("value",r.value),n==="print")break;t.addEventListener("input",a=>{i.setValue(e,{value:a.target.value})})}break;case"select":if(r.value!==null){t.setAttribute("value",r.value);for(const a of s.children)a.attributes.value===r.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}t.addEventListener("input",a=>{const l=a.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(e,{value:c})});break}}static setAttributes({html:t,element:e,storage:s=null,intent:i,linkService:n}){const{attributes:r}=e,a=t instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${i}`);for(const[l,c]of Object.entries(r))if(c!=null)switch(l){case"class":c.length&&t.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",c);break;case"style":Object.assign(t.style,c);break;case"textContent":t.textContent=c;break;default:(!a||l!=="href"&&l!=="newWindow")&&t.setAttribute(l,c)}a&&n.addLinkAttributes(t,r.href,r.newWindow),s&&r.dataId&&this.setupStorage(t,r.dataId,e,s)}static render(t){const e=t.annotationStorage,s=t.linkService,i=t.xfaHtml,n=t.intent||"display",r=document.createElement(i.name);i.attributes&&this.setAttributes({html:r,element:i,intent:n,linkService:s});const a=n!=="richText",l=t.div;if(l.append(r),t.viewport){const d=`matrix(${t.viewport.transform.join(",")})`;l.style.transform=d}a&&l.setAttribute("class","xfaLayer xfaFont");const c=[];if(i.children.length===0){if(i.value){const d=document.createTextNode(i.value);r.append(d),a&&es.shouldBuildText(i.name)&&c.push(d)}return{textDivs:c}}const h=[[i,-1,r]];for(;h.length>0;){const[d,f,p]=h.at(-1);if(f+1===d.children.length){h.pop();continue}const b=d.children[++h.at(-1)[1]];if(b===null)continue;const{name:g}=b;if(g==="#text"){const y=document.createTextNode(b.value);c.push(y),p.append(y);continue}const m=b?.attributes?.xmlns?document.createElementNS(b.attributes.xmlns,g):document.createElement(g);if(p.append(m),b.attributes&&this.setAttributes({html:m,element:b,storage:e,intent:n,linkService:s}),b.children?.length>0)h.push([b,-1,m]);else if(b.value){const y=document.createTextNode(b.value);a&&es.shouldBuildText(g)&&c.push(y),m.append(y)}}for(const d of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))d.setAttribute("readOnly",!0);return{textDivs:c}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const te="http://www.w3.org/2000/svg";class ge{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function Me(o,t="text"){if(Ye(o,document.baseURI)){const e=await fetch(o);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,s)=>{const i=new XMLHttpRequest;i.open("GET",o,!0),i.responseType=t,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(i.response);return}e(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class os{constructor({viewBox:t,userUnit:e,scale:s,rotation:i,offsetX:n=0,offsetY:r=0,dontFlip:a=!1}){this.viewBox=t,this.userUnit=e,this.scale=s,this.rotation=i,this.offsetX=n,this.offsetY=r,s*=e;const l=(t[2]+t[0])/2,c=(t[3]+t[1])/2;let h,d,f,p;switch(i%=360,i<0&&(i+=360),i){case 180:h=-1,d=0,f=0,p=1;break;case 90:h=0,d=1,f=1,p=0;break;case 270:h=0,d=-1,f=-1,p=0;break;case 0:h=1,d=0,f=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(f=-f,p=-p);let b,g,m,y;h===0?(b=Math.abs(c-t[1])*s+n,g=Math.abs(l-t[0])*s+r,m=(t[3]-t[1])*s,y=(t[2]-t[0])*s):(b=Math.abs(l-t[0])*s+n,g=Math.abs(c-t[1])*s+r,m=(t[2]-t[0])*s,y=(t[3]-t[1])*s),this.transform=[h*s,d*s,f*s,p*s,b-h*s*l-f*s*c,g-d*s*l-p*s*c],this.width=m,this.height=y}get rawDims(){const t=this.viewBox;return H(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:n=!1}={}){return new os({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:n})}convertToViewportPoint(t,e){const s=[t,e];return N.applyTransform(s,this.transform),s}convertToViewportRectangle(t){const e=[t[0],t[1]];N.applyTransform(e,this.transform);const s=[t[2],t[3]];return N.applyTransform(s,this.transform),[e[0],e[1],s[0],s[1]]}convertToPdfPoint(t,e){const s=[t,e];return N.applyInverseTransform(s,this.transform),s}}class zs extends be{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function ls(o){const t=o.length;let e=0;for(;e<t&&o[e].trim()==="";)e++;return o.substring(e,e+5).toLowerCase()==="data:"}function Ws(o){return typeof o=="string"&&/\.pdf$/i.test(o)}function da(o){return[o]=o.split(/[#?]/,1),o.substring(o.lastIndexOf("/")+1)}function ua(o,t="document.pdf"){if(typeof o!="string")return t;if(ls(o))return $('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const s=(a=>{try{return new URL(a)}catch{try{return new URL(decodeURIComponent(a))}catch{try{return new URL(a,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(a),"https://foo.bar")}catch{return null}}}}})(o);if(!s)return t;const i=a=>{try{let l=decodeURIComponent(a);return l.includes("/")?(l=l.split("/").at(-1),l.test(/^\.pdf$/i)?l:a):l}catch{return a}},n=/\.pdf$/i,r=s.pathname.split("/").at(-1);if(n.test(r))return i(r);if(s.searchParams.size>0){const a=Array.from(s.searchParams.values()).reverse();for(const c of a)if(n.test(c))return i(c);const l=Array.from(s.searchParams.keys()).reverse();for(const c of l)if(n.test(c))return i(c)}if(s.hash){const l=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(s.hash);if(l)return i(l[0])}return t}class Fn{started=Object.create(null);times=[];time(t){t in this.started&&$(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||$(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:s}of this.times)e=Math.max(s.length,e);for(const{name:s,start:i,end:n}of this.times)t.push(`${s.padEnd(e)} ${n-i}ms
`);return t.join("")}}function Ye(o,t){const e=t?URL.parse(o,t):URL.parse(o);return e?.protocol==="http:"||e?.protocol==="https:"}function It(o){o.preventDefault()}function nt(o){o.preventDefault(),o.stopPropagation()}function vh(o){console.log("Deprecated API usage: "+o)}class Ns{static#t;static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;this.#t||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const e=this.#t.exec(t);if(!e)return null;const s=parseInt(e[1],10);let i=parseInt(e[2],10);i=i>=1&&i<=12?i-1:0;let n=parseInt(e[3],10);n=n>=1&&n<=31?n:1;let r=parseInt(e[4],10);r=r>=0&&r<=23?r:0;let a=parseInt(e[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(e[6],10);l=l>=0&&l<=59?l:0;const c=e[7]||"Z";let h=parseInt(e[8],10);h=h>=0&&h<=23?h:0;let d=parseInt(e[9],10)||0;return d=d>=0&&d<=59?d:0,c==="-"?(r+=h,a+=d):c==="+"&&(r-=h,a-=d),new Date(Date.UTC(s,i,n,r,a,l))}}function fa(o,{scale:t=1,rotation:e=0}){const{width:s,height:i}=o.attributes.style,n=[0,0,parseInt(s),parseInt(i)];return new os({viewBox:n,userUnit:1,scale:t,rotation:e})}function je(o){if(o.startsWith("#")){const t=parseInt(o.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return o.startsWith("rgb(")?o.slice(4,-1).split(",").map(t=>parseInt(t)):o.startsWith("rgba(")?o.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):($(`Not a valid color format: "${o}"`),[0,0,0])}function Ah(o){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of o.keys()){t.style.color=e;const s=window.getComputedStyle(t).color;o.set(e,je(s))}t.remove()}function it(o){const{a:t,b:e,c:s,d:i,e:n,f:r}=o.getTransform();return[t,e,s,i,n,r]}function Xt(o){const{a:t,b:e,c:s,d:i,e:n,f:r}=o.getTransform().invertSelf();return[t,e,s,i,n,r]}function oe(o,t,e=!1,s=!0){if(t instanceof os){const{pageWidth:i,pageHeight:n}=t.rawDims,{style:r}=o,a=ut.isCSSRoundSupported,l=`var(--total-scale-factor) * ${i}px`,c=`var(--total-scale-factor) * ${n}px`,h=a?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,d=a?`round(down, ${c}, var(--scale-round-y))`:`calc(${c})`;!e||t.rotation%180===0?(r.width=h,r.height=d):(r.width=d,r.height=h)}s&&o.setAttribute("data-main-rotation",t.rotation)}class zt{constructor(){const{pixelRatio:t}=zt;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,s,i,n=-1){let r=1/0,a=1/0,l=1/0;s=zt.capPixels(s,n),s>0&&(r=Math.sqrt(s/(t*e))),i!==-1&&(a=i/t,l=i/e);const c=Math.min(r,a,l);return this.sx>c||this.sy>c?(this.sx=c,this.sy=c,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const s=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,s):s}return t}}const Ls=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class Sh{static get isDarkMode(){return H(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class pa{static get commentForegroundColor(){const t=document.createElement("span");t.classList.add("comment","sidebar");const{style:e}=t;e.width=e.height="0",e.display="none",e.color="var(--comment-fg-color)",document.body.append(t);const{color:s}=window.getComputedStyle(t);return t.remove(),H(this,"commentForegroundColor",je(s))}}function ga(o,t,e,s){s=Math.min(Math.max(s??1,0),1);const i=255*(1-s);return o=Math.round(o*s+i),t=Math.round(t*s+i),e=Math.round(e*s+i),[o,t,e]}function On(o,t){const e=o[0]/255,s=o[1]/255,i=o[2]/255,n=Math.max(e,s,i),r=Math.min(e,s,i),a=(n+r)/2;if(n===r)t[0]=t[1]=0;else{const l=n-r;switch(t[1]=a<.5?l/(n+r):l/(2-n-r),n){case e:t[0]=((s-i)/l+(s<i?6:0))*60;break;case s:t[0]=((i-e)/l+2)*60;break;case i:t[0]=((e-s)/l+4)*60;break}}t[2]=a}function Ti(o,t){const e=o[0],s=o[1],i=o[2],n=(1-Math.abs(2*i-1))*s,r=n*(1-Math.abs(e/60%2-1)),a=i-n/2;switch(Math.floor(e/60)){case 0:t[0]=n+a,t[1]=r+a,t[2]=a;break;case 1:t[0]=r+a,t[1]=n+a,t[2]=a;break;case 2:t[0]=a,t[1]=n+a,t[2]=r+a;break;case 3:t[0]=a,t[1]=r+a,t[2]=n+a;break;case 4:t[0]=r+a,t[1]=a,t[2]=n+a;break;case 5:case 6:t[0]=n+a,t[1]=a,t[2]=r+a;break}}function Bn(o){return o<=.03928?o/12.92:((o+.055)/1.055)**2.4}function Un(o,t,e){Ti(o,e),e.map(Bn);const s=.2126*e[0]+.7152*e[1]+.0722*e[2];Ti(t,e),e.map(Bn);const i=.2126*e[0]+.7152*e[1]+.0722*e[2];return s>i?(s+.05)/(i+.05):(i+.05)/(s+.05)}const Hn=new Map;function ma(o,t){const e=o[0]+o[1]*256+o[2]*65536+t[0]*16777216+t[1]*4294967296+t[2]*1099511627776;let s=Hn.get(e);if(s)return s;const i=new Float32Array(9),n=i.subarray(0,3),r=i.subarray(3,6);On(o,r);const a=i.subarray(6,9);On(t,a);const l=a[2]<.5,c=l?12:4.5;if(r[2]=l?Math.sqrt(r[2]):1-Math.sqrt(1-r[2]),Un(r,a,n)<c){let h,d;l?(h=r[2],d=1):(h=0,d=r[2]);const f=.005;for(;d-h>f;){const p=r[2]=(h+d)/2;l===Un(r,a,n)<c?h=p:d=p}r[2]=l?d:h}return Ti(r,n),s=N.makeHexColor(Math.round(n[0]*255),Math.round(n[1]*255),Math.round(n[2]*255)),Hn.set(e,s),s}function Ji({html:o,dir:t,className:e},s){const i=document.createDocumentFragment();if(typeof o=="string"){const n=document.createElement("p");n.dir=t||"auto";const r=o.split(/(?:\r\n?|\n)/);for(let a=0,l=r.length;a<l;++a){const c=r[a];n.append(document.createTextNode(c)),a<l-1&&n.append(document.createElement("br"))}i.append(n)}else Ki.render({xfaHtml:o,div:i,intent:"richText"});i.firstElementChild.classList.add("richText",e),s.append(i)}function ba(o){const t=new Path2D;if(!o)return t;for(let e=0,s=o.length;e<s;)switch(o[e++]){case He.moveTo:t.moveTo(o[e++],o[e++]);break;case He.lineTo:t.lineTo(o[e++],o[e++]);break;case He.curveTo:t.bezierCurveTo(o[e++],o[e++],o[e++],o[e++],o[e++],o[e++]);break;case He.quadraticCurveTo:t.quadraticCurveTo(o[e++],o[e++],o[e++],o[e++]);break;case He.closePath:t.closePath();break;default:$(`Unrecognized drawing path operator: ${o[e-1]}`);break}return t}class Y{static#t=null;static#e=null;static#i=null;static#s=0;static#a=[];get pagesNumber(){return Y.#s}set pagesNumber(t){Y.#s!==t&&(Y.#s=t,t===0&&(Y.#e=null,Y.#t=null))}addListener(t){Y.#a.push(t)}removeListener(t){const e=Y.#a.indexOf(t);e>=0&&Y.#a.splice(e,1)}#r(){for(const t of Y.#a)t()}#n(t){if(Y.#e)return;const e=Y.#s,s=new Uint32Array(3*e),i=Y.#e=s.subarray(0,e),n=Y.#t=s.subarray(e,2*e);if(t)for(let r=0;r<e;r++)i[r]=n[r]=r+1;Y.#i=s.subarray(2*e)}movePages(t,e,s){this.#n(!0);const i=Y.#e,n=Y.#t;Y.#i.set(n);const r=e.length,a=new Uint32Array(r);let l=0;for(let p=0;p<r;p++){const b=e[p]-1;a[p]=i[b],b<s&&(l+=1)}const c=Y.#s;let h=s-l;const d=c-r;h=xt(h,0,d);for(let p=0,b=0;p<c;p++)t.has(p+1)||(i[b++]=i[p]);i.copyWithin(h+r,h,d),i.set(a,h);let f=!1;for(let p=0,b=c;p<b;p++){const g=i[p];f||=g!==p+1,n[g-1]=p+1}this.#r(),f||(this.pagesNumber=0)}hasBeenAltered(){return Y.#e!==null}getPageMappingForSaving(){return{pageIndices:Y.#t?Y.#t.map(t=>t-1):null}}getPrevPageNumber(t){return Y.#i[Y.#e[t-1]-1]}getPageNumber(t){return Y.#t?.[t-1]??t}getPageId(t){return Y.#e?.[t-1]??t}static get instance(){return H(this,"instance",new Y)}getMapping(){return Y.#e.subarray(0,this.pagesNumber)}}class Je{#t=null;#e=null;#i;#s=null;#a=null;#r=null;#n=null;#o=null;static#c=null;constructor(t){this.#i=t,Je.#c||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const t=this.#t=document.createElement("div");t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=this.#i._uiManager._signal;e instanceof AbortSignal&&!e.aborted&&(t.addEventListener("contextmenu",It,{signal:e}),t.addEventListener("pointerdown",Je.#l,{signal:e}));const s=this.#s=document.createElement("div");s.className="buttons",t.append(s);const i=this.#i.toolbarPosition;if(i){const{style:n}=t,r=this.#i._uiManager.direction==="ltr"?1-i[0]:i[0];n.insetInlineEnd=`${100*r}%`,n.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return this.#t}static#l(t){t.stopPropagation()}#u(t){this.#i._focusEventsAllowed=!1,nt(t)}#d(t){this.#i._focusEventsAllowed=!0,nt(t)}#f(t){const e=this.#i._uiManager._signal;return!(e instanceof AbortSignal)||e.aborted?!1:(t.addEventListener("focusin",this.#u.bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",this.#d.bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",It,{signal:e}),!0)}hide(){this.#t.classList.add("hidden"),this.#e?.hideDropdown()}show(){this.#t.classList.remove("hidden"),this.#a?.shown(),this.#r?.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=this.#i,s=document.createElement("button");s.classList.add("basic","deleteButton"),s.tabIndex=0,s.setAttribute("data-l10n-id",Je.#c[t]),this.#f(s)&&s.addEventListener("click",i=>{e.delete()},{signal:e._signal}),this.#s.append(s)}get#m(){const t=document.createElement("div");return t.className="divider",t}async addAltText(t){const e=await t.render();this.#f(e),this.#s.append(e,this.#m),this.#a=t}addComment(t,e=null){if(this.#r)return;const s=t.renderForToolbar();if(!s)return;this.#f(s);const i=this.#n=this.#m;e?(this.#s.insertBefore(s,e),this.#s.insertBefore(i,e)):this.#s.append(s,i),this.#r=t,t.toolbar=this}addColorPicker(t){if(this.#e)return;this.#e=t;const e=t.renderButton();this.#f(e),this.#s.append(e,this.#m)}async addEditSignatureButton(t){const e=this.#o=await t.renderEditButton(this.#i);this.#f(e),this.#s.append(e,this.#m)}removeButton(t){switch(t){case"comment":this.#r?.removeToolbarCommentButton(),this.#r=null,this.#n?.remove(),this.#n=null;break}}async addButton(t,e){switch(t){case"colorPicker":e&&this.addColorPicker(e);break;case"altText":e&&await this.addAltText(e);break;case"editSignature":e&&await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":e&&this.addComment(e);break}}async addButtonBefore(t,e,s){if(!e&&t==="comment")return;const i=this.#s.querySelector(s);i&&t==="comment"&&this.addComment(e,i)}updateEditSignatureButton(t){this.#o&&(this.#o.title=t)}remove(){this.#t.remove(),this.#e?.destroy(),this.#e=null}}class Eh{#t=null;#e=null;#i;constructor(t){this.#i=t}#s(){const t=this.#e=document.createElement("div");t.className="editToolbar",t.setAttribute("role","toolbar");const e=this.#i._signal;e instanceof AbortSignal&&!e.aborted&&t.addEventListener("contextmenu",It,{signal:e});const s=this.#t=document.createElement("div");return s.className="buttons",t.append(s),this.#i.hasCommentManager()&&this.#r("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#i.commentSelection("floating_button")}),this.#r("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#i.highlightSelection("floating_button")}),t}#a(t,e){let s=0,i=0;for(const n of t){const r=n.y+n.height;if(r<s)continue;const a=n.x+(e?n.width:0);if(r>s){i=a,s=r;continue}e?a>i&&(i=a):a<i&&(i=a)}return[e?1-i:i,s]}show(t,e,s){const[i,n]=this.#a(e,s),{style:r}=this.#e||=this.#s();t.append(this.#e),r.insetInlineEnd=`${100*i}%`,r.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){this.#e.remove()}#r(t,e,s,i){const n=document.createElement("button");n.classList.add("basic",t),n.tabIndex=0,n.setAttribute("data-l10n-id",e);const r=document.createElement("span");n.append(r),r.className="visuallyHidden",r.setAttribute("data-l10n-id",s);const a=this.#i._signal;a instanceof AbortSignal&&!a.aborted&&(n.addEventListener("contextmenu",It,{signal:a}),n.addEventListener("click",i,{signal:a})),this.#t.append(n)}}function ya(o,t,e){for(const s of e)t.addEventListener(s,o[s].bind(o))}class K{static#t=NaN;static#e=null;static#i=NaN;static#s=null;static initializeAndAddPointerId(t){(K.#e||=new Set).add(t)}static setPointer(t,e){K.#t||=e,K.#s??=t}static setTimeStamp(t){K.#i=t}static isSamePointerId(t){return K.#t===t}static isSamePointerIdOrRemove(t){return K.#t===t?!0:(K.#e?.delete(t),!1)}static isSamePointerType(t){return K.#s===t}static isInitializedAndDifferentPointerType(t){return K.#s!==null&&!K.isSamePointerType(t)}static isSameTimeStamp(t){return K.#i===t}static isUsingMultiplePointers(){return K.#e?.size>=1}static clearPointerType(){K.#s=null}static clearPointerIds(){K.#t=NaN,K.#e=null}static clearTimeStamp(){K.#i=NaN}}class Ch{#t=0;get id(){return`${Ze}${this.#t++}`}}class Qi{#t=qi();#e=0;#i=null;static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=t;const n=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return H(this,"_isSVGFittingCanvas",n)}async#s(t,e){this.#i||=new Map;let s=this.#i.get(t);if(s===null)return null;if(s?.bitmap)return s.refCounter+=1,s;try{s||={bitmap:null,id:`image_${this.#t}_${this.#e++}`,refCounter:0,isSvg:!1};let i;if(typeof e=="string"?(s.url=e,i=await Me(e,"blob")):e instanceof File?i=s.file=e:e instanceof Blob&&(i=e),i.type==="image/svg+xml"){const n=Qi._isSVGFittingCanvas,r=new FileReader,a=new Image,l=new Promise((c,h)=>{a.onload=()=>{s.bitmap=a,s.isSvg=!0,c()},r.onload=async()=>{const d=s.svgUrl=r.result;a.src=await n?`${d}#svgView(preserveAspectRatio(none))`:d},a.onerror=r.onerror=h});r.readAsDataURL(i),await l}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){$(i),s=null}return this.#i.set(t,s),s&&this.#i.set(s.id,s),s}async getFromFile(t){const{lastModified:e,name:s,size:i,type:n}=t;return this.#s(`${e}_${s}_${i}_${n}`,t)}async getFromUrl(t){return this.#s(t,t)}async getFromBlob(t,e){const s=await e;return this.#s(t,s)}async getFromId(t){this.#i||=new Map;const e=this.#i.get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:s}=e;return delete e.blobPromise,this.getFromBlob(e.id,s)}return this.getFromUrl(e.url)}getFromCanvas(t,e){this.#i||=new Map;let s=this.#i.get(t);if(s?.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(e.width,e.height);return i.getContext("2d").drawImage(e,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${this.#t}_${this.#e++}`,refCounter:1,isSvg:!1},this.#i.set(t,s),this.#i.set(s.id,s),s}getSvgUrl(t){const e=this.#i.get(t);return e?.isSvg?e.svgUrl:null}deleteId(t){this.#i||=new Map;const e=this.#i.get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:s}=e;if(!e.url&&!e.file){const i=new OffscreenCanvas(s.width,s.height);i.getContext("bitmaprenderer").transferFromImageBitmap(s),e.blobPromise=i.convertToBlob()}s.close?.(),e.bitmap=null}isValidId(t){return t.startsWith(`image_${this.#t}_`)}}class Th{#t=[];#e=!1;#i;#s=-1;constructor(t=128){this.#i=t}add({cmd:t,undo:e,post:s,mustExec:i,type:n=NaN,overwriteIfSameType:r=!1,keepUndo:a=!1}){if(i&&t(),this.#e)return;const l={cmd:t,undo:e,post:s,type:n};if(this.#s===-1){this.#t.length>0&&(this.#t.length=0),this.#s=0,this.#t.push(l);return}if(r&&this.#t[this.#s].type===n){a&&(l.undo=this.#t[this.#s].undo),this.#t[this.#s]=l;return}const c=this.#s+1;c===this.#i?this.#t.splice(0,1):(this.#s=c,c<this.#t.length&&this.#t.splice(c)),this.#t.push(l)}undo(){if(this.#s===-1)return;this.#e=!0;const{undo:t,post:e}=this.#t[this.#s];t(),e?.(),this.#e=!1,this.#s-=1}redo(){if(this.#s<this.#t.length-1){this.#s+=1,this.#e=!0;const{cmd:t,post:e}=this.#t[this.#s];t(),e?.(),this.#e=!1}}hasSomethingToUndo(){return this.#s!==-1}hasSomethingToRedo(){return this.#s<this.#t.length-1}cleanType(t){if(this.#s!==-1){for(let e=this.#s;e>=0;e--)if(this.#t[e].type!==t){this.#t.splice(e+1,this.#s-e),this.#s=e;return}this.#t.length=0,this.#s=-1}}destroy(){this.#t=null}}class cs{constructor(t){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=ut.platform;for(const[s,i,n={}]of t)for(const r of s){const a=r.startsWith("mac+");e&&a?(this.callbacks.set(r.slice(4),{callback:i,options:n}),this.allKeys.add(r.split("+").at(-1))):!e&&!a&&(this.callbacks.set(r,{callback:i,options:n}),this.allKeys.add(r.split("+").at(-1)))}}#t(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e}exec(t,e){if(!this.allKeys.has(e.key))return;const s=this.callbacks.get(this.#t(e));if(!s)return;const{callback:i,options:{bubbles:n=!1,args:r=[],checker:a=null}}=s;a&&!a(t,e)||(i.bind(t,...r,e)(),n||nt(e))}}class Zi{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return Ah(t),H(this,"_colors",t)}convert(t){const e=je(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[s,i]of this._colors)if(i.every((n,r)=>n===e[r]))return Zi._colorsMapping.get(s);return e}getHexCode(t){const e=this._colors.get(t);return e?N.makeHexColor(...e):t}}class re{#t=new AbortController;#e=null;#i=null;#s=new Map;#a=new Map;#r=null;#n=null;#o=null;#c=new Th;#l=null;#u=null;#d=null;#f=0;#m=new Set;#g=null;#h=null;#p=new Set;_editorUndoBar=null;#b=!1;#x=!1;#y=!1;#C=null;#S=null;#v=null;#_=null;#w=!1;#E=null;#R=new Ch;#k=!1;#P=!1;#F=!1;#N=null;#I=null;#O=null;#M=null;#W=null;#T=z.NONE;#A=new Set;#L=null;#B=null;#H=null;#X=null;#V=null;#Y={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#$=[0,0];#j=null;#G=null;#Q=null;#Z=null;#U=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const t=re.prototype,e=r=>r.#G.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&r.hasSomethingToControl(),s=(r,{target:a})=>{if(a instanceof HTMLInputElement){const{type:l}=a;return l!=="text"&&l!=="number"}return!0},i=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return H(this,"_keyboardManager",new cs([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],t.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:s}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&r.#G.contains(a)&&!r.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&r.#G.contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:e}]]))}constructor(t,e,s,i,n,r,a,l,c,h,d,f,p,b,g,m){const y=this._signal=this.#t.signal;this.#G=t,this.#Q=e,this.#Z=s,this.#r=i,this.#l=n,this.#B=r,this.#V=l,this._eventBus=a,a._on("editingaction",this.onEditingAction.bind(this),{signal:y}),a._on("pagechanging",this.onPageChanging.bind(this),{signal:y}),a._on("scalechanging",this.onScaleChanging.bind(this),{signal:y}),a._on("rotationchanging",this.onRotationChanging.bind(this),{signal:y}),a._on("setpreference",this.onSetPreference.bind(this),{signal:y}),a._on("switchannotationeditorparams",x=>this.updateParams(x.type,x.value),{signal:y}),a._on("pagesedited",this.onPagesEdited.bind(this),{signal:y}),window.addEventListener("pointerdown",()=>{this.#P=!0},{capture:!0,signal:y}),window.addEventListener("pointerup",()=>{this.#P=!1},{capture:!0,signal:y}),this.#at(),this.#ut(),this.#et(),this.#n=l.annotationStorage,this.#C=l.filterFactory,this.#H=c,this.#_=h||null,this.#b=d,this.#x=f,this.#y=p,this.#W=b||null,this.viewParameters={realScale:ge.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=g||null,this._supportsPinchToZoom=m!==!1,n?.setSidebarUiManager(this)}destroy(){this.#U?.resolve(),this.#U=null,this.#t?.abort(),this.#t=null,this._signal=null;for(const t of this.#a.values())t.destroy();this.#a.clear(),this.#s.clear(),this.#p.clear(),this.#M?.clear(),this.#e=null,this.#A.clear(),this.#c.destroy(),this.#r?.destroy(),this.#l?.destroy(),this.#B?.destroy(),this.#E?.hide(),this.#E=null,this.#O?.destroy(),this.#O=null,this.#i=null,this.#S&&(clearTimeout(this.#S),this.#S=null),this.#j&&(clearTimeout(this.#j),this.#j=null),this._editorUndoBar?.destroy(),this.#V=null}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return this.#W}get useNewAltTextFlow(){return this.#x}get useNewAltTextWhenAddingImage(){return this.#y}get hcmFilter(){return H(this,"hcmFilter",this.#H?this.#C.addHCMFilter(this.#H.foreground,this.#H.background):"none")}get direction(){return H(this,"direction",getComputedStyle(this.#G).direction)}get _highlightColors(){return H(this,"_highlightColors",this.#_?new Map(this.#_.split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return H(this,"highlightColors",null);const e=new Map,s=!!this.#H;for(const[i,n]of t){const r=i.endsWith("_HCM");if(s&&r){e.set(i.replace("_HCM",""),n);continue}!s&&!r&&e.set(i,n)}return H(this,"highlightColors",e)}get highlightColorNames(){return H(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#d=t}setMainHighlightColorPicker(t){this.#O=t}editAltText(t,e=!1){this.#r?.editAltText(this,t,e)}hasCommentManager(){return!!this.#l}editComment(t,e,s,i){this.#l?.showDialog(this,t,e,s,i)}selectComment(t,e){this.#a.get(t)?.getEditorByUID(e)?.toggleComment(!0,!0)}updateComment(t){this.#l?.updateComment(t.getData())}updatePopupColor(t){this.#l?.updatePopupColor(t)}removeComment(t){this.#l?.removeComments([t.uid])}deleteComment(t,e){const s=()=>{t.comment=e},i=()=>{this._editorUndoBar?.show(s,"comment"),this.toggleComment(null),t.comment=null};this.addCommands({cmd:i,undo:s,mustExec:!0})}toggleComment(t,e,s=void 0){this.#l?.toggleCommentPopup(t,e,s)}makeCommentColor(t,e){return t&&this.#l?.makeCommentColor(t,e)||null}getCommentDialogElement(){return this.#l?.dialogElement||null}async waitForEditorsRendered(t){if(this.#a.has(t-1))return;const{resolve:e,promise:s}=Promise.withResolvers(),i=n=>{n.pageNumber===t&&(this._eventBus._off("editorsrendered",i),e())};this._eventBus.on("editorsrendered",i),await s}getSignature(t){this.#B?.getSignature({uiManager:this,editor:t})}get signatureManager(){return this.#B}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":this.#y=e;break}}onPagesEdited({pagesMapper:t}){for(const i of this.#s.values())i.updatePageIndex(t.getPrevPageNumber(i.pageIndex+1)-1);const e=this.#a,s=this.#a=new Map;for(const[i,n]of e){const r=t.getPrevPageNumber(i+1)-1;if(r===-1){n.destroy();continue}s.set(r,n),n.updatePageIndex(r)}}onPageChanging({pageNumber:t}){this.#f=t-1}focusMainContainer(){this.#G.focus()}findParent(t,e){for(const s of this.#a.values()){const{x:i,y:n,width:r,height:a}=s.div.getBoundingClientRect();if(t>=i&&t<=i+r&&e>=n&&e<=n+a)return s}return null}disableUserSelect(t=!1){this.#Q.classList.toggle("noUserSelect",t)}addShouldRescale(t){this.#p.add(t)}removeShouldRescale(t){this.#p.delete(t)}onScaleChanging({scale:t}){this.commitOrRemove(),this.viewParameters.realScale=t*ge.PDF_TO_CSS_UNITS;for(const e of this.#p)e.onScaleChanging();this.#d?.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}#J({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t}#tt(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const s of this.#a.values())if(s.hasTextLayer(t))return s;return null}highlightSelection(t="",e=!1){const s=document.getSelection();if(!s||s.isCollapsed)return;const{anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:a}=s,l=s.toString(),h=this.#J(s).closest(".textLayer"),d=this.getSelectionBoxes(h);if(!d)return;s.empty();const f=this.#tt(h),p=this.#T===z.NONE,b=()=>{const g=f?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:d,anchorNode:i,anchorOffset:n,focusNode:r,focusOffset:a,text:l});p&&this.showAllEditors("highlight",!0,!0),e&&g?.editComment()};if(p){this.switchToMode(z.HIGHLIGHT,b);return}b()}commentSelection(t=""){this.highlightSelection(t,!0)}#nt(){const t=document.getSelection();if(!t||t.isCollapsed)return;const s=this.#J(t).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(this.#E||=new Eh(this),this.#E.show(s,i,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(t){if(!this.#n)return null;const e=`${Ze}${t}`,s=this.#n.getRawValue(e);return s&&this.#n.remove(e),s}addToAnnotationStorage(t){!t.isEmpty()&&this.#n&&!this.#n.has(t.id)&&this.#n.setValue(t.id,t)}a11yAlert(t,e=null){const s=this.#Z;s&&(s.setAttribute("data-l10n-id",t),e?s.setAttribute("data-l10n-args",JSON.stringify(e)):s.removeAttribute("data-l10n-args"))}#rt(){const t=document.getSelection();if(!t||t.isCollapsed){this.#L&&(this.#E?.hide(),this.#L=null,this.#D({hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===this.#L)return;const i=this.#J(t).closest(".textLayer");if(!i){this.#L&&(this.#E?.hide(),this.#L=null,this.#D({hasSelectedText:!1}));return}if(this.#E?.hide(),this.#L=e,this.#D({hasSelectedText:!0}),!(this.#T!==z.HIGHLIGHT&&this.#T!==z.NONE)&&(this.#T===z.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#w=this.isShiftKeyDown,!this.isShiftKeyDown)){const n=this.#T===z.HIGHLIGHT?this.#tt(i):null;if(n?.toggleDrawing(),this.#P){const r=new AbortController,a=this.combinedSignal(r),l=c=>{c.type==="pointerup"&&c.button!==0||(r.abort(),n?.toggleDrawing(!0),c.type==="pointerup"&&this.#q("main_toolbar"))};window.addEventListener("pointerup",l,{signal:a}),window.addEventListener("blur",l,{signal:a})}else n?.toggleDrawing(!0),this.#q("main_toolbar")}}#q(t=""){this.#T===z.HIGHLIGHT?this.highlightSelection(t):this.#b&&this.#nt()}#at(){document.addEventListener("selectionchange",this.#rt.bind(this),{signal:this._signal})}#ot(){if(this.#v)return;this.#v=new AbortController;const t=this.combinedSignal(this.#v);window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})}#lt(){this.#v?.abort(),this.#v=null}blur(){if(this.isShiftKeyDown=!1,this.#w&&(this.#w=!1,this.#q("main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of this.#A)if(e.div.contains(t)){this.#I=[e,t],e._focusEventsAllowed=!1;break}}focus(){if(!this.#I)return;const[t,e]=this.#I;this.#I=null,e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}#et(){if(this.#N)return;this.#N=new AbortController;const t=this.combinedSignal(this.#N);window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})}#ct(){this.#N?.abort(),this.#N=null}#ht(){if(this.#u)return;this.#u=new AbortController;const t=this.combinedSignal(this.#u);document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})}#dt(){this.#u?.abort(),this.#u=null}#ut(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})}addEditListeners(){this.#et(),this.setEditingState(!0)}removeEditListeners(){this.#ct(),this.setEditingState(!1)}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const s of this.#h)if(s.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const s of this.#h)if(s.isHandlingMimeForPasting(e.type)){s.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){if(t.preventDefault(),this.#e?.commitOrRemove(),!this.hasSelection)return;const e=[];for(const s of this.#A){const i=s.serialize(!0);i&&e.push(i)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const n of e.items)for(const r of this.#h)if(r.isHandlingMimeForPasting(n.type)){r.paste(n,this.currentLayer);return}let s=e.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(n){$(`paste: "${n.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const n=[];for(const l of s){const c=await i.deserialize(l);if(!c)return;n.push(c)}const r=()=>{for(const l of n)this.#st(l);this.#it(n)},a=()=>{for(const l of n)l.remove()};this.addCommands({cmd:r,undo:a,mustExec:!0})}catch(n){$(`paste: "${n.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),this.#T!==z.NONE&&!this.isEditorHandlingKeyboard&&re._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,this.#w&&(this.#w=!1,this.#q("main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#D(t){Object.entries(t).some(([s,i])=>this.#Y[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#Y,t)}),this.#T===z.HIGHLIGHT&&t.hasSelectedEditor===!1&&this.#z([[V.HIGHLIGHT_FREE,!0]]))}#z(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})}setEditingState(t){t?(this.#ot(),this.#ht(),this.#D({isEditing:this.#T!==z.NONE,isEmpty:this.#K(),hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:this.#c.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#lt(),this.#dt(),this.#D({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!this.#h){this.#h=t;for(const e of this.#h)this.#z(e.defaultPropertiesToUpdate)}}getId(){return this.#R.id}get currentLayer(){return this.#a.get(this.#f)}getLayer(t){return this.#a.get(t)}get currentPageIndex(){return this.#f}addLayer(t){this.#a.set(t.pageIndex,t),this.#k?t.enable():t.disable()}removeLayer(t){this.#a.delete(t.pageIndex)}async updateMode(t,e=null,s=!1,i=!1,n=!1,r=!1){if(this.#T!==t&&!(this.#U&&(await this.#U.promise,!this.#U))){if(this.#U=Promise.withResolvers(),this.#d?.commitOrRemove(),this.#T===z.POPUP&&this.#l?.hideSidebar(),this.#l?.destroyPopup(),this.#T=t,t===z.NONE){this.setEditingState(!1),this.#pt();for(const a of this.#s.values())a.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#U.resolve();return}for(const a of this.#s.values())a.addStandaloneCommentButton();t===z.SIGNATURE&&await this.#B?.loadSignatures(),s&&K.clearPointerType(),this.setEditingState(!0),await this.#ft(),this.unselectAll();for(const a of this.#a.values())a.updateMode(t);if(t===z.POPUP){this.#i||=await this.#V.getAnnotationsByType(new Set(this.#h.map(c=>c._editorType)));const a=new Set,l=[];for(const c of this.#s.values()){const{annotationElementId:h,hasComment:d,deleted:f}=c;h&&a.add(h),d&&!f&&l.push(c.getData())}for(const c of this.#i){const{id:h,popupRef:d,contentsObj:f}=c;d&&f?.str&&!a.has(h)&&!this.#m.has(h)&&l.push(c)}this.#l?.showSidebar(l)}if(!e){i&&this.addNewEditorFromKeyboard(),this.#U.resolve();return}for(const a of this.#s.values())a.uid===e?(this.setSelected(a),r?a.editComment():n?a.enterInEditMode():a.focus()):a.unselect();this.#U.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==this.#T&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(this.#h){switch(t){case V.CREATE:this.currentLayer.addNewEditor(e);return;case V.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#X||=new Map).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const s of this.#A)s.updateParams(t,e);else for(const s of this.#h)s.updateDefaultParams(t,e)}}showAllEditors(t,e,s=!1){for(const n of this.#s.values())n.editorType===t&&n.show(e);(this.#X?.get(V.HIGHLIGHT_SHOW_ALL)??!0)!==e&&this.#z([[V.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(this.#F!==t){this.#F=t;for(const e of this.#a.values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}async#ft(){if(!this.#k){this.#k=!0;const t=[];for(const e of this.#a.values())t.push(e.enable());await Promise.all(t);for(const e of this.#s.values())e.enable()}}#pt(){if(this.unselectAll(),this.#k){this.#k=!1;for(const t of this.#a.values())t.disable();for(const t of this.#s.values())t.disable()}}*getEditors(t){for(const e of this.#s.values())e.pageIndex===t&&(yield e)}getEditor(t){return this.#s.get(t)}addEditor(t){this.#s.set(t.id,t)}removeEditor(t){t.div.contains(document.activeElement)&&(this.#S&&clearTimeout(this.#S),this.#S=setTimeout(()=>{this.focusMainContainer(),this.#S=null},0)),this.#s.delete(t.id),t.annotationElementId&&this.#M?.delete(t.annotationElementId),this.unselect(t),(!t.annotationElementId||!this.#m.has(t.annotationElementId))&&this.#n?.remove(t.id)}addDeletedAnnotationElement(t){this.#m.add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return this.#m.has(t)}removeDeletedAnnotationElement(t){this.#m.delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}#st(t){const e=this.#a.get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))}setActiveEditor(t){this.#e!==t&&(this.#e=t,t&&this.#z(t.propertiesToUpdate))}get#gt(){let t=null;for(t of this.#A);return t}updateUI(t){this.#gt===t&&this.#z(t.propertiesToUpdate)}updateUIForDefaultProperties(t){this.#z(t.defaultPropertiesToUpdate)}toggleSelected(t){if(this.#A.has(t)){this.#A.delete(t),t.unselect(),this.#D({hasSelectedEditor:this.hasSelection});return}this.#A.add(t),t.select(),this.#z(t.propertiesToUpdate),this.#D({hasSelectedEditor:!0})}setSelected(t){this.updateToolbar({mode:t.mode,editId:t.uid}),this.#d?.commitOrRemove();for(const e of this.#A)e!==t&&e.unselect();this.#A.clear(),this.#A.add(t),t.select(),this.#z(t.propertiesToUpdate),this.#D({hasSelectedEditor:!0})}isSelected(t){return this.#A.has(t)}get firstSelectedEditor(){return this.#A.values().next().value}unselect(t){t.unselect(),this.#A.delete(t),this.#D({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#A.size!==0}get isEnterHandled(){return this.#A.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#c.undo(),this.#D({hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#K()}),this._editorUndoBar?.hide()}redo(){this.#c.redo(),this.#D({hasSomethingToUndo:!0,hasSomethingToRedo:this.#c.hasSomethingToRedo(),isEmpty:this.#K()})}addCommands(t){this.#c.add(t),this.#D({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#K()})}cleanUndoStack(t){this.#c.cleanType(t)}#K(){if(this.#s.size===0)return!0;if(this.#s.size===1)for(const t of this.#s.values())return t.isEmpty();return!1}delete(){this.commitOrRemove();const t=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...this.#A],s=()=>{this._editorUndoBar?.show(i,e.length===1?e[0].editorType:e.length);for(const n of e)n.remove()},i=()=>{for(const n of e)this.#st(n)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){this.#e?.commitOrRemove()}hasSomethingToControl(){return this.#e||this.hasSelection}#it(t){for(const e of this.#A)e.unselect();this.#A.clear();for(const e of t)e.isEmpty()||(this.#A.add(e),e.select());this.#D({hasSelectedEditor:this.hasSelection})}selectAll(){for(const t of this.#A)t.commit();this.#it(this.#s.values())}unselectAll(){if(!(this.#e&&(this.#e.commitOrRemove(),this.#T!==z.NONE))&&!this.#d?.commitOrRemove()&&this.hasSelection){for(const t of this.#A)t.unselect();this.#A.clear(),this.#D({hasSelectedEditor:!1})}}translateSelectedEditors(t,e,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;this.#$[0]+=t,this.#$[1]+=e;const[i,n]=this.#$,r=[...this.#A],a=1e3;this.#j&&clearTimeout(this.#j),this.#j=setTimeout(()=>{this.#j=null,this.#$[0]=this.#$[1]=0,this.addCommands({cmd:()=>{for(const l of r)this.#s.has(l.id)&&(l.translateInPage(i,n),l.translationDone())},undo:()=>{for(const l of r)this.#s.has(l.id)&&(l.translateInPage(-i,-n),l.translationDone())},mustExec:!1})},a);for(const l of r)l.translateInPage(t,e),l.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#g=new Map;for(const t of this.#A)this.#g.set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#g)return!1;this.disableUserSelect(!1);const t=this.#g;this.#g=null;let e=!1;for(const[{x:i,y:n,pageIndex:r},a]of t)a.newX=i,a.newY=n,a.newPageIndex=r,e||=i!==a.savedX||n!==a.savedY||r!==a.savedPageIndex;if(!e)return!1;const s=(i,n,r,a)=>{if(this.#s.has(i.id)){const l=this.#a.get(a);l?i._setParentAndPosition(l,n,r):(i.pageIndex=a,i.x=n,i.y=r)}};return this.addCommands({cmd:()=>{for(const[i,{newX:n,newY:r,newPageIndex:a}]of t)s(i,n,r,a)},undo:()=>{for(const[i,{savedX:n,savedY:r,savedPageIndex:a}]of t)s(i,n,r,a)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(this.#g)for(const s of this.#g.keys())s.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#A.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return this.#e===t}getActive(){return this.#e}getMode(){return this.#T}isEditingMode(){return this.#T!==z.NONE}get imageManager(){return H(this,"imageManager",new Qi)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let c=0,h=e.rangeCount;c<h;c++)if(!t.contains(e.getRangeAt(c).commonAncestorContainer))return null;const{x:s,y:i,width:n,height:r}=t.getBoundingClientRect();let a;switch(t.getAttribute("data-main-rotation")){case"90":a=(c,h,d,f)=>({x:(h-i)/r,y:1-(c+d-s)/n,width:f/r,height:d/n});break;case"180":a=(c,h,d,f)=>({x:1-(c+d-s)/n,y:1-(h+f-i)/r,width:d/n,height:f/r});break;case"270":a=(c,h,d,f)=>({x:1-(h+f-i)/r,y:(c-s)/n,width:f/r,height:d/n});break;default:a=(c,h,d,f)=>({x:(c-s)/n,y:(h-i)/r,width:d/n,height:f/r});break}const l=[];for(let c=0,h=e.rangeCount;c<h;c++){const d=e.getRangeAt(c);if(!d.collapsed)for(const{x:f,y:p,width:b,height:g}of d.getClientRects())b===0||g===0||l.push(a(f,p,b,g))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:t,id:e}){(this.#o||=new Map).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){this.#o?.delete(t)}renderAnnotationElement(t){const e=this.#o?.get(t.data.id);if(!e)return;const s=this.#n.getRawValue(e);s&&(this.#T===z.NONE&&!s.hasBeenModified||s.renderAnnotationElement(t))}setMissingCanvas(t,e,s){const i=this.#M?.get(t);i&&(i.setCanvas(e,s),this.#M.delete(t))}addMissingCanvas(t,e){(this.#M||=new Map).set(t,e)}}class Kt{#t=null;#e=!1;#i=null;#s=null;#a=null;#r=null;#n=!1;#o=null;#c=null;#l=null;#u=null;#d=!1;static#f=null;static _l10n=null;constructor(t){this.#c=t,this.#d=t._uiManager.useNewAltTextFlow,Kt.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(t){Kt._l10n??=t}async render(){const t=this.#i=document.createElement("button");t.className="altText",t.tabIndex="0";const e=this.#s=document.createElement("span");t.append(e),this.#d?(t.classList.add("new"),t.setAttribute("data-l10n-id",Kt.#f.missing),e.setAttribute("data-l10n-id",Kt.#f["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=this.#c._uiManager._signal;t.addEventListener("contextmenu",It,{signal:s}),t.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:s});const i=n=>{n.preventDefault(),this.#c._uiManager.editAltText(this.#c),this.#d&&this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#m}})};return t.addEventListener("click",i,{capture:!0,signal:s}),t.addEventListener("keydown",n=>{n.target===t&&n.key==="Enter"&&(this.#n=!0,i(n))},{signal:s}),await this.#g(),t}get#m(){return this.#t&&"added"||this.#t===null&&this.guessedText&&"review"||"missing"}finish(){this.#i&&(this.#i.focus({focusVisible:this.#n}),this.#n=!1)}isEmpty(){return this.#d?this.#t===null:!this.#t&&!this.#e}hasData(){return this.#d?this.#t!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}async setGuessedText(t){this.#t===null&&(this.#l=t,this.#u=await Kt._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t}),this.#g())}toggleAltTextBadge(t=!1){if(!this.#d||this.#t){this.#o?.remove(),this.#o=null;return}if(!this.#o){const e=this.#o=document.createElement("div");e.className="noAltTextBadge",this.#c.div.append(e)}this.#o.classList.toggle("hidden",!t)}serialize(t){let e=this.#t;return!t&&this.#l===e&&(e=this.#u),{altText:e,decorative:this.#e,guessedText:this.#l,textWithDisclaimer:this.#u}}get data(){return{altText:this.#t,decorative:this.#e}}set data({altText:t,decorative:e,guessedText:s,textWithDisclaimer:i,cancel:n=!1}){s&&(this.#l=s,this.#u=i),!(this.#t===t&&this.#e===e)&&(n||(this.#t=t,this.#e=e),this.#g())}toggle(t=!1){this.#i&&(!t&&this.#r&&(clearTimeout(this.#r),this.#r=null),this.#i.disabled=!t)}shown(){this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#m}})}destroy(){this.#i?.remove(),this.#i=null,this.#s=null,this.#a=null,this.#o?.remove(),this.#o=null}async#g(){const t=this.#i;if(!t)return;if(this.#d){if(t.classList.toggle("done",!!this.#t),t.setAttribute("data-l10n-id",Kt.#f[this.#m]),this.#s?.setAttribute("data-l10n-id",Kt.#f[`${this.#m}-label`]),!this.#t){this.#a?.remove();return}}else{if(!this.#t&&!this.#e){t.classList.remove("done"),this.#a?.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=this.#a;if(!e){this.#a=e=document.createElement("span"),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${this.#c.id}`;const i=100,n=this.#c._uiManager._signal;n.addEventListener("abort",()=>{clearTimeout(this.#r),this.#r=null},{once:!0}),t.addEventListener("mouseenter",()=>{this.#r=setTimeout(()=>{this.#r=null,this.#a.classList.add("show"),this.#c._reportTelemetry({action:"alt_text_tooltip"})},i)},{signal:n}),t.addEventListener("mouseleave",()=>{this.#r&&(clearTimeout(this.#r),this.#r=null),this.#a?.classList.remove("show")},{signal:n})}this.#e?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=this.#t),e.parentNode||t.append(e),this.#c.getElementForAltText()?.setAttribute("aria-describedby",e.id)}}class ms{#t=null;#e=null;#i=!1;#s=null;#a=null;#r=null;#n=null;#o=null;#c=!1;#l=null;constructor(t){this.#s=t}renderForToolbar(){const t=this.#e=document.createElement("button");return t.className="comment",this.#u(t,!1)}renderForStandalone(){const t=this.#t=document.createElement("button");t.className="annotationCommentButton";const e=this.#s.commentButtonPosition;if(e){const{style:s}=t;s.insetInlineEnd=`calc(${100*(this.#s._uiManager.direction==="ltr"?1-e[0]:e[0])}% - var(--comment-button-dim))`,s.top=`calc(${100*e[1]}% - var(--comment-button-dim))`;const i=this.#s.commentButtonColor;i&&(s.backgroundColor=i)}return this.#u(t,!0)}focusButton(){setTimeout(()=>{(this.#t??this.#e)?.focus()},0)}onUpdatedColor(){if(!this.#t)return;const t=this.#s.commentButtonColor;t&&(this.#t.style.backgroundColor=t),this.#s._uiManager.updatePopupColor(this.#s)}get commentButtonWidth(){return(this.#t?.getBoundingClientRect().width??0)/this.#s.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#l)return this.#l;if(!this.#t)return null;const{x:t,y:e,height:s}=this.#t.getBoundingClientRect(),{x:i,y:n,width:r,height:a}=this.#s.parent.boundingClientRect;return[(t-i)/r,(e+s-n)/a]}set commentPopupPositionInLayer(t){this.#l=t}hasDefaultPopupPosition(){return this.#l===null}removeStandaloneCommentButton(){this.#t?.remove(),this.#t=null}removeToolbarCommentButton(){this.#e?.remove(),this.#e=null}setCommentButtonStates({selected:t,hasPopup:e}){this.#t&&(this.#t.classList.toggle("selected",t),this.#t.ariaExpanded=e)}#u(t,e){if(!this.#s._uiManager.hasCommentManager())return null;t.tabIndex="0",t.ariaHasPopup="dialog",e?(t.ariaControls="commentPopup",t.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(t.ariaControlsElements=[this.#s._uiManager.getCommentDialogElement()],t.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const s=this.#s._uiManager._signal;if(!(s instanceof AbortSignal)||s.aborted)return t;t.addEventListener("contextmenu",It,{signal:s}),e&&(t.addEventListener("focusin",n=>{this.#s._focusEventsAllowed=!1,nt(n)},{capture:!0,signal:s}),t.addEventListener("focusout",n=>{this.#s._focusEventsAllowed=!0,nt(n)},{capture:!0,signal:s})),t.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:s});const i=n=>{n.preventDefault(),t===this.#e?this.edit():this.#s.toggleComment(!0)};return t.addEventListener("click",i,{capture:!0,signal:s}),t.addEventListener("keydown",n=>{n.target===t&&n.key==="Enter"&&(this.#i=!0,i(n))},{signal:s}),t.addEventListener("pointerenter",()=>{this.#s.toggleComment(!1,!0)},{signal:s}),t.addEventListener("pointerleave",()=>{this.#s.toggleComment(!1,!1)},{signal:s}),t}edit(t){const e=this.commentPopupPositionInLayer;let s,i;if(e)[s,i]=e;else{[s,i]=this.#s.commentButtonPosition;const{width:h,height:d,x:f,y:p}=this.#s;s=f+s*h,i=p+i*d}const n=this.#s.parent.boundingClientRect,{x:r,y:a,width:l,height:c}=n;this.#s._uiManager.editComment(this.#s,r+s*l,a+i*c,{...t,parentDimensions:n})}finish(){this.#e&&(this.#e.focus({focusVisible:this.#i}),this.#i=!1)}isDeleted(){return this.#c||this.#n===""}isEmpty(){return this.#n===null}hasBeenEdited(){return this.isDeleted()||this.#n!==this.#a}serialize(){return this.data}get data(){return{text:this.#n,richText:this.#r,date:this.#o,deleted:this.isDeleted()}}set data(t){if(t!==this.#n&&(this.#r=null),t===null){this.#n="",this.#c=!0;return}this.#n=t,this.#o=new Date,this.#c=!1}restoreData({text:t,richText:e,date:s}){this.#n=t,this.#r=e,this.#o=s,this.#c=!1}setInitialText(t,e=null){this.#a=t,this.data=t,this.#o=null,this.#r=e}shown(){}destroy(){this.#e?.remove(),this.#e=null,this.#t?.remove(),this.#t=null,this.#n="",this.#r=null,this.#o=null,this.#s=null,this.#i=!1,this.#c=!1}}class hs{#t;#e=!1;#i=null;#s;#a;#r;#n;#o=null;#c;#l=null;#u;#d=null;constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:n=null,onPinchEnd:r=null,signal:a}){this.#t=t,this.#i=s,this.#s=e,this.#a=i,this.#r=n,this.#n=r,this.#u=new AbortController,this.#c=AbortSignal.any([a,this.#u.signal]),t.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#c})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/zt.pixelRatio}#f(t){if(this.#s?.())return;if(t.touches.length===1){if(this.#o)return;const i=this.#o=new AbortController,n=AbortSignal.any([this.#c,i.signal]),r=this.#t,a={capture:!0,signal:n,passive:!1},l=c=>{c.pointerType==="touch"&&(this.#o?.abort(),this.#o=null)};r.addEventListener("pointerdown",c=>{c.pointerType==="touch"&&(nt(c),l(c))},a),r.addEventListener("pointerup",l,a),r.addEventListener("pointercancel",l,a);return}if(!this.#d){this.#d=new AbortController;const i=AbortSignal.any([this.#c,this.#d.signal]),n=this.#t,r={signal:i,capture:!1,passive:!1};n.addEventListener("touchmove",this.#m.bind(this),r);const a=this.#g.bind(this);n.addEventListener("touchend",a,r),n.addEventListener("touchcancel",a,r),r.capture=!0,n.addEventListener("pointerdown",nt,r),n.addEventListener("pointermove",nt,r),n.addEventListener("pointercancel",nt,r),n.addEventListener("pointerup",nt,r),this.#a?.()}if(nt(t),t.touches.length!==2||this.#i?.()){this.#l=null;return}let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]),this.#l={touch0X:e.screenX,touch0Y:e.screenY,touch1X:s.screenX,touch1Y:s.screenY}}#m(t){if(!this.#l||t.touches.length!==2)return;nt(t);let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]);const{screenX:i,screenY:n}=e,{screenX:r,screenY:a}=s,l=this.#l,{touch0X:c,touch0Y:h,touch1X:d,touch1Y:f}=l,p=d-c,b=f-h,g=r-i,m=a-n,y=Math.hypot(g,m)||1,x=Math.hypot(p,b)||1;if(!this.#e&&Math.abs(x-y)<=hs.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=i,l.touch0Y=n,l.touch1X=r,l.touch1Y=a,!this.#e){this.#e=!0;return}const w=[(i+r)/2,(n+a)/2];this.#r?.(w,x,y)}#g(t){t.touches.length>=2||(this.#d&&(this.#d.abort(),this.#d=null,this.#n?.()),this.#l&&(nt(t),this.#l=null,this.#e=!1))}destroy(){this.#u?.abort(),this.#u=null,this.#o?.abort(),this.#o=null}}class F{#t=null;#e=null;#i=null;#s=null;#a=null;#r=!1;#n=null;#o="";#c=null;#l=null;#u=null;#d=null;#f=null;#m="";#g=!1;#h=null;#p=!1;#b=!1;#x=!1;#y=null;#C=0;#S=0;#v=null;#_=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#w=!1;#E=F._zIndex++;static _borderLineWidth=-1;static _colorManager=new Zi;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const t=F.prototype._resizeWithKeyboard,e=re.TRANSLATE_SMALL,s=re.TRANSLATE_BIG;return H(this,"_resizerKeyboardManager",new cs([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,s]}],[["Escape","mac+Escape"],F.prototype._stopResizingWithKeyboard]]))}constructor(t){this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null,this.creationDate=t.creationDate||new Date,this.modificationDate=t.modificationDate||null,this.canAddComment=!0;const{rotation:e,rawDims:{pageWidth:s,pageHeight:i,pageX:n,pageY:r}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[n,r];const[a,l]=this.parentDimensions;this.x=t.x/a,this.y=t.y/l,this.isAttachedToDOM=!1,this.deleted=!1}updatePageIndex(t){this.pageIndex=t}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return H(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new _h({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(F._l10n??=t,F._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),F._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);F._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){Q("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#w}set _isDraggable(t){this.#w=t,this.div?.classList.toggle("draggable",t)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#E}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):(this.#j(),this.#d?.remove(),this.#d=null),this.parent=t}focusin(t){this._focusEventsAllowed&&(this.#g?this.#g=!1:this.parent.setSelected(this))}focusout(t){!this._focusEventsAllowed||!this.isAttachedToDOM||t.relatedTarget?.closest(`#${this.id}`)||(t.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,s,i){const[n,r]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(t+s)/n,this.y=(e+i)/r,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[s,i]=this.parentDimensions;this.setAt(t*s,e*i,this.width*s,this.height*i),this._onTranslated()}#R([t,e],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/t,this.y+=i/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(t,e){this.#R(this.parentDimensions,t,e)}translateInPage(t,e){this.#h||=[this.x,this.y,this.width,this.height],this.#R(this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){this.#h||=[this.x,this.y,this.width,this.height];const{div:s,parentDimensions:[i,n]}=this;if(this.x+=t/i,this.y+=e/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:d,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,d,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:a}=this;const[l,c]=this.getBaseTranslation();r+=l,a+=c;const{style:h}=s;h.left=`${(100*r).toFixed(2)}%`,h.top=`${(100*a).toFixed(2)}%`,this._onTranslating(r,a),s.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!this.#h&&(this.#h[0]!==this.x||this.#h[1]!==this.y)}get _hasBeenResized(){return!!this.#h&&(this.#h[2]!==this.width||this.#h[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:s}=F,i=s/t,n=s/e;switch(this.rotation){case 90:return[-i,n];case 180:return[i,n];case 270:return[i,-n];default:return[-i,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[s,i]}=this;let{x:n,y:r,width:a,height:l}=this;if(a*=s,l*=i,n*=s,r*=i,this._mustFixPosition)switch(t){case 0:n=xt(n,0,s-a),r=xt(r,0,i-l);break;case 90:n=xt(n,0,s-l),r=xt(r,a,i);break;case 180:n=xt(n,a,s),r=xt(r,l,i);break;case 270:n=xt(n,l,s),r=xt(r,0,i-a);break}this.x=n/=s,this.y=r/=i;const[c,h]=this.getBaseTranslation();n+=c,r+=h,e.left=`${(100*n).toFixed(2)}%`,e.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}static#k(t,e,s){switch(s){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}}screenToPageTranslation(t,e){return F.#k(t,e,this.parentRotation)}pageTranslationToScreen(t,e){return F.#k(t,e,360-this.parentRotation)}#P(t){switch(t){case 90:{const[e,s]=this.pageDimensions;return[0,-e/s,s/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,s]=this.pageDimensions;return[0,e/s,-s/e,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,s]}=this;return[e*t,s*t]}setDims(){const{div:{style:t},width:e,height:s}=this;t.width=`${(100*e).toFixed(2)}%`,t.height=`${(100*s).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#F(){if(this.#c)return;this.#c=document.createElement("div"),this.#c.classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const s of t){const i=document.createElement("div");this.#c.append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",this.#N.bind(this,s),{signal:e}),i.addEventListener("contextmenu",It,{signal:e}),i.tabIndex=-1}this.div.prepend(this.#c)}#N(t,e){e.preventDefault();const{isMac:s}=ut.platform;if(e.button!==0||e.ctrlKey&&s)return;this.#i?.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,this.#l=[e.screenX,e.screenY];const n=new AbortController,r=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#M.bind(this,t),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",nt,{passive:!1,signal:r}),window.addEventListener("contextmenu",It,{signal:r}),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const c=()=>{n.abort(),this.parent.togglePointerEvents(!0),this.#i?.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=a,this.div.style.cursor=l,this.#O()};window.addEventListener("pointerup",c,{signal:r}),window.addEventListener("blur",c,{signal:r})}#I(t,e,s,i){this.width=s,this.height=i,this.x=t,this.y=e,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#O(){if(!this.#u)return;const{savedX:t,savedY:e,savedWidth:s,savedHeight:i}=this.#u;this.#u=null;const n=this.x,r=this.y,a=this.width,l=this.height;n===t&&r===e&&a===s&&l===i||this.addCommands({cmd:this.#I.bind(this,n,r,a,l),undo:this.#I.bind(this,t,e,s,i),mustExec:!0})}static _round(t){return Math.round(t*1e4)/1e4}#M(t,e){const[s,i]=this.parentDimensions,n=this.x,r=this.y,a=this.width,l=this.height,c=F.MIN_SIZE/s,h=F.MIN_SIZE/i,d=this.#P(this.rotation),f=(D,I)=>[d[0]*D+d[2]*I,d[1]*D+d[3]*I],p=this.#P(360-this.rotation),b=(D,I)=>[p[0]*D+p[2]*I,p[1]*D+p[3]*I];let g,m,y=!1,x=!1;switch(t){case"topLeft":y=!0,g=(D,I)=>[0,0],m=(D,I)=>[D,I];break;case"topMiddle":g=(D,I)=>[D/2,0],m=(D,I)=>[D/2,I];break;case"topRight":y=!0,g=(D,I)=>[D,0],m=(D,I)=>[0,I];break;case"middleRight":x=!0,g=(D,I)=>[D,I/2],m=(D,I)=>[0,I/2];break;case"bottomRight":y=!0,g=(D,I)=>[D,I],m=(D,I)=>[0,0];break;case"bottomMiddle":g=(D,I)=>[D/2,I],m=(D,I)=>[D/2,0];break;case"bottomLeft":y=!0,g=(D,I)=>[0,I],m=(D,I)=>[D,0];break;case"middleLeft":x=!0,g=(D,I)=>[0,I/2],m=(D,I)=>[D,I/2];break}const w=g(a,l),v=m(a,l);let A=f(...v);const E=F._round(n+A[0]),C=F._round(r+A[1]);let P=1,T=1,_,k;if(e.fromKeyboard)({deltaX:_,deltaY:k}=e);else{const{screenX:D,screenY:I}=e,[W,pt]=this.#l;[_,k]=this.screenToPageTranslation(D-W,I-pt),this.#l[0]=D,this.#l[1]=I}if([_,k]=b(_/s,k/i),y){const D=Math.hypot(a,l);P=T=Math.max(Math.min(Math.hypot(v[0]-w[0]-_,v[1]-w[1]-k)/D,1/a,1/l),c/a,h/l)}else x?P=xt(Math.abs(v[0]-w[0]-_),c,1)/a:T=xt(Math.abs(v[1]-w[1]-k),h,1)/l;const R=F._round(a*P),M=F._round(l*T);A=f(...m(R,M));const O=E-A[0],G=C-A[1];this.#h||=[this.x,this.y,this.width,this.height],this.width=R,this.height=M,this.x=O,this.y=G,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#i?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#b)return this._editToolbar;this._editToolbar=new Je(this),this.div.append(this._editToolbar.render());const{toolbarButtons:t}=this;if(t)for(const[e,s]of t)await this._editToolbar.addButton(e,s);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#i?.destroy()}addContainer(t){const e=this._editToolbar?.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#i||(Kt.initialize(F._l10n),this.#i=new Kt(this),this.#t&&(this.#i.data=this.#t,this.#t=null)),this.#i}get altTextData(){return this.#i?.data}set altTextData(t){this.#i&&(this.#i.data=t)}get guessedAltText(){return this.#i?.guessedText}async setGuessedAltText(t){await this.#i?.setGuessedText(t)}serializeAltText(t){return this.#i?.serialize(t)}hasAltText(){return!!this.#i&&!this.#i.isEmpty()}hasAltTextData(){return this.#i?.hasData()??!1}focusCommentButton(){this.#s?.focusButton()}addCommentButton(){return this.canAddComment?this.#s||=new ms(this):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(this.#a){this._uiManager.isEditingMode()&&this.#a.classList.remove("hidden");return}this.hasComment&&(this.#a=this.#s.renderForStandalone(),this.div.append(this.#a))}}removeStandaloneCommentButton(){this.#s.removeStandaloneCommentButton(),this.#a=null}hideStandaloneCommentButton(){this.#a?.classList.add("hidden")}get comment(){if(!this.#s)return null;const{data:{richText:t,text:e,date:s,deleted:i}}=this.#s;return{text:e,richText:t,date:s,deleted:i,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(t){this.#s||=new ms(this),typeof t=="object"&&t!==null?this.#s.restoreData(t):this.#s.data=t,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:t,popupRef:e,richText:s}){if(!e||(this.#s||=new ms(this),this.#s.setInitialText(t,s),!this.annotationElementId))return;const i=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);i&&this.updateFromAnnotationLayer(i)}get hasEditedComment(){return this.#s?.hasBeenEdited()}get hasDeletedComment(){return this.#s?.isDeleted()}get hasComment(){return!!this.#s&&!this.#s.isEmpty()&&!this.#s.isDeleted()}async editComment(t){this.#s||=new ms(this),this.#s.edit(t)}toggleComment(t,e=void 0){this.hasComment&&this._uiManager.toggleComment(this,t,e)}setSelectedCommentButton(t){this.#s.setSelectedButton(t)}addComment(t){if(this.hasEditedComment){const[,,,i]=t.rect,[n]=this.pageDimensions,[r]=this.pageTranslation,a=r+n+1,l=i-100,c=a+180;t.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[a,l,c,i]}}}updateFromAnnotationLayer({popup:{contents:t,deleted:e}}){this.#s.data=e?null:t}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=this.#r?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),this.#H();const[e,s]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*s/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/s).toFixed(2)}%`);const[i,n]=this.getInitialTranslation();return this.translate(i,n),ya(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#_||=new hs({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#W.bind(this),onPinching:this.#T.bind(this),onPinchEnd:this.#A.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),t}#W(){this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#i?.toggle(!1),this.parent.togglePointerEvents(!1)}#T(t,e,s){let n=.7*(s/e)+1-.7;if(n===1)return;const r=this.#P(this.rotation),a=(E,C)=>[r[0]*E+r[2]*C,r[1]*E+r[3]*C],[l,c]=this.parentDimensions,h=this.x,d=this.y,f=this.width,p=this.height,b=F.MIN_SIZE/l,g=F.MIN_SIZE/c;n=Math.max(Math.min(n,1/f,1/p),b/f,g/p);const m=F._round(f*n),y=F._round(p*n);if(m===f&&y===p)return;this.#h||=[h,d,f,p];const x=a(f/2,p/2),w=F._round(h+x[0]),v=F._round(d+x[1]),A=a(m/2,y/2);this.x=w-A[0],this.y=v-A[1],this.width=m,this.height=y,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#A(){this.#i?.toggle(!0),this.parent.togglePointerEvents(!0),this.#O()}pointerdown(t){const{isMac:e}=ut.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(this.#g=!0,this._isDraggable){this.#B(t);return}this.#L(t)}#L(t){const{isMac:e}=ut.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)}#B(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,n=this._uiManager.combinedSignal(i),r={capture:!0,passive:!1,signal:n},a=c=>{i.abort(),this.#n=null,this.#g=!1,this._uiManager.endDragSession()||this.#L(c),s&&this._onStopDragging()};e&&(this.#C=t.clientX,this.#S=t.clientY,this.#n=t.pointerId,this.#o=t.pointerType,window.addEventListener("pointermove",c=>{s||(s=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:h,clientY:d,pointerId:f}=c;if(f!==this.#n){nt(c);return}const[p,b]=this.screenToPageTranslation(h-this.#C,d-this.#S);this.#C=h,this.#S=d,this._uiManager.dragSelectedEditors(p,b)},r),window.addEventListener("touchmove",nt,r),window.addEventListener("pointerdown",c=>{c.pointerType===this.#o&&(this.#_||c.isPrimary)&&a(c),nt(c)},r));const l=c=>{if(!this.#n||this.#n===c.pointerId){a(c);return}nt(c)};window.addEventListener("pointerup",l,{signal:n}),window.addEventListener("blur",l,{signal:n})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.#y=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(t,e,s){t.changeParent(this),this.x=e,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,s=this.rotation){const i=this.parentScale,[n,r]=this.pageDimensions,[a,l]=this.pageTranslation,c=t/i,h=e/i,d=this.x*n,f=this.y*r,p=this.width*n,b=this.height*r;switch(s){case 0:return[d+c+a,r-f-h-b+l,d+c+p+a,r-f-h+l];case 90:return[d+h+a,r-f+c+l,d+h+b+a,r-f+c+p+l];case 180:return[d-c-p+a,r-f+h+l,d-c+a,r-f+h+b+l];case 270:return[d-h-b+a,r-f-c-p+l,d-h+a,r-f-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[s,i,n,r]=t,a=n-s,l=r-i;switch(this.rotation){case 0:return[s,e-r,a,l];case 90:return[s,e-i,l,a];case 180:return[n,e-i,a,l];case 270:return[n,e-r,l,a];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&F._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#s?.onUpdatedColor()}getData(){const{comment:{text:t,color:e,date:s,opacity:i,deleted:n,richText:r},uid:a,pageIndex:l,creationDate:c,modificationDate:h}=this;return{id:a,pageIndex:l,rect:this.getPDFRect(),richText:r,contentsObj:{str:t},creationDate:c,modificationDate:s||h,popupRef:!n,color:e,opacity:i}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#b=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#b=!1,!0):!1}isInEditMode(){return this.#b}shouldGetKeyboardEvents(){return this.#x}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:n,innerWidth:r}=window;return e<r&&i>0&&t<n&&s>0}#H(){if(this.#f||!this.div)return;this.#f=new AbortController;const t=this._uiManager.combinedSignal(this.#f);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})}rebuild(){this.#H()}rotate(t){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(t=!1,e=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(t,e,s){const i=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:s,annotationElementId:t.annotationElementId,creationDate:t.creationDate,modificationDate:t.modificationDate});i.rotation=t.rotation,i.#t=t.accessibilityData,i._isCopy=t.isCopy||!1;const[n,r]=i.pageDimensions,[a,l,c,h]=i.getRectInCurrentCoords(t.rect,r);return i.x=a/n,i.y=l/r,i.width=c/n,i.height=h/r,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#f?.abort(),this.#f=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),this.#y&&(clearTimeout(this.#y),this.#y=null),this.#j(),this.removeEditToolbar(),this.#v){for(const t of this.#v.values())clearTimeout(t);this.#v=null}this.parent=null,this.#_?.destroy(),this.#_=null,this.#d?.remove(),this.#d=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#F(),this.#c.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[t,e]}=this,[s,i,n,r]=this.getPDFRect();return[F._round(s+(n-s)*t),F._round(i+(r-i)*(1-e))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#s.commentPopupPositionInLayer}set commentPopupPosition(t){this.#s.commentPopupPositionInLayer=t}hasDefaultPopupPosition(){return this.#s.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#s.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(t){this.#s?.setCommentButtonStates(t)}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const e=this.#c.children;if(!this.#e){this.#e=Array.from(e);const r=this.#X.bind(this),a=this.#V.bind(this),l=this._uiManager._signal;for(const c of this.#e){const h=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",r,{signal:l}),c.addEventListener("blur",a,{signal:l}),c.addEventListener("focus",this.#Y.bind(this,h),{signal:l}),c.setAttribute("data-l10n-id",F._l10nResizer[h])}}const s=this.#e[0];let i=0;for(const r of e){if(r===s)break;i++}const n=(360-this.rotation+this.parentRotation)%360/90*(this.#e.length/4);if(n!==i){if(n<i)for(let a=0;a<i-n;a++)this.#c.append(this.#c.firstElementChild);else if(n>i)for(let a=0;a<n-i;a++)this.#c.firstElementChild.before(this.#c.lastElementChild);let r=0;for(const a of e){const c=this.#e[r++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",F._l10nResizer[c])}}this.#$(0),this.#x=!0,this.#c.firstElementChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}#X(t){F._resizerKeyboardManager.exec(this,t)}#V(t){this.#x&&t.relatedTarget?.parentNode!==this.#c&&this.#j()}#Y(t){this.#m=this.#x?t:""}#$(t){if(this.#e)for(const e of this.#e)e.tabIndex=t}_resizeWithKeyboard(t,e){this.#x&&this.#M(this.#m,{deltaX:t,deltaY:e,fromKeyboard:!0})}#j(){this.#x=!1,this.#$(-1),this.#O()}_stopResizingWithKeyboard(){this.#j(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#i?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#c?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#i?.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){t.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(t){this.#p=t,this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){this.#v||=new Map;const{action:s}=t;let i=this.#v.get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(t),this.#v.delete(s),this.#v.size===0&&(this.#v=null)},F._telemetryTimeout),this.#v.set(s,i);return}t.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),this.#r=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#r=!0}updateFakeAnnotationElement(t){if(!this.#d&&!this.deleted){this.#d=t.addFakeAnnotation(this);return}if(this.deleted){this.#d.remove(),this.#d=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#d.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const s=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),s.before(e)}return e}resetAnnotationElement(t){const{firstElementChild:e}=t.container;e?.nodeName==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}}class _h extends F{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const $n=3285377520,Ot=4294901760,Yt=65535;class xa{constructor(t){this.h1=t?t&4294967295:$n,this.h2=t?t&4294967295:$n}update(t){let e,s;if(typeof t=="string"){e=new Uint8Array(t.length*2),s=0;for(let g=0,m=t.length;g<m;g++){const y=t.charCodeAt(g);y<=255?e[s++]=y:(e[s++]=y>>>8,e[s++]=y&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),s=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,n=s-i*4,r=new Uint32Array(e.buffer,0,i);let a=0,l=0,c=this.h1,h=this.h2;const d=3432918353,f=461845907,p=d&Yt,b=f&Yt;for(let g=0;g<i;g++)g&1?(a=r[g],a=a*d&Ot|a*p&Yt,a=a<<15|a>>>17,a=a*f&Ot|a*b&Yt,c^=a,c=c<<13|c>>>19,c=c*5+3864292196):(l=r[g],l=l*d&Ot|l*p&Yt,l=l<<15|l>>>17,l=l*f&Ot|l*b&Yt,h^=l,h=h<<13|h>>>19,h=h*5+3864292196);switch(a=0,n){case 3:a^=e[i*4+2]<<16;case 2:a^=e[i*4+1]<<8;case 1:a^=e[i*4],a=a*d&Ot|a*p&Yt,a=a<<15|a>>>17,a=a*f&Ot|a*b&Yt,i&1?c^=a:h^=a}this.h1=c,this.h2=h}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&Ot|t*36045&Yt,e=e*4283543511&Ot|((e<<16|t>>>16)*2950163797&Ot)>>>16,t^=e>>>1,t=t*444984403&Ot|t*60499&Yt,e=e*3301882366&Ot|((e<<16|t>>>16)*3120437893&Ot)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const _i=Object.freeze({map:null,hash:"",transfer:void 0});class tn{#t=!1;#e=null;#i=null;#s=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const s=this.#s.get(t);return s===void 0?e:Object.assign(e,s)}getRawValue(t){return this.#s.get(t)}remove(t){const e=this.#s.get(t);if(e!==void 0&&(e instanceof F&&this.#i.delete(e.annotationElementId),this.#s.delete(t),this.#s.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const s of this.#s.values())if(s instanceof F)return;this.onAnnotationEditor(null)}}setValue(t,e){const s=this.#s.get(t);let i=!1;if(s!==void 0)for(const[n,r]of Object.entries(e))s[n]!==r&&(i=!0,s[n]=r);else i=!0,this.#s.set(t,e);i&&this.#a(),e instanceof F&&((this.#i||=new Map).set(e.annotationElementId,e),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type))}has(t){return this.#s.has(t)}get size(){return this.#s.size}#a(){this.#t||(this.#t=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#t&&(this.#t=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new wa(this)}get serializable(){if(this.#s.size===0)return _i;const t=new Map,e=new xa,s=[],i=Object.create(null);let n=!1;for(const[r,a]of this.#s){const l=a instanceof F?a.serialize(!1,i):a;a.page&&(a.pageIndex=a.page._pageIndex,delete a.page),l&&(t.set(r,l),e.update(`${r}:${JSON.stringify(l)}`),n||=!!l.bitmap)}if(n)for(const r of t.values())r.bitmap&&s.push(r.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:s}:_i}get editorStats(){let t=null;const e=new Map;let s=0,i=0;for(const n of this.#s.values()){if(!(n instanceof F)){n.popup&&(n.popup.deleted?i+=1:s+=1);continue}n.isCommentDeleted?i+=1:n.hasEditedComment&&(s+=1);const r=n.telemetryFinalData;if(!r)continue;const{type:a}=r;e.has(a)||e.set(a,Object.getPrototypeOf(n).constructor),t||=Object.create(null);const l=t[a]||=new Map;for(const[c,h]of Object.entries(r)){if(c==="type")continue;let d=l.get(c);d||(d=new Map,l.set(c,d));const f=d.get(h)??0;d.set(h,f+1)}}if((i>0||s>0)&&(t||=Object.create(null),t.comments={deleted:i,edited:s}),!t)return null;for(const[n,r]of e)t[n]=r.computeTelemetryFinalData(t[n]);return t}resetModifiedIds(){this.#e=null}updateEditor(t,e){const s=this.#i?.get(t);return s?(s.updateFromAnnotationLayer(e),!0):!1}getEditor(t){return this.#i?.get(t)||null}get modifiedIds(){if(this.#e)return this.#e;const t=[];if(this.#i)for(const e of this.#i.values())e.serialize()&&t.push(e.annotationElementId);return this.#e={ids:new Set(t),hash:t.join(",")}}[Symbol.iterator](){return this.#s.entries()}}class wa extends tn{#t;constructor(t){super();const{map:e,hash:s,transfer:i}=t.serializable,n=structuredClone(e,i?{transfer:i}:null);this.#t={map:n,hash:s,transfer:i}}get print(){Q("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#t}get modifiedIds(){return H(this,"modifiedIds",{ids:new Set,hash:""})}}class kh{#t=new Set;constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),this.#t.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:s}){if(!(!t||this.#t.has(t.loadedName))){if(J(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:n,style:r}=t,a=new FontFace(i,n,r);this.addNativeFontFace(a);try{await a.load(),this.#t.add(i),s?.(t)}catch{$(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}Q("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const s=t.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw $(`Failed to load font '${s.family}': '${i}'.`),t.disableFontFace=!0,i}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(t,i)})}}get isFontLoadingAPISupported(){const t=!!this._document?.fonts;return H(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return H(this,"isSyncFontLoadingSupported",St||ut.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(J(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const n=s.shift();setTimeout(n.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:e,callback:t};return s.push(i),i}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return H(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function s(v,A){return v.charCodeAt(A)<<24|v.charCodeAt(A+1)<<16|v.charCodeAt(A+2)<<8|v.charCodeAt(A+3)&255}function i(v,A,E,C){const P=v.substring(0,A),T=v.substring(A+E);return P+C+T}let n,r;const a=this._document.createElement("canvas");a.width=1,a.height=1;const l=a.getContext("2d");let c=0;function h(v,A){if(++c>30){$("Load test font never loaded."),A();return}if(l.font="30px "+v,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){A();return}setTimeout(h.bind(null,v,A))}const d=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=i(f,976,d.length,d);const b=16,g=1482184792;let m=s(f,b);for(n=0,r=d.length-3;n<r;n+=4)m=m-g+s(d,n)|0;n<d.length&&(m=m-g+s(d+"XXX",n)|0),f=i(f,b,4,mh(m));const y=`url(data:font/opentype;base64,${btoa(f)});`,x=`@font-face {font-family:"${d}";src:${y}}`;this.insertRule(x);const w=this._document.createElement("div");w.style.visibility="hidden",w.style.width=w.style.height="10px",w.style.position="absolute",w.style.top=w.style.left="0px";for(const v of[t.loadedName,d]){const A=this._document.createElement("span");A.textContent="Hi",A.style.fontFamily=v,w.append(A)}this._document.body.append(w),h(d,()=>{w.remove(),e.complete()})}}class Ph{#t;constructor(t,e=null,s,i){this.compiledGlyphs=Object.create(null),this.#t=t,this._inspectFont=e,s&&Object.assign(this,s),i&&(this.charProcOperatorList=i)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const e={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(e.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,e)}return this._inspectFont?.(this),t}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${this.data.toBase64()});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${t}}`}return this._inspectFont?.(this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const s=this.loadedName+"_path_"+e;let i;try{i=t.get(s)}catch(r){$(`getPathGenerator - ignoring character: "${r}".`)}const n=ba(i?.path);return this.fontExtraProperties||t.delete(s),this.compiledGlyphs[e]=n}get black(){return this.#t.black}get bold(){return this.#t.bold}get disableFontFace(){return this.#t.disableFontFace??!1}set disableFontFace(t){H(this,"disableFontFace",!!t)}get fontExtraProperties(){return this.#t.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#t.isInvalidPDFjsFont}get isType3Font(){return this.#t.isType3Font}get italic(){return this.#t.italic}get missingFile(){return this.#t.missingFile}get remeasure(){return this.#t.remeasure}get vertical(){return this.#t.vertical}get ascent(){return this.#t.ascent}get defaultWidth(){return this.#t.defaultWidth}get descent(){return this.#t.descent}get bbox(){return this.#t.bbox}set bbox(t){H(this,"bbox",t)}get fontMatrix(){return this.#t.fontMatrix}get fallbackName(){return this.#t.fallbackName}get loadedName(){return this.#t.loadedName}get mimetype(){return this.#t.mimetype}get name(){return this.#t.name}get data(){return this.#t.data}clearData(){this.#t.clearData()}get cssFontInfo(){return this.#t.cssFontInfo}get systemFontInfo(){return this.#t.systemFontInfo}get defaultVMetrics(){return this.#t.defaultVMetrics}}class _e{#t;#e;#i;static strings=["fontFamily","fontWeight","italicAngle"];static write(t){const e=new TextEncoder,s={};let i=0;for(const c of _e.strings){const h=e.encode(t[c]);s[c]=h,i+=4+h.length}const n=new ArrayBuffer(i),r=new Uint8Array(n),a=new DataView(n);let l=0;for(const c of _e.strings){const h=s[c],d=h.length;a.setUint32(l,d),r.set(h,l+4),l+=4+d}return J(l===n.byteLength,"CssFontInfo.write: Buffer overflow"),n}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#i=new TextDecoder}#s(t){J(t<_e.strings.length,"Invalid string index");let e=0;for(let i=0;i<t;i++)e+=this.#e.getUint32(e)+4;const s=this.#e.getUint32(e);return this.#i.decode(new Uint8Array(this.#t,e+4,s))}get fontFamily(){return this.#s(0)}get fontWeight(){return this.#s(1)}get italicAngle(){return this.#s(2)}}class ke{#t;#e;#i;static strings=["css","loadedName","baseFontName","src"];static write(t){const e=new TextEncoder,s={};let i=0;for(const f of ke.strings){const p=e.encode(t[f]);s[f]=p,i+=4+p.length}i+=4;let n,r,a=1+i;t.style&&(n=e.encode(t.style.style),r=e.encode(t.style.weight),a+=4+n.length+4+r.length);const l=new ArrayBuffer(a),c=new Uint8Array(l),h=new DataView(l);let d=0;h.setUint8(d++,t.guessFallback?1:0),h.setUint32(d,0),d+=4,i=0;for(const f of ke.strings){const p=s[f],b=p.length;i+=4+b,h.setUint32(d,b),c.set(p,d+4),d+=4+b}return h.setUint32(d-i-4,i),t.style&&(h.setUint32(d,n.length),c.set(n,d+4),d+=4+n.length,h.setUint32(d,r.length),c.set(r,d+4),d+=4+r.length),J(d<=l.byteLength,"SubstitionInfo.write: Buffer overflow"),l.transferToFixedLength(d)}constructor(t){this.#t=t,this.#e=new DataView(this.#t),this.#i=new TextDecoder}get guessFallback(){return this.#e.getUint8(0)!==0}#s(t){J(t<ke.strings.length,"Invalid string index");let e=5;for(let i=0;i<t;i++)e+=this.#e.getUint32(e)+4;const s=this.#e.getUint32(e);return this.#i.decode(new Uint8Array(this.#t,e+4,s))}get css(){return this.#s(0)}get loadedName(){return this.#s(1)}get baseFontName(){return this.#s(2)}get src(){return this.#s(3)}get style(){let t=1;t+=4+this.#e.getUint32(t);const e=this.#e.getUint32(t),s=this.#i.decode(new Uint8Array(this.#t,t+4,e));t+=4+e;const i=this.#e.getUint32(t),n=this.#i.decode(new Uint8Array(this.#t,t+4,i));return{style:s,weight:n}}}class tt{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#t=Math.ceil(this.bools.length*2/8);static#e=this.#t+this.numbers.length*8;static#i=this.#e+1+8;static#s=this.#i+1+48;static#a=this.#s+1+6;#r;#n;#o;constructor({data:t,extra:e}){this.#r=t,this.#n=new TextDecoder,this.#o=new DataView(this.#r),e&&Object.assign(this,e)}#c(t){J(t<tt.bools.length,"Invalid boolean index");const e=Math.floor(t/4),s=t*2%8,i=this.#o.getUint8(e)>>s&3;return i===0?void 0:i===2}get black(){return this.#c(0)}get bold(){return this.#c(1)}get disableFontFace(){return this.#c(2)}get fontExtraProperties(){return this.#c(3)}get isInvalidPDFjsFont(){return this.#c(4)}get isType3Font(){return this.#c(5)}get italic(){return this.#c(6)}get missingFile(){return this.#c(7)}get remeasure(){return this.#c(8)}get vertical(){return this.#c(9)}#l(t){return J(t<tt.numbers.length,"Invalid number index"),this.#o.getFloat64(tt.#t+t*8)}get ascent(){return this.#l(0)}get defaultWidth(){return this.#l(1)}get descent(){return this.#l(2)}get bbox(){let t=tt.#e;if(this.#o.getUint8(t)===0)return;t+=1;const s=[];for(let i=0;i<4;i++)s.push(this.#o.getInt16(t,!0)),t+=2;return s}get fontMatrix(){let t=tt.#i;if(this.#o.getUint8(t)===0)return;t+=1;const s=[];for(let i=0;i<6;i++)s.push(this.#o.getFloat64(t,!0)),t+=8;return s}get defaultVMetrics(){let t=tt.#s;if(this.#o.getUint8(t)===0)return;t+=1;const s=[];for(let i=0;i<3;i++)s.push(this.#o.getInt16(t,!0)),t+=2;return s}#u(t){J(t<tt.strings.length,"Invalid string index");let e=tt.#a+4;for(let n=0;n<t;n++)e+=this.#o.getUint32(e)+4;const s=this.#o.getUint32(e),i=new Uint8Array(s);return i.set(new Uint8Array(this.#r,e+4,s)),this.#n.decode(i)}get fallbackName(){return this.#u(0)}get loadedName(){return this.#u(1)}get mimetype(){return this.#u(2)}get name(){return this.#u(3)}get data(){let t=tt.#a;const e=this.#o.getUint32(t);t+=4+e;const s=this.#o.getUint32(t);t+=4+s;const i=this.#o.getUint32(t);t+=4+i;const n=this.#o.getUint32(t);if(n!==0)return new Uint8Array(this.#r,t+4,n)}clearData(){let t=tt.#a;const e=this.#o.getUint32(t);t+=4+e;const s=this.#o.getUint32(t);t+=4+s;const i=this.#o.getUint32(t);t+=4+i;const n=this.#o.getUint32(t);new Uint8Array(this.#r,t+4,n).fill(0),this.#o.setUint32(t,0)}get cssFontInfo(){let t=tt.#a;const e=this.#o.getUint32(t);t+=4+e;const s=this.#o.getUint32(t);t+=4+s;const i=this.#o.getUint32(t);if(i===0)return null;const n=new Uint8Array(i);return n.set(new Uint8Array(this.#r,t+4,i)),new _e(n.buffer)}get systemFontInfo(){let t=tt.#a;const e=this.#o.getUint32(t);t+=4+e;const s=this.#o.getUint32(t);if(s===0)return null;const i=new Uint8Array(s);return i.set(new Uint8Array(this.#r,t+4,s)),new ke(i.buffer)}static write(t){const e=t.systemFontInfo?ke.write(t.systemFontInfo):null,s=t.cssFontInfo?_e.write(t.cssFontInfo):null,i=new TextEncoder,n={};let r=0;for(const g of tt.strings)n[g]=i.encode(t[g]),r+=4+n[g].length;const a=tt.#a+4+r+4+(e?e.byteLength:0)+4+(s?s.byteLength:0)+4+(t.data?t.data.length:0),l=new ArrayBuffer(a),c=new Uint8Array(l),h=new DataView(l);let d=0;const f=tt.bools.length;let p=0,b=0;for(let g=0;g<f;g++){const m=t[tt.bools[g]];p|=(m===void 0?0:m?2:1)<<b,b+=2,(b===8||g===f-1)&&(h.setUint8(d++,p),p=0,b=0)}J(d===tt.#t,"FontInfo.write: Boolean properties offset mismatch");for(const g of tt.numbers)h.setFloat64(d,t[g]),d+=8;if(J(d===tt.#e,"FontInfo.write: Number properties offset mismatch"),t.bbox){h.setUint8(d++,4);for(const g of t.bbox)h.setInt16(d,g,!0),d+=2}else h.setUint8(d++,0),d+=8;if(J(d===tt.#i,"FontInfo.write: BBox properties offset mismatch"),t.fontMatrix){h.setUint8(d++,6);for(const g of t.fontMatrix)h.setFloat64(d,g,!0),d+=8}else h.setUint8(d++,0),d+=48;if(J(d===tt.#s,"FontInfo.write: FontMatrix properties offset mismatch"),t.defaultVMetrics){h.setUint8(d++,1);for(const g of t.defaultVMetrics)h.setInt16(d,g,!0),d+=2}else h.setUint8(d++,0),d+=6;J(d===tt.#a,"FontInfo.write: DefaultVMetrics properties offset mismatch"),h.setUint32(tt.#a,0),d+=4;for(const g of tt.strings){const m=n[g],y=m.length;h.setUint32(d,y),c.set(m,d+4),d+=4+y}if(h.setUint32(tt.#a,d-tt.#a-4),!e)h.setUint32(d,0),d+=4;else{const g=e.byteLength;h.setUint32(d,g),J(d+4+g<=l.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),c.set(new Uint8Array(e),d+4),d+=4+g}if(!s)h.setUint32(d,0),d+=4;else{const g=s.byteLength;h.setUint32(d,g),J(d+4+g<=l.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),c.set(new Uint8Array(s),d+4),d+=4+g}return t.data===void 0?(h.setUint32(d,0),d+=4):(h.setUint32(d,t.data.length),c.set(t.data,d+4),d+=4+t.data.length),J(d<=l.byteLength,"FontInfo.write: Buffer overflow"),l.transferToFixedLength(d)}}class gt{static#t=0;static#e=1;static#i=2;static#s=3;static#a=4;static#r=8;static#n=12;static#o=16;constructor(t){this.buffer=t,this.view=new DataView(t),this.data=new Uint8Array(t)}static write(t){let e,s=null,i=[],n=[],r=[],a=[],l=null,c=null;switch(t[0]){case"RadialAxial":e=t[1]==="axial"?1:2,s=t[2],r=t[3],e===1?i.push(...t[4],...t[5]):i.push(t[4][0],t[4][1],t[6],t[5][0],t[5][1],t[7]);break;case"Mesh":e=3,l=t[1],i=t[2],n=t[3],a=t[4]||[],s=t[6],c=t[7];break;default:throw new Error(`Unsupported pattern type: ${t[0]}`)}const h=Math.floor(i.length/2),d=Math.floor(n.length/3),f=r.length,p=a.length;let b=0;for(const A of a)b+=1,b=Math.ceil(b/4)*4,b+=4+A.coords.length*4,b+=4+A.colors.length*4,A.verticesPerRow!==void 0&&(b+=4);const g=20+h*8+d*3+f*8+(s?16:0)+(c?3:0)+b,m=new ArrayBuffer(g),y=new DataView(m),x=new Uint8Array(m);y.setUint8(gt.#t,e),y.setUint8(gt.#e,s?1:0),y.setUint8(gt.#i,c?1:0),y.setUint8(gt.#s,l),y.setUint32(gt.#a,h,!0),y.setUint32(gt.#r,d,!0),y.setUint32(gt.#n,f,!0),y.setUint32(gt.#o,p,!0);let w=20;new Float32Array(m,w,h*2).set(i),w+=h*8,x.set(n,w),w+=d*3;for(const[A,E]of r)y.setFloat32(w,A,!0),w+=4,y.setUint32(w,parseInt(E.slice(1),16),!0),w+=4;if(s)for(const A of s)y.setFloat32(w,A,!0),w+=4;c&&(x.set(c,w),w+=3);for(let A=0;A<a.length;A++){const E=a[A];y.setUint8(w,E.type),w+=1,w=Math.ceil(w/4)*4,y.setUint32(w,E.coords.length,!0),w+=4,new Int32Array(m,w,E.coords.length).set(E.coords),w+=E.coords.length*4,y.setUint32(w,E.colors.length,!0),w+=4,new Int32Array(m,w,E.colors.length).set(E.colors),w+=E.colors.length*4,E.verticesPerRow!==void 0&&(y.setUint32(w,E.verticesPerRow,!0),w+=4)}return m}getIR(){const t=this.view,e=this.data[gt.#t],s=!!this.data[gt.#e],i=!!this.data[gt.#i],n=t.getUint32(gt.#a,!0),r=t.getUint32(gt.#r,!0),a=t.getUint32(gt.#n,!0),l=t.getUint32(gt.#o,!0);let c=20;const h=new Float32Array(this.buffer,c,n*2);c+=n*8;const d=new Uint8Array(this.buffer,c,r*3);c+=r*3;const f=[];for(let m=0;m<a;++m){const y=t.getFloat32(c,!0);c+=4;const x=t.getUint32(c,!0);c+=4,f.push([y,`#${x.toString(16).padStart(6,"0")}`])}let p=null;if(s){p=[];for(let m=0;m<4;++m)p.push(t.getFloat32(c,!0)),c+=4}let b=null;i&&(b=new Uint8Array(this.buffer,c,3),c+=3);const g=[];for(let m=0;m<l;++m){const y=t.getUint8(c);c+=1,c=Math.ceil(c/4)*4;const x=t.getUint32(c,!0);c+=4;const w=new Int32Array(this.buffer,c,x);c+=x*4;const v=t.getUint32(c,!0);c+=4;const A=new Int32Array(this.buffer,c,v);c+=v*4;const E={type:y,coords:w,colors:A};y===Ci.LATTICE&&(E.verticesPerRow=t.getUint32(c,!0),c+=4),g.push(E)}if(e===1)return["RadialAxial","axial",p,f,Array.from(h.slice(0,2)),Array.from(h.slice(2,4)),null,null];if(e===2)return["RadialAxial","radial",p,f,[h[0],h[1]],[h[3],h[4]],h[2],h[5]];if(e===3){const m=this.data[gt.#s];let y=null;if(h.length>0){let x=h[0],w=h[0],v=h[1],A=h[1];for(let E=0;E<h.length;E+=2){const C=h[E],P=h[E+1];x=x>C?C:x,v=v>P?P:v,w=w<C?C:w,A=A<P?P:A}y=[x,v,w,A]}return["Mesh",m,h,d,g,y,p,b]}throw new Error(`Unsupported pattern kind: ${e}`)}}class Rh{static write(t){let e,s;return ut.isFloat16ArraySupported?(s=new ArrayBuffer(t.length*2),e=new Float16Array(s)):(s=new ArrayBuffer(t.length*4),e=new Float32Array(s)),e.set(t),s}#t;constructor(t){this.#t=t}get path(){return ut.isFloat16ArraySupported?new Float16Array(this.#t):new Float32Array(this.#t)}}function Dh(o){if(o instanceof URL)return o.href;if(typeof o=="string"){if(St)return o;const t=URL.parse(o,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Nh(o){if(St&&typeof Buffer<"u"&&o instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength)return o;if(typeof o=="string")return $s(o);if(o instanceof ArrayBuffer||ArrayBuffer.isView(o)||typeof o=="object"&&!isNaN(o?.length))return new Uint8Array(o);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function bs(o){if(typeof o!="string")return null;if(o.endsWith("/"))return o;throw new Error(`Invalid factory url: "${o}" must include trailing slash.`)}const ki=o=>typeof o=="object"&&Number.isInteger(o?.num)&&o.num>=0&&Number.isInteger(o?.gen)&&o.gen>=0,Lh=o=>typeof o=="object"&&typeof o?.name=="string",va=wh.bind(null,ki,Lh);class Ih{#t=new Map;#e=Promise.resolve();postMessage(t,e){const s={data:structuredClone(t,e?{transfer:e}:null)};this.#e.then(()=>{for(const[i]of this.#t)i.call(this,s)})}addEventListener(t,e,s=null){let i=null;if(s?.signal instanceof AbortSignal){const{signal:n}=s;if(n.aborted){$("LoopbackPort - cannot use an `aborted` signal.");return}const r=()=>this.removeEventListener(t,e);i=()=>n.removeEventListener("abort",r),n.addEventListener("abort",r)}this.#t.set(e,i)}removeEventListener(t,e){this.#t.get(e)?.(),this.#t.delete(e)}terminate(){for(const[,t]of this.#t)t?.();this.#t.clear()}}const ys={DATA:1,ERROR:2},dt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function zn(){}function Ct(o){if(o instanceof ne||o instanceof Ds||o instanceof Mn||o instanceof ts||o instanceof ci)return o;switch(o instanceof Error||typeof o=="object"&&o!==null||Q('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),o.name){case"AbortException":return new ne(o.message);case"InvalidPDFException":return new Ds(o.message);case"PasswordException":return new Mn(o.message,o.code);case"ResponseException":return new ts(o.message,o.status,o.missing);case"UnknownErrorException":return new ci(o.message,o.details)}return new ci(o.message,o.toString())}class qe{#t=new AbortController;constructor(t,e,s){this.sourceName=t,this.targetName=e,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",this.#e.bind(this),{signal:this.#t.signal})}#e({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){this.#s(t);return}if(t.callback){const s=t.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],t.callback===ys.DATA)i.resolve(t.data);else if(t.callback===ys.ERROR)i.reject(Ct(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const s=this.sourceName,i=t.sourceName,n=this.comObj;Promise.try(e,t.data).then(function(r){n.postMessage({sourceName:s,targetName:i,callback:ys.DATA,callbackId:t.callbackId,data:r})},function(r){n.postMessage({sourceName:s,targetName:i,callback:ys.ERROR,callbackId:t.callbackId,reason:Ct(r)})});return}if(t.streamId){this.#i(t);return}e(t.data)}on(t,e){const s=this.actionHandler;if(s[t])throw new Error(`There is already an actionName called "${t}"`);s[t]=e}send(t,e,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},s)}sendWithPromise(t,e,s){const i=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[i]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:e},s)}catch(r){n.reject(r)}return n.promise}sendWithStream(t,e,s,i){const n=this.streamId++,r=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{const h=Promise.withResolvers();return this.streamControllers[n]={controller:c,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:r,targetName:a,action:t,streamId:n,data:e,desiredSize:c.desiredSize},i),h.promise},pull:c=>{const h=Promise.withResolvers();return this.streamControllers[n].pullCall=h,l.postMessage({sourceName:r,targetName:a,stream:dt.PULL,streamId:n,desiredSize:c.desiredSize}),h.promise},cancel:c=>{J(c instanceof Error,"cancel must have a valid reason");const h=Promise.withResolvers();return this.streamControllers[n].cancelCall=h,this.streamControllers[n].isClosed=!0,l.postMessage({sourceName:r,targetName:a,stream:dt.CANCEL,streamId:n,reason:Ct(c)}),h.promise}},s)}#i(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,n=this.comObj,r=this,a=this.actionHandler[t.action],l={enqueue(c,h=1,d){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=h,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:s,targetName:i,stream:dt.ENQUEUE,streamId:e,chunk:c},d)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:dt.CLOSE,streamId:e}),delete r.streamSinks[e])},error(c){J(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:dt.ERROR,streamId:e,reason:Ct(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[e]=l,Promise.try(a,t.data,l).then(function(){n.postMessage({sourceName:s,targetName:i,stream:dt.START_COMPLETE,streamId:e,success:!0})},function(c){n.postMessage({sourceName:s,targetName:i,stream:dt.START_COMPLETE,streamId:e,reason:Ct(c)})})}#s(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,n=this.comObj,r=this.streamControllers[e],a=this.streamSinks[e];switch(t.stream){case dt.START_COMPLETE:t.success?r.startCall.resolve():r.startCall.reject(Ct(t.reason));break;case dt.PULL_COMPLETE:t.success?r.pullCall.resolve():r.pullCall.reject(Ct(t.reason));break;case dt.PULL:if(!a){n.postMessage({sourceName:s,targetName:i,stream:dt.PULL_COMPLETE,streamId:e,success:!0});break}a.desiredSize<=0&&t.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=t.desiredSize,Promise.try(a.onPull||zn).then(function(){n.postMessage({sourceName:s,targetName:i,stream:dt.PULL_COMPLETE,streamId:e,success:!0})},function(c){n.postMessage({sourceName:s,targetName:i,stream:dt.PULL_COMPLETE,streamId:e,reason:Ct(c)})});break;case dt.ENQUEUE:if(J(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(t.chunk);break;case dt.CLOSE:if(J(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),this.#a(r,e);break;case dt.ERROR:J(r,"error should have stream controller"),r.controller.error(Ct(t.reason)),this.#a(r,e);break;case dt.CANCEL_COMPLETE:t.success?r.cancelCall.resolve():r.cancelCall.reject(Ct(t.reason)),this.#a(r,e);break;case dt.CANCEL:if(!a)break;const l=Ct(t.reason);Promise.try(a.onCancel||zn,l).then(function(){n.postMessage({sourceName:s,targetName:i,stream:dt.CANCEL_COMPLETE,streamId:e,success:!0})},function(c){n.postMessage({sourceName:s,targetName:i,stream:dt.CANCEL_COMPLETE,streamId:e,reason:Ct(c)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}}async#a(t,e){await Promise.allSettled([t.startCall?.promise,t.pullCall?.promise,t.cancelCall?.promise]),delete this.streamControllers[e]}destroy(){this.#t?.abort(),this.#t=null}}class Aa{#t=!1;constructor({enableHWA:t=!1}){this.#t=t}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(t,e);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!this.#t})}}reset(t,e,s){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||s<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=s}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){Q("Abstract method `_createCanvas` called.")}}class Mh extends Aa{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const s=this._document.createElement("canvas");return s.width=t,s.height=e,s}}class Sa{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){Q("Abstract method `_fetch` called.")}}class Wn extends Sa{async _fetch(t){const e=await Me(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):$s(e)}}class Ea{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,s,i,n){return"none"}destroy(t=!1){}}class jh extends Ea{#t;#e;#i;#s;#a;#r;#n=0;constructor({docId:t,ownerDocument:e=globalThis.document}){super(),this.#s=t,this.#a=e}get#o(){return this.#e||=new Map}get#c(){return this.#r||=new Map}get#l(){if(!this.#i){const t=this.#a.createElement("div"),{style:e}=t;e.visibility="hidden",e.contain="strict",e.width=e.height=0,e.position="absolute",e.top=e.left=0,e.zIndex=-1;const s=this.#a.createElementNS(te,"svg");s.setAttribute("width",0),s.setAttribute("height",0),this.#i=this.#a.createElementNS(te,"defs"),t.append(s),s.append(this.#i),this.#a.body.append(t)}return this.#i}#u(t){if(t.length===1){const l=t[0],c=new Array(256);for(let d=0;d<256;d++)c[d]=l[d]/255;const h=c.join(",");return[h,h,h]}const[e,s,i]=t,n=new Array(256),r=new Array(256),a=new Array(256);for(let l=0;l<256;l++)n[l]=e[l]/255,r[l]=s[l]/255,a[l]=i[l]/255;return[n.join(","),r.join(","),a.join(",")]}#d(t){if(this.#t===void 0){this.#t="";const e=this.#a.URL;e!==this.#a.baseURI&&(ls(e)?$('#createUrl: ignore "data:"-URL for performance reasons.'):this.#t=Yi(e,""))}return`url(${this.#t}#${t})`}addFilter(t){if(!t)return"none";let e=this.#o.get(t);if(e)return e;const[s,i,n]=this.#u(t),r=t.length===1?s:`${s}${i}${n}`;if(e=this.#o.get(r),e)return this.#o.set(t,e),e;const a=`g_${this.#s}_transfer_map_${this.#n++}`,l=this.#d(a);this.#o.set(t,l),this.#o.set(r,l);const c=this.#g(a);return this.#p(s,i,n,c),l}addHCMFilter(t,e){const s=`${t}-${e}`,i="base";let n=this.#c.get(i);if(n?.key===s||(n?(n.filter?.remove(),n.key=s,n.url="none",n.filter=null):(n={key:s,url:"none",filter:null},this.#c.set(i,n)),!t||!e))return n.url;const r=this.#x(t);t=N.makeHexColor(...r);const a=this.#x(e);if(e=N.makeHexColor(...a),this.#l.style.color="",t==="#000000"&&e==="#ffffff"||t===e)return n.url;const l=new Array(256);for(let p=0;p<=255;p++){const b=p/255;l[p]=b<=.03928?b/12.92:((b+.055)/1.055)**2.4}const c=l.join(","),h=`g_${this.#s}_hcm_filter`,d=n.filter=this.#g(h);this.#p(c,c,c,d),this.#m(d);const f=(p,b)=>{const g=r[p]/255,m=a[p]/255,y=new Array(b+1);for(let x=0;x<=b;x++)y[x]=g+x/b*(m-g);return y.join(",")};return this.#p(f(0,5),f(1,5),f(2,5),d),n.url=this.#d(h),n.url}addAlphaFilter(t){let e=this.#o.get(t);if(e)return e;const[s]=this.#u([t]),i=`alpha_${s}`;if(e=this.#o.get(i),e)return this.#o.set(t,e),e;const n=`g_${this.#s}_alpha_map_${this.#n++}`,r=this.#d(n);this.#o.set(t,r),this.#o.set(i,r);const a=this.#g(n);return this.#b(s,a),r}addLuminosityFilter(t){let e=this.#o.get(t||"luminosity");if(e)return e;let s,i;if(t?([s]=this.#u([t]),i=`luminosity_${s}`):i="luminosity",e=this.#o.get(i),e)return this.#o.set(t,e),e;const n=`g_${this.#s}_luminosity_map_${this.#n++}`,r=this.#d(n);this.#o.set(t,r),this.#o.set(i,r);const a=this.#g(n);return this.#f(a),t&&this.#b(s,a),r}addHighlightHCMFilter(t,e,s,i,n){const r=`${e}-${s}-${i}-${n}`;let a=this.#c.get(t);if(a?.key===r||(a?(a.filter?.remove(),a.key=r,a.url="none",a.filter=null):(a={key:r,url:"none",filter:null},this.#c.set(t,a)),!e||!s))return a.url;const[l,c]=[e,s].map(this.#x.bind(this));let h=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),d=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[f,p]=[i,n].map(this.#x.bind(this));d<h&&([h,d,f,p]=[d,h,p,f]),this.#l.style.color="";const b=(y,x,w)=>{const v=new Array(256),A=(d-h)/w,E=y/255,C=(x-y)/(255*w);let P=0;for(let T=0;T<=w;T++){const _=Math.round(h+T*A),k=E+T*C;for(let R=P;R<=_;R++)v[R]=k;P=_+1}for(let T=P;T<256;T++)v[T]=v[P-1];return v.join(",")},g=`g_${this.#s}_hcm_${t}_filter`,m=a.filter=this.#g(g);return this.#m(m),this.#p(b(f[0],p[0],5),b(f[1],p[1],5),b(f[2],p[2],5),m),a.url=this.#d(g),a.url}destroy(t=!1){t&&this.#r?.size||(this.#i?.parentNode.parentNode.remove(),this.#i=null,this.#e?.clear(),this.#e=null,this.#r?.clear(),this.#r=null,this.#n=0)}#f(t){const e=this.#a.createElementNS(te,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(e)}#m(t){const e=this.#a.createElementNS(te,"feColorMatrix");e.setAttribute("type","matrix"),e.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(e)}#g(t){const e=this.#a.createElementNS(te,"filter");return e.setAttribute("color-interpolation-filters","sRGB"),e.setAttribute("id",t),this.#l.append(e),e}#h(t,e,s){const i=this.#a.createElementNS(te,e);i.setAttribute("type","discrete"),i.setAttribute("tableValues",s),t.append(i)}#p(t,e,s,i){const n=this.#a.createElementNS(te,"feComponentTransfer");i.append(n),this.#h(n,"feFuncR",t),this.#h(n,"feFuncG",e),this.#h(n,"feFuncB",s)}#b(t,e){const s=this.#a.createElementNS(te,"feComponentTransfer");e.append(s),this.#h(s,"feFuncA",t)}#x(t){return this.#l.style.color=t,je(getComputedStyle(this.#l).getPropertyValue("color"))}}class Ca{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){Q("Abstract method `_fetch` called.")}}class Gn extends Ca{async _fetch(t){const e=await Me(t,"arraybuffer");return new Uint8Array(e)}}class Ta{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){Q("Abstract method `_fetch` called.")}}class Vn extends Ta{async _fetch(t){const e=await Me(t,"arraybuffer");return new Uint8Array(e)}}St&&$("Please use the `legacy` build in Node.js environments.");async function en(o){const e=await process.getBuiltinModule("fs").promises.readFile(o);return new Uint8Array(e)}class Fh extends Ea{}class Oh extends Aa{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class Bh extends Sa{async _fetch(t){return en(t)}}class Uh extends Ca{async _fetch(t){return en(t)}}class Hh extends Ta{async _fetch(t){return en(t)}}const we="__forcedDependency",{floor:Xn,ceil:Yn}=Math;function xs(o,t,e,s,i,n){o[t*4+0]=Math.min(o[t*4+0],e),o[t*4+1]=Math.min(o[t*4+1],s),o[t*4+2]=Math.max(o[t*4+2],i),o[t*4+3]=Math.max(o[t*4+3],n)}const Pi=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class $h{#t;#e;constructor(t,e){this.#t=t,this.#e=e}get length(){return this.#t.length}isEmpty(t){return this.#t[t]===Pi}minX(t){return this.#e[t*4+0]/256}minY(t){return this.#e[t*4+1]/256}maxX(t){return(this.#e[t*4+2]+1)/256}maxY(t){return(this.#e[t*4+3]+1)/256}}const ws=(o,t)=>{if(!o)return;let e=o.get(t);return e||(e={dependencies:new Set,isRenderingOperation:!1},o.set(t,e)),e};class zh{#t={__proto__:null};#e={__proto__:null,transform:[],moveText:[],sameLineText:[],[we]:[]};#i=new Map;#s=[];#a=[];#r=[[1,0,0,1,0,0]];#n=[-1/0,-1/0,1/0,1/0];#o=new Float64Array([1/0,1/0,-1/0,-1/0]);#c=-1;#l=new Set;#u=new Map;#d=new Map;#f;#m;#g;#h;#p;constructor(t,e,s=!1){this.#f=t.width,this.#m=t.height,this.#b(e),s&&(this.#p=new Map)}growOperationsCount(t){t>=this.#h.length&&this.#b(t,this.#h)}#b(t,e){const s=new ArrayBuffer(t*4);this.#g=new Uint8ClampedArray(s),this.#h=new Uint32Array(s),e&&e.length>0?(this.#h.set(e),this.#h.fill(Pi,e.length)):this.#h.fill(Pi)}save(t){return this.#t={__proto__:this.#t},this.#e={__proto__:this.#e,transform:{__proto__:this.#e.transform},moveText:{__proto__:this.#e.moveText},sameLineText:{__proto__:this.#e.sameLineText},[we]:{__proto__:this.#e[we]}},this.#n={__proto__:this.#n},this.#s.push(t),this}restore(t){const e=Object.getPrototypeOf(this.#t);if(e===null)return this;this.#t=e,this.#e=Object.getPrototypeOf(this.#e),this.#n=Object.getPrototypeOf(this.#n);const s=this.#s.pop();return s!==void 0&&(ws(this.#p,t)?.dependencies.add(s),this.#h[t]=this.#h[s]),this}recordOpenMarker(t){return this.#s.push(t),this}getOpenMarker(){return this.#s.length===0?null:this.#s.at(-1)}recordCloseMarker(t){const e=this.#s.pop();return e!==void 0&&(ws(this.#p,t)?.dependencies.add(e),this.#h[t]=this.#h[e]),this}beginMarkedContent(t){return this.#a.push(t),this}endMarkedContent(t){const e=this.#a.pop();return e!==void 0&&(ws(this.#p,t)?.dependencies.add(e),this.#h[t]=this.#h[e]),this}pushBaseTransform(t){return this.#r.push(N.multiplyByDOMMatrix(this.#r.at(-1),t.getTransform())),this}popBaseTransform(){return this.#r.length>1&&this.#r.pop(),this}recordSimpleData(t,e){return this.#t[t]=e,this}recordIncrementalData(t,e){return this.#e[t].push(e),this}resetIncrementalData(t,e){return this.#e[t].length=0,this}recordNamedData(t,e){return this.#i.set(t,e),this}recordSimpleDataFromNamed(t,e,s){this.#t[t]=this.#i.get(e)??s}recordFutureForcedDependency(t,e){return this.recordIncrementalData(we,e),this}inheritSimpleDataAsFutureForcedDependencies(t){for(const e of t)e in this.#t&&this.recordFutureForcedDependency(e,this.#t[e]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const t of this.#l)this.recordFutureForcedDependency(we,t);return this}resetBBox(t){return this.#c!==t&&(this.#c=t,this.#o[0]=1/0,this.#o[1]=1/0,this.#o[2]=-1/0,this.#o[3]=-1/0),this}recordClipBox(t,e,s,i,n,r){const a=N.multiplyByDOMMatrix(this.#r.at(-1),e.getTransform()),l=[1/0,1/0,-1/0,-1/0];N.axialAlignedBoundingBox([s,n,i,r],a,l);const c=N.intersect(this.#n,l);return c?(this.#n[0]=c[0],this.#n[1]=c[1],this.#n[2]=c[2],this.#n[3]=c[3]):(this.#n[0]=this.#n[1]=1/0,this.#n[2]=this.#n[3]=-1/0),this}recordBBox(t,e,s,i,n,r){const a=this.#n;if(a[0]===1/0)return this;const l=N.multiplyByDOMMatrix(this.#r.at(-1),e.getTransform());if(a[0]===-1/0)return N.axialAlignedBoundingBox([s,n,i,r],l,this.#o),this;const c=[1/0,1/0,-1/0,-1/0];return N.axialAlignedBoundingBox([s,n,i,r],l,c),this.#o[0]=Math.min(this.#o[0],Math.max(c[0],a[0])),this.#o[1]=Math.min(this.#o[1],Math.max(c[1],a[1])),this.#o[2]=Math.max(this.#o[2],Math.min(c[2],a[2])),this.#o[3]=Math.max(this.#o[3],Math.min(c[3],a[3])),this}recordCharacterBBox(t,e,s,i=1,n=0,r=0,a){const l=s.bbox;let c,h;if(l&&(c=l[2]!==l[0]&&l[3]!==l[1]&&this.#d.get(s),c!==!1&&(h=[0,0,0,0],N.axialAlignedBoundingBox(l,s.fontMatrix,h),(i!==1||n!==0||r!==0)&&N.scaleMinMax([i,0,0,-i,n,r],h),c)))return this.recordBBox(t,e,h[0],h[2],h[1],h[3]);if(!a)return this.recordFullPageBBox(t);const d=a();return l&&h&&c===void 0&&(c=h[0]<=n-d.actualBoundingBoxLeft&&h[2]>=n+d.actualBoundingBoxRight&&h[1]<=r-d.actualBoundingBoxAscent&&h[3]>=r+d.actualBoundingBoxDescent,this.#d.set(s,c),c)?this.recordBBox(t,e,h[0],h[2],h[1],h[3]):this.recordBBox(t,e,n-d.actualBoundingBoxLeft,n+d.actualBoundingBoxRight,r-d.actualBoundingBoxAscent,r+d.actualBoundingBoxDescent)}recordFullPageBBox(t){return this.#o[0]=Math.max(0,this.#n[0]),this.#o[1]=Math.max(0,this.#n[1]),this.#o[2]=Math.min(this.#f,this.#n[2]),this.#o[3]=Math.min(this.#m,this.#n[3]),this}getSimpleIndex(t){return this.#t[t]}recordDependencies(t,e){const s=this.#l,i=this.#t,n=this.#e;for(const r of e)r in this.#t?s.add(i[r]):r in n&&n[r].forEach(s.add,s);return this}recordNamedDependency(t,e){return this.#i.has(e)&&this.#l.add(this.#i.get(e)),this}recordOperation(t,e=!1){if(this.recordDependencies(t,[we]),this.#p){const s=ws(this.#p,t),{dependencies:i}=s;this.#l.forEach(i.add,i),this.#s.forEach(i.add,i),this.#a.forEach(i.add,i),i.delete(t),s.isRenderingOperation=!0}if(this.#c===t){const s=Xn(this.#o[0]*256/this.#f),i=Xn(this.#o[1]*256/this.#m),n=Yn(this.#o[2]*256/this.#f),r=Yn(this.#o[3]*256/this.#m);xs(this.#g,t,s,i,n,r);for(const a of this.#l)a!==t&&xs(this.#g,a,s,i,n,r);for(const a of this.#s)a!==t&&xs(this.#g,a,s,i,n,r);for(const a of this.#a)a!==t&&xs(this.#g,a,s,i,n,r);e||(this.#l.clear(),this.#c=-1)}return this}recordShowTextOperation(t,e=!1){const s=Array.from(this.#l);this.recordOperation(t,e),this.recordIncrementalData("sameLineText",t);for(const i of s)this.recordIncrementalData("sameLineText",i);return this}bboxToClipBoxDropOperation(t,e=!1){return this.#c===t&&(this.#c=-1,this.#n[0]=Math.max(this.#n[0],this.#o[0]),this.#n[1]=Math.max(this.#n[1],this.#o[1]),this.#n[2]=Math.min(this.#n[2],this.#o[2]),this.#n[3]=Math.min(this.#n[3],this.#o[3]),e||this.#l.clear()),this}_takePendingDependencies(){const t=this.#l;return this.#l=new Set,t}_extractOperation(t){const e=this.#u.get(t);return this.#u.delete(t),e}_pushPendingDependencies(t){for(const e of t)this.#l.add(e)}take(){return this.#d.clear(),new $h(this.#h,this.#g)}takeDebugMetadata(){return this.#p}}class Is{#t;#e;#i;#s=0;#a=0;constructor(t,e,s){if(t instanceof Is&&t.#i===!!s)return t;this.#t=t,this.#e=e,this.#i=!!s}growOperationsCount(){throw new Error("Unreachable")}save(t){return this.#a++,this.#t.save(this.#e),this}restore(t){return this.#a>0&&(this.#t.restore(this.#e),this.#a--),this}recordOpenMarker(t){return this.#s++,this}getOpenMarker(){return this.#s>0?this.#e:this.#t.getOpenMarker()}recordCloseMarker(t){return this.#s--,this}beginMarkedContent(t){return this}endMarkedContent(t){return this}pushBaseTransform(t){return this.#t.pushBaseTransform(t),this}popBaseTransform(){return this.#t.popBaseTransform(),this}recordSimpleData(t,e){return this.#t.recordSimpleData(t,this.#e),this}recordIncrementalData(t,e){return this.#t.recordIncrementalData(t,this.#e),this}resetIncrementalData(t,e){return this.#t.resetIncrementalData(t,this.#e),this}recordNamedData(t,e){return this}recordSimpleDataFromNamed(t,e,s){return this.#t.recordSimpleDataFromNamed(t,e,this.#e),this}recordFutureForcedDependency(t,e){return this.#t.recordFutureForcedDependency(t,this.#e),this}inheritSimpleDataAsFutureForcedDependencies(t){return this.#t.inheritSimpleDataAsFutureForcedDependencies(t),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#t.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(t){return this.#i||this.#t.resetBBox(this.#e),this}recordClipBox(t,e,s,i,n,r){return this.#i||this.#t.recordClipBox(this.#e,e,s,i,n,r),this}recordBBox(t,e,s,i,n,r){return this.#i||this.#t.recordBBox(this.#e,e,s,i,n,r),this}recordCharacterBBox(t,e,s,i,n,r,a){return this.#i||this.#t.recordCharacterBBox(this.#e,e,s,i,n,r,a),this}recordFullPageBBox(t){return this.#i||this.#t.recordFullPageBBox(this.#e),this}getSimpleIndex(t){return this.#t.getSimpleIndex(t)}recordDependencies(t,e){return this.#t.recordDependencies(this.#e,e),this}recordNamedDependency(t,e){return this.#t.recordNamedDependency(this.#e,e),this}recordOperation(t){return this.#t.recordOperation(this.#e,!0),this}recordShowTextOperation(t){return this.#t.recordShowTextOperation(this.#e,!0),this}bboxToClipBoxDropOperation(t){return this.#i||this.#t.bboxToClipBoxDropOperation(this.#e,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const Bt={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},vt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Ri(o,t){if(!t)return;const e=t[2]-t[0],s=t[3]-t[1],i=new Path2D;i.rect(t[0],t[1],e,s),o.clip(i)}class sn{isModifyingCurrentTransform(){return!1}getPattern(){Q("Abstract method `getPattern` called.")}}class Wh extends sn{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}isOriginBased(){return this._p0[0]===0&&this._p0[1]===0&&(!this.isRadial()||this._p1[0]===0&&this._p1[1]===0)}isRadial(){return this._type==="radial"}_createGradient(t,e=null){let s,i=this._p0,n=this._p1;if(e&&(i=i.slice(),n=n.slice(),N.applyTransform(i,e),N.applyTransform(n,e)),this._type==="axial")s=t.createLinearGradient(i[0],i[1],n[0],n[1]);else if(this._type==="radial"){let r=this._r0,a=this._r1;if(e){const l=new Float32Array(2);N.singularValueDecompose2dScale(e,l),r*=l[0],a*=l[0]}s=t.createRadialGradient(i[0],i[1],r,n[0],n[1],a)}for(const r of this._colorStops)s.addColorStop(r[0],r[1]);return s}getPattern(t,e,s,i){let n;if(i===vt.STROKE||i===vt.FILL){if(this.isOriginBased()){let f=N.transform(s,e.baseTransform);this.matrix&&(f=N.transform(f,this.matrix));const p=.001,b=Math.hypot(f[0],f[1]),g=Math.hypot(f[2],f[3]),m=(f[0]*f[2]+f[1]*f[3])/(b*g);if(Math.abs(m)<p)if(this.isRadial()){if(Math.abs(b-g)<p)return this._createGradient(t,f)}else return this._createGradient(t,f)}const r=e.current.getClippedPathBoundingBox(i,it(t))||[0,0,0,0],a=Math.ceil(r[2]-r[0])||1,l=Math.ceil(r[3]-r[1])||1,c=e.cachedCanvases.getCanvas("pattern",a,l),h=c.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-r[0],-r[1]),s=N.transform(s,[1,0,0,1,r[0],r[1]]),h.transform(...e.baseTransform),this.matrix&&h.transform(...this.matrix),Ri(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),n=t.createPattern(c.canvas,"no-repeat");const d=new DOMMatrix(s);n.setTransform(d)}else Ri(t,this._bbox),n=this._createGradient(t);return n}}function ui(o,t,e,s,i,n,r,a){const l=t.coords,c=t.colors,h=o.data,d=o.width*4;let f;l[e+1]>l[s+1]&&(f=e,e=s,s=f,f=n,n=r,r=f),l[s+1]>l[i+1]&&(f=s,s=i,i=f,f=r,r=a,a=f),l[e+1]>l[s+1]&&(f=e,e=s,s=f,f=n,n=r,r=f);const p=(l[e]+t.offsetX)*t.scaleX,b=(l[e+1]+t.offsetY)*t.scaleY,g=(l[s]+t.offsetX)*t.scaleX,m=(l[s+1]+t.offsetY)*t.scaleY,y=(l[i]+t.offsetX)*t.scaleX,x=(l[i+1]+t.offsetY)*t.scaleY;if(b>=x)return;const w=c[n],v=c[n+1],A=c[n+2],E=c[r],C=c[r+1],P=c[r+2],T=c[a],_=c[a+1],k=c[a+2],R=Math.round(b),M=Math.round(x);let O,G,D,I,W,pt,jt,at;for(let Z=R;Z<=M;Z++){if(Z<m){const ot=Z<b?0:(b-Z)/(b-m);O=p-(p-g)*ot,G=w-(w-E)*ot,D=v-(v-C)*ot,I=A-(A-P)*ot}else{let ot;Z>x?ot=1:m===x?ot=0:ot=(m-Z)/(m-x),O=g-(g-y)*ot,G=E-(E-T)*ot,D=C-(C-_)*ot,I=P-(P-k)*ot}let U;Z<b?U=0:Z>x?U=1:U=(b-Z)/(b-x),W=p-(p-y)*U,pt=w-(w-T)*U,jt=v-(v-_)*U,at=A-(A-k)*U;const kt=Math.round(Math.min(O,W)),Gt=Math.round(Math.max(O,W));let Qt=d*Z+kt*4;for(let ot=kt;ot<=Gt;ot++)U=(O-ot)/(O-W),U<0?U=0:U>1&&(U=1),h[Qt++]=G-(G-pt)*U|0,h[Qt++]=D-(D-jt)*U|0,h[Qt++]=I-(I-at)*U|0,h[Qt++]=255}}function Gh(o,t,e){const s=t.coords,i=t.colors;let n,r;switch(t.type){case Ci.LATTICE:const a=t.verticesPerRow,l=Math.floor(s.length/a)-1,c=a-1;for(n=0;n<l;n++){let h=n*a;for(let d=0;d<c;d++,h++)ui(o,e,s[h],s[h+1],s[h+a],i[h],i[h+1],i[h+a]),ui(o,e,s[h+a+1],s[h+1],s[h+a],i[h+a+1],i[h+1],i[h+a])}break;case Ci.TRIANGLES:for(n=0,r=s.length;n<r;n+=3)ui(o,e,s[n],s[n+1],s[n+2],i[n],i[n+1],i[n+2]);break;default:throw new Error("illegal figure")}}class Vh extends sn{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,s){const a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-a,h=Math.ceil(this._bounds[3])-l,d=Math.min(Math.ceil(Math.abs(c*t[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(h*t[1]*1.1)),3e3),p=c/d,b=h/f,g={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/p,scaleY:1/b},m=d+4,y=f+4,x=s.getCanvas("mesh",m,y),w=x.context,v=w.createImageData(d,f);if(e){const E=v.data;for(let C=0,P=E.length;C<P;C+=4)E[C]=e[0],E[C+1]=e[1],E[C+2]=e[2],E[C+3]=255}for(const E of this._figures)Gh(v,E,g);return w.putImageData(v,2,2),{canvas:x.canvas,offsetX:a-2*p,offsetY:l-2*b,scaleX:p,scaleY:b}}isModifyingCurrentTransform(){return!0}getPattern(t,e,s,i){Ri(t,this._bbox);const n=new Float32Array(2);if(i===vt.SHADING)N.singularValueDecompose2dScale(it(t),n);else if(this.matrix){N.singularValueDecompose2dScale(this.matrix,n);const[a,l]=n;N.singularValueDecompose2dScale(e.baseTransform,n),n[0]*=a,n[1]*=l}else N.singularValueDecompose2dScale(e.baseTransform,n);const r=this._createMeshCanvas(n,i===vt.SHADING?null:this._background,e.cachedCanvases);return i!==vt.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(r.offsetX,r.offsetY),t.scale(r.scaleX,r.scaleY),t.createPattern(r.canvas,"no-repeat")}}class Xh extends sn{getPattern(){return"hotpink"}}function Yh(o){switch(o[0]){case"RadialAxial":return new Wh(o);case"Mesh":return new Vh(o);case"Dummy":return new Xh}throw new Error(`Unknown IR type: ${o[0]}`)}const qn={COLORED:1,UNCOLORED:2};class nn{static MAX_PATTERN_SIZE=3e3;constructor(t,e,s,i){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=s,this.baseTransform=i}createPatternCanvas(t,e){const{bbox:s,operatorList:i,paintType:n,tilingType:r,color:a,canvasGraphicsFactory:l}=this;let{xstep:c,ystep:h}=this;c=Math.abs(c),h=Math.abs(h),Hs("TilingType: "+r);const d=s[0],f=s[1],p=s[2],b=s[3],g=p-d,m=b-f,y=new Float32Array(2);N.singularValueDecompose2dScale(this.matrix,y);const[x,w]=y;N.singularValueDecompose2dScale(this.baseTransform,y);const v=x*y[0],A=w*y[1];let E=g,C=m,P=!1,T=!1;const _=Math.ceil(c*v),k=Math.ceil(h*A),R=Math.ceil(g*v),M=Math.ceil(m*A);_>=R?E=c:P=!0,k>=M?C=h:T=!0;const O=this.getSizeAndScale(E,this.ctx.canvas.width,v),G=this.getSizeAndScale(C,this.ctx.canvas.height,A),D=t.cachedCanvases.getCanvas("pattern",O.size,G.size),I=D.context,W=l.createCanvasGraphics(I,e);if(W.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext(W,n,a),I.translate(-O.scale*d,-G.scale*f),W.transform(0,O.scale,0,0,G.scale,0,0),I.save(),W.dependencyTracker?.save(),this.clipBbox(W,d,f,p,b),W.baseTransform=it(W.ctx),W.executeOperatorList(i),W.endDrawing(),W.dependencyTracker?.restore(),I.restore(),P||T){const pt=D.canvas;P&&(E=c),T&&(C=h);const jt=this.getSizeAndScale(E,this.ctx.canvas.width,v),at=this.getSizeAndScale(C,this.ctx.canvas.height,A),Z=jt.size,U=at.size,kt=t.cachedCanvases.getCanvas("pattern-workaround",Z,U),Gt=kt.context,Qt=P?Math.floor(g/c):0,ot=T?Math.floor(m/h):0;for(let xe=0;xe<=Qt;xe++)for(let he=0;he<=ot;he++)Gt.drawImage(pt,Z*xe,U*he,Z,U,0,0,Z,U);return{canvas:kt.canvas,scaleX:jt.scale,scaleY:at.scale,offsetX:d,offsetY:f}}return{canvas:D.canvas,scaleX:O.scale,scaleY:G.scale,offsetX:d,offsetY:f}}getSizeAndScale(t,e,s){const i=Math.max(nn.MAX_PATTERN_SIZE,e);let n=Math.ceil(t*s);return n>=i?n=i:s=n/t,{scale:s,size:n}}clipBbox(t,e,s,i,n){const r=i-e,a=n-s;t.ctx.rect(e,s,r,a),N.axialAlignedBoundingBox([e,s,i,n],it(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,s){const i=t.ctx,n=t.current;switch(e){case qn.COLORED:const{fillStyle:r,strokeStyle:a}=this.ctx;i.fillStyle=n.fillColor=r,i.strokeStyle=n.strokeColor=a;break;case qn.UNCOLORED:i.fillStyle=i.strokeStyle=s,n.fillColor=n.strokeColor=s;break;default:throw new ph(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,s,i,n){let r=s;i!==vt.SHADING&&(r=N.transform(r,e.baseTransform),this.matrix&&(r=N.transform(r,this.matrix)));const a=this.createPatternCanvas(e,n);let l=new DOMMatrix(r);l=l.translate(a.offsetX,a.offsetY),l=l.scale(1/a.scaleX,1/a.scaleY);const c=t.createPattern(a.canvas,"repeat");return c.setTransform(l),c}}function qh({src:o,srcPos:t=0,dest:e,width:s,height:i,nonBlackColor:n=4294967295,inverseDecode:r=!1}){const a=ut.isLittleEndian?4278190080:255,[l,c]=r?[n,a]:[a,n],h=s>>3,d=s&7,f=o.length;e=new Uint32Array(e.buffer);let p=0;for(let b=0;b<i;b++){for(const m=t+h;t<m;t++){const y=t<f?o[t]:255;e[p++]=y&128?c:l,e[p++]=y&64?c:l,e[p++]=y&32?c:l,e[p++]=y&16?c:l,e[p++]=y&8?c:l,e[p++]=y&4?c:l,e[p++]=y&2?c:l,e[p++]=y&1?c:l}if(d===0)continue;const g=t<f?o[t++]:255;for(let m=0;m<d;m++)e[p++]=g&1<<7-m?c:l}return{srcPos:t,destPos:p}}const Kn=16,Jn=100,Kh=15,Qn=10,Tt=16,fi=new DOMMatrix,Lt=new Float32Array(2),Ce=new Float32Array([1/0,1/0,-1/0,-1/0]);function Jh(o,t){if(o._removeMirroring)throw new Error("Context is already forwarding operations.");o.__originalSave=o.save,o.__originalRestore=o.restore,o.__originalRotate=o.rotate,o.__originalScale=o.scale,o.__originalTranslate=o.translate,o.__originalTransform=o.transform,o.__originalSetTransform=o.setTransform,o.__originalResetTransform=o.resetTransform,o.__originalClip=o.clip,o.__originalMoveTo=o.moveTo,o.__originalLineTo=o.lineTo,o.__originalBezierCurveTo=o.bezierCurveTo,o.__originalRect=o.rect,o.__originalClosePath=o.closePath,o.__originalBeginPath=o.beginPath,o._removeMirroring=()=>{o.save=o.__originalSave,o.restore=o.__originalRestore,o.rotate=o.__originalRotate,o.scale=o.__originalScale,o.translate=o.__originalTranslate,o.transform=o.__originalTransform,o.setTransform=o.__originalSetTransform,o.resetTransform=o.__originalResetTransform,o.clip=o.__originalClip,o.moveTo=o.__originalMoveTo,o.lineTo=o.__originalLineTo,o.bezierCurveTo=o.__originalBezierCurveTo,o.rect=o.__originalRect,o.closePath=o.__originalClosePath,o.beginPath=o.__originalBeginPath,delete o._removeMirroring},o.save=function(){t.save(),this.__originalSave()},o.restore=function(){t.restore(),this.__originalRestore()},o.translate=function(e,s){t.translate(e,s),this.__originalTranslate(e,s)},o.scale=function(e,s){t.scale(e,s),this.__originalScale(e,s)},o.transform=function(e,s,i,n,r,a){t.transform(e,s,i,n,r,a),this.__originalTransform(e,s,i,n,r,a)},o.setTransform=function(e,s,i,n,r,a){t.setTransform(e,s,i,n,r,a),this.__originalSetTransform(e,s,i,n,r,a)},o.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},o.rotate=function(e){t.rotate(e),this.__originalRotate(e)},o.clip=function(e){t.clip(e),this.__originalClip(e)},o.moveTo=function(e,s){t.moveTo(e,s),this.__originalMoveTo(e,s)},o.lineTo=function(e,s){t.lineTo(e,s),this.__originalLineTo(e,s)},o.bezierCurveTo=function(e,s,i,n,r,a){t.bezierCurveTo(e,s,i,n,r,a),this.__originalBezierCurveTo(e,s,i,n,r,a)},o.rect=function(e,s,i,n){t.rect(e,s,i,n),this.__originalRect(e,s,i,n)},o.closePath=function(){t.closePath(),this.__originalClosePath()},o.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class Qh{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,s){let i;return this.cache[t]!==void 0?(i=this.cache[t],this.canvasFactory.reset(i,e,s)):(i=this.canvasFactory.create(e,s),this.cache[t]=i),i}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function vs(o,t,e,s,i,n,r,a,l,c){const[h,d,f,p,b,g]=it(o);if(d===0&&f===0){const x=r*h+b,w=Math.round(x),v=a*p+g,A=Math.round(v),E=(r+l)*h+b,C=Math.abs(Math.round(E)-w)||1,P=(a+c)*p+g,T=Math.abs(Math.round(P)-A)||1;return o.setTransform(Math.sign(h),0,0,Math.sign(p),w,A),o.drawImage(t,e,s,i,n,0,0,C,T),o.setTransform(h,d,f,p,b,g),[C,T]}if(h===0&&p===0){const x=a*f+b,w=Math.round(x),v=r*d+g,A=Math.round(v),E=(a+c)*f+b,C=Math.abs(Math.round(E)-w)||1,P=(r+l)*d+g,T=Math.abs(Math.round(P)-A)||1;return o.setTransform(0,Math.sign(d),Math.sign(f),0,w,A),o.drawImage(t,e,s,i,n,0,0,T,C),o.setTransform(h,d,f,p,b,g),[T,C]}o.drawImage(t,e,s,i,n,r,a,l,c);const m=Math.hypot(h,d),y=Math.hypot(f,p);return[m*l,y*c]}class Zn{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=Ei;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=ft.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(t,e,s){s?.(this),this.clipBox=new Float32Array([0,0,t,e]),this.minMax=Ce.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=vt.FILL,e=null){const s=this.minMax.slice();if(t===vt.STROKE){e||Q("Stroke bounding box must include transform."),N.singularValueDecompose2dScale(e,Lt);const i=Lt[0]*this.lineWidth/2,n=Lt[1]*this.lineWidth/2;s[0]-=i,s[1]-=n,s[2]+=i,s[3]+=n}return s}updateClipFromPath(){const t=N.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(Ce,0)}getClippedPathBoundingBox(t=vt.FILL,e=null){return N.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function tr(o,t){if(t instanceof ImageData){o.putImageData(t,0,0);return}const e=t.height,s=t.width,i=e%Tt,n=(e-i)/Tt,r=i===0?n:n+1,a=o.createImageData(s,Tt);let l=0,c;const h=t.data,d=a.data;let f,p,b,g;if(t.kind===Ke.GRAYSCALE_1BPP){const m=h.byteLength,y=new Uint32Array(d.buffer,0,d.byteLength>>2),x=y.length,w=s+7>>3,v=4294967295,A=ut.isLittleEndian?4278190080:255;for(f=0;f<r;f++){for(b=f<n?Tt:i,c=0,p=0;p<b;p++){const E=m-l;let C=0;const P=E>w?s:E*8-7,T=P&-8;let _=0,k=0;for(;C<T;C+=8)k=h[l++],y[c++]=k&128?v:A,y[c++]=k&64?v:A,y[c++]=k&32?v:A,y[c++]=k&16?v:A,y[c++]=k&8?v:A,y[c++]=k&4?v:A,y[c++]=k&2?v:A,y[c++]=k&1?v:A;for(;C<P;C++)_===0&&(k=h[l++],_=128),y[c++]=k&_?v:A,_>>=1}for(;c<x;)y[c++]=0;o.putImageData(a,0,f*Tt)}}else if(t.kind===Ke.RGBA_32BPP){for(p=0,g=s*Tt*4,f=0;f<n;f++)d.set(h.subarray(l,l+g)),l+=g,o.putImageData(a,0,p),p+=Tt;f<r&&(g=s*i*4,d.set(h.subarray(l,l+g)),o.putImageData(a,0,p))}else if(t.kind===Ke.RGB_24BPP)for(b=Tt,g=s*b,f=0;f<r;f++){for(f>=n&&(b=i,g=s*b),c=0,p=g;p--;)d[c++]=h[l++],d[c++]=h[l++],d[c++]=h[l++],d[c++]=255;o.putImageData(a,0,f*Tt)}else throw new Error(`bad image kind: ${t.kind}`)}function er(o,t){if(t.bitmap){o.drawImage(t.bitmap,0,0);return}const e=t.height,s=t.width,i=e%Tt,n=(e-i)/Tt,r=i===0?n:n+1,a=o.createImageData(s,Tt);let l=0;const c=t.data,h=a.data;for(let d=0;d<r;d++){const f=d<n?Tt:i;({srcPos:l}=qh({src:c,srcPos:l,dest:h,width:s,height:f,nonBlackColor:0})),o.putImageData(a,0,d*Tt)}}function $e(o,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of e)o[s]!==void 0&&(t[s]=o[s]);o.setLineDash!==void 0&&(t.setLineDash(o.getLineDash()),t.lineDashOffset=o.lineDashOffset)}function As(o){o.strokeStyle=o.fillStyle="#000000",o.fillRule="nonzero",o.globalAlpha=1,o.lineWidth=1,o.lineCap="butt",o.lineJoin="miter",o.miterLimit=10,o.globalCompositeOperation="source-over",o.font="10px sans-serif",o.setLineDash!==void 0&&(o.setLineDash([]),o.lineDashOffset=0);const{filter:t}=o;t!=="none"&&t!==""&&(o.filter="none")}function sr(o,t){if(t)return!0;N.singularValueDecompose2dScale(o,Lt);const e=Math.fround(zt.pixelRatio*ge.PDF_TO_CSS_UNITS);return Lt[0]<=e&&Lt[1]<=e}const Zh=["butt","round","square"],td=["miter","round","bevel"],ed={},ir={};class Pe{constructor(t,e,s,i,n,{optionalContentConfig:r,markedContentStack:a=null},l,c,h){this.ctx=t,this.current=new Zn(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=s,this.canvasFactory=i,this.filterFactory=n,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=r,this.cachedCanvases=new Qh(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=h??null}getObject(t,e,s=null){return typeof e=="string"?(this.dependencyTracker?.recordNamedDependency(t,e),e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e)):s}beginDrawing({transform:t,viewport:e,transparency:s=!1,background:i=null}){const n=this.ctx.canvas.width,r=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,n,r),this.ctx.fillStyle=a,s){const l=this.cachedCanvases.getCanvas("transparent",n,r);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...it(this.compositeCtx))}this.ctx.save(),As(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=it(this.ctx)}executeOperatorList(t,e,s,i,n){const r=t.argsArray,a=t.fnArray;let l=e||0;const c=r.length;if(c===l)return l;const h=c-l>Qn&&typeof s=="function",d=h?Date.now()+Kh:0;let f=0;const p=this.commonObjs,b=this.objs;let g,m;for(;;){if(i!==void 0&&l===i.nextBreakPoint)return i.breakIt(l,s),l;if(!n||n(l))if(g=a[l],m=r[l]??null,g!==De.dependency)m===null?this[g](l):this[g](l,...m);else for(const y of m){this.dependencyTracker?.recordNamedData(y,l);const x=y.startsWith("g_")?p:b;if(!x.has(y))return x.get(y,s),l}if(l++,l===c)return l;if(h&&++f>Qn){if(Date.now()>d)return s(),l;f=0}}}#t(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#t(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),this.#e()}#e(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}}_scaleImage(t,e){const s=t.width??t.displayWidth,i=t.height??t.displayHeight;let n=Math.max(Math.hypot(e[0],e[1]),1),r=Math.max(Math.hypot(e[2],e[3]),1),a=s,l=i,c="prescale1",h,d;for(;n>2&&a>1||r>2&&l>1;){let f=a,p=l;n>2&&a>1&&(f=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),n/=a/f),r>2&&l>1&&(p=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,r/=l/p),h=this.cachedCanvases.getCanvas(c,f,p),d=h.context,d.clearRect(0,0,f,p),d.drawImage(t,0,0,a,l,0,0,f,p),t=h.canvas,a=f,l=p,c=c==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:a,paintHeight:l}}_createMaskCanvas(t,e){const s=this.ctx,{width:i,height:n}=e,r=this.current.fillColor,a=this.current.patternFill,l=it(s);let c,h,d,f;if((e.bitmap||e.data)&&e.count>1){const _=e.bitmap||e.data.buffer;h=JSON.stringify(a?l:[l.slice(0,4),r]),c=this._cachedBitmapsMap.get(_),c||(c=new Map,this._cachedBitmapsMap.set(_,c));const k=c.get(h);if(k&&!a){const R=Math.round(Math.min(l[0],l[2])+l[4]),M=Math.round(Math.min(l[1],l[3])+l[5]);return this.dependencyTracker?.recordDependencies(t,Bt.transformAndFill),{canvas:k,offsetX:R,offsetY:M}}d=k}d||(f=this.cachedCanvases.getCanvas("maskCanvas",i,n),er(f.context,e));let p=N.transform(l,[1/i,0,0,-1/n,0,0]);p=N.transform(p,[1,0,0,1,0,-n]);const b=Ce.slice();N.axialAlignedBoundingBox([0,0,i,n],p,b);const[g,m,y,x]=b,w=Math.round(y-g)||1,v=Math.round(x-m)||1,A=this.cachedCanvases.getCanvas("fillCanvas",w,v),E=A.context,C=g,P=m;E.translate(-C,-P),E.transform(...p),d||(d=this._scaleImage(f.canvas,Xt(E)),d=d.img,c&&a&&c.set(h,d)),E.imageSmoothingEnabled=sr(it(E),e.interpolate),vs(E,d,0,0,d.width,d.height,0,0,i,n),E.globalCompositeOperation="source-in";const T=N.transform(Xt(E),[1,0,0,1,-C,-P]);return E.fillStyle=a?r.getPattern(s,this,T,vt.FILL,t):r,E.fillRect(0,0,i,n),c&&!a&&(this.cachedCanvases.delete("fillCanvas"),c.set(h,A.canvas)),this.dependencyTracker?.recordDependencies(t,Bt.transformAndFill),{canvas:A.canvas,offsetX:Math.round(C),offsetY:Math.round(P)}}setLineWidth(t,e){this.dependencyTracker?.recordSimpleData("lineWidth",t),e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(t,e){this.dependencyTracker?.recordSimpleData("lineCap",t),this.ctx.lineCap=Zh[e]}setLineJoin(t,e){this.dependencyTracker?.recordSimpleData("lineJoin",t),this.ctx.lineJoin=td[e]}setMiterLimit(t,e){this.dependencyTracker?.recordSimpleData("miterLimit",t),this.ctx.miterLimit=e}setDash(t,e,s){this.dependencyTracker?.recordSimpleData("dash",t);const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(e),i.lineDashOffset=s)}setRenderingIntent(t,e){}setFlatness(t,e){}setGState(t,e){for(const[s,i]of e)switch(s){case"LW":this.setLineWidth(t,i);break;case"LC":this.setLineCap(t,i);break;case"LJ":this.setLineJoin(t,i);break;case"ML":this.setMiterLimit(t,i);break;case"D":this.setDash(t,i[0],i[1]);break;case"RI":this.setRenderingIntent(t,i);break;case"FL":this.setFlatness(t,i);break;case"Font":this.setFont(t,i[0],i[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",t),this.current.strokeAlpha=i;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",t),this.ctx.globalAlpha=this.current.fillAlpha=i;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",t),this.ctx.globalCompositeOperation=i;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",t),this.current.activeSMask=i?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",t),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(i);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(t){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,s=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,n=this.cachedCanvases.getCanvas(i,e,s);this.suspendedCtx=this.ctx;const r=this.ctx=n.context;r.setTransform(this.suspendedCtx.getTransform()),$e(this.suspendedCtx,r),Jh(r,this.suspendedCtx),this.setGState(t,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),$e(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,s,i){const n=i[0],r=i[1],a=i[2]-n,l=i[3]-r;a===0||l===0||(this.genericComposeSMask(e.context,s,a,l,e.subtype,e.backdrop,e.transferMap,n,r,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(s.canvas,0,0),t.restore())}genericComposeSMask(t,e,s,i,n,r,a,l,c,h,d){let f=t.canvas,p=l-h,b=c-d;if(r)if(p<0||b<0||p+s>f.width||b+i>f.height){const m=this.cachedCanvases.getCanvas("maskExtension",s,i),y=m.context;y.drawImage(f,-p,-b),y.globalCompositeOperation="destination-atop",y.fillStyle=r,y.fillRect(0,0,s,i),y.globalCompositeOperation="source-over",f=m.canvas,p=b=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const m=new Path2D;m.rect(p,b,s,i),t.clip(m),t.globalCompositeOperation="destination-atop",t.fillStyle=r,t.fillRect(p,b,s,i),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),n==="Alpha"&&a?e.filter=this.filterFactory.addAlphaFilter(a):n==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(a));const g=new Path2D;g.rect(l,c,s,i),e.clip(g),e.globalCompositeOperation="destination-in",e.drawImage(f,p,b,s,i,l,c,s,i),e.restore()}save(t){this.inSMaskMode&&$e(this.ctx,this.suspendedCtx),this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone(),this.dependencyTracker?.save(t)}restore(t){if(this.dependencyTracker?.restore(t),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&$e(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,s,i,n,r,a){this.dependencyTracker?.recordIncrementalData("transform",t),this.ctx.transform(e,s,i,n,r,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,s,i){let[n]=s;if(!i){n||=s[0]=new Path2D,this[e](t,n);return}if(this.dependencyTracker!==null){const r=e===De.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(t).recordBBox(t,this.ctx,i[0]-r,i[2]+r,i[1]-r,i[3]+r).recordDependencies(t,["transform"])}n instanceof Path2D||(n=s[0]=ba(n)),N.axialAlignedBoundingBox(i,it(this.ctx),this.current.minMax),this[e](t,n),this._pathStartIdx=t}closePath(t){this.ctx.closePath()}stroke(t,e,s=!0){const i=this.ctx,n=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof n=="object"&&n?.getPattern){const r=n.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=n.getPattern(i,this,Xt(i),vt.STROKE,t),r){const a=new Path2D;a.addPath(e,i.getTransform().invertSelf().multiplySelf(r)),e=a}this.rescaleAndStroke(e,!1),i.restore()}else this.rescaleAndStroke(e,!0);this.dependencyTracker?.recordDependencies(t,Bt.stroke),s&&this.consumePath(t,e,this.current.getClippedPathBoundingBox(vt.STROKE,it(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(t,e){this.stroke(t,e)}fill(t,e,s=!0){const i=this.ctx,n=this.current.fillColor,r=this.current.patternFill;let a=!1;if(r){const c=n.isModifyingCurrentTransform()?i.getTransform():null;if(this.dependencyTracker?.save(t),i.save(),i.fillStyle=n.getPattern(i,this,Xt(i),vt.FILL,t),c){const h=new Path2D;h.addPath(e,i.getTransform().invertSelf().multiplySelf(c)),e=h}a=!0}const l=this.current.getClippedPathBoundingBox();this.contentVisible&&l!==null&&(this.pendingEOFill?(i.fill(e,"evenodd"),this.pendingEOFill=!1):i.fill(e)),this.dependencyTracker?.recordDependencies(t,Bt.fill),a&&(i.restore(),this.dependencyTracker?.restore(t)),s&&this.consumePath(t,e,l)}eoFill(t,e){this.pendingEOFill=!0,this.fill(t,e)}fillStroke(t,e){this.fill(t,e,!1),this.stroke(t,e,!1),this.consumePath(t,e)}eoFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}closeFillStroke(t,e){this.fillStroke(t,e)}closeEOFillStroke(t,e){this.pendingEOFill=!0,this.fillStroke(t,e)}endPath(t,e){this.consumePath(t,e)}rawFillPath(t,e){this.ctx.fill(e),this.dependencyTracker?.recordDependencies(t,Bt.rawFillPath).recordOperation(t)}clip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=ed}eoClip(t){this.dependencyTracker?.recordFutureForcedDependency("clipMode",t),this.pendingClip=ir}beginText(t){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(t).resetIncrementalData("sameLineText").resetIncrementalData("moveText",t)}endText(t){const e=this.pendingTextPaths,s=this.ctx;if(this.dependencyTracker){const{dependencyTracker:i}=this;e!==void 0&&i.recordFutureForcedDependency("textClip",i.getOpenMarker()).recordFutureForcedDependency("textClip",t),i.recordCloseMarker(t)}if(e!==void 0){const i=new Path2D,n=s.getTransform().invertSelf();for(const{transform:r,x:a,y:l,fontSize:c,path:h}of e)h&&i.addPath(h,new DOMMatrix(r).preMultiplySelf(n).translate(a,l).scale(c,-c));s.clip(i)}delete this.pendingTextPaths}setCharSpacing(t,e){this.dependencyTracker?.recordSimpleData("charSpacing",t),this.current.charSpacing=e}setWordSpacing(t,e){this.dependencyTracker?.recordSimpleData("wordSpacing",t),this.current.wordSpacing=e}setHScale(t,e){this.dependencyTracker?.recordSimpleData("hScale",t),this.current.textHScale=e/100}setLeading(t,e){this.dependencyTracker?.recordSimpleData("leading",t),this.current.leading=-e}setFont(t,e,s){this.dependencyTracker?.recordSimpleData("font",t).recordSimpleDataFromNamed("fontObj",e,t);const i=this.commonObjs.get(e),n=this.current;if(!i)throw new Error(`Can't find font for ${e}`);if(n.fontMatrix=i.fontMatrix||Ei,(n.fontMatrix[0]===0||n.fontMatrix[3]===0)&&$("Invalid font matrix for font "+e),s<0?(s=-s,n.fontDirection=-1):n.fontDirection=1,this.current.font=i,this.current.fontSize=s,i.isType3Font)return;const r=i.loadedName||"sans-serif",a=i.systemFontInfo?.css||`"${r}", ${i.fallbackName}`;let l="normal";i.black?l="900":i.bold&&(l="bold");const c=i.italic?"italic":"normal";let h=s;s<Kn?h=Kn:s>Jn&&(h=Jn),this.current.fontSizeScale=s/h,this.ctx.font=`${c} ${l} ${h}px ${a}`}setTextRenderingMode(t,e){this.dependencyTracker?.recordSimpleData("textRenderingMode",t),this.current.textRenderingMode=e}setTextRise(t,e){this.dependencyTracker?.recordSimpleData("textRise",t),this.current.textRise=e}moveText(t,e,s){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",t),this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=s}setLeadingMoveText(t,e,s){this.setLeading(t,-s),this.moveText(t,e,s)}setTextMatrix(t,e){this.dependencyTracker?.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",t);const{current:s}=this;s.textMatrix=e,s.textMatrixScale=Math.hypot(e[0],e[1]),s.x=s.lineX=0,s.y=s.lineY=0}nextLine(t){this.moveText(t,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??t)}#i(t,e,s){const i=new Path2D;return i.addPath(t,new DOMMatrix(s).invertSelf().multiplySelf(e)),i}paintChar(t,e,s,i,n,r){const a=this.ctx,l=this.current,c=l.font,h=l.textRenderingMode,d=l.fontSize/l.fontSizeScale,f=h&ft.FILL_STROKE_MASK,p=!!(h&ft.ADD_TO_PATH_FLAG),b=l.patternFill&&!c.missingFile,g=l.patternStroke&&!c.missingFile;let m;if((c.disableFontFace||p||b||g)&&!c.missingFile&&(m=c.getPathGenerator(this.commonObjs,e)),m&&(c.disableFontFace||b||g)){a.save(),a.translate(s,i),a.scale(d,-d),this.dependencyTracker?.recordCharacterBBox(t,a,c);let y;if(f===ft.FILL||f===ft.FILL_STROKE)if(n){y=a.getTransform(),a.setTransform(...n);const x=this.#i(m,y,n);a.fill(x)}else a.fill(m);if(f===ft.STROKE||f===ft.FILL_STROKE)if(r){y||=a.getTransform(),a.setTransform(...r);const{a:x,b:w,c:v,d:A}=y,E=N.inverseTransform(r),C=N.transform([x,w,v,A,0,0],E);N.singularValueDecompose2dScale(C,Lt),a.lineWidth*=Math.max(Lt[0],Lt[1])/d,a.stroke(this.#i(m,y,r))}else a.lineWidth/=d,a.stroke(m);a.restore()}else(f===ft.FILL||f===ft.FILL_STROKE)&&(a.fillText(e,s,i),this.dependencyTracker?.recordCharacterBBox(t,a,c,d,s,i,()=>a.measureText(e))),(f===ft.STROKE||f===ft.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(t,a,c,d,s,i,()=>a.measureText(e)).recordDependencies(t,Bt.stroke),a.strokeText(e,s,i));p&&((this.pendingTextPaths||=[]).push({transform:it(a),x:s,y:i,fontSize:d,path:m}),this.dependencyTracker?.recordCharacterBBox(t,a,c,d,s,i))}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<e.length;i+=4)if(e[i]>0&&e[i]<255){s=!0;break}return H(this,"isFontSubpixelAAEnabled",s)}showText(t,e){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(t,Bt.showText).resetBBox(t),this.current.textRenderingMode&ft.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",t).inheritPendingDependenciesAsFutureForcedDependencies());const s=this.current,i=s.font;if(i.isType3Font){this.showType3Text(t,e),this.dependencyTracker?.recordShowTextOperation(t);return}const n=s.fontSize;if(n===0){this.dependencyTracker?.recordOperation(t);return}const r=this.ctx,a=s.fontSizeScale,l=s.charSpacing,c=s.wordSpacing,h=s.fontDirection,d=s.textHScale*h,f=e.length,p=i.vertical,b=p?1:-1,g=i.defaultVMetrics,m=n*s.fontMatrix[0],y=s.textRenderingMode===ft.FILL&&!i.disableFontFace&&!s.patternFill;r.save(),s.textMatrix&&r.transform(...s.textMatrix),r.translate(s.x,s.y+s.textRise),h>0?r.scale(d,-1):r.scale(d,1);let x,w;const v=s.textRenderingMode&ft.FILL_STROKE_MASK,A=v===ft.FILL||v===ft.FILL_STROKE,E=v===ft.STROKE||v===ft.FILL_STROKE;if(A&&s.patternFill){r.save();const k=s.fillColor.getPattern(r,this,Xt(r),vt.FILL,t);x=it(r),r.restore(),r.fillStyle=k}if(E&&s.patternStroke){r.save();const k=s.strokeColor.getPattern(r,this,Xt(r),vt.STROKE,t);w=it(r),r.restore(),r.strokeStyle=k}let C=s.lineWidth;const P=s.textMatrixScale;if(P===0||C===0?E&&(C=this.getSinglePixelWidth()):C/=P,a!==1&&(r.scale(a,a),C/=a),r.lineWidth=C,i.isInvalidPDFjsFont){const k=[];let R=0;for(const O of e)k.push(O.unicode),R+=O.width;const M=k.join("");if(r.fillText(M,0,0),this.dependencyTracker!==null){const O=r.measureText(M);this.dependencyTracker.recordBBox(t,this.ctx,-O.actualBoundingBoxLeft,O.actualBoundingBoxRight,-O.actualBoundingBoxAscent,O.actualBoundingBoxDescent).recordShowTextOperation(t)}s.x+=R*m*d,r.restore(),this.compose();return}let T=0,_;for(_=0;_<f;++_){const k=e[_];if(typeof k=="number"){T+=b*k*n/1e3;continue}let R=!1;const M=(k.isSpace?c:0)+l,O=k.fontChar,G=k.accent;let D,I,W=k.width;if(p){const at=k.vmetric||g,Z=-(k.vmetric?at[1]:W*.5)*m,U=at[2]*m;W=at?-at[0]:W,D=Z/a,I=(T+U)/a}else D=T/a,I=0;let pt;if(i.remeasure&&W>0){pt=r.measureText(O);const at=pt.width*1e3/n*a;if(W<at&&this.isFontSubpixelAAEnabled){const Z=W/at;R=!0,r.save(),r.scale(Z,1),D/=Z}else W!==at&&(D+=(W-at)/2e3*n/a)}if(this.contentVisible&&(k.isInFont||i.missingFile)){if(y&&!G)r.fillText(O,D,I),this.dependencyTracker?.recordCharacterBBox(t,r,pt?{bbox:null}:i,n/a,D,I,()=>pt??r.measureText(O));else if(this.paintChar(t,O,D,I,x,w),G){const at=D+n*G.offset.x/a,Z=I-n*G.offset.y/a;this.paintChar(t,G.fontChar,at,Z,x,w)}}const jt=p?W*m-M*h:W*m+M*h;T+=jt,R&&r.restore()}p?s.y-=T:s.x+=T*d,r.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(t)}showType3Text(t,e){const s=this.ctx,i=this.current,n=i.font,r=i.fontSize,a=i.fontDirection,l=n.vertical?1:-1,c=i.charSpacing,h=i.wordSpacing,d=i.textHScale*a,f=i.fontMatrix||Ei,p=e.length,b=i.textRenderingMode===ft.INVISIBLE;let g,m,y,x;if(b||r===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,s.save(),i.textMatrix&&s.transform(...i.textMatrix),s.translate(i.x,i.y+i.textRise),s.scale(d,a);const w=this.dependencyTracker;for(this.dependencyTracker=w?new Is(w,t):null,g=0;g<p;++g){if(m=e[g],typeof m=="number"){x=l*m*r/1e3,this.ctx.translate(x,0),i.x+=x*d;continue}const v=(m.isSpace?h:0)+c,A=n.charProcOperatorList[m.operatorListId];A?this.contentVisible&&(this.save(),s.scale(r,r),s.transform(...f),this.executeOperatorList(A),this.restore()):$(`Type3 character "${m.operatorListId}" is not available.`);const E=[m.width,0];N.applyTransform(E,f),y=E[0]*r+v,s.translate(y,0),i.x+=y*d}s.restore(),w&&(this.dependencyTracker=w)}setCharWidth(t,e,s){}setCharWidthAndBounds(t,e,s,i,n,r,a){const l=new Path2D;l.rect(i,n,r-i,a-n),this.ctx.clip(l),this.dependencyTracker?.recordBBox(t,this.ctx,i,r,n,a).recordClipBox(t,this.ctx,i,r,n,a),this.endPath(t)}getColorN_Pattern(t,e){let s;if(e[0]==="TilingPattern"){const i=this.baseTransform||it(this.ctx),n={createCanvasGraphics:(r,a)=>new Pe(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new Is(this.dependencyTracker,a,!0):null)};s=new nn(e,this.ctx,n,i)}else s=this._getPattern(t,e[1],e[2]);return s}setStrokeColorN(t,...e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.current.strokeColor=this.getColorN_Pattern(t,e),this.current.patternStroke=!0}setFillColorN(t,...e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.current.fillColor=this.getColorN_Pattern(t,e),this.current.patternFill=!0}setStrokeRGBColor(t,e){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor=e,this.current.patternStroke=!1}setStrokeTransparent(t){this.dependencyTracker?.recordSimpleData("strokeColor",t),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t,e){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor=e,this.current.patternFill=!1}setFillTransparent(t){this.dependencyTracker?.recordSimpleData("fillColor",t),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e,s=null){let i;return this.cachedPatterns.has(e)?i=this.cachedPatterns.get(e):(i=Yh(this.getObject(t,e)),this.cachedPatterns.set(e,i)),s&&(i.matrix=s),i}shadingFill(t,e){if(!this.contentVisible)return;const s=this.ctx;this.save(t);const i=this._getPattern(t,e);s.fillStyle=i.getPattern(s,this,Xt(s),vt.SHADING,t);const n=Xt(s);if(n){const{width:r,height:a}=s.canvas,l=Ce.slice();N.axialAlignedBoundingBox([0,0,r,a],n,l);const[c,h,d,f]=l;this.ctx.fillRect(c,h,d-c,f-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(t).recordFullPageBBox(t).recordDependencies(t,Bt.transform).recordDependencies(t,Bt.fill).recordOperation(t),this.compose(this.current.getClippedPathBoundingBox()),this.restore(t)}beginInlineImage(){Q("Should not call beginInlineImage")}beginImageData(){Q("Should not call beginImageData")}paintFormXObjectBegin(t,e,s){if(this.contentVisible&&(this.save(t),this.baseTransformStack.push(this.baseTransform),e&&this.transform(t,...e),this.baseTransform=it(this.ctx),s)){N.axialAlignedBoundingBox(s,this.baseTransform,this.current.minMax);const[i,n,r,a]=s,l=new Path2D;l.rect(i,n,r-i,a-n),this.ctx.clip(l),this.dependencyTracker?.recordClipBox(t,this.ctx,i,r,n,a),this.endPath(t)}}paintFormXObjectEnd(t){this.contentVisible&&(this.restore(t),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t,e){if(!this.contentVisible)return;this.save(t),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const s=this.ctx;e.isolated||Hs("TODO: Support non-isolated groups."),e.knockout&&$("Knockout groups not supported.");const i=it(s);if(e.matrix&&s.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let n=Ce.slice();N.axialAlignedBoundingBox(e.bbox,it(s),n);const r=[0,0,s.canvas.width,s.canvas.height];n=N.intersect(n,r)||[0,0,0,0];const a=Math.floor(n[0]),l=Math.floor(n[1]),c=Math.max(Math.ceil(n[2])-a,1),h=Math.max(Math.ceil(n[3])-l,1);this.current.startNewPathAndClipBox([0,0,c,h]);let d="groupAt"+this.groupLevel;e.smask&&(d+="_smask_"+this.smaskCounter++%2);const f=this.cachedCanvases.getCanvas(d,c,h),p=f.context;p.translate(-a,-l),p.transform(...i);let b=new Path2D;const[g,m,y,x]=e.bbox;if(b.rect(g,m,y-g,x-m),e.matrix){const w=new Path2D;w.addPath(b,new DOMMatrix(e.matrix)),b=w}p.clip(b),e.smask&&this.smaskStack.push({canvas:f.canvas,context:p,offsetX:a,offsetY:l,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}),(!e.smask||this.dependencyTracker)&&(s.setTransform(1,0,0,1,0,0),s.translate(a,l),s.save()),$e(s,p),this.ctx=p,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(s),this.setGState(t,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(s),this.groupLevel++}endGroup(t,e){if(!this.contentVisible)return;this.groupLevel--;const s=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),e.smask)this.tempSMask=this.smaskStack.pop(),this.restore(t),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const n=it(this.ctx);this.restore(t),this.ctx.save(),this.ctx.setTransform(...n);const r=Ce.slice();N.axialAlignedBoundingBox([0,0,s.canvas.width,s.canvas.height],n,r),this.ctx.drawImage(s.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(t,e,s,i,n,r){if(this.#t(),As(this.ctx),this.ctx.save(),this.save(t),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),s){const a=s[2]-s[0],l=s[3]-s[1];if(r&&this.annotationCanvasMap){i=i.slice(),i[4]-=s[0],i[5]-=s[1],s=s.slice(),s[0]=s[1]=0,s[2]=a,s[3]=l,N.singularValueDecompose2dScale(it(this.ctx),Lt);const{viewportScale:c}=this,h=Math.ceil(a*this.outputScaleX*c),d=Math.ceil(l*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(h,d);const{canvas:f,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(e,f),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(Lt[0],0,0,-Lt[1],0,l*Lt[1]),As(this.ctx)}else{As(this.ctx),this.endPath(t);const c=new Path2D;c.rect(s[0],s[1],a,l),this.ctx.clip(c)}}this.current=new Zn(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(t,...i),this.transform(t,...n)}endAnnotation(t){this.annotationCanvas&&(this.ctx.restore(),this.#e(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t,e){if(!this.contentVisible)return;const s=e.count;e=this.getObject(t,e.data,e),e.count=s;const i=this.ctx,n=this._createMaskCanvas(t,e),r=n.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(r,n.offsetX,n.offsetY),this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,n.offsetX,n.offsetX+r.width,n.offsetY,n.offsetY+r.height).recordOperation(t),i.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,s,i=0,n=0,r,a){if(!this.contentVisible)return;e=this.getObject(t,e.data,e);const l=this.ctx;l.save();const c=it(l);l.transform(s,i,n,r,0,0);const h=this._createMaskCanvas(t,e);l.setTransform(1,0,0,1,h.offsetX-c[4],h.offsetY-c[5]),this.dependencyTracker?.resetBBox(t);for(let d=0,f=a.length;d<f;d+=2){const p=N.transform(c,[s,i,n,r,a[d],a[d+1]]);l.drawImage(h.canvas,p[4],p[5]),this.dependencyTracker?.recordBBox(t,this.ctx,p[4],p[4]+h.canvas.width,p[5],p[5]+h.canvas.height)}l.restore(),this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageMaskXObjectGroup(t,e){if(!this.contentVisible)return;const s=this.ctx,i=this.current.fillColor,n=this.current.patternFill;this.dependencyTracker?.resetBBox(t).recordDependencies(t,Bt.transformAndFill);for(const r of e){const{data:a,width:l,height:c,transform:h}=r,d=this.cachedCanvases.getCanvas("maskCanvas",l,c),f=d.context;f.save();const p=this.getObject(t,a,r);er(f,p),f.globalCompositeOperation="source-in",f.fillStyle=n?i.getPattern(f,this,Xt(s),vt.FILL,t):i,f.fillRect(0,0,l,c),f.restore(),s.save(),s.transform(...h),s.scale(1,-1),vs(s,d.canvas,0,0,l,c,0,-1,1,1),this.dependencyTracker?.recordBBox(t,s,0,l,0,c),s.restore()}this.compose(),this.dependencyTracker?.recordOperation(t)}paintImageXObject(t,e){if(!this.contentVisible)return;const s=this.getObject(t,e);if(!s){$("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t,s)}paintImageXObjectRepeat(t,e,s,i,n){if(!this.contentVisible)return;const r=this.getObject(t,e);if(!r){$("Dependent image isn't ready yet");return}const a=r.width,l=r.height,c=[];for(let h=0,d=n.length;h<d;h+=2)c.push({transform:[s,0,0,i,n[h],n[h+1]],x:0,y:0,w:a,h:l});this.paintInlineImageXObjectGroup(t,r,c)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:s,height:i}=t,n=this.cachedCanvases.getCanvas("inlineImage",s,i),r=n.context;return r.filter=this.current.transferMaps,r.drawImage(e,0,0),r.filter="none",n.canvas}paintInlineImageXObject(t,e){if(!this.contentVisible)return;const s=e.width,i=e.height,n=this.ctx;this.save(t);const{filter:r}=n;r!=="none"&&r!==""&&(n.filter="none"),n.scale(1/s,-1/i);let a;if(e.bitmap)a=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)a=e;else{const h=this.cachedCanvases.getCanvas("inlineImage",s,i).context;tr(h,e),a=this.applyTransferMapsToCanvas(h)}const l=this._scaleImage(a,Xt(n));n.imageSmoothingEnabled=sr(it(n),e.interpolate),this.dependencyTracker?.resetBBox(t).recordBBox(t,n,0,s,-i,0).recordDependencies(t,Bt.imageXObject).recordOperation(t),vs(n,l.img,0,0,l.paintWidth,l.paintHeight,0,-i,s,i),this.compose(),this.restore(t)}paintInlineImageXObjectGroup(t,e,s){if(!this.contentVisible)return;const i=this.ctx;let n;if(e.bitmap)n=e.bitmap;else{const r=e.width,a=e.height,c=this.cachedCanvases.getCanvas("inlineImage",r,a).context;tr(c,e),n=this.applyTransferMapsToCanvas(c)}this.dependencyTracker?.resetBBox(t);for(const r of s)i.save(),i.transform(...r.transform),i.scale(1,-1),vs(i,n,r.x,r.y,r.w,r.h,0,-1,1,1),this.dependencyTracker?.recordBBox(t,i,0,1,-1,0),i.restore();this.dependencyTracker?.recordOperation(t),this.compose()}paintSolidColorImageMask(t){this.contentVisible&&(this.dependencyTracker?.resetBBox(t).recordBBox(t,this.ctx,0,1,0,1).recordDependencies(t,Bt.fill).recordOperation(t),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t,e){}markPointProps(t,e,s){}beginMarkedContent(t,e){this.dependencyTracker?.beginMarkedContent(t),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e,s){this.dependencyTracker?.beginMarkedContent(t),e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(s)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(t){this.dependencyTracker?.endMarkedContent(t),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(t){}endCompat(t){}consumePath(t,e,s){const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(s);const n=this.ctx;this.pendingClip?(i||(this.pendingClip===ir?n.clip(e,"evenodd"):n.clip(e)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(t).recordFutureForcedDependency("clipPath",t)):this.dependencyTracker?.recordOperation(t),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=it(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),s=Math.hypot(t[0],t[2]),i=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:s,c:i,d:n}=this.ctx.getTransform();let r,a;if(s===0&&i===0){const l=Math.abs(e),c=Math.abs(n);if(l===c)if(t===0)r=a=1/l;else{const h=l*t;r=a=h<1?1/h:1}else if(t===0)r=1/l,a=1/c;else{const h=l*t,d=c*t;r=h<1?1/h:1,a=d<1?1/d:1}}else{const l=Math.abs(e*n-s*i),c=Math.hypot(e,s),h=Math.hypot(i,n);if(t===0)r=h/l,a=c/l;else{const d=t*l;r=h>d?h/d:1,a=c>d?c/d:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:s,current:{lineWidth:i}}=this,[n,r]=this.getScaleForStroking();if(n===r){s.lineWidth=(i||1)*n,s.stroke(t);return}const a=s.getLineDash();e&&s.save(),s.scale(n,r),fi.a=1/n,fi.d=1/r;const l=new Path2D;if(l.addPath(t,fi),a.length>0){const c=Math.max(n,r);s.setLineDash(a.map(h=>h/c)),s.lineDashOffset/=c}s.lineWidth=i||1,s.stroke(l),e&&s.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}}for(const o in De)Pe.prototype[o]!==void 0&&(Pe.prototype[De[o]]=Pe.prototype[o]);class pe{static#t=null;static#e="";static get workerPort(){return this.#t}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");this.#t=t}static get workerSrc(){return this.#e}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");this.#e=t}}class sd{#t;#e;constructor({parsedData:t,rawData:e}){this.#t=t,this.#e=e}getRaw(){return this.#e}get(t){return this.#t.get(t)??null}[Symbol.iterator](){return this.#t.entries()}}const Se=Symbol("INTERNAL");class id{#t=!1;#e=!1;#i=!1;#s=!0;constructor(t,{name:e,intent:s,usage:i,rbGroups:n}){this.#t=!!(t&Dt.DISPLAY),this.#e=!!(t&Dt.PRINT),this.name=e,this.intent=s,this.usage=i,this.rbGroups=n}get visible(){if(this.#i)return this.#s;if(!this.#s)return!1;const{print:t,view:e}=this.usage;return this.#t?e?.viewState!=="OFF":this.#e?t?.printState!=="OFF":!0}_setVisible(t,e,s=!1){t!==Se&&Q("Internal method `_setVisible` called."),this.#i=s,this.#s=e}}class nd{#t=null;#e=new Map;#i=null;#s=null;constructor(t,e=Dt.DISPLAY){if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,this.#s=t.order;for(const s of t.groups)this.#e.set(s.id,new id(e,s));if(t.baseState==="OFF")for(const s of this.#e.values())s._setVisible(Se,!1);for(const s of t.on)this.#e.get(s)._setVisible(Se,!0);for(const s of t.off)this.#e.get(s)._setVisible(Se,!1);this.#i=this.getHash()}}#a(t){const e=t.length;if(e<2)return!0;const s=t[0];for(let i=1;i<e;i++){const n=t[i];let r;if(Array.isArray(n))r=this.#a(n);else if(this.#e.has(n))r=this.#e.get(n).visible;else return $(`Optional content group not found: ${n}`),!0;switch(s){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return s==="And"}isVisible(t){if(this.#e.size===0)return!0;if(!t)return Hs("Optional content group not defined."),!0;if(t.type==="OCG")return this.#e.has(t.id)?this.#e.get(t.id).visible:($(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return this.#a(t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!this.#e.has(e))return $(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!this.#e.has(e))return $(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!this.#e.has(e))return $(`Optional content group not found: ${e}`),!0;if(!this.#e.get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!this.#e.has(e))return $(`Optional content group not found: ${e}`),!0;if(this.#e.get(e).visible)return!1}return!0}return $(`Unknown optional content policy ${t.policy}.`),!0}return $(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,s=!0){const i=this.#e.get(t);if(!i){$(`Optional content group not found: ${t}`);return}if(s&&e&&i.rbGroups.length)for(const n of i.rbGroups)for(const r of n)r!==t&&this.#e.get(r)?._setVisible(Se,!1,!0);i._setVisible(Se,!!e,!0),this.#t=null}setOCGState({state:t,preserveRB:e}){let s;for(const i of t){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const n=this.#e.get(i);if(n)switch(s){case"ON":this.setVisibility(i,!0,e);break;case"OFF":this.setVisibility(i,!1,e);break;case"Toggle":this.setVisibility(i,!n.visible,e);break}}this.#t=null}get hasInitialVisibility(){return this.#i===null||this.getHash()===this.#i}getOrder(){return this.#e.size?this.#s?this.#s.slice():[...this.#e.keys()]:null}getGroup(t){return this.#e.get(t)||null}getHash(){if(this.#t!==null)return this.#t;const t=new xa;for(const[e,s]of this.#e)t.update(`${e}:${s.visible}`);return this.#t=t.hexdigest()}[Symbol.iterator](){return this.#e.entries()}}class Gs{#t=null;#e=null;_fullReader=null;_rangeReaders=new Set;_source=null;constructor(t,e,s){this._source=t,this.#t=e,this.#e=s}get _progressiveDataLength(){return this._fullReader?._loaded??0}getFullReader(){return J(!this._fullReader,"BasePDFStream.getFullReader can only be called once."),this._fullReader=new this.#t(this)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new this.#e(this,t,e);return this._rangeReaders.add(s),s}cancelAllRequests(t){this._fullReader?.cancel(t);for(const e of new Set(this._rangeReaders))e.cancel(t)}}class Vs{onProgress=null;_contentLength=0;_filename=null;_headersCapability=Promise.withResolvers();_isRangeSupported=!1;_isStreamingSupported=!1;_loaded=0;_stream=null;constructor(t){this._stream=t}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){Q("Abstract method `read` called")}cancel(t){Q("Abstract method `cancel` called")}}class Xs{_stream=null;constructor(t,e,s){this._stream=t}async read(){Q("Abstract method `read` called")}cancel(t){Q("Abstract method `cancel` called")}}function nr(o){return o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength?o.buffer:new Uint8Array(o).buffer}class rd extends Gs{_progressiveDone=!1;_queuedChunks=[];constructor(t){super(t,ad,od);const{pdfDataRangeTransport:e}=t,{initialData:s,progressiveDone:i}=e;if(s?.length>0){const n=nr(s);this._queuedChunks.push(n)}this._progressiveDone=i,e.addRangeListener((n,r)=>{this.#t(n,r)}),e.addProgressListener((n,r)=>{r!==void 0&&this._fullReader?.onProgress?.({loaded:n,total:r})}),e.addProgressiveReadListener(n=>{this.#t(void 0,n)}),e.addProgressiveDoneListener(()=>{this._fullReader?.progressiveDone(),this._progressiveDone=!0}),e.transportReady()}#t(t,e){const s=nr(e);if(t===void 0)this._fullReader?this._fullReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.keys().find(n=>n._begin===t);J(i,"#onReceiveData - no `PDFDataTransportStreamRangeReader` instance found."),i._enqueue(s)}}getFullReader(){const t=super.getFullReader();return this._queuedChunks=null,t}getRangeReader(t,e){const s=super.getRangeReader(t,e);return s&&(s.onDone=()=>this._rangeReaders.delete(s),this._source.pdfDataRangeTransport.requestDataRange(t,e)),s}cancelAllRequests(t){super.cancelAllRequests(t),this._source.pdfDataRangeTransport.abort()}}class ad extends Vs{_done=!1;_queuedChunks=null;_requests=[];constructor(t){super(t);const{pdfDataRangeTransport:e,disableRange:s,disableStream:i}=t._source,{length:n,contentDispositionFilename:r}=e;this._queuedChunks=t._queuedChunks||[];for(const a of this._queuedChunks)this._loaded+=a.byteLength;this._done=t._progressiveDone,this._contentLength=n,this._isStreamingSupported=!i,this._isRangeSupported=!s,Ws(r)&&(this._filename=r),this._headersCapability.resolve()}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||=!0}}class od extends Xs{onDone=null;_begin=-1;_done=!1;_queuedChunk=null;_requests=[];constructor(t,e,s){super(t,e,s),this._begin=e}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this.onDone?.()}}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this.onDone?.()}}function ld(o){let t=!0,e=s("filename\\*","i").exec(o);if(e){e=e[1];let h=a(e);return h=unescape(h),h=l(h),h=c(h),n(h)}if(e=r(o),e){const h=c(e);return n(h)}if(e=s("filename","i").exec(o),e){e=e[1];let h=a(e);return h=c(h),n(h)}function s(h,d){return new RegExp("(?:^|;)\\s*"+h+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',d)}function i(h,d){if(h){if(!/^[\x00-\xFF]+$/.test(d))return d;try{const f=new TextDecoder(h,{fatal:!0}),p=$s(d);d=f.decode(p),t=!1}catch{}}return d}function n(h){return t&&/[\x80-\xff]/.test(h)&&(h=i("utf-8",h),t&&(h=i("iso-8859-1",h))),h}function r(h){const d=[];let f;const p=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=p.exec(h))!==null;){let[,g,m,y]=f;if(g=parseInt(g,10),g in d){if(g===0)break;continue}d[g]=[m,y]}const b=[];for(let g=0;g<d.length&&g in d;++g){let[m,y]=d[g];y=a(y),m&&(y=unescape(y),g===0&&(y=l(y))),b.push(y)}return b.join("")}function a(h){if(h.startsWith('"')){const d=h.slice(1).split('\\"');for(let f=0;f<d.length;++f){const p=d[f].indexOf('"');p!==-1&&(d[f]=d[f].slice(0,p),d.length=f+1),d[f]=d[f].replaceAll(/\\(.)/g,"$1")}h=d.join('"')}return h}function l(h){const d=h.indexOf("'");if(d===-1)return h;const f=h.slice(0,d),b=h.slice(d+1).replace(/^[^']*'/,"");return i(f,b)}function c(h){return!h.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(h)?h:h.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(d,f,p,b){if(p==="q"||p==="Q")return b=b.replaceAll("_"," "),b=b.replaceAll(/=([0-9a-fA-F]{2})/g,function(g,m){return String.fromCharCode(parseInt(m,16))}),i(f,b);try{b=atob(b)}catch{}return i(f,b)})}return""}function _a(o,t){const e=new Headers;if(!o||!t||typeof t!="object")return e;for(const s in t){const i=t[s];i!==void 0&&e.append(s,i)}return e}function Ys(o){return URL.parse(o)?.origin??null}function ka({responseHeaders:o,isHttp:t,rangeChunkSize:e,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(o.get("Content-Length"),10);return!Number.isInteger(n)||(i.suggestedLength=n,n<=2*e)||s||!t||o.get("Accept-Ranges")!=="bytes"||(o.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function Pa(o){const t=o.get("Content-Disposition");if(t){let e=ld(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(Ws(e))return e}return null}function qs(o,t){return new ts(`Unexpected server response (${o}) while retrieving PDF "${t}".`,o,o===404||o===0&&t.startsWith("file:"))}function Ra(o,t){if(o!==t)throw new Error(`Expected range response-origin "${o}" to match "${t}".`)}function Da(o,t,e,s){return fetch(o,{method:"GET",headers:t,signal:s.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"})}function Na(o,t){if(o!==200&&o!==206)throw qs(o,t)}function La(o){return o instanceof Uint8Array?o.buffer:o instanceof ArrayBuffer?o:($(`getArrayBuffer - unexpected data format: ${o}`),new Uint8Array(o).buffer)}class cd extends Gs{_responseOrigin=null;constructor(t){super(t,hd,dd),this.isHttp=/^https?:/i.test(t.url),this.headers=_a(this.isHttp,t.httpHeaders)}}class hd extends Vs{_abortController=new AbortController;_reader=null;constructor(t){super(t);const{disableRange:e,disableStream:s,length:i,rangeChunkSize:n,url:r,withCredentials:a}=t._source;this._contentLength=i,this._isStreamingSupported=!s,this._isRangeSupported=!e;const l=new Headers(t.headers);Da(r,l,a,this._abortController).then(c=>{t._responseOrigin=Ys(c.url),Na(c.status,r),this._reader=c.body.getReader();const h=c.headers,{allowRangeRequests:d,suggestedLength:f}=ka({responseHeaders:h,isHttp:t.isHttp,rangeChunkSize:n,disableRange:e});this._isRangeSupported=d,this._contentLength=f||this._contentLength,this._filename=Pa(h),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new ne("Streaming is disabled.")),this._headersCapability.resolve()}).catch(this._headersCapability.reject)}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:La(t),done:!1})}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}class dd extends Xs{_abortController=new AbortController;_readCapability=Promise.withResolvers();_reader=null;constructor(t,e,s){super(t,e,s);const{url:i,withCredentials:n}=t._source,r=new Headers(t.headers);r.append("Range",`bytes=${e}-${s-1}`),Da(i,r,n,this._abortController).then(a=>{const l=Ys(a.url);Ra(l,t._responseOrigin),Na(a.status,i),this._reader=a.body.getReader(),this._readCapability.resolve()}).catch(this._readCapability.reject)}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:{value:La(t),done:!1}}cancel(t){this._reader?.cancel(t),this._abortController.abort()}}const pi=200,rr=206;function ud(o){return typeof o!="string"?o:$s(o).buffer}class fd extends Gs{#t=new WeakMap;_responseOrigin=null;constructor(t){super(t,pd,gd),this.url=t.url,this.isHttp=/^https?:/i.test(this.url),this.headers=_a(this.isHttp,t.httpHeaders)}_request(t){const e=new XMLHttpRequest,s={validateStatus:null,onHeadersReceived:t.onHeadersReceived,onDone:t.onDone,onError:t.onError,onProgress:t.onProgress};this.#t.set(e,s),e.open("GET",this.url),e.withCredentials=this._source.withCredentials;for(const[i,n]of this.headers)e.setRequestHeader(i,n);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),s.validateStatus=i=>i===rr||i===pi):s.validateStatus=i=>i===pi,e.responseType="arraybuffer",J(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>t.onError(e.status),e.onreadystatechange=this.#i.bind(this,e),e.onprogress=this.#e.bind(this,e),e.send(null),e}#e(t,e){this.#t.get(t)?.onProgress?.(e)}#i(t,e){const s=this.#t.get(t);if(!s||(t.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),t.readyState!==4)||!this.#t.has(t))return;if(this.#t.delete(t),t.status===0&&this.isHttp){s.onError(t.status);return}const i=t.status||pi;if(!s.validateStatus(i)){s.onError(t.status);return}const n=ud(t.response);if(i===rr){const r=t.getResponseHeader("Content-Range");/bytes (\d+)-(\d+)\/(\d+)/.test(r)?s.onDone(n):($('Missing or invalid "Content-Range" header.'),s.onError(0))}else n?s.onDone(n):s.onError(t.status)}_abortRequest(t){this.#t.has(t)&&(this.#t.delete(t),t.abort())}getRangeReader(t,e){const s=super.getRangeReader(t,e);return s&&(s.onClosed=()=>this._rangeReaders.delete(s)),s}}class pd extends Vs{_cachedChunks=[];_done=!1;_requests=[];_storedError=null;constructor(t){super(t);const{length:e}=t._source;this._contentLength=e,this._fullRequestXhr=t._request({onHeadersReceived:this.#t.bind(this),onDone:this.#e.bind(this),onError:this.#i.bind(this),onProgress:this.#s.bind(this)})}#t(){const t=this._stream,{disableRange:e,rangeChunkSize:s}=t._source,i=this._fullRequestXhr;t._responseOrigin=Ys(i.responseURL);const n=i.getAllResponseHeaders(),r=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(c=>{const[h,...d]=c.split(": ");return[h,d.join(": ")]}):[]),{allowRangeRequests:a,suggestedLength:l}=ka({responseHeaders:r,isHttp:t.isHttp,rangeChunkSize:s,disableRange:e});a&&(this._isRangeSupported=!0),this._contentLength=l||this._contentLength,this._filename=Pa(r),this._isRangeSupported&&t._abortRequest(i),this._headersCapability.resolve()}#e(t){if(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._cachedChunks.push(t),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}#i(t){this._storedError=qs(t,this._stream.url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}#s(t){this.onProgress?.({loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._abortRequest(this._fullRequestXhr),this._fullRequestXhr=null}}class gd extends Xs{onClosed=null;_done=!1;_queuedChunk=null;_requests=[];_storedError=null;constructor(t,e,s){super(t,e,s),this._requestXhr=t._request({begin:e,end:s,onHeadersReceived:this.#t.bind(this),onDone:this.#e.bind(this),onError:this.#i.bind(this),onProgress:null})}#t(){const t=Ys(this._requestXhr?.responseURL);try{Ra(t,this._stream._responseOrigin)}catch(e){this._storedError=e,this.#i(0)}}#e(t){this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this.onClosed?.()}#i(t){this._storedError??=qs(t,this._stream.url);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._abortRequest(this._requestXhr),this.onClosed?.()}}const md=/^[a-z][a-z0-9\-+.]+:/i;function bd(o){if(md.test(o))return new URL(o);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(o))}function Ia(o){const{Readable:t}=process.getBuiltinModule("stream");return typeof t.toWeb=="function"?t.toWeb(o):process.getBuiltinModule("module").createRequire(import.meta.url)("node-readable-to-web-readable-stream").makeDefaultReadableStreamFromNodeReadable(o)}function Ma(o){return o instanceof Uint8Array?o.buffer:o instanceof ArrayBuffer?o:($(`getArrayBuffer - unexpected data format: ${o}`),new Uint8Array(o).buffer)}class yd extends Gs{constructor(t){super(t,xd,wd),this.url=bd(t.url),J(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs.")}}class xd extends Vs{_reader=null;constructor(t){super(t);const{disableRange:e,disableStream:s,length:i,rangeChunkSize:n}=t._source;this._contentLength=i,this._isStreamingSupported=!s,this._isRangeSupported=!e;const r=t.url,a=process.getBuiltinModule("fs");a.promises.lstat(r).then(l=>{const c=a.createReadStream(r),h=Ia(c);this._reader=h.getReader();const{size:d}=l;d<=2*n&&(this._isRangeSupported=!1),this._contentLength=d,!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new ne("Streaming is disabled.")),this._headersCapability.resolve()}).catch(l=>{l.code==="ENOENT"&&(l=qs(0,r.href)),this._headersCapability.reject(l)})}async read(){await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Ma(t),done:!1})}cancel(t){this._reader?.cancel(t)}}class wd extends Xs{_readCapability=Promise.withResolvers();_reader=null;constructor(t,e,s){super(t,e,s);const i=t.url,n=process.getBuiltinModule("fs");try{const r=n.createReadStream(i,{start:e,end:s-1}),a=Ia(r);this._reader=a.getReader(),this._readCapability.resolve()}catch(r){this._readCapability.reject(r)}}async read(){await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:{value:Ma(t),done:!1}}cancel(t){this._reader?.cancel(t)}}const ze=Symbol("INITIAL_DATA");class ja{#t=Object.create(null);#e(t){return this.#t[t]||={...Promise.withResolvers(),data:ze}}get(t,e=null){if(e){const i=this.#e(t);return i.promise.then(()=>e(i.data)),null}const s=this.#t[t];if(!s||s.data===ze)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return s.data}has(t){const e=this.#t[t];return!!e&&e.data!==ze}delete(t){const e=this.#t[t];return!e||e.data===ze?!1:(delete this.#t[t],!0)}resolve(t,e=null){const s=this.#e(t);s.data=e,s.resolve()}clear(){for(const t in this.#t){const{data:e}=this.#t[t];e?.bitmap?.close()}this.#t=Object.create(null)}*[Symbol.iterator](){for(const t in this.#t){const{data:e}=this.#t[t];e!==ze&&(yield[t,e])}}}const vd=1e5,ar=30;class _t{#t=Promise.withResolvers();#e=null;#i=!1;#s=!!globalThis.FontInspector?.enabled;#a=null;#r=null;#n=0;#o=0;#c=null;#l=null;#u=0;#d=0;#f=Object.create(null);#m=[];#g=null;#h=[];#p=new WeakMap;#b=null;static#x=new Map;static#y=new Map;static#C=new WeakMap;static#S=null;static#v=new Set;constructor({textContentSource:t,container:e,viewport:s}){if(t instanceof ReadableStream)this.#g=t;else if(typeof t=="object")this.#g=new ReadableStream({start(l){l.enqueue(t),l.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#e=this.#l=e,this.#d=s.scale*zt.pixelRatio,this.#u=s.rotation,this.#r={div:null,properties:null,ctx:null};const{pageWidth:i,pageHeight:n,pageX:r,pageY:a}=s.rawDims;this.#b=[1,0,0,-1,-r,a+n],this.#o=i,this.#n=n,_t.#P(),e.style.setProperty("--min-font-size",_t.#S),oe(e,s),this.#t.promise.finally(()=>{_t.#v.delete(this),this.#r=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=ut.platform;return H(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{this.#c.read().then(({value:e,done:s})=>{if(s){this.#t.resolve();return}this.#a??=e.lang,Object.assign(this.#f,e.styles),this.#_(e.items),t()},this.#t.reject)};return this.#c=this.#g.getReader(),_t.#v.add(this),t(),this.#t.promise}update({viewport:t,onBefore:e=null}){const s=t.scale*zt.pixelRatio,i=t.rotation;if(i!==this.#u&&(e?.(),this.#u=i,oe(this.#l,{rotation:i})),s!==this.#d){e?.(),this.#d=s;const n={div:null,properties:null,ctx:_t.#R(this.#a)};for(const r of this.#h)n.properties=this.#p.get(r),n.div=r,this.#E(n)}}cancel(){const t=new ne("TextLayer task cancelled.");this.#c?.cancel(t).catch(()=>{}),this.#c=null,this.#t.reject(t)}get textDivs(){return this.#h}get textContentItemsStr(){return this.#m}#_(t){if(this.#i)return;this.#r.ctx??=_t.#R(this.#a);const e=this.#h,s=this.#m;for(const i of t){if(e.length>vd){$("Ignoring additional textDivs for performance reasons."),this.#i=!0;return}if(i.str===void 0){if(i.type==="beginMarkedContentProps"||i.type==="beginMarkedContent"){const n=this.#e;this.#e=document.createElement("span"),this.#e.classList.add("markedContent"),i.id&&this.#e.setAttribute("id",`${i.id}`),i.tag==="Artifact"&&(this.#e.ariaHidden=!0),n.append(this.#e)}else i.type==="endMarkedContent"&&(this.#e=this.#e.parentNode);continue}s.push(i.str),this.#w(i)}}#w(t){const e=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};this.#h.push(e);const i=N.transform(this.#b,t.transform);let n=Math.atan2(i[1],i[0]);const r=this.#f[t.fontName];r.vertical&&(n+=Math.PI/2);let a=this.#s&&r.fontSubstitution||r.fontFamily;a=_t.fontFamilyMap.get(a)||a;const l=Math.hypot(i[2],i[3]),c=l*_t.#F(a,r,this.#a);let h,d;n===0?(h=i[4],d=i[5]-c):(h=i[4]+c*Math.sin(n),d=i[5]-c*Math.cos(n));const f=e.style;f.left=`${(100*h/this.#o).toFixed(2)}%`,f.top=`${(100*d/this.#n).toFixed(2)}%`,f.setProperty("--font-height",`${l.toFixed(2)}px`),f.fontFamily=a,s.fontSize=l,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,this.#s&&(e.dataset.fontName=r.fontSubstitutionLoadedName||t.fontName),n!==0&&(s.angle=n*(180/Math.PI));let p=!1;if(t.str.length>1)p=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const b=Math.abs(t.transform[0]),g=Math.abs(t.transform[3]);b!==g&&Math.max(b,g)/Math.min(b,g)>1.5&&(p=!0)}if(p&&(s.canvasWidth=r.vertical?t.height:t.width),this.#p.set(e,s),this.#r.div=e,this.#r.properties=s,this.#E(this.#r),s.hasText&&this.#e.append(e),s.hasEOL){const b=document.createElement("br");b.setAttribute("role","presentation"),this.#e.append(b)}}#E(t){const{div:e,properties:s,ctx:i}=t,{style:n}=e;if(s.canvasWidth!==0&&s.hasText){const{fontFamily:r}=n,{canvasWidth:a,fontSize:l}=s;_t.#k(i,l*this.#d,r);const{width:c}=i.measureText(e.textContent);c>0&&n.setProperty("--scale-x",a*this.#d/c)}s.angle!==0&&n.setProperty("--rotate",`${s.angle}deg`)}static cleanup(){if(!(this.#v.size>0)){this.#x.clear();for(const{canvas:t}of this.#y.values())t.remove();this.#y.clear()}}static#R(t=null){let e=this.#y.get(t||="");if(!e){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=t,document.body.append(s),e=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#y.set(t,e),this.#C.set(e,{size:0,family:""})}return e}static#k(t,e,s){const i=this.#C.get(t);e===i.size&&s===i.family||(t.font=`${e}px ${s}`,i.size=e,i.family=s)}static#P(){if(this.#S!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),this.#S=t.getBoundingClientRect().height,t.remove()}static#F(t,e,s){const i=this.#x.get(t);if(i)return i;const n=this.#R(s);n.canvas.width=n.canvas.height=ar,this.#k(n,ar,t);const r=n.measureText(""),a=r.fontBoundingBoxAscent,l=Math.abs(r.fontBoundingBoxDescent);n.canvas.width=n.canvas.height=0;let c=.8;return a?c=a/(a+l):(ut.platform.isFirefox&&$("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?c=e.ascent:e.descent&&(c=1+e.descent)),this.#x.set(t,c),c}}const Ad=100;function Fa(o={}){typeof o=="string"||o instanceof URL?o={url:o}:(o instanceof ArrayBuffer||ArrayBuffer.isView(o))&&(o={data:o});const t=new rn,{docId:e}=t,s=o.url?Dh(o.url):null,i=o.data?Nh(o.data):null,n=o.httpHeaders||null,r=o.withCredentials===!0,a=o.password??null,l=o.range instanceof an?o.range:null,c=Number.isInteger(o.rangeChunkSize)&&o.rangeChunkSize>0?o.rangeChunkSize:2**16;let h=o.worker instanceof yt?o.worker:null;const d=o.verbosity,f=typeof o.docBaseUrl=="string"&&!ls(o.docBaseUrl)?o.docBaseUrl:null,p=bs(o.cMapUrl),b=o.cMapPacked!==!1,g=o.CMapReaderFactory||(St?Bh:Wn),m=bs(o.iccUrl),y=bs(o.standardFontDataUrl),x=o.StandardFontDataFactory||(St?Uh:Gn),w=bs(o.wasmUrl),v=o.WasmFactory||(St?Hh:Vn),A=o.stopAtErrors!==!0,E=Number.isInteger(o.maxImageSize)&&o.maxImageSize>-1?o.maxImageSize:-1,C=o.isEvalSupported!==!1,P=typeof o.isOffscreenCanvasSupported=="boolean"?o.isOffscreenCanvasSupported:!St,T=typeof o.isImageDecoderSupported=="boolean"?o.isImageDecoderSupported:!St&&(ut.platform.isFirefox||!globalThis.chrome),_=Number.isInteger(o.canvasMaxAreaInBytes)?o.canvasMaxAreaInBytes:-1,k=typeof o.disableFontFace=="boolean"?o.disableFontFace:St,R=o.fontExtraProperties===!0,M=o.enableXfa===!0,O=o.ownerDocument||globalThis.document,G=o.disableRange===!0,D=o.disableStream===!0,I=o.disableAutoFetch===!0,W=o.pdfBug===!0,pt=o.CanvasFactory||(St?Oh:Mh),jt=o.FilterFactory||(St?Fh:jh),at=o.enableHWA===!0,Z=o.useWasm!==!1,U=l?l.length:o.length??NaN,kt=typeof o.useSystemFonts=="boolean"?o.useSystemFonts:!St&&!k,Gt=typeof o.useWorkerFetch=="boolean"?o.useWorkerFetch:!!(g===Wn&&x===Gn&&v===Vn&&p&&y&&w&&Ye(p,document.baseURI)&&Ye(y,document.baseURI)&&Ye(w,document.baseURI)),Qt=null;dh(d);const ot={canvasFactory:new pt({ownerDocument:O,enableHWA:at}),filterFactory:new jt({docId:e,ownerDocument:O}),cMapReaderFactory:Gt?null:new g({baseUrl:p,isCompressed:b}),standardFontDataFactory:Gt?null:new x({baseUrl:y}),wasmFactory:Gt?null:new v({baseUrl:w})};h||(h=yt.create({verbosity:d,port:pe.workerPort}),t._worker=h);const xe={docId:e,apiVersion:"5.4.624",data:i,password:a,disableAutoFetch:I,rangeChunkSize:c,length:U,docBaseUrl:f,enableXfa:M,evaluatorOptions:{maxImageSize:E,disableFontFace:k,ignoreErrors:A,isEvalSupported:C,isOffscreenCanvasSupported:P,isImageDecoderSupported:T,canvasMaxAreaInBytes:_,fontExtraProperties:R,useSystemFonts:kt,useWasm:Z,useWorkerFetch:Gt,cMapUrl:p,iccUrl:m,standardFontDataUrl:y,wasmUrl:w}},he={ownerDocument:O,pdfBug:W,styleElement:Qt,enableHWA:at,loadingParams:{disableAutoFetch:I,enableXfa:M}};return h.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const us=h.messageHandler.sendWithPromise("GetDocRequest",xe,i?[i.buffer]:null);let Fe;if(l)Fe=new rd({pdfDataRangeTransport:l,disableRange:G,disableStream:D});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");const de=Ye(s)?cd:St?yd:fd;Fe=new de({url:s,length:U,httpHeaders:n,withCredentials:r,rangeChunkSize:c,disableRange:G,disableStream:D})}return us.then(de=>{if(t.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const Qs=new qe(e,de,h.port),un=new Cd(Qs,t,Fe,he,ot);t._transport=un,Qs.send("Ready",null)})}).catch(t._capability.reject),t}class rn{static#t=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${rn.#t++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(t){throw this._worker?.port&&delete this._worker._pendingDestroy,t}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class an{#t=Promise.withResolvers();#e=[];#i=[];#s=[];#a=[];constructor(t,e,s=!1,i=null){this.length=t,this.initialData=e,this.progressiveDone=s,this.contentDispositionFilename=i}addRangeListener(t){this.#a.push(t)}addProgressListener(t){this.#s.push(t)}addProgressiveReadListener(t){this.#i.push(t)}addProgressiveDoneListener(t){this.#e.push(t)}onDataRange(t,e){for(const s of this.#a)s(t,e)}onDataProgress(t,e){this.#t.promise.then(()=>{for(const s of this.#s)s(t,e)})}onDataProgressiveRead(t){this.#t.promise.then(()=>{for(const e of this.#i)e(t)})}onDataProgressiveDone(){this.#t.promise.then(()=>{for(const t of this.#e)t()})}transportReady(){this.#t.resolve()}requestDataRange(t,e){Q("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class Sd{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return H(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(t,e){return this._transport.getAnnotationsByType(t,e)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}extractPages(t){return this._transport.extractPages(t)}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class Ed{#t=!1;#e=Y.instance;constructor(t,e,s,i=!1){this._pageIndex=t,this._pageInfo=e,this._transport=s,this._stats=i?new Fn:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new ja,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}set pageNumber(t){this._pageIndex=t-1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:n=!1}={}){return new os({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:n})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return H(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:t,canvas:e=t.canvas,viewport:s,intent:i="display",annotationMode:n=ee.ENABLE,transform:r=null,background:a=null,optionalContentConfigPromise:l=null,annotationCanvasMap:c=null,pageColors:h=null,printAnnotationStorage:d=null,isEditing:f=!1,recordOperations:p=!1,operationsFilter:b=null}){this._stats?.time("Overall");const g=this._transport.getRenderingIntent(i,n,d,f),{renderingIntent:m,cacheKey:y}=g;this.#t=!1,l||=this._transport.getOptionalContentConfig(m);let x=this._intentStates.get(y);x||(x=Object.create(null),this._intentStates.set(y,x)),x.streamReaderCancelTimeout&&(clearTimeout(x.streamReaderCancelTimeout),x.streamReaderCancelTimeout=null);const w=!!(m&Dt.PRINT);x.displayReadyCapability||(x.displayReadyCapability=Promise.withResolvers(),x.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(g));const v=!!(this._pdfBug&&globalThis.StepperManager?.enabled),A=!this.recordedBBoxes&&(p||v),E=T=>{if(x.renderTasks.delete(C),A){const _=C.gfx?.dependencyTracker.take();_&&(C.stepper&&C.stepper.setOperatorBBoxes(_,C.gfx.dependencyTracker.takeDebugMetadata()),p&&(this.recordedBBoxes=_))}w&&(this.#t=!0),this.#i(),T?(C.capability.reject(T),this._abortOperatorList({intentState:x,reason:T instanceof Error?T:new Error(T)})):C.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},C=new Te({callback:E,params:{canvas:e,canvasContext:t,dependencyTracker:A?new zh(e,x.operatorList.length,v):null,viewport:s,transform:r,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:x.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!w,pdfBug:this._pdfBug,pageColors:h,enableHWA:this._transport.enableHWA,operationsFilter:b});(x.renderTasks||=new Set).add(C);const P=C.task;return Promise.all([x.displayReadyCapability.promise,l]).then(([T,_])=>{if(this.destroyed){E();return}if(this._stats?.time("Rendering"),!(_.renderingIntent&m))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");C.initializeGraphics({transparency:T,optionalContentConfig:_}),C.operatorListChanged()}).catch(E),P}getOperatorList({intent:t="display",annotationMode:e=ee.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){function n(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}const r=this._transport.getRenderingIntent(t,e,s,i,!0);let a=this._intentStates.get(r.cacheKey);a||(a=Object.create(null),this._intentStates.set(r.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=n,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||=new Set).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(r)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageId:this.#e.getPageId(this._pageIndex+1)-1,pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>es.textContent(s));const e=this.streamTextContent(t);return new Promise(function(s,i){function n(){r.read().then(function({value:l,done:c}){if(c){s(a);return}a.lang??=l.lang,Object.assign(a.styles,l.styles),a.items.push(...l.items),n()},i)}const r=e.getReader(),a={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const s of e.renderTasks)t.push(s.completed),s.cancel();return this.objs.clear(),this.#t=!1,Promise.all(t)}cleanup(t=!1){this.#t=!0;const e=this.#i();return t&&e&&(this._stats&&=new Fn),e}#i(){if(!this.#t||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#t=!1,!0}_startRenderPage(t,e){const s=this._intentStates.get(e);s&&(this._stats?.timeEnd("Page Request"),s.displayReadyCapability?.resolve(t))}_renderPageChunk(t,e){for(let s=0,i=t.length;s<i;s++)e.operatorList.fnArray.push(t.fnArray[s]),e.operatorList.argsArray.push(t.argsArray[s]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const s of e.renderTasks)s.operatorListChanged();t.lastChunk&&this.#i()}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:s,modifiedIds:i}){const{map:n,transfer:r}=s,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageId:this.#e.getPageId(this._pageIndex+1)-1,pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:n,modifiedIds:i},r).getReader(),c=this._intentStates.get(e);c.streamReader=l;const h=()=>{l.read().then(({value:d,done:f})=>{if(f){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(d,c),h())},d=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(const f of c.renderTasks)f.operatorListChanged();this.#i()}if(c.displayReadyCapability)c.displayReadyCapability.reject(d);else if(c.opListReadCapability)c.opListReadCapability.reject(d);else throw d}})};h()}_abortOperatorList({intentState:t,reason:e,force:s=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!s){if(t.renderTasks.size>0)return;if(e instanceof zs){let i=Ad;e.extraDelay>0&&e.extraDelay<1e3&&(i+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},i);return}}if(t.streamReader.cancel(new ne(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[i,n]of this._intentStates)if(n===t){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}class yt{#t=Promise.withResolvers();#e=null;#i=null;#s=null;static#a=0;static#r=!1;static#n=new WeakMap;static{St&&(this.#r=!0,pe.workerSrc||="./pdf.worker.mjs"),this._isSameOrigin=(t,e)=>{const s=URL.parse(t);if(!s?.origin||s.origin==="null")return!1;const i=new URL(e,s);return s.origin===i.origin},this._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},this.fromPort=t=>{if(vh("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!t?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return this.create(t)}}constructor({name:t=null,port:e=null,verbosity:s=uh()}={}){if(this.name=t,this.destroyed=!1,this.verbosity=s,e){if(yt.#n.has(e))throw new Error("Cannot use more than one PDFWorker per port.");yt.#n.set(e,this),this.#c(e)}else this.#l()}get promise(){return this.#t.promise}#o(){this.#t.resolve(),this.#e.send("configure",{verbosity:this.verbosity})}get port(){return this.#i}get messageHandler(){return this.#e}#c(t){this.#i=t,this.#e=new qe("main","worker",t),this.#e.on("ready",()=>{}),this.#o()}#l(){if(yt.#r||yt.#d){this.#u();return}let{workerSrc:t}=yt;try{yt._isSameOrigin(window.location,t)||(t=yt._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),s=new qe("main","worker",e),i=()=>{n.abort(),s.destroy(),e.terminate(),this.destroyed?this.#t.reject(new Error("Worker was destroyed")):this.#u()},n=new AbortController;e.addEventListener("error",()=>{this.#s||i()},{signal:n.signal}),s.on("test",a=>{if(n.abort(),this.destroyed||!a){i();return}this.#e=s,this.#i=e,this.#s=e,this.#o()}),s.on("ready",a=>{if(n.abort(),this.destroyed){i();return}try{r()}catch{this.#u()}});const r=()=>{const a=new Uint8Array;s.send("test",a,[a.buffer])};r();return}catch{Hs("The worker has been disabled.")}this.#u()}#u(){yt.#r||($("Setting up fake worker."),yt.#r=!0),yt._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){this.#t.reject(new Error("Worker was destroyed"));return}const e=new Ih;this.#i=e;const s=`fake${yt.#a++}`,i=new qe(s+"_worker",s,e);t.setup(i,e),this.#e=new qe(s,s+"_worker",e),this.#o()}).catch(t=>{this.#t.reject(new Error(`Setting up fake worker failed: "${t.message}".`))})}destroy(){this.destroyed=!0,this.#s?.terminate(),this.#s=null,yt.#n.delete(this.#i),this.#i=null,this.#e?.destroy(),this.#e=null}static create(t){const e=this.#n.get(t?.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new yt(t)}static get workerSrc(){if(pe.workerSrc)return pe.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#d(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){return H(this,"_setupFakeWorkerGlobal",(async()=>this.#d?this.#d:(await import(this.workerSrc)).WorkerMessageHandler)())}}class Cd{downloadInfoCapability=Promise.withResolvers();#t=null;#e=new Map;#i=null;#s=new Map;#a=new Map;#r=new Map;#n=null;#o=Y.instance;constructor(t,e,s,i,n){this.messageHandler=t,this.loadingTask=e,this.#i=s,this.commonObjs=new ja,this.fontLoader=new kh({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.enableHWA=i.enableHWA,this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.wasmFactory=n.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this.setupMessageHandler(),this.#o.addListener(this.#c.bind(this))}#c(){const t=new Map,e=new Map;for(let s=0,i=this.#o.pagesNumber;s<i;s++){const n=this.#o.getPrevPageNumber(s+1)-1,r=this.#s.get(n);r&&t.set(s,r);const a=this.#a.get(n);a&&e.set(s,a)}this.#s=t,this.#a=e}#l(t,e=null){const s=this.#e.get(t);if(s)return s;const i=this.messageHandler.sendWithPromise(t,e);return this.#e.set(t,i),i}#u({loaded:t,total:e}){this.loadingTask.onProgress?.({loaded:t,total:e,percent:xt(Math.round(t/e*100),0,100)})}get annotationStorage(){return H(this,"annotationStorage",new tn)}getRenderingIntent(t,e=ee.ENABLE,s=null,i=!1,n=!1){let r=Dt.DISPLAY,a=_i;switch(t){case"any":r=Dt.ANY;break;case"display":break;case"print":r=Dt.PRINT;break;default:$(`getRenderingIntent - invalid intent: ${t}`)}const l=r&Dt.PRINT&&s instanceof wa?s:this.annotationStorage;switch(e){case ee.DISABLE:r+=Dt.ANNOTATIONS_DISABLE;break;case ee.ENABLE:break;case ee.ENABLE_FORMS:r+=Dt.ANNOTATIONS_FORMS;break;case ee.ENABLE_STORAGE:r+=Dt.ANNOTATIONS_STORAGE,a=l.serializable;break;default:$(`getRenderingIntent - invalid annotationMode: ${e}`)}i&&(r+=Dt.IS_EDITING),n&&(r+=Dt.OPLIST);const{ids:c,hash:h}=l.modifiedIds,d=[r,a.hash,h];return{renderingIntent:r,cacheKey:d.join("_"),annotationStorageSerializable:a,modifiedIds:c}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#n?.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const s of this.#s.values())t.push(s._destroy());this.#s.clear(),this.#a.clear(),this.#r.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(),_t.cleanup(),this.#i?.cancelAllRequests(new ne("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(s,i)=>{J(this.#i,"GetReader - no `BasePDFStream` instance available."),this.#t=this.#i.getFullReader(),this.#t.onProgress=n=>this.#u(n),i.onPull=()=>{this.#t.read().then(function({value:n,done:r}){if(r){i.close();return}J(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{i.error(n)})},i.onCancel=n=>{this.#t.cancel(n),i.ready.catch(r=>{if(!this.destroyed)throw r})}}),t.on("ReaderHeadersReady",async s=>{await this.#t.headersReady;const{isStreamingSupported:i,isRangeSupported:n,contentLength:r}=this.#t;return i&&n&&(this.#t.onProgress=null),{isStreamingSupported:i,isRangeSupported:n,contentLength:r}}),t.on("GetRangeReader",(s,i)=>{J(this.#i,"GetRangeReader - no `BasePDFStream` instance available.");const n=this.#i.getRangeReader(s.begin,s.end);if(!n){i.close();return}i.onPull=()=>{n.read().then(function({value:r,done:a}){if(a){i.close();return}J(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{n.cancel(r),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("GetDoc",({pdfInfo:s})=>{this.#o.pagesNumber=s.numPages,this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,e._capability.resolve(new Sd(s,this))}),t.on("DocException",s=>{e._capability.reject(Ct(s))}),t.on("PasswordRequest",s=>{this.#n=Promise.withResolvers();try{if(!e.onPassword)throw Ct(s);const i=n=>{n instanceof Error?this.#n.reject(n):this.#n.resolve({password:n})};e.onPassword(i,s.code)}catch(i){this.#n.reject(i)}return this.#n.promise}),t.on("DataLoaded",s=>{this.#u({loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),t.on("StartRenderPage",s=>{if(this.destroyed)return;this.#s.get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),t.on("commonobj",([s,i,n])=>{if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":if("error"in n){const d=n.error;$(`Error during font loading: ${d}`),this.commonObjs.resolve(s,d);break}const r=new tt(n),a=this._params.pdfBug&&globalThis.FontInspector?.enabled?(d,f)=>globalThis.FontInspector.fontAdded(d,f):null,l=new Ph(r,a,n.extra,n.charProcOperatorList);this.fontLoader.bind(l).catch(()=>t.sendWithPromise("FontFallback",{id:s})).finally(()=>{!l.fontExtraProperties&&l.data&&l.clearData(),this.commonObjs.resolve(s,l)});break;case"CopyLocalImage":const{imageRef:c}=n;J(c,"The imageRef must be defined.");for(const d of this.#s.values())for(const[,f]of d.objs)if(f?.ref===c)return f.dataLen?(this.commonObjs.resolve(s,structuredClone(f)),f.dataLen):null;break;case"FontPath":this.commonObjs.resolve(s,new Rh(n));break;case"Image":this.commonObjs.resolve(s,n);break;case"Pattern":const h=new gt(n);this.commonObjs.resolve(s,h.getIR());break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),t.on("obj",([s,i,n,r])=>{if(this.destroyed)return;const a=this.#s.get(i);if(!a.objs.has(s)){if(a._intentStates.size===0){r?.bitmap?.close();return}switch(n){case"Image":case"Pattern":a.objs.resolve(s,r);break;default:throw new Error(`Got unknown object type ${n}`)}}}),t.on("DocProgress",s=>{this.destroyed||this.#u(s)}),t.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[s.type];if(!i)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&$("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:this.#t?.filename??null},e).finally(()=>{this.annotationStorage.resetModified()})}extractPages(t){return this.messageHandler.sendWithPromise("ExtractPages",{pageInfos:t})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this.#o.pagesNumber)return Promise.reject(new Error("Invalid page request."));const e=t-1,s=this.#o.getPageId(t)-1,i=this.#a.get(e);if(i)return i;const n=this.messageHandler.sendWithPromise("GetPage",{pageIndex:s}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&this.#r.set(r.refStr,s);const a=new Ed(e,r,this,this._params.pdfBug);return this.#s.set(e,a),a});return this.#a.set(e,n),n}async getPageIndex(t){if(!ki(t))throw new Error("Invalid pageIndex request.");const e=await this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen});return this.#o.getPageNumber(e+1)-1}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:this.#o.getPageId(t+1)-1,intent:e})}getFieldObjects(){return this.#l("GetFieldObjects")}hasJSActions(){return this.#l("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(t,e){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:t,pageIndexesToSkip:e})}getDocJSActions(){return this.#l("GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:this.#o.getPageId(t+1)-1})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:this.#o.getPageId(t+1)-1})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return this.#l("GetOptionalContentConfig").then(e=>new nd(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=this.#e.get(t);if(e)return e;const s=this.messageHandler.sendWithPromise(t,null).then(i=>({info:i[0],metadata:i[1]?new sd(i[1]):null,contentDispositionFilename:this.#t?.filename??null,contentLength:this.#t?.contentLength??null,hasStructTree:i[2]}));return this.#e.set(t,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of this.#s.values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(!0),_t.cleanup()}}cachedPageNumber(t){if(!ki(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`,s=this.#r.get(e);return s>=0?this.#o.getPageNumber(s+1):null}}class Td{_internalRenderTask=null;onContinue=null;onError=null;constructor(t){this._internalRenderTask=t}get promise(){return this._internalRenderTask.capability.promise}cancel(t=0){this._internalRenderTask.cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=this._internalRenderTask.operatorList;if(!t)return!1;const{annotationCanvasMap:e}=this._internalRenderTask;return t.form||t.canvas&&e?.size>0}}class Te{#t=null;static#e=new WeakSet;constructor({callback:t,params:e,objs:s,commonObjs:i,annotationCanvasMap:n,operatorList:r,pageIndex:a,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:h=!1,pdfBug:d=!1,pageColors:f=null,enableHWA:p=!1,operationsFilter:b=null}){this.callback=t,this.params=e,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=d,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=h===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Td(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=p,this._dependencyTracker=e.dependencyTracker,this._operationsFilter=b}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){if(this.cancelled)return;if(this._canvas){if(Te.#e.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Te.#e.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:s,transform:i,background:n,dependencyTracker:r}=this.params,a=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Pe(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors,r),this.gfx.beginDrawing({transform:i,viewport:s,transparency:t,background:n}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(t=null,e=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#t&&(window.cancelAnimationFrame(this.#t),this.#t=null),Te.#e.delete(this._canvas),t||=new zs(`Rendering cancelled, page ${this._pageIndex+1}`,e),this.callback(t),this.task.onError?.(t)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#t=window.requestAnimationFrame(()=>{this.#t=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Te.#e.delete(this._canvas),this.callback())))}}const Oa="5.4.624",Ba="384c6208b";class Nt{#t=null;#e=null;#i;#s=null;#a=!1;#r=!1;#n=null;#o;#c=null;#l=null;static#u=null;static get _keyboardManager(){return H(this,"_keyboardManager",new cs([[["Escape","mac+Escape"],Nt.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Nt.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Nt.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Nt.prototype._moveToPrevious],[["Home","mac+Home"],Nt.prototype._moveToBeginning],[["End","mac+End"],Nt.prototype._moveToEnd]]))}constructor({editor:t=null,uiManager:e=null}){t?(this.#r=!1,this.#n=t):this.#r=!0,this.#l=t?._uiManager||e,this.#o=this.#l._eventBus,this.#i=t?.color?.toUpperCase()||this.#l?.highlightColors.values().next().value||"#FFFF98",Nt.#u||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const t=this.#t=document.createElement("button");t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",this.#n&&(t.ariaControls=`${this.#n.id}_colorpicker_dropdown`);const e=this.#l._signal;t.addEventListener("click",this.#g.bind(this),{signal:e}),t.addEventListener("keydown",this.#m.bind(this),{signal:e});const s=this.#e=document.createElement("span");return s.className="swatch",s.ariaHidden="true",s.style.backgroundColor=this.#i,t.append(s),t}renderMainDropdown(){const t=this.#s=this.#d();return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}#d(){const t=document.createElement("div"),e=this.#l._signal;t.addEventListener("contextmenu",It,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#n&&(t.id=`${this.#n.id}_colorpicker_dropdown`);for(const[s,i]of this.#l.highlightColors){const n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",i),n.title=s,n.setAttribute("data-l10n-id",Nt.#u[s]);const r=document.createElement("span");n.append(r),r.className="swatch",r.style.backgroundColor=i,n.ariaSelected=i===this.#i,n.addEventListener("click",this.#f.bind(this,i),{signal:e}),t.append(n)}return t.addEventListener("keydown",this.#m.bind(this),{signal:e}),t}#f(t,e){e.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:V.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)}_colorSelectFromKeyboard(t){if(t.target===this.#t){this.#g(t);return}const e=t.target.getAttribute("data-color");e&&this.#f(e,t)}_moveToNext(t){if(!this.#p){this.#g(t);return}if(t.target===this.#t){this.#s.firstElementChild?.focus();return}t.target.nextSibling?.focus()}_moveToPrevious(t){if(t.target===this.#s?.firstElementChild||t.target===this.#t){this.#p&&this._hideDropdownFromKeyboard();return}this.#p||this.#g(t),t.target.previousSibling?.focus()}_moveToBeginning(t){if(!this.#p){this.#g(t);return}this.#s.firstElementChild?.focus()}_moveToEnd(t){if(!this.#p){this.#g(t);return}this.#s.lastElementChild?.focus()}#m(t){Nt._keyboardManager.exec(this,t)}#g(t){if(this.#p){this.hideDropdown();return}if(this.#a=t.detail===0,this.#c||(this.#c=new AbortController,window.addEventListener("pointerdown",this.#h.bind(this),{signal:this.#l.combinedSignal(this.#c)})),this.#t.ariaExpanded="true",this.#s){this.#s.classList.remove("hidden");return}const e=this.#s=this.#d();this.#t.append(e)}#h(t){this.#s?.contains(t.target)||this.hideDropdown()}hideDropdown(){this.#s?.classList.add("hidden"),this.#t.ariaExpanded="false",this.#c?.abort(),this.#c=null}get#p(){return this.#s&&!this.#s.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#r){if(!this.#p){this.#n?.unselect();return}this.hideDropdown(),this.#t.focus({preventScroll:!0,focusVisible:this.#a})}}updateColor(t){if(this.#e&&(this.#e.style.backgroundColor=t),!this.#s)return;const e=this.#l.highlightColors.values();for(const s of this.#s.children)s.ariaSelected=e.next().value===t.toUpperCase()}destroy(){this.#t?.remove(),this.#t=null,this.#e=null,this.#s?.remove(),this.#s=null}}class ss{#t=null;#e=null;#i=null;static#s=null;constructor(t){this.#e=t,this.#i=t._uiManager,ss.#s||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#t)return this.#t;const{editorType:t,colorType:e,color:s}=this.#e,i=this.#t=document.createElement("input");return i.type="color",i.value=s||"#000000",i.className="basicColorPicker",i.tabIndex=0,i.setAttribute("data-l10n-id",ss.#s[t]),i.addEventListener("input",()=>{this.#i.updateParams(e,i.value)},{signal:this.#i._signal}),i}update(t){this.#t&&(this.#t.value=t)}destroy(){this.#t?.remove(),this.#t=null}hideDropdown(){}}function or(o){return Math.floor(Math.max(0,Math.min(1,o))*255).toString(16).padStart(2,"0")}function We(o){return Math.max(0,Math.min(255,255*o))}class lr{static CMYK_G([t,e,s,i]){return["G",1-Math.min(1,.3*t+.59*s+.11*e+i)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=We(t),[t,t,t]}static G_HTML([t]){const e=or(t);return`#${e}${e}${e}`}static RGB_G([t,e,s]){return["G",.3*t+.59*e+.11*s]}static RGB_rgb(t){return t.map(We)}static RGB_HTML(t){return`#${t.map(or).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,s,i]){return["RGB",1-Math.min(1,t+i),1-Math.min(1,s+i),1-Math.min(1,e+i)]}static CMYK_rgb([t,e,s,i]){return[We(1-Math.min(1,t+i)),We(1-Math.min(1,s+i)),We(1-Math.min(1,e+i))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,s]){const i=1-t,n=1-e,r=1-s,a=Math.min(i,n,r);return["CMYK",i,n,r,a]}}class _d{create(t,e,s=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${t} ${e}`),i}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){Q("Abstract method `_createSVG` called.")}}class is extends _d{_createSVG(t){return document.createElementNS(te,t)}}const kd=9,me=new WeakSet,Pd=new Date().getTimezoneOffset()*60*1e3;class gi{static create(t){switch(t.data.annotationType){case lt.LINK:return new on(t);case lt.TEXT:return new Dd(t);case lt.WIDGET:switch(t.data.fieldType){case"Tx":return new Nd(t);case"Btn":return t.data.radioButton?new Ua(t):t.data.checkBox?new Id(t):new Md(t);case"Ch":return new jd(t);case"Sig":return new Ld(t)}return new ye(t);case lt.POPUP:return new Di(t);case lt.FREETEXT:return new Ha(t);case lt.LINE:return new Od(t);case lt.SQUARE:return new Bd(t);case lt.CIRCLE:return new Ud(t);case lt.POLYLINE:return new $a(t);case lt.CARET:return new $d(t);case lt.INK:return new ln(t);case lt.POLYGON:return new Hd(t);case lt.HIGHLIGHT:return new za(t);case lt.UNDERLINE:return new zd(t);case lt.SQUIGGLY:return new Wd(t);case lt.STRIKEOUT:return new Gd(t);case lt.STAMP:return new Wa(t);case lt.FILEATTACHMENT:return new Vd(t);default:return new rt(t)}}}class rt{#t=null;#e=!1;#i=null;constructor(t,{isRenderable:e=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableComment=t.enableComment,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,this.hasOwnCommentButton=!1,e&&(this.contentElement=this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t?.str||e?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return rt._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:t}=this,e=this.annotationStorage?.getEditor(t.id);return e?e.getData():t}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const t=this.annotationStorage?.getEditor(this.data.id);if(t)return t.commentButtonPositionInPage;const{quadPoints:e,inkLists:s,rect:i}=this.data;let n=-1/0,r=-1/0;if(e?.length>=8){for(let a=0;a<e.length;a+=8)e[a+1]>r?(r=e[a+1],n=e[a+2]):e[a+1]===r&&(n=Math.max(n,e[a+2]));return[n,r]}if(s?.length>=1){for(const a of s)for(let l=0,c=a.length;l<c;l+=2)a[l+1]>r?(r=a[l+1],n=a[l]):a[l+1]===r&&(n=Math.max(n,a[l]));if(n!==1/0)return[n,r]}return i?[i[2],i[3]]:null}_normalizePoint(t){const{page:{view:e},viewport:{rawDims:{pageWidth:s,pageHeight:i,pageX:n,pageY:r}}}=this.parent;return t[1]=e[3]-t[1]+e[1],t[0]=100*(t[0]-n)/s,t[1]=100*(t[1]-r)/i,t}get commentText(){const{data:t}=this;return this.annotationStorage.getRawValue(`${Ze}${t.id}`)?.popup?.contents||t.contentsObj?.str||""}set commentText(t){const{data:e}=this,s={deleted:!t,contents:t||""};this.annotationStorage.updateEditor(e.id,{popup:s})||this.annotationStorage.setValue(`${Ze}${e.id}`,{id:e.id,annotationType:e.annotationType,page:this.parent.page,popup:s,popupRef:e.popupRef,modificationDate:new Date}),t||this.removePopup()}removePopup(){(this.#i?.popup||this.popup)?.remove(),this.#i=this.popup=null}updateEdited(t){if(!this.container)return;t.rect&&(this.#t||={rect:this.data.rect.slice(0)});const{rect:e,popup:s}=t;e&&this.#s(e);let i=this.#i?.popup||this.popup;!i&&s?.text&&(this._createPopup(s),i=this.#i.popup),i&&(i.updateEdited(t),s?.deleted&&(i.remove(),this.#i=null,this.popup=null))}resetEdited(){this.#t&&(this.#s(this.#t.rect),this.#i?.popup.resetEdited(),this.#t=null)}#s(t){const{container:{style:e},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:r,pageX:a,pageY:l}}}}=this;s?.splice(0,4,...t),e.left=`${100*(t[0]-a)/n}%`,e.top=`${100*(r-t[3]+l)/r}%`,i===0?(e.width=`${100*(t[2]-t[0])/n}%`,e.height=`${100*(t[3]-t[1])/r}%`):this.setRotation(i)}_createContainer(t){const{data:e,parent:{page:s,viewport:i}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",e.id),!(this instanceof ye)&&!(this instanceof on)&&(n.tabIndex=0);const{style:r}=n;if(r.zIndex=this.parent.zIndex,this.parent.zIndex+=2,e.alternativeText&&(n.title=e.alternativeText),e.noRotate&&n.classList.add("norotate"),!e.rect||this instanceof Di){const{rotation:g}=e;return!e.hasOwnCanvas&&g!==0&&this.setRotation(g,n),n}const{width:a,height:l}=this;if(!t&&e.borderStyle.width>0){r.borderWidth=`${e.borderStyle.width}px`;const g=e.borderStyle.horizontalCornerRadius,m=e.borderStyle.verticalCornerRadius;if(g>0||m>0){const x=`calc(${g}px * var(--total-scale-factor)) / calc(${m}px * var(--total-scale-factor))`;r.borderRadius=x}else if(this instanceof Ua){const x=`calc(${a}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;r.borderRadius=x}switch(e.borderStyle.style){case Ae.SOLID:r.borderStyle="solid";break;case Ae.DASHED:r.borderStyle="dashed";break;case Ae.BEVELED:$("Unimplemented border style: beveled");break;case Ae.INSET:$("Unimplemented border style: inset");break;case Ae.UNDERLINE:r.borderBottomStyle="solid";break}const y=e.borderColor||null;y?(this.#e=!0,r.borderColor=N.makeHexColor(y[0]|0,y[1]|0,y[2]|0)):r.borderWidth=0}const c=N.normalizeRect([e.rect[0],s.view[3]-e.rect[1]+s.view[1],e.rect[2],s.view[3]-e.rect[3]+s.view[1]]),{pageWidth:h,pageHeight:d,pageX:f,pageY:p}=i.rawDims;r.left=`${100*(c[0]-f)/h}%`,r.top=`${100*(c[1]-p)/d}%`;const{rotation:b}=e;return e.hasOwnCanvas||b===0?(r.width=`${100*a/h}%`,r.height=`${100*l/d}%`):this.setRotation(b,n),n}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims;let{width:n,height:r}=this;t%180!==0&&([n,r]=[r,n]),e.style.width=`${100*n/s}%`,e.style.height=`${100*r/i}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,s,i)=>{const n=i.detail[e],r=n[0],a=n.slice(1);i.target.style[s]=lr[`${r}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[s]:lr[`${r}_rgb`](a)})};return H(this,"_commonActions",{display:e=>{const{display:s}=e.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:s}=e.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const s=e.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(t,e){const s=this._commonActions;for(const i of Object.keys(e.detail))(t[i]||s[i])?.(e)}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const s=this._commonActions;for(const[i,n]of Object.entries(e)){const r=s[i];if(r){const a={detail:{[i]:n},target:t};r(a),delete e[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,s,i,n]=this.data.rect.map(g=>Math.fround(g));if(t.length===8){const[g,m,y,x]=t.subarray(2,6);if(i===g&&n===m&&e===y&&s===x)return}const{style:r}=this.container;let a;if(this.#e){const{borderColor:g,borderWidth:m}=r;r.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${g}" stroke-width="${m}">`],this.container.classList.add("hasBorder")}const l=i-e,c=n-s,{svgFactory:h}=this,d=h.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0),d.role="none";const f=h.createElement("defs");d.append(f);const p=h.createElement("clipPath"),b=`clippath_${this.data.id}`;p.setAttribute("id",b),p.setAttribute("clipPathUnits","objectBoundingBox"),f.append(p);for(let g=2,m=t.length;g<m;g+=8){const y=t[g],x=t[g+1],w=t[g+2],v=t[g+3],A=h.createElement("rect"),E=(w-e)/l,C=(n-x)/c,P=(y-w)/l,T=(x-v)/c;A.setAttribute("x",E),A.setAttribute("y",C),A.setAttribute("width",P),A.setAttribute("height",T),p.append(A),a?.push(`<rect vector-effect="non-scaling-stroke" x="${E}" y="${C}" width="${P}" height="${T}"/>`)}this.#e&&(a.push("</g></svg>')"),r.backgroundImage=a.join("")),this.container.append(d),this.container.style.clipPath=`url(#${b})`}_createPopup(t=null){const{data:e}=this;let s,i;t?(s={str:t.text},i=t.date):(s=e.contentsObj,i=e.modificationDate),this.#i=new Di({data:{color:e.color,titleObj:e.titleObj,modificationDate:i,contentsObj:s,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]})}get hasPopupElement(){return!!(this.#i||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#i}render(){Q("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[t];if(i)for(const{page:n,id:r,exportValues:a}of i){if(n===-1||r===e)continue;const l=typeof a=="string"?a:null,c=document.querySelector(`[data-element-id="${r}"]`);if(c&&!me.has(c)){$(`_getElementsByName - element not allowed: ${r}`);continue}s.push({id:r,exportValue:l,domElement:c})}return s}for(const i of document.getElementsByName(t)){const{exportValue:n}=i,r=i.getAttribute("data-element-id");r!==e&&me.has(i)&&s.push({id:r,exportValue:n,domElement:i})}return s}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class Rd extends rt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.editor=t.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:t}=this;t.hasComment&&this._createPopup(t.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(t){this.editor.comment=t,t||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}class on extends rt{constructor(t,e=null){super(t,{isRenderable:!0,ignoreBorder:!!e?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:e}=this,s=document.createElement("a");s.setAttribute("data-element-id",t.id);let i=!1;return t.url?(e.addLinkAttributes(s,t.url,t.newWindow),i=!0):t.action?(this._bindNamedAction(s,t.action,t.overlaidText),i=!0):t.attachment?(this.#e(s,t.attachment,t.overlaidText,t.attachmentDest),i=!0):t.setOCGState?(this.#i(s,t.setOCGState,t.overlaidText),i=!0):t.dest?(this._bindLink(s,t.dest,t.overlaidText),i=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,t),i=!0),t.resetForm?(this._bindResetFormAction(s,t.resetForm),i=!0):this.isTooltipOnly&&!i&&(this._bindLink(s,""),i=!0)),this.container.classList.add("linkAnnotation"),i&&(this.contentElement=s,this.container.append(s)),this.container}#t(){this.container.setAttribute("data-internal-link","")}_bindLink(t,e,s=""){t.href=this.linkService.getDestinationHash(e),t.onclick=()=>(e&&this.linkService.goToDestination(e),!1),(e||e==="")&&this.#t(),s&&(t.title=s)}_bindNamedAction(t,e,s=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(e),!1),s&&(t.title=s),this.#t()}#e(t,e,s="",i=null){t.href=this.linkService.getAnchorUrl(""),e.description?t.title=e.description:s&&(t.title=s),t.onclick=()=>(this.downloadManager?.openOrDownloadData(e.content,e.filename,i),!1),this.#t()}#i(t,e,s=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(e),!1),s&&(t.title=s),this.#t()}_bindJSAction(t,e){t.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const i of Object.keys(e.actions)){const n=s.get(i);n&&(t[n]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e.id,name:i}}),!1))}e.overlaidText&&(t.title=e.overlaidText),t.onclick||(t.onclick=()=>!1),this.#t()}_bindResetFormAction(t,e){const s=t.onclick;if(s||(t.href=this.linkService.getAnchorUrl("")),this.#t(),!this._fieldObjects){$('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(t.onclick=()=>!1);return}t.onclick=()=>{s?.();const{fields:i,refs:n,include:r}=e,a=[];if(i.length!==0||n.length!==0){const h=new Set(n);for(const d of i){const f=this._fieldObjects[d]||[];for(const{id:p}of f)h.add(p)}for(const d of Object.values(this._fieldObjects))for(const f of d)h.has(f.id)===r&&a.push(f)}else for(const h of Object.values(this._fieldObjects))a.push(...h);const l=this.annotationStorage,c=[];for(const h of a){const{id:d}=h;switch(c.push(d),h.type){case"text":{const p=h.defaultValue||"";l.setValue(d,{value:p});break}case"checkbox":case"radiobutton":{const p=h.defaultValue===h.exportValues;l.setValue(d,{value:p});break}case"combobox":case"listbox":{const p=h.defaultValue||"";l.setValue(d,{value:p});break}default:continue}const f=document.querySelector(`[data-element-id="${d}"]`);if(f){if(!me.has(f)){$(`_bindResetFormAction - element not allowed: ${d}`);continue}}else continue;f.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:c,name:"ResetForm"}}),!1}}}class Dd extends rt{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(t),this.container}}class ye extends rt{render(){return this.container}showElementAndHideCanvas(t){this.data.hasOwnCanvas&&(t.previousSibling?.nodeName==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return ut.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,s,i,n){s.includes("mouse")?t.addEventListener(s,r=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):t.addEventListener(s,r=>{if(s==="blur"){if(!e.focused||!r.relatedTarget)return;e.focused=!1}else if(s==="focus"){if(e.focused)return;e.focused=!0}n&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(r)}})})}_setEventListeners(t,e,s,i){for(const[n,r]of s)(r==="Action"||this.data.actions?.[r])&&((r==="Focus"||r==="Blur")&&(e||={focused:!1}),this._setEventListener(t,e,n,r,i),r==="Focus"&&!this.data.actions?.Blur?this._setEventListener(t,e,"blur","Blur",null):r==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":N.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||kd,n=t.style;let r;const a=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){const c=Math.abs(this.data.rect[3]-this.data.rect[1]-a),h=Math.round(c/(li*i))||1,d=c/h;r=Math.min(i,l(d/li))}else{const c=Math.abs(this.data.rect[3]-this.data.rect[1]-a);r=Math.min(i,l(c/li))}n.fontSize=`calc(${r}px * var(--total-scale-factor))`,n.color=N.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(n.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class Nd extends ye{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,s,i){const n=this.annotationStorage;for(const r of this._getElementsByName(t.name,t.id))r.domElement&&(r.domElement[e]=s),n.setValue(r.id,{[i]:s})}render(){const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const i=t.getValue(e,{value:this.data.fieldValue});let n=i.value||"";const r=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;r&&n.length>r&&(n=n.slice(0,r));let a=i.formattedValue||this.data.textContent?.join(`
`)||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));const l={userValue:n,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=a??n,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",a??n),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),me.add(s),this.contentElement=s,s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=0;const{datetimeFormat:c,datetimeType:h,timeStep:d}=this.data,f=!!h&&this.enableScripting;c&&(s.title=c),this._setRequired(s,this.data.required),r&&(s.maxLength=r),s.addEventListener("input",b=>{t.setValue(e,{value:b.target.value}),this.setPropertyOnSiblings(s,"value",b.target.value,"value"),l.formattedValue=null}),s.addEventListener("resetform",b=>{const g=this.data.defaultFieldValue??"";s.value=l.userValue=g,l.formattedValue=null});let p=b=>{const{formattedValue:g}=l;g!=null&&(b.target.value=g),b.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",g=>{if(l.focused)return;const{target:m}=g;if(f&&(m.type=h,d&&(m.step=d)),l.userValue){const y=l.userValue;if(f)if(h==="time"){const x=new Date(y),w=[x.getHours(),x.getMinutes(),x.getSeconds()];m.value=w.map(v=>v.toString().padStart(2,"0")).join(":")}else m.value=new Date(y-Pd).toISOString().split(h==="date"?"T":".",1)[0];else m.value=y}l.lastCommittedValue=m.value,l.commitKey=1,this.data.actions?.Focus||(l.focused=!0)}),s.addEventListener("updatefromsandbox",g=>{this.showElementAndHideCanvas(g.target);const m={value(y){l.userValue=y.detail.value??"",f||t.setValue(e,{value:l.userValue.toString()}),y.target.value=l.userValue},formattedValue(y){const{formattedValue:x}=y.detail;l.formattedValue=x,x!=null&&y.target!==document.activeElement&&(y.target.value=x);const w={formattedValue:x};f&&(w.value=x),t.setValue(e,w)},selRange(y){y.target.setSelectionRange(...y.detail.selRange)},charLimit:y=>{const{charLimit:x}=y.detail,{target:w}=y;if(x===0){w.removeAttribute("maxLength");return}w.setAttribute("maxLength",x);let v=l.userValue;!v||v.length<=x||(v=v.slice(0,x),w.value=l.userValue=v,t.setValue(e,{value:v}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:v,willCommit:!0,commitKey:1,selStart:w.selectionStart,selEnd:w.selectionEnd}}))}};this._dispatchEventFromSandbox(m,g)}),s.addEventListener("keydown",g=>{l.commitKey=1;let m=-1;if(g.key==="Escape"?m=0:g.key==="Enter"&&!this.data.multiLine?m=2:g.key==="Tab"&&(l.commitKey=3),m===-1)return;const{value:y}=g.target;l.lastCommittedValue!==y&&(l.lastCommittedValue=y,l.userValue=y,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:y,willCommit:!0,commitKey:m,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}}))});const b=p;p=null,s.addEventListener("blur",g=>{if(!l.focused||!g.relatedTarget)return;this.data.actions?.Blur||(l.focused=!1);const{target:m}=g;let{value:y}=m;if(f){if(y&&h==="time"){const x=y.split(":").map(w=>parseInt(w,10));y=new Date(2e3,0,1,x[0],x[1],x[2]||0).valueOf(),m.step=""}else y.includes("T")||(y=`${y}T00:00`),y=new Date(y).valueOf();m.type="text"}l.userValue=y,l.lastCommittedValue!==y&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:y,willCommit:!0,commitKey:l.commitKey,selStart:g.target.selectionStart,selEnd:g.target.selectionEnd}}),b(g)}),this.data.actions?.Keystroke&&s.addEventListener("beforeinput",g=>{l.lastCommittedValue=null;const{data:m,target:y}=g,{value:x,selectionStart:w,selectionEnd:v}=y;let A=w,E=v;switch(g.inputType){case"deleteWordBackward":{const C=x.substring(0,w).match(/\w*[^\w]*$/);C&&(A-=C[0].length);break}case"deleteWordForward":{const C=x.substring(w).match(/^[^\w]*\w*/);C&&(E+=C[0].length);break}case"deleteContentBackward":w===v&&(A-=1);break;case"deleteContentForward":w===v&&(E+=1);break}g.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:x,change:m||"",willCommit:!1,selStart:A,selEnd:E}})}),this._setEventListeners(s,l,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],g=>g.target.value)}if(p&&s.addEventListener("blur",p),this.data.comb){const g=(this.data.rect[2]-this.data.rect[0])/r;s.classList.add("comb"),s.style.letterSpacing=`calc(${g}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Ld extends ye{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class Id extends ye{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.exportValue===e.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",t.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");return me.add(n),n.setAttribute("data-element-id",s),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=e.fieldName,i&&n.setAttribute("checked",!0),n.setAttribute("exportValue",e.exportValue),n.tabIndex=0,n.addEventListener("change",r=>{const{name:a,checked:l}=r.target;for(const c of this._getElementsByName(a,s)){const h=l&&c.exportValue===e.exportValue;c.domElement&&(c.domElement.checked=h),t.setValue(c.id,{value:h})}t.setValue(s,{value:l})}),n.addEventListener("resetform",r=>{const a=e.defaultFieldValue||"Off";r.target.checked=a===e.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",r=>{const a={value(l){l.target.checked=l.detail.value!=="Off",t.setValue(s,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,r)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Ua extends ye{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.fieldValue===e.buttonValue}).value;if(typeof i=="string"&&(i=i!==e.buttonValue,t.setValue(s,{value:i})),i)for(const r of this._getElementsByName(e.fieldName,s))t.setValue(r.id,{value:!1});const n=document.createElement("input");if(me.add(n),n.setAttribute("data-element-id",s),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=e.fieldName,i&&n.setAttribute("checked",!0),n.tabIndex=0,n.addEventListener("change",r=>{const{name:a,checked:l}=r.target;for(const c of this._getElementsByName(a,s))t.setValue(c.id,{value:!1});t.setValue(s,{value:l})}),n.addEventListener("resetform",r=>{const a=e.defaultFieldValue;r.target.checked=a!=null&&a===e.buttonValue}),this.enableScripting&&this.hasJSActions){const r=e.buttonValue;n.addEventListener("updatefromsandbox",a=>{const l={value:c=>{const h=r===c.detail.value;for(const d of this._getElementsByName(c.target.name)){const f=h&&d.id===s;d.domElement&&(d.domElement.checked=f),t.setValue(d.id,{value:f})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Md extends on{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),t}}class jd extends ye{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,s=t.getValue(e,{value:this.data.fieldValue}),i=document.createElement("select");me.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=0;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",h=>{const d=this.data.defaultFieldValue;for(const f of i.options)f.selected=f.value===d});for(const h of this.data.options){const d=document.createElement("option");d.textContent=h.displayValue,d.value=h.exportValue,s.value.includes(h.exportValue)&&(d.setAttribute("selected",!0),n=!1),i.append(d)}let r=null;if(n){const h=document.createElement("option");h.value=" ",h.setAttribute("hidden",!0),h.setAttribute("selected",!0),i.prepend(h),r=()=>{h.remove(),i.removeEventListener("input",r),r=null},i.addEventListener("input",r)}const a=h=>{const d=h?"value":"textContent",{options:f,multiple:p}=i;return p?Array.prototype.filter.call(f,b=>b.selected).map(b=>b[d]):f.selectedIndex===-1?null:f[f.selectedIndex][d]};let l=a(!1);const c=h=>{const d=h.target.options;return Array.prototype.map.call(d,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",h=>{const d={value(f){r?.();const p=f.detail.value,b=new Set(Array.isArray(p)?p:[p]);for(const g of i.options)g.selected=b.has(g.value);t.setValue(e,{value:a(!0)}),l=a(!1)},multipleSelection(f){i.multiple=!0},remove(f){const p=i.options,b=f.detail.remove;p[b].selected=!1,i.remove(b),p.length>0&&Array.prototype.findIndex.call(p,m=>m.selected)===-1&&(p[0].selected=!0),t.setValue(e,{value:a(!0),items:c(f)}),l=a(!1)},clear(f){for(;i.length!==0;)i.remove(0);t.setValue(e,{value:null,items:[]}),l=a(!1)},insert(f){const{index:p,displayValue:b,exportValue:g}=f.detail.insert,m=i.children[p],y=document.createElement("option");y.textContent=b,y.value=g,m?m.before(y):i.append(y),t.setValue(e,{value:a(!0),items:c(f)}),l=a(!1)},items(f){const{items:p}=f.detail;for(;i.length!==0;)i.remove(0);for(const b of p){const{displayValue:g,exportValue:m}=b,y=document.createElement("option");y.textContent=g,y.value=m,i.append(y)}i.options.length>0&&(i.options[0].selected=!0),t.setValue(e,{value:a(!0),items:c(f)}),l=a(!1)},indices(f){const p=new Set(f.detail.indices);for(const b of f.target.options)b.selected=p.has(b.index);t.setValue(e,{value:a(!0)}),l=a(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(d,h)}),i.addEventListener("input",h=>{const d=a(!0),f=a(!1);t.setValue(e,{value:d}),h.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:l,change:f,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],h=>h.target.value)):i.addEventListener("input",function(h){t.setValue(e,{value:a(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class Di extends rt{constructor(t){const{data:e,elements:s,parent:i}=t,n=!!i._commentManager;if(super(t,{isRenderable:!n&&rt._hasPopupData(e)}),this.elements=s,n&&rt._hasPopupData(e)){const r=this.popup=this.#t();for(const a of s)a.popup=r}else this.popup=null}#t(){return new Fd({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=this.#t(),s=[];for(const i of this.elements)i.popup=e,i.container.ariaHasPopup="dialog",s.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",s.map(i=>`${Ee}${i}`).join(",")),this.container}}class Fd{#t=null;#e=this.#W.bind(this);#i=this.#B.bind(this);#s=this.#L.bind(this);#a=this.#A.bind(this);#r=null;#n=null;#o=null;#c=null;#l=null;#u=null;#d=null;#f=!1;#m=null;#g=null;#h=null;#p=null;#b=null;#x=null;#y=null;#C=null;#S=null;#v=null;#_=!1;#w=null;#E=null;constructor({container:t,color:e,elements:s,titleObj:i,modificationDate:n,contentsObj:r,richText:a,parent:l,rect:c,parentRect:h,open:d,commentManager:f=null}){this.#n=t,this.#S=i,this.#o=r,this.#C=a,this.#u=l,this.#r=e,this.#y=c,this.#d=h,this.#l=s,this.#t=f,this.#w=s[0],this.#c=Ns.toDateObject(n),this.trigger=s.flatMap(p=>p.getElementsToTriggerPopup()),f||(this.#R(),this.#n.hidden=!0,d&&this.#A())}#R(){if(this.#g)return;this.#g=new AbortController;const{signal:t}=this.#g;for(const e of this.trigger)e.addEventListener("click",this.#a,{signal:t}),e.addEventListener("pointerenter",this.#s,{signal:t}),e.addEventListener("pointerleave",this.#i,{signal:t}),e.classList.add("popupTriggerArea");for(const e of this.#l)e.container?.addEventListener("keydown",this.#e,{signal:t})}#k(){const t=this.#l.find(e=>e.hasCommentButton);t&&(this.#b=t._normalizePoint(t.commentButtonPosition))}renderCommentButton(){if(this.#p){this.#p.parentNode||this.#w.container.after(this.#p);return}if(this.#b||this.#k(),!this.#b)return;const{signal:t}=this.#g=new AbortController,e=this.#w.hasOwnCommentButton,s=()=>{this.#t.toggleCommentPopup(this,!0,void 0,!e)},i=()=>{this.#t.toggleCommentPopup(this,!1,!0,!e)},n=()=>{this.#t.toggleCommentPopup(this,!1,!1)};if(e){this.#p=this.#w.container;for(const r of this.trigger)r.ariaHasPopup="dialog",r.ariaControls="commentPopup",r.addEventListener("keydown",this.#e,{signal:t}),r.addEventListener("click",s,{signal:t}),r.addEventListener("pointerenter",i,{signal:t}),r.addEventListener("pointerleave",n,{signal:t}),r.classList.add("popupTriggerArea")}else{const r=this.#p=document.createElement("button");r.className="annotationCommentButton";const a=this.#w.container;r.style.zIndex=a.style.zIndex+1,r.tabIndex=0,r.ariaHasPopup="dialog",r.ariaControls="commentPopup",r.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#F(),this.#P(),r.addEventListener("keydown",this.#e,{signal:t}),r.addEventListener("click",s,{signal:t}),r.addEventListener("pointerenter",i,{signal:t}),r.addEventListener("pointerleave",n,{signal:t}),a.after(r)}}#P(){if(this.#w.extraPopupElement&&!this.#w.editor)return;this.#p||this.renderCommentButton();const[t,e]=this.#b,{style:s}=this.#p;s.left=`calc(${t}%)`,s.top=`calc(${e}% - var(--comment-button-dim))`}#F(){this.#w.extraPopupElement||(this.#p||this.renderCommentButton(),this.#p.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:t,opacity:e}=this.#w.commentData;return t?this.#u._commentManager.makeCommentColor(t,e):null}focusCommentButton(){setTimeout(()=>{this.#p?.focus()},0)}getData(){const{richText:t,color:e,opacity:s,creationDate:i,modificationDate:n}=this.#w.commentData;return{contentsObj:{str:this.comment},richText:t,color:e,opacity:s,creationDate:i,modificationDate:n}}get elementBeforePopup(){return this.#p}get comment(){return this.#E||=this.#w.commentText,this.#E}set comment(t){t!==this.comment&&(this.#w.commentText=this.#E=t)}focus(){this.#w.container?.focus()}get parentBoundingClientRect(){return this.#w.layer.getBoundingClientRect()}setCommentButtonStates({selected:t,hasPopup:e}){this.#p&&(this.#p.classList.toggle("selected",t),this.#p.ariaExpanded=e)}setSelectedCommentButton(t){this.#p.classList.toggle("selected",t)}get commentPopupPosition(){if(this.#x)return this.#x;const{x:t,y:e,height:s}=this.#p.getBoundingClientRect(),{x:i,y:n,width:r,height:a}=this.#w.layer.getBoundingClientRect();return[(t-i)/r,(e+s-n)/a]}set commentPopupPosition(t){this.#x=t}hasDefaultPopupPosition(){return this.#x===null}get commentButtonPosition(){return this.#b}get commentButtonWidth(){return this.#p.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(t){const[e,s]=this.#x||this.commentButtonPosition.map(c=>c/100),i=this.parentBoundingClientRect,{x:n,y:r,width:a,height:l}=i;this.#t.showDialog(null,this,n+e*a,r+s*l,{...t,parentDimensions:i})}render(){if(this.#m)return;const t=this.#m=document.createElement("div");if(t.className="popup",this.#r){const s=t.style.outlineColor=N.makeHexColor(...this.#r);t.style.backgroundColor=`color-mix(in srgb, ${s} 30%, white)`}const e=document.createElement("span");if(e.className="header",this.#S?.str){const s=document.createElement("span");s.className="title",e.append(s),{dir:s.dir,str:s.textContent}=this.#S}if(t.append(e),this.#c){const s=document.createElement("time");s.className="popupDate",s.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),s.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#c.valueOf()})),s.dateTime=this.#c.toISOString(),e.append(s)}Ji({html:this.#N||this.#o.str,dir:this.#o?.dir,className:"popupContent"},t),this.#n.append(t)}get#N(){const t=this.#C,e=this.#o;return t?.str&&(!e?.str||e.str===t.str)&&this.#C.html||null}get#I(){return this.#N?.attributes?.style?.fontSize||0}get#O(){return this.#N?.attributes?.style?.color||null}#M(t){const e=[],s={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},i={style:{color:this.#O,fontSize:this.#I?`calc(${this.#I}px * var(--total-scale-factor))`:""}};for(const n of t.split(`
`))e.push({name:"span",value:n,attributes:i});return s}#W(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&this.#f)&&this.#A()}updateEdited({rect:t,popup:e,deleted:s}){if(this.#t){s?(this.remove(),this.#E=null):e&&(e.deleted?this.remove():(this.#F(),this.#E=e.text)),t&&(this.#b=null,this.#k(),this.#P());return}if(s||e?.deleted){this.remove();return}this.#R(),this.#v||={contentsObj:this.#o,richText:this.#C},t&&(this.#h=null),e&&e.text&&(this.#C=this.#M(e.text),this.#c=Ns.toDateObject(e.date),this.#o=null),this.#m?.remove(),this.#m=null}resetEdited(){this.#v&&({contentsObj:this.#o,richText:this.#C}=this.#v,this.#v=null,this.#m?.remove(),this.#m=null,this.#h=null)}remove(){if(this.#g?.abort(),this.#g=null,this.#m?.remove(),this.#m=null,this.#_=!1,this.#f=!1,this.#p?.remove(),this.#p=null,this.trigger)for(const t of this.trigger)t.classList.remove("popupTriggerArea")}#T(){if(this.#h!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:s,pageX:i,pageY:n}}}=this.#u;let r=!!this.#d,a=r?this.#d:this.#y;for(const b of this.#l)if(!a||N.intersect(b.data.rect,a)!==null){a=b.data.rect,r=!0;break}const l=N.normalizeRect([a[0],t[3]-a[1]+t[1],a[2],t[3]-a[3]+t[1]]),h=r?a[2]-a[0]+5:0,d=l[0]+h,f=l[1];this.#h=[100*(d-i)/e,100*(f-n)/s];const{style:p}=this.#n;p.left=`${this.#h[0]}%`,p.top=`${this.#h[1]}%`}#A(){if(this.#t){this.#t.toggleCommentPopup(this,!1);return}this.#f=!this.#f,this.#f?(this.#L(),this.#n.addEventListener("click",this.#a),this.#n.addEventListener("keydown",this.#e)):(this.#B(),this.#n.removeEventListener("click",this.#a),this.#n.removeEventListener("keydown",this.#e))}#L(){this.#m||this.render(),this.isVisible?this.#f&&this.#n.classList.add("focused"):(this.#T(),this.#n.hidden=!1,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)+1e3)}#B(){this.#n.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#n.hidden=!0,this.#n.style.zIndex=parseInt(this.#n.style.zIndex)-1e3)}forceHide(){this.#_=this.isVisible,this.#_&&(this.#n.hidden=!0)}maybeShow(){this.#t||(this.#R(),this.#_&&(this.#m||this.#L(),this.#_=!1,this.#n.hidden=!1))}get isVisible(){return this.#t?!1:this.#n.hidden===!1}}class Ha extends rt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=z.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=this.contentElement=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const s=document.createElement("span");s.textContent=e,t.append(s)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class Od extends rt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:t,width:e,height:s}=this,i=this.svgFactory.create(e,s,!0),n=this.#t=this.svgFactory.createElement("svg:line");return n.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),n.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),n.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),n.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),n.setAttribute("stroke-width",t.borderStyle.width||1),n.setAttribute("stroke","transparent"),n.setAttribute("fill","transparent"),i.append(n),this.container.append(i),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Bd extends rt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:t,width:e,height:s}=this,i=this.svgFactory.create(e,s,!0),n=t.borderStyle.width,r=this.#t=this.svgFactory.createElement("svg:rect");return r.setAttribute("x",n/2),r.setAttribute("y",n/2),r.setAttribute("width",e-n),r.setAttribute("height",s-n),r.setAttribute("stroke-width",n||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Ud extends rt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:t,width:e,height:s}=this,i=this.svgFactory.create(e,s,!0),n=t.borderStyle.width,r=this.#t=this.svgFactory.createElement("svg:ellipse");return r.setAttribute("cx",e/2),r.setAttribute("cy",s/2),r.setAttribute("rx",e/2-n/2),r.setAttribute("ry",s/2-n/2),r.setAttribute("stroke-width",n||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),i.append(r),this.container.append(i),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class $a extends rt{#t=null;constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:e,borderStyle:s,popupRef:i},width:n,height:r}=this;if(!e)return this.container;const a=this.svgFactory.create(n,r,!0);let l=[];for(let h=0,d=e.length;h<d;h+=2){const f=e[h]-t[0],p=t[3]-e[h+1];l.push(`${f},${p}`)}l=l.join(" ");const c=this.#t=this.svgFactory.createElement(this.svgElementName);return c.setAttribute("points",l),c.setAttribute("stroke-width",s.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),a.append(c),this.container.append(a),!i&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Hd extends $a{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class $d extends rt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}class ln extends rt{#t=null;#e=[];constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?z.HIGHLIGHT:z.INK}#i(t,e){switch(t){case 90:return{transform:`rotate(90) translate(${-e[0]},${e[1]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};case 180:return{transform:`rotate(180) translate(${-e[2]},${e[1]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]};case 270:return{transform:`rotate(270) translate(${-e[2]},${e[3]}) scale(1,-1)`,width:e[3]-e[1],height:e[2]-e[0]};default:return{transform:`translate(${-e[0]},${e[3]}) scale(1,-1)`,width:e[2]-e[0],height:e[3]-e[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:e,inkLists:s,borderStyle:i,popupRef:n}}=this,{transform:r,width:a,height:l}=this.#i(e,t),c=this.svgFactory.create(a,l,!0),h=this.#t=this.svgFactory.createElement("svg:g");c.append(h),h.setAttribute("stroke-width",i.width||1),h.setAttribute("stroke-linecap","round"),h.setAttribute("stroke-linejoin","round"),h.setAttribute("stroke-miterlimit",10),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),h.setAttribute("transform",r);for(let d=0,f=s.length;d<f;d++){const p=this.svgFactory.createElement(this.svgElementName);this.#e.push(p),p.setAttribute("points",s[d].join(",")),h.append(p)}return!n&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:e,points:s,rect:i}=t,n=this.#t;if(e>=0&&n.setAttribute("stroke-width",e||1),s)for(let r=0,a=this.#e.length;r<a;r++)this.#e[r].setAttribute("points",s[r].join(","));if(i){const{transform:r,width:a,height:l}=this.#i(this.data.rotation,i);n.parentElement.setAttribute("viewBox",`0 0 ${a} ${l}`),n.setAttribute("transform",r)}}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class za extends rt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=z.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const s=document.createElement("mark");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class zd extends rt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),t){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class Wd extends rt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),t){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class Gd extends rt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),t){const s=document.createElement("s");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class Wa extends rt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=z.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class Vd extends rt{#t=null;constructor(t){super(t,{isRenderable:!0});const{file:e}=this.data;this.filename=e.filename,this.content=e.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...e})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:e}=this;let s;e.hasAppearance||e.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(e.name)?"paperclip":"pushpin"}.svg`,e.fillAlpha&&e.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(e.fillAlpha*100)}%);`)),s.addEventListener("dblclick",this.#e.bind(this)),this.#t=s;const{isMac:i}=ut.platform;return t.addEventListener("keydown",n=>{n.key==="Enter"&&(i?n.metaKey:n.ctrlKey)&&this.#e()}),!e.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):s.classList.add("popupTriggerArea"),t.append(s),t}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}#e(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class Ks{#t=null;#e=null;#i=null;#s=new Map;#a=null;#r=null;#n=[];#o=!1;constructor({div:t,accessibilityManager:e,annotationCanvasMap:s,annotationEditorUIManager:i,page:n,viewport:r,structTreeLayer:a,commentManager:l,linkService:c,annotationStorage:h}){this.div=t,this.#t=e,this.#e=s,this.#a=a||null,this.#r=c||null,this.#i=h||new tn,this.page=n,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=i,this._commentManager=l||null}hasEditableAnnotations(){return this.#s.size>0}async render(t){const{annotations:e}=t,s=this.div;oe(s,this.viewport);const i=new Map,n=[],r={data:null,layer:s,linkService:this.#r,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new is,annotationStorage:this.#i,enableComment:t.enableComment===!0,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const a of e){if(a.noHTML)continue;const l=a.annotationType===lt.POPUP;if(l){const d=i.get(a.id);if(!d)continue;if(!this._commentManager){n.push(a);continue}r.elements=d}else if(a.rect[2]===a.rect[0]||a.rect[3]===a.rect[1])continue;r.data=a;const c=gi.create(r);if(!c.isRenderable)continue;if(!l&&(this.#n.push(c),a.popupRef)){const d=i.get(a.popupRef);d?d.push(c):i.set(a.popupRef,[c])}const h=c.render();a.hidden&&(h.style.visibility="hidden"),c._isEditable&&(this.#s.set(c.data.id,c),this._annotationEditorUIManager?.renderAnnotationElement(c))}await this.#c();for(const a of n){const l=r.elements=i.get(a.id);r.data=a;const c=gi.create(r);if(!c.isRenderable)continue;const h=c.render();c.contentElement.id=`${Ee}${a.id}`,a.hidden&&(h.style.visibility="hidden"),l.at(-1).container.after(h)}this.#l()}async#c(){if(this.#n.length===0)return;this.div.replaceChildren();const t=[];if(!this.#o){this.#o=!0;for(const{contentElement:s,data:{id:i}}of this.#n){const n=s.id=`${Ee}${i}`;t.push(this.#a?.getAriaAttributes(n).then(r=>{if(r)for(const[a,l]of r)s.setAttribute(a,l)}))}}this.#n.sort(({data:{rect:[s,i,n,r]}},{data:{rect:[a,l,c,h]}})=>{if(s===n&&i===r)return 1;if(a===c&&l===h)return-1;const d=r,f=i,p=(i+r)/2,b=h,g=l,m=(l+h)/2;if(p>=b&&m<=f)return-1;if(m>=d&&p<=g)return 1;const y=(s+n)/2,x=(a+c)/2;return y-x});const e=document.createDocumentFragment();for(const s of this.#n)e.append(s.container),this._commentManager?(s.extraPopupElement?.popup||s.popup)?.renderCommentButton():s.extraPopupElement&&e.append(s.extraPopupElement.render());if(this.div.append(e),await Promise.all(t),this.#t)for(const s of this.#n)this.#t.addPointerInTextLayer(s.contentElement,!1)}async addLinkAnnotations(t){const e={data:null,layer:this.div,linkService:this.#r,svgFactory:new is,parent:this};for(const s of t){s.borderStyle||=Ks._defaultBorderStyle,e.data=s;const i=gi.create(e);i.isRenderable&&(i.render(),i.contentElement.id=`${Ee}${s.id}`,this.#n.push(i))}await this.#c()}update({viewport:t}){const e=this.div;this.viewport=t,oe(e,{rotation:t.rotation}),this.#l(),e.hidden=!1}#l(){if(!this.#e)return;const t=this.div;for(const[e,s]of this.#e){const i=t.querySelector(`[data-annotation-id="${e}"]`);if(!i)continue;s.className="annotationContent";const{firstChild:n}=i;n?n.nodeName==="CANVAS"?n.replaceWith(s):n.classList.contains("annotationContent")?n.after(s):n.before(s):i.append(s);const r=this.#s.get(e);r&&(r._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(e,i.id,s),r._hasNoCanvas=!1):r.canvas=s)}this.#e.clear()}getEditableAnnotations(){return Array.from(this.#s.values())}getEditableAnnotation(t){return this.#s.get(t)}addFakeAnnotation(t){const{div:e}=this,{id:s,rotation:i}=t,n=new Rd({data:{id:s,rect:t.getPDFRect(),rotation:i},editor:t,layer:e,parent:this,enableComment:!!this._commentManager,linkService:this.#r,annotationStorage:this.#i});return n.render(),n.contentElement.id=`${Ee}${s}`,n.createOrUpdatePopup(),this.#n.push(n),n}removeAnnotation(t){const e=this.#n.findIndex(i=>i.data.id===t);if(e<0)return;const[s]=this.#n.splice(e,1);this.#t?.removePointerInTextLayer(s.contentElement)}updateFakeAnnotations(t){if(t.length!==0){for(const e of t)e.updateFakeAnnotationElement(this);this.#c()}}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}static get _defaultBorderStyle(){return H(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Ae.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const Ss=/\r\n?|\n/g;class mt extends F{#t="";#e=`${this.id}-editor`;#i=null;#s;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const t=mt.prototype,e=n=>n.isEmpty(),s=re.TRANSLATE_SMALL,i=re.TRANSLATE_BIG;return H(this,"_keyboardManager",new cs([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[i,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:e}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,i],checker:e}]]))}static _type="freetext";static _editorType=z.FREETEXT;constructor(t){super({...t,name:"freeTextEditor"}),this.color=t.color||mt._defaultColor||F._defaultLineColor,this.#s=t.fontSize||mt._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static initialize(t,e){F.initialize(t,e);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,e){switch(t){case V.FREETEXT_SIZE:mt._defaultFontSize=e;break;case V.FREETEXT_COLOR:mt._defaultColor=e;break}}updateParams(t,e){switch(t){case V.FREETEXT_SIZE:this.#a(e);break;case V.FREETEXT_COLOR:this.#r(e);break}}static get defaultPropertiesToUpdate(){return[[V.FREETEXT_SIZE,mt._defaultFontSize],[V.FREETEXT_COLOR,mt._defaultColor||F._defaultLineColor]]}get propertiesToUpdate(){return[[V.FREETEXT_SIZE,this.#s],[V.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new ss(this),[["colorPicker",this._colorPicker]]}get colorType(){return V.FREETEXT_COLOR}#a(t){const e=i=>{this.editorDiv.style.fontSize=`calc(${i}px * var(--total-scale-factor))`,this.translate(0,-(i-this.#s)*this.parentScale),this.#s=i,this.#o()},s=this.#s;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#r(t){const e=i=>{this.color=i,this.onUpdatedColor()},s=this.color;this.addCommands({cmd:e.bind(this,t),undo:e.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(t,e){this._uiManager.translateSelectedEditors(t,e,!0)}getInitialTranslation(){const t=this.parentScale;return[-mt._internalPadding*t,-(mt._internalPadding+this.#s)*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#i=new AbortController;const t=this._uiManager.combinedSignal(this.#i);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#e),this._isDraggable=!0,this.#i?.abort(),this.#i=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#n(){const t=[];this.editorDiv.normalize();let e=null;for(const s of this.editorDiv.childNodes)e?.nodeType===Node.TEXT_NODE&&s.nodeName==="BR"||(t.push(mt.#c(s)),e=s);return t.join(`
`)}#o(){const[t,e]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:i,div:n}=this,r=n.style.display,a=n.classList.contains("hidden");n.classList.remove("hidden"),n.style.display="hidden",i.div.append(this.div),s=n.getBoundingClientRect(),n.remove(),n.style.display=r,n.classList.toggle("hidden",a)}this.rotation%180===this.parentRotation%180?(this.width=s.width/t,this.height=s.height/e):(this.width=s.height/t,this.height=s.width/e),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=this.#t,e=this.#t=this.#n().trimEnd();if(t===e)return;const s=i=>{if(this.#t=i,!i){this.remove();return}this.#l(),this._uiManager.rebuild(this),this.#o()};this.addCommands({cmd:()=>{s(e)},undo:()=>{s(t)},mustExec:!1}),this.#o()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){mt._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,e;(this._isCopy||this.annotationElementId)&&(t=this.x,e=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#e),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${this.#s}px * var(--total-scale-factor))`,s.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[i,n]=this.parentDimensions;if(this.annotationElementId){const{position:r}=this._initialData;let[a,l]=this.getInitialTranslation();[a,l]=this.pageTranslationToScreen(a,l);const[c,h]=this.pageDimensions,[d,f]=this.pageTranslation;let p,b;switch(this.rotation){case 0:p=t+(r[0]-d)/c,b=e+this.height-(r[1]-f)/h;break;case 90:p=t+(r[0]-d)/c,b=e-(r[1]-f)/h,[a,l]=[l,-a];break;case 180:p=t-this.width+(r[0]-d)/c,b=e-(r[1]-f)/h,[a,l]=[-a,-l];break;case 270:p=t+(r[0]-d-this.height*h)/c,b=e+(r[1]-f-this.width*c)/h,[a,l]=[-l,a];break}this.setAt(p*i,b*n,a,l)}else this._moveAfterPaste(t,e);this.#l(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Ss,"")}editorDivPaste(t){const e=t.clipboardData||window.clipboardData,{types:s}=e;if(s.length===1&&s[0]==="text/plain")return;t.preventDefault();const i=mt.#d(e.getData("text")||"").replaceAll(Ss,`
`);if(!i)return;const n=window.getSelection();if(!n.rangeCount)return;this.editorDiv.normalize(),n.deleteFromDocument();const r=n.getRangeAt(0);if(!i.includes(`
`)){r.insertNode(document.createTextNode(i)),this.editorDiv.normalize(),n.collapseToStart();return}const{startContainer:a,startOffset:l}=r,c=[],h=[];if(a.nodeType===Node.TEXT_NODE){const p=a.parentElement;if(h.push(a.nodeValue.slice(l).replaceAll(Ss,"")),p!==this.editorDiv){let b=c;for(const g of this.editorDiv.childNodes){if(g===p){b=h;continue}b.push(mt.#c(g))}}c.push(a.nodeValue.slice(0,l).replaceAll(Ss,""))}else if(a===this.editorDiv){let p=c,b=0;for(const g of this.editorDiv.childNodes)b++===l&&(p=h),p.push(mt.#c(g))}this.#t=`${c.join(`
`)}${i}${h.join(`
`)}`,this.#l();const d=new Range;let f=Math.sumPrecise(c.map(p=>p.length));for(const{firstChild:p}of this.editorDiv.childNodes)if(p.nodeType===Node.TEXT_NODE){const b=p.nodeValue.length;if(f<=b){d.setStart(p,f),d.setEnd(p,f);break}f-=b}n.removeAllRanges(),n.addRange(d)}#l(){if(this.editorDiv.replaceChildren(),!!this.#t)for(const t of this.#t.split(`
`)){const e=document.createElement("div");e.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(e)}}#u(){return this.#t.replaceAll("Â "," ")}static#d(t){return t.replaceAll(" ","Â ")}get contentDiv(){return this.editorDiv}getPDFRect(){const t=mt._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,e,s){let i=null;if(t instanceof Ha){const{data:{defaultAppearanceData:{fontSize:r,fontColor:a},rect:l,rotation:c,id:h,popupRef:d,richText:f,contentsObj:p,creationDate:b,modificationDate:g},textContent:m,textPosition:y,parent:{page:{pageNumber:x}}}=t;if(!m||m.length===0)return null;i=t={annotationType:z.FREETEXT,color:Array.from(a),fontSize:r,value:m.join(`
`),position:y,pageIndex:x-1,rect:l.slice(0),rotation:c,annotationElementId:h,id:h,deleted:!1,popupRef:d,comment:p?.str||null,richText:f,creationDate:b,modificationDate:g}}const n=await super.deserialize(t,e,s);return n.#s=t.fontSize,n.color=N.makeHexColor(...t.color),n.#t=mt.#d(t.value),n._initialData=i,t.comment&&n.setCommentData(t),n}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const e=F._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),s=Object.assign(super.serialize(t),{color:e,fontSize:this.#s,value:this.#u()});return this.addComment(s),t?(s.isCopy=!0,s):this.annotationElementId&&!this.#f(s)?null:(s.id=this.annotationElementId,s)}#f(t){const{value:e,fontSize:s,color:i,pageIndex:n}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==e||t.fontSize!==s||t.color.some((r,a)=>r!==i[a])||t.pageIndex!==n}renderAnnotationElement(t){const e=super.renderAnnotationElement(t);if(!e)return null;const{style:s}=e;s.fontSize=`calc(${this.#s}px * var(--total-scale-factor))`,s.color=this.color,e.replaceChildren();for(const i of this.#t.split(`
`)){const n=document.createElement("div");n.append(i?document.createTextNode(i):document.createElement("br")),e.append(n)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#t}}),e}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}}class L{static PRECISION=1e-4;toSVGPath(){Q("Abstract method `toSVGPath` must be implemented.")}get box(){Q("Abstract getter `box` must be implemented.")}serialize(t,e){Q("Abstract method `serialize` must be implemented.")}static _rescale(t,e,s,i,n,r){r||=new Float32Array(t.length);for(let a=0,l=t.length;a<l;a+=2)r[a]=e+t[a]*i,r[a+1]=s+t[a+1]*n;return r}static _rescaleAndSwap(t,e,s,i,n,r){r||=new Float32Array(t.length);for(let a=0,l=t.length;a<l;a+=2)r[a]=e+t[a+1]*i,r[a+1]=s+t[a]*n;return r}static _translate(t,e,s,i){i||=new Float32Array(t.length);for(let n=0,r=t.length;n<r;n+=2)i[n]=e+t[n],i[n+1]=s+t[n+1];return i}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,s,i,n){switch(n){case 90:return[1-e/s,t/i];case 180:return[1-t/s,1-e/i];case 270:return[e/s,1-t/i];default:return[t/s,e/i]}}static _normalizePagePoint(t,e,s){switch(s){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,s,i,n,r){return[(t+5*s)/6,(e+5*i)/6,(5*s+n)/6,(5*i+r)/6,(s+n)/2,(i+r)/2]}}class fe{#t;#e=[];#i;#s;#a=[];#r=new Float32Array(18);#n;#o;#c;#l;#u;#d;#f=[];static#m=8;static#g=2;static#h=fe.#m+fe.#g;constructor({x:t,y:e},s,i,n,r,a=0){this.#t=s,this.#d=n*i,this.#s=r,this.#r.set([NaN,NaN,NaN,NaN,t,e],6),this.#i=a,this.#l=fe.#m*i,this.#c=fe.#h*i,this.#u=i,this.#f.push(t,e)}isEmpty(){return isNaN(this.#r[8])}#p(){const t=this.#r.subarray(4,6),e=this.#r.subarray(16,18),[s,i,n,r]=this.#t;return[(this.#n+(t[0]-e[0])/2-s)/n,(this.#o+(t[1]-e[1])/2-i)/r,(this.#n+(e[0]-t[0])/2-s)/n,(this.#o+(e[1]-t[1])/2-i)/r]}add({x:t,y:e}){this.#n=t,this.#o=e;const[s,i,n,r]=this.#t;let[a,l,c,h]=this.#r.subarray(8,12);const d=t-c,f=e-h,p=Math.hypot(d,f);if(p<this.#c)return!1;const b=p-this.#l,g=b/p,m=g*d,y=g*f;let x=a,w=l;a=c,l=h,c+=m,h+=y,this.#f?.push(t,e);const v=-y/b,A=m/b,E=v*this.#d,C=A*this.#d;return this.#r.set(this.#r.subarray(2,8),0),this.#r.set([c+E,h+C],4),this.#r.set(this.#r.subarray(14,18),12),this.#r.set([c-E,h-C],16),isNaN(this.#r[6])?(this.#a.length===0&&(this.#r.set([a+E,l+C],2),this.#a.push(NaN,NaN,NaN,NaN,(a+E-s)/n,(l+C-i)/r),this.#r.set([a-E,l-C],14),this.#e.push(NaN,NaN,NaN,NaN,(a-E-s)/n,(l-C-i)/r)),this.#r.set([x,w,a,l,c,h],6),!this.isEmpty()):(this.#r.set([x,w,a,l,c,h],6),Math.abs(Math.atan2(w-l,x-a)-Math.atan2(y,m))<Math.PI/2?([a,l,c,h]=this.#r.subarray(2,6),this.#a.push(NaN,NaN,NaN,NaN,((a+c)/2-s)/n,((l+h)/2-i)/r),[a,l,x,w]=this.#r.subarray(14,18),this.#e.push(NaN,NaN,NaN,NaN,((x+a)/2-s)/n,((w+l)/2-i)/r),!0):([x,w,a,l,c,h]=this.#r.subarray(0,6),this.#a.push(((x+5*a)/6-s)/n,((w+5*l)/6-i)/r,((5*a+c)/6-s)/n,((5*l+h)/6-i)/r,((a+c)/2-s)/n,((l+h)/2-i)/r),[c,h,a,l,x,w]=this.#r.subarray(12,18),this.#e.push(((x+5*a)/6-s)/n,((w+5*l)/6-i)/r,((5*a+c)/6-s)/n,((5*l+h)/6-i)/r,((a+c)/2-s)/n,((l+h)/2-i)/r),!0))}toSVGPath(){if(this.isEmpty())return"";const t=this.#a,e=this.#e;if(isNaN(this.#r[6])&&!this.isEmpty())return this.#b();const s=[];s.push(`M${t[4]} ${t[5]}`);for(let i=6;i<t.length;i+=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);this.#y(s);for(let i=e.length-6;i>=6;i-=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);return this.#x(s),s.join(" ")}#b(){const[t,e,s,i]=this.#t,[n,r,a,l]=this.#p();return`M${(this.#r[2]-t)/s} ${(this.#r[3]-e)/i} L${(this.#r[4]-t)/s} ${(this.#r[5]-e)/i} L${n} ${r} L${a} ${l} L${(this.#r[16]-t)/s} ${(this.#r[17]-e)/i} L${(this.#r[14]-t)/s} ${(this.#r[15]-e)/i} Z`}#x(t){const e=this.#e;t.push(`L${e[4]} ${e[5]} Z`)}#y(t){const[e,s,i,n]=this.#t,r=this.#r.subarray(4,6),a=this.#r.subarray(16,18),[l,c,h,d]=this.#p();t.push(`L${(r[0]-e)/i} ${(r[1]-s)/n} L${l} ${c} L${h} ${d} L${(a[0]-e)/i} ${(a[1]-s)/n}`)}newFreeDrawOutline(t,e,s,i,n,r){return new Ga(t,e,s,i,n,r)}getOutlines(){const t=this.#a,e=this.#e,s=this.#r,[i,n,r,a]=this.#t,l=new Float32Array((this.#f?.length??0)+2);for(let d=0,f=l.length-2;d<f;d+=2)l[d]=(this.#f[d]-i)/r,l[d+1]=(this.#f[d+1]-n)/a;if(l[l.length-2]=(this.#n-i)/r,l[l.length-1]=(this.#o-n)/a,isNaN(s[6])&&!this.isEmpty())return this.#C(l);const c=new Float32Array(this.#a.length+24+this.#e.length);let h=t.length;for(let d=0;d<h;d+=2){if(isNaN(t[d])){c[d]=c[d+1]=NaN;continue}c[d]=t[d],c[d+1]=t[d+1]}h=this.#v(c,h);for(let d=e.length-6;d>=6;d-=6)for(let f=0;f<6;f+=2){if(isNaN(e[d+f])){c[h]=c[h+1]=NaN,h+=2;continue}c[h]=e[d+f],c[h+1]=e[d+f+1],h+=2}return this.#S(c,h),this.newFreeDrawOutline(c,l,this.#t,this.#u,this.#i,this.#s)}#C(t){const e=this.#r,[s,i,n,r]=this.#t,[a,l,c,h]=this.#p(),d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(e[2]-s)/n,(e[3]-i)/r,NaN,NaN,NaN,NaN,(e[4]-s)/n,(e[5]-i)/r,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,c,h,NaN,NaN,NaN,NaN,(e[16]-s)/n,(e[17]-i)/r,NaN,NaN,NaN,NaN,(e[14]-s)/n,(e[15]-i)/r],0),this.newFreeDrawOutline(d,t,this.#t,this.#u,this.#i,this.#s)}#S(t,e){const s=this.#e;return t.set([NaN,NaN,NaN,NaN,s[4],s[5]],e),e+=6}#v(t,e){const s=this.#r.subarray(4,6),i=this.#r.subarray(16,18),[n,r,a,l]=this.#t,[c,h,d,f]=this.#p();return t.set([NaN,NaN,NaN,NaN,(s[0]-n)/a,(s[1]-r)/l,NaN,NaN,NaN,NaN,c,h,NaN,NaN,NaN,NaN,d,f,NaN,NaN,NaN,NaN,(i[0]-n)/a,(i[1]-r)/l],e),e+=24}}class Ga extends L{#t;#e=new Float32Array(4);#i;#s;#a;#r;#n;constructor(t,e,s,i,n,r){super(),this.#n=t,this.#a=e,this.#t=s,this.#r=i,this.#i=n,this.#s=r,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#o(r);const[a,l,c,h]=this.#e;for(let d=0,f=t.length;d<f;d+=2)t[d]=(t[d]-a)/c,t[d+1]=(t[d+1]-l)/h;for(let d=0,f=e.length;d<f;d+=2)e[d]=(e[d]-a)/c,e[d+1]=(e[d+1]-l)/h}toSVGPath(){const t=[`M${this.#n[4]} ${this.#n[5]}`];for(let e=6,s=this.#n.length;e<s;e+=6){if(isNaN(this.#n[e])){t.push(`L${this.#n[e+4]} ${this.#n[e+5]}`);continue}t.push(`C${this.#n[e]} ${this.#n[e+1]} ${this.#n[e+2]} ${this.#n[e+3]} ${this.#n[e+4]} ${this.#n[e+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,e,s,i],n){const r=s-t,a=i-e;let l,c;switch(n){case 0:l=L._rescale(this.#n,t,i,r,-a),c=L._rescale(this.#a,t,i,r,-a);break;case 90:l=L._rescaleAndSwap(this.#n,t,e,r,a),c=L._rescaleAndSwap(this.#a,t,e,r,a);break;case 180:l=L._rescale(this.#n,s,e,-r,a),c=L._rescale(this.#a,s,e,-r,a);break;case 270:l=L._rescaleAndSwap(this.#n,s,i,-r,-a),c=L._rescaleAndSwap(this.#a,s,i,-r,-a);break}return{outline:Array.from(l),points:[Array.from(c)]}}#o(t){const e=this.#n;let s=e[4],i=e[5];const n=[s,i,s,i];let r=s,a=i,l=s,c=i;const h=t?Math.max:Math.min,d=new Float32Array(4);for(let p=6,b=e.length;p<b;p+=6){const g=e[p+4],m=e[p+5];isNaN(e[p])?(N.pointBoundingBox(g,m,n),a>m?(r=g,a=m):a===m&&(r=h(r,g)),c<m?(l=g,c=m):c===m&&(l=h(l,g))):(d[0]=d[1]=1/0,d[2]=d[3]=-1/0,N.bezierBoundingBox(s,i,...e.slice(p,p+6),d),N.rectBoundingBox(d[0],d[1],d[2],d[3],n),a>d[1]?(r=d[0],a=d[1]):a===d[1]&&(r=h(r,d[0])),c<d[3]?(l=d[2],c=d[3]):c===d[3]&&(l=h(l,d[2]))),s=g,i=m}const f=this.#e;f[0]=n[0]-this.#i,f[1]=n[1]-this.#i,f[2]=n[2]-n[0]+2*this.#i,f[3]=n[3]-n[1]+2*this.#i,this.firstPoint=[r,a],this.lastPoint=[l,c]}get box(){return this.#e}newOutliner(t,e,s,i,n,r=0){return new fe(t,e,s,i,n,r)}getNewOutline(t,e){const[s,i,n,r]=this.#e,[a,l,c,h]=this.#t,d=n*c,f=r*h,p=s*c+a,b=i*h+l,g=this.newOutliner({x:this.#a[0]*d+p,y:this.#a[1]*f+b},this.#t,this.#r,t,this.#s,e??this.#i);for(let m=2;m<this.#a.length;m+=2)g.add({x:this.#a[m]*d+p,y:this.#a[m+1]*f+b});return g.getOutlines()}}class Ni{#t;#e;#i;#s=[];#a=[];constructor(t,e=0,s=0,i=!0){const n=[1/0,1/0,-1/0,-1/0],r=10**-4;for(const{x:g,y:m,width:y,height:x}of t){const w=Math.floor((g-e)/r)*r,v=Math.ceil((g+y+e)/r)*r,A=Math.floor((m-e)/r)*r,E=Math.ceil((m+x+e)/r)*r,C=[w,A,E,!0],P=[v,A,E,!1];this.#s.push(C,P),N.rectBoundingBox(w,A,v,E,n)}const a=n[2]-n[0]+2*s,l=n[3]-n[1]+2*s,c=n[0]-s,h=n[1]-s;let d=i?-1/0:1/0,f=1/0;const p=this.#s.at(i?-1:-2),b=[p[0],p[2]];for(const g of this.#s){const[m,y,x,w]=g;!w&&i?y<f?(f=y,d=m):y===f&&(d=Math.max(d,m)):w&&!i&&(y<f?(f=y,d=m):y===f&&(d=Math.min(d,m))),g[0]=(m-c)/a,g[1]=(y-h)/l,g[2]=(x-h)/l}this.#t=new Float32Array([c,h,a,l]),this.#e=[d,f],this.#i=b}getOutlines(){this.#s.sort((e,s)=>e[0]-s[0]||e[1]-s[1]||e[2]-s[2]);const t=[];for(const e of this.#s)e[3]?(t.push(...this.#l(e)),this.#o(e)):(this.#c(e),t.push(...this.#l(e)));return this.#r(t)}#r(t){const e=[],s=new Set;for(const r of t){const[a,l,c]=r;e.push([a,l,r],[a,c,r])}e.sort((r,a)=>r[1]-a[1]||r[0]-a[0]);for(let r=0,a=e.length;r<a;r+=2){const l=e[r][2],c=e[r+1][2];l.push(c),c.push(l),s.add(l),s.add(c)}const i=[];let n;for(;s.size>0;){const r=s.values().next().value;let[a,l,c,h,d]=r;s.delete(r);let f=a,p=l;for(n=[a,c],i.push(n);;){let b;if(s.has(h))b=h;else if(s.has(d))b=d;else break;s.delete(b),[a,l,c,h,d]=b,f!==a&&(n.push(f,p,a,p===l?l:c),f=a),p=p===l?c:l}n.push(f,p)}return new Xd(i,this.#t,this.#e,this.#i)}#n(t){const e=this.#a;let s=0,i=e.length-1;for(;s<=i;){const n=s+i>>1,r=e[n][0];if(r===t)return n;r<t?s=n+1:i=n-1}return i+1}#o([,t,e]){const s=this.#n(t);this.#a.splice(s,0,[t,e])}#c([,t,e]){const s=this.#n(t);for(let i=s;i<this.#a.length;i++){const[n,r]=this.#a[i];if(n!==t)break;if(n===t&&r===e){this.#a.splice(i,1);return}}for(let i=s-1;i>=0;i--){const[n,r]=this.#a[i];if(n!==t)break;if(n===t&&r===e){this.#a.splice(i,1);return}}}#l(t){const[e,s,i]=t,n=[[e,s,i]],r=this.#n(i);for(let a=0;a<r;a++){const[l,c]=this.#a[a];for(let h=0,d=n.length;h<d;h++){const[,f,p]=n[h];if(!(c<=f||p<=l)){if(f>=l){if(p>c)n[h][1]=c;else{if(d===1)return[];n.splice(h,1),h--,d--}continue}n[h][2]=l,p>c&&n.push([e,c,p])}}}return n}}class Xd extends L{#t;#e;constructor(t,e,s,i){super(),this.#e=t,this.#t=e,this.firstPoint=s,this.lastPoint=i}toSVGPath(){const t=[];for(const e of this.#e){let[s,i]=e;t.push(`M${s} ${i}`);for(let n=2;n<e.length;n+=2){const r=e[n],a=e[n+1];r===s?(t.push(`V${a}`),i=a):a===i&&(t.push(`H${r}`),s=r)}t.push("Z")}return t.join(" ")}serialize([t,e,s,i],n){const r=[],a=s-t,l=i-e;for(const c of this.#e){const h=new Array(c.length);for(let d=0;d<c.length;d+=2)h[d]=t+c[d]*a,h[d+1]=i-c[d+1]*l;r.push(h)}return r}get box(){return this.#t}get classNamesForOutlining(){return["highlightOutline"]}}class Li extends fe{newFreeDrawOutline(t,e,s,i,n,r){return new Yd(t,e,s,i,n,r)}}class Yd extends Ga{newOutliner(t,e,s,i,n,r=0){return new Li(t,e,s,i,n,r)}}class ct extends F{#t=null;#e=0;#i;#s=null;#a=null;#r=null;#n=null;#o=0;#c=null;#l=null;#u=null;#d=!1;#f=null;#m=null;#g=null;#h="";#p;#b="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=z.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const t=ct.prototype;return H(this,"_keyboardManager",new cs([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}constructor(t){super({...t,name:"highlightEditor"}),this.color=t.color||ct._defaultColor,this.#p=t.thickness||ct._defaultThickness,this.opacity=t.opacity||ct._defaultOpacity,this.#i=t.boxes||null,this.#b=t.methodOfCreation||"",this.#h=t.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(this.#d=!0,this.#y(t),this.#w()):this.#i&&(this.#t=t.anchorNode,this.#e=t.anchorOffset,this.#n=t.focusNode,this.#o=t.focusOffset,this.#x(),this.#w(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#d?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#p,methodOfCreation:this.#b}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}#x(){const t=new Ni(this.#i,.001);this.#l=t.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;const e=new Ni(this.#i,.0025,.001,this._uiManager.direction==="ltr");this.#r=e.getOutlines();const{firstPoint:s}=this.#l;this.#f=[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height];const{lastPoint:i}=this.#r;this.#m=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]}#y({highlightOutlines:t,highlightId:e,clipPathId:s}){this.#l=t;const i=1.5;if(this.#r=t.getNewOutline(this.#p/2+i,.0025),e>=0)this.#u=e,this.#s=s,this.parent.drawLayer.finalizeDraw(e,{bbox:t.box,path:{d:t.toSVGPath()}}),this.#g=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#r.box,path:{d:this.#r.toSVGPath()}},!0);else if(this.parent){const d=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#u,{bbox:ct.#E(this.#l.box,(d-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#g,{bbox:ct.#E(this.#r.box,d),path:{d:this.#r.toSVGPath()}})}const[n,r,a,l]=t.box;switch(this.rotation){case 0:this.x=n,this.y=r,this.width=a,this.height=l;break;case 90:{const[d,f]=this.parentDimensions;this.x=r,this.y=1-n,this.width=a*f/d,this.height=l*d/f;break}case 180:this.x=1-n,this.y=1-r,this.width=a,this.height=l;break;case 270:{const[d,f]=this.parentDimensions;this.x=1-r,this.y=n,this.width=a*f/d,this.height=l*d/f;break}}const{firstPoint:c}=t;this.#f=[(c[0]-n)/a,(c[1]-r)/l];const{lastPoint:h}=this.#r;this.#m=[(h[0]-n)/a,(h[1]-r)/l]}static initialize(t,e){F.initialize(t,e),ct._defaultColor||=e.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(t,e){switch(t){case V.HIGHLIGHT_COLOR:ct._defaultColor=e;break;case V.HIGHLIGHT_THICKNESS:ct._defaultThickness=e;break}}translateInPage(t,e){}get toolbarPosition(){return this.#m}get commentButtonPosition(){return this.#f}updateParams(t,e){switch(t){case V.HIGHLIGHT_COLOR:this.#C(e);break;case V.HIGHLIGHT_THICKNESS:this.#S(e);break}}static get defaultPropertiesToUpdate(){return[[V.HIGHLIGHT_COLOR,ct._defaultColor],[V.HIGHLIGHT_THICKNESS,ct._defaultThickness]]}get propertiesToUpdate(){return[[V.HIGHLIGHT_COLOR,this.color||ct._defaultColor],[V.HIGHLIGHT_THICKNESS,this.#p||ct._defaultThickness],[V.HIGHLIGHT_FREE,this.#d]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#u,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#a?.updateColor(this.color),super.onUpdatedColor()}#C(t){const e=(n,r)=>{this.color=n,this.opacity=r,this.onUpdatedColor()},s=this.color,i=this.opacity;this.addCommands({cmd:e.bind(this,t,ct._defaultOpacity),undo:e.bind(this,s,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)}#S(t){const e=this.#p,s=i=>{this.#p=i,this.#v(i)};this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,e),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:V.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#a=new Nt({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#P())}getBaseTranslation(){return[0,0]}getRect(t,e){return super.getRect(t,e,this.#P())}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){this.#_(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#w(),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?this.#_():t&&(this.#w(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),this.show(this._isVisible),e&&this.select()}#v(t){this.#d&&(this.#y({highlightOutlines:this.#l.getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims())}#_(){this.#u===null||!this.parent||(this.parent.drawLayer.remove(this.#u),this.#u=null,this.parent.drawLayer.remove(this.#g),this.#g=null)}#w(t=this.parent){this.#u===null&&({id:this.#u,clipPathId:this.#s}=t.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#d},path:{d:this.#l.toSVGPath()}},!1,!0),this.#g=t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#d},bbox:this.#r.box,path:{d:this.#r.toSVGPath()}},this.#d),this.#c&&(this.#c.style.clipPath=this.#s))}static#E([t,e,s,i],n){switch(n){case 90:return[1-e-i,t,i,s];case 180:return[1-t-s,1-e-i,s,i];case 270:return[e,1-t-s,i,s]}return[t,e,s,i]}rotate(t){const{drawLayer:e}=this.parent;let s;this.#d?(t=(t-this.rotation+360)%360,s=ct.#E(this.#l.box,t)):s=ct.#E([this.x,this.y,this.width,this.height],t),e.updateProperties(this.#u,{bbox:s,root:{"data-main-rotation":t}}),e.updateProperties(this.#g,{bbox:ct.#E(this.#r.box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();this.#h&&(t.setAttribute("aria-label",this.#h),t.setAttribute("role","mark")),this.#d?t.classList.add("free"):this.div.addEventListener("keydown",this.#R.bind(this),{signal:this._uiManager._signal});const e=this.#c=document.createElement("div");return t.append(e),e.setAttribute("aria-hidden","true"),e.className="internal",e.style.clipPath=this.#s,this.setDims(),ya(this,this.#c,["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!1}})}#R(t){ct._keyboardManager.exec(this,t)}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:this.#k(!0);break;case 1:case 3:this.#k(!1);break}}#k(t){if(!this.#t)return;const e=window.getSelection();t?e.setPosition(this.#t,this.#e):e.setPosition(this.#n,this.#o)}select(){super.select(),this.#g&&this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#g&&(this.parent?.drawLayer.updateProperties(this.#g,{rootClass:{selected:!1}}),this.#d||this.#k(!1))}get _mustFixPosition(){return!this.#d}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(this.#u,{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(this.#g,{rootClass:{hidden:!t}}))}#P(){return this.#d?this.rotation:0}#F(){if(this.#d)return null;const[t,e]=this.pageDimensions,[s,i]=this.pageTranslation,n=this.#i,r=new Float32Array(n.length*8);let a=0;for(const{x:l,y:c,width:h,height:d}of n){const f=l*t+s,p=(1-c)*e+i;r[a]=r[a+4]=f,r[a+1]=r[a+3]=p,r[a+2]=r[a+6]=f+h*t,r[a+5]=r[a+7]=p-d*e,a+=8}return r}#N(t){return this.#l.serialize(t,this.#P())}static startHighlighting(t,e,{target:s,x:i,y:n}){const{x:r,y:a,width:l,height:c}=s.getBoundingClientRect(),h=new AbortController,d=t.combinedSignal(h),f=p=>{h.abort(),this.#O(t,p)};window.addEventListener("blur",f,{signal:d}),window.addEventListener("pointerup",f,{signal:d}),window.addEventListener("pointerdown",nt,{capture:!0,passive:!1,signal:d}),window.addEventListener("contextmenu",It,{signal:d}),s.addEventListener("pointermove",this.#I.bind(this,t),{signal:d}),this._freeHighlight=new Li({x:i,y:n},[r,a,l,c],t.scale,this._defaultThickness/2,e,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#I(t,e){this._freeHighlight.add(e)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#O(t,e){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(e,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(t,e,s){let i=null;if(t instanceof za){const{data:{quadPoints:b,rect:g,rotation:m,id:y,color:x,opacity:w,popupRef:v,richText:A,contentsObj:E,creationDate:C,modificationDate:P},parent:{page:{pageNumber:T}}}=t;i=t={annotationType:z.HIGHLIGHT,color:Array.from(x),opacity:w,quadPoints:b,boxes:null,pageIndex:T-1,rect:g.slice(0),rotation:m,annotationElementId:y,id:y,deleted:!1,popupRef:v,richText:A,comment:E?.str||null,creationDate:C,modificationDate:P}}else if(t instanceof ln){const{data:{inkLists:b,rect:g,rotation:m,id:y,color:x,borderStyle:{rawWidth:w},popupRef:v,richText:A,contentsObj:E,creationDate:C,modificationDate:P},parent:{page:{pageNumber:T}}}=t;i=t={annotationType:z.HIGHLIGHT,color:Array.from(x),thickness:w,inkLists:b,boxes:null,pageIndex:T-1,rect:g.slice(0),rotation:m,annotationElementId:y,id:y,deleted:!1,popupRef:v,richText:A,comment:E?.str||null,creationDate:C,modificationDate:P}}const{color:n,quadPoints:r,inkLists:a,opacity:l}=t,c=await super.deserialize(t,e,s);c.color=N.makeHexColor(...n),c.opacity=l||1,a&&(c.#p=t.thickness),c._initialData=i,t.comment&&c.setCommentData(t);const[h,d]=c.pageDimensions,[f,p]=c.pageTranslation;if(r){const b=c.#i=[];for(let g=0;g<r.length;g+=8)b.push({x:(r[g]-f)/h,y:1-(r[g+1]-p)/d,width:(r[g+2]-r[g])/h,height:(r[g+1]-r[g+5])/d});c.#x(),c.#w(),c.rotate(c.rotation)}else if(a){c.#d=!0;const b=a[0],g={x:b[0]-f,y:d-(b[1]-p)},m=new Li(g,[0,0,h,d],1,c.#p/2,!0,.001);for(let w=0,v=b.length;w<v;w+=2)g.x=b[w]-f,g.y=d-(b[w+1]-p),m.add(g);const{id:y,clipPathId:x}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:m.toSVGPath()}},!0,!0);c.#y({highlightOutlines:m.getOutlines(),highlightId:y,clipPathId:x}),c.#w(),c.rotate(c.parentRotation)}return c}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const e=F._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),s=super.serialize(t);return Object.assign(s,{color:e,opacity:this.opacity,thickness:this.#p,quadPoints:this.#F(),outlines:this.#N(s.rect)}),this.addComment(s),this.annotationElementId&&!this.#M(s)?null:(s.id=this.annotationElementId,s)}#M(t){const{color:e}=this._initialData;return this.hasEditedComment||t.color.some((s,i)=>s!==e[i])}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class Va{#t=Object.create(null);updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,s]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,s)}updateSVGProperty(t,e){this.#t[t]=e}toSVGProperties(){const t=this.#t;return this.#t=Object.create(null),{root:t}}reset(){this.#t=Object.create(null)}updateAll(t=this){this.updateProperties(t)}clone(){Q("Not implemented")}}class q extends F{#t=null;#e;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#i=null;static#s=null;static#a=null;static _INNER_MARGIN=3;constructor(t){super(t),this.#e=t.mustBeCommitted||!1,this._addOutlines(t)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(this.#r(t),this.#c())}#r({drawOutlines:t,drawId:e,drawingOptions:s}){this.#t=t,this._drawingOptions||=s,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),e>=0?(this._drawId=e,this.parent.drawLayer.finalizeDraw(e,t.defaultProperties)):this._drawId=this.#n(t,this.parent),this.#d(t.box)}#n(t,e){const{id:s}=e.drawLayer.draw(q._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return s}static _mergeSVGProperties(t,e){const s=new Set(Object.keys(t));for(const[i,n]of Object.entries(e))s.has(i)?Object.assign(t[i],n):t[i]=n;return t}static getDefaultDrawingOptions(t){Q("Not implemented")}static get typesMap(){Q("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,e){const s=this.typesMap.get(t);s&&this._defaultDrawingOptions.updateProperty(s,e),this._currentParent&&(q.#i.updateProperty(s,e),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,e){const s=this.constructor.typesMap.get(t);s&&this._updateProperty(t,s,e)}static get defaultPropertiesToUpdate(){const t=[],e=this._defaultDrawingOptions;for(const[s,i]of this.typesMap)t.push([s,e[i]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:e}=this;for(const[s,i]of this.constructor.typesMap)t.push([s,e[i]]);return t}_updateProperty(t,e,s){const i=this._drawingOptions,n=i[e],r=a=>{i.updateProperty(e,a);const l=this.#t.updateProperty(e,a);l&&this.#d(l),this.parent?.drawLayer.updateProperties(this._drawId,i.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:r.bind(this,s),undo:r.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,q._mergeSVGProperties(this.#t.getPathResizingSVGProperties(this.#u()),{bbox:this.#f()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,q._mergeSVGProperties(this.#t.getPathResizedSVGProperties(this.#u()),{bbox:this.#f()}))}_onTranslating(t,e){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#f()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,q._mergeSVGProperties(this.#t.getPathTranslatedSVGProperties(this.#u(),this.parentDimensions),{bbox:this.#f()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#e&&(this.#e=!1,this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){this.#o(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#c(),this.#d(this.#t.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){let e=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),this.#o()):t&&(this._uiManager.addShouldRescale(this),this.#c(t),e=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(t),e&&this.select()}#o(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#c(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#n(this.#t,t)}}#l([t,e,s,i]){const{parentDimensions:[n,r],rotation:a}=this;switch(a){case 90:return[e,1-t,s*(r/n),i*(n/r)];case 180:return[1-t,1-e,s,i];case 270:return[1-e,t,s*(r/n),i*(n/r)];default:return[t,e,s,i]}}#u(){const{x:t,y:e,width:s,height:i,parentDimensions:[n,r],rotation:a}=this;switch(a){case 90:return[1-e,t,s*(n/r),i*(r/n)];case 180:return[1-t,1-e,s,i];case 270:return[e,1-t,s*(n/r),i*(r/n)];default:return[t,e,s,i]}}#d(t){[this.x,this.y,this.width,this.height]=this.#l(t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#f(){const{x:t,y:e,width:s,height:i,rotation:n,parentRotation:r,parentDimensions:[a,l]}=this;switch((n*4+r)/90){case 1:return[1-e-i,t,i,s];case 2:return[1-t-s,1-e-i,s,i];case 3:return[e,1-t-s,i,s];case 4:return[t,e-s*(a/l),i*(l/a),s*(a/l)];case 5:return[1-e,t,s*(a/l),i*(l/a)];case 6:return[1-t-i*(l/a),1-e,i*(l/a),s*(a/l)];case 7:return[e-s*(a/l),1-t-i*(l/a),s*(a/l),i*(l/a)];case 8:return[t-s,e-i,s,i];case 9:return[1-e,t-s,i,s];case 10:return[1-t,1-e,s,i];case 11:return[e-i,1-t,i,s];case 12:return[t-i*(l/a),e,i*(l/a),s*(a/l)];case 13:return[1-e-s*(a/l),t-i*(l/a),s*(a/l),i*(l/a)];case 14:return[1-t,1-e-s*(a/l),i*(l/a),s*(a/l)];case 15:return[e,1-t,s*(a/l),i*(l/a)];default:return[t,e,s,i]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,q._mergeSVGProperties({bbox:this.#f()},this.#t.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#d(this.#t.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,e;this._isCopy&&(t=this.x,e=this.y);const s=super.render();s.classList.add("draw");const i=document.createElement("div");return s.append(i),i.setAttribute("aria-hidden","true"),i.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,e),s}static createDrawerInstance(t,e,s,i,n){Q("Not implemented")}static startDrawing(t,e,s,i){const{target:n,offsetX:r,offsetY:a,pointerId:l,pointerType:c}=i;if(K.isInitializedAndDifferentPointerType(c))return;const{viewport:{rotation:h}}=t,{width:d,height:f}=n.getBoundingClientRect(),p=q.#s=new AbortController,b=t.combinedSignal(p);if(K.setPointer(c,l),window.addEventListener("pointerup",g=>{K.isSamePointerIdOrRemove(g.pointerId)&&this._endDraw(g)},{signal:b}),window.addEventListener("pointercancel",g=>{K.isSamePointerIdOrRemove(g.pointerId)&&this._currentParent.endDrawingSession()},{signal:b}),window.addEventListener("pointerdown",g=>{K.isSamePointerType(g.pointerType)&&(K.initializeAndAddPointerId(g.pointerId),q.#i.isCancellable()&&(q.#i.removeLastElement(),q.#i.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:b}),window.addEventListener("contextmenu",It,{signal:b}),n.addEventListener("pointermove",this._drawMove.bind(this),{signal:b}),n.addEventListener("touchmove",g=>{K.isSameTimeStamp(g.timeStamp)&&nt(g)},{signal:b}),t.toggleDrawing(),e._editorUndoBar?.hide(),q.#i){t.drawLayer.updateProperties(this._currentDrawId,q.#i.startNew(r,a,d,f,h));return}e.updateUIForDefaultProperties(this),q.#i=this.createDrawerInstance(r,a,d,f,h),q.#a=this.getDefaultDrawingOptions(),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(q.#a.toSVGProperties(),q.#i.defaultSVGProperties),!0,!1)}static _drawMove(t){if(K.isSameTimeStamp(t.timeStamp),!q.#i)return;const{offsetX:e,offsetY:s,pointerId:i}=t;if(K.isSamePointerId(i)){if(K.isUsingMultiplePointers()){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,q.#i.add(e,s)),K.setTimeStamp(t.timeStamp),nt(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,q.#i=null,q.#a=null,K.clearTimeStamp()),q.#s&&(q.#s.abort(),q.#s=null,K.clearPointerIds())}static _endDraw(t){const e=this._currentParent;if(e){if(e.toggleDrawing(!0),this._cleanup(!1),t?.target===e.div&&e.drawLayer.updateProperties(this._currentDrawId,q.#i.end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const s=q.#i,i=this._currentDrawId,n=s.getLastElement();e.addCommands({cmd:()=>{e.drawLayer.updateProperties(i,s.setLastElement(n))},undo:()=>{e.drawLayer.updateProperties(i,s.removeLastElement())},mustExec:!1,type:V.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const e=this._currentParent;if(!e)return null;if(e.toggleDrawing(!0),e.cleanUndoStack(V.DRAW_STEP),!q.#i.isEmpty()){const{pageDimensions:[s,i],scale:n}=e,r=e.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:q.#i.getOutlines(s*n,i*n,n,this._INNER_MARGIN),drawingOptions:q.#a,mustBeCommitted:!t});return this._cleanup(!0),r}return e.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,e,s,i,n,r){Q("Not implemented")}static async deserialize(t,e,s){const{rawDims:{pageWidth:i,pageHeight:n,pageX:r,pageY:a}}=e.viewport,l=this.deserializeDraw(r,a,i,n,this._INNER_MARGIN,t),c=await super.deserialize(t,e,s);return c.createDrawingOptions(t),c.#r({drawOutlines:l}),c.#c(),c.onScaleChanging(),c.rotate(),c}serializeDraw(t){const[e,s]=this.pageTranslation,[i,n]=this.pageDimensions;return this.#t.serialize([e,s,i,n],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class qd{#t=new Float64Array(6);#e;#i;#s;#a;#r;#n="";#o=0;#c=new ds;#l;#u;constructor(t,e,s,i,n,r){this.#l=s,this.#u=i,this.#s=n,this.#a=r,[t,e]=this.#d(t,e);const a=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#r=[t,e],this.#i=[{line:a,points:this.#r}],this.#t.set(a,0)}updateProperty(t,e){t==="stroke-width"&&(this.#a=e)}#d(t,e){return L._normalizePoint(t,e,this.#l,this.#u,this.#s)}isEmpty(){return!this.#i||this.#i.length===0}isCancellable(){return this.#r.length<=10}add(t,e){[t,e]=this.#d(t,e);const[s,i,n,r]=this.#t.subarray(2,6),a=t-n,l=e-r;return Math.hypot(this.#l*a,this.#u*l)<=2?null:(this.#r.push(t,e),isNaN(s)?(this.#t.set([n,r,t,e],2),this.#e.push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(this.#t[0])&&this.#e.splice(6,6),this.#t.set([s,i,n,r,t,e],0),this.#e.push(...L.createBezierPoints(s,i,n,r,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const s=this.add(t,e);return s||(this.#r.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,s,i,n){this.#l=s,this.#u=i,this.#s=n,[t,e]=this.#d(t,e);const r=this.#e=[NaN,NaN,NaN,NaN,t,e];this.#r=[t,e];const a=this.#i.at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),this.#i.push({line:r,points:this.#r}),this.#t.set(r,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#i.at(-1)}setLastElement(t){return this.#i?(this.#i.push(t),this.#e=t.line,this.#r=t.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#c.setLastElement(t)}removeLastElement(){if(!this.#i)return this.#c.removeLastElement();this.#i.pop(),this.#n="";for(let t=0,e=this.#i.length;t<e;t++){const{line:s,points:i}=this.#i[t];this.#e=s,this.#r=i,this.#o=0,this.toSVGPath()}return{path:{d:this.#n}}}toSVGPath(){const t=L.svgRound(this.#e[4]),e=L.svgRound(this.#e[5]);if(this.#r.length===2)return this.#n=`${this.#n} M ${t} ${e} Z`,this.#n;if(this.#r.length<=6){const i=this.#n.lastIndexOf("M");this.#n=`${this.#n.slice(0,i)} M ${t} ${e}`,this.#o=6}if(this.#r.length===4){const i=L.svgRound(this.#e[10]),n=L.svgRound(this.#e[11]);return this.#n=`${this.#n} L ${i} ${n}`,this.#o=12,this.#n}const s=[];this.#o===0&&(s.push(`M ${t} ${e}`),this.#o=6);for(let i=this.#o,n=this.#e.length;i<n;i+=6){const[r,a,l,c,h,d]=this.#e.slice(i,i+6).map(L.svgRound);s.push(`C${r} ${a} ${l} ${c} ${h} ${d}`)}return this.#n+=s.join(" "),this.#o=this.#e.length,this.#n}getOutlines(t,e,s,i){const n=this.#i.at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),this.#c.build(this.#i,t,e,s,this.#s,this.#a,i),this.#t=null,this.#e=null,this.#i=null,this.#n=null,this.#c}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class ds extends L{#t;#e=0;#i;#s;#a;#r;#n;#o;#c;build(t,e,s,i,n,r,a){this.#a=e,this.#r=s,this.#n=i,this.#o=n,this.#c=r,this.#i=a??0,this.#s=t,this.#d()}get thickness(){return this.#c}setLastElement(t){return this.#s.push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#s.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:e}of this.#s){if(t.push(`M${L.svgRound(e[4])} ${L.svgRound(e[5])}`),e.length===6){t.push("Z");continue}if(e.length===12&&isNaN(e[6])){t.push(`L${L.svgRound(e[10])} ${L.svgRound(e[11])}`);continue}for(let s=6,i=e.length;s<i;s+=6){const[n,r,a,l,c,h]=e.subarray(s,s+6).map(L.svgRound);t.push(`C${n} ${r} ${a} ${l} ${c} ${h}`)}}return t.join("")}serialize([t,e,s,i],n){const r=[],a=[],[l,c,h,d]=this.#u();let f,p,b,g,m,y,x,w,v;switch(this.#o){case 0:v=L._rescale,f=t,p=e+i,b=s,g=-i,m=t+l*s,y=e+(1-c-d)*i,x=t+(l+h)*s,w=e+(1-c)*i;break;case 90:v=L._rescaleAndSwap,f=t,p=e,b=s,g=i,m=t+c*s,y=e+l*i,x=t+(c+d)*s,w=e+(l+h)*i;break;case 180:v=L._rescale,f=t+s,p=e,b=-s,g=i,m=t+(1-l-h)*s,y=e+c*i,x=t+(1-l)*s,w=e+(c+d)*i;break;case 270:v=L._rescaleAndSwap,f=t+s,p=e+i,b=-s,g=-i,m=t+(1-c-d)*s,y=e+(1-l-h)*i,x=t+(1-c)*s,w=e+(1-l)*i;break}for(const{line:A,points:E}of this.#s)r.push(v(A,f,p,b,g,n?new Array(A.length):null)),a.push(v(E,f,p,b,g,n?new Array(E.length):null));return{lines:r,points:a,rect:[m,y,x,w]}}static deserialize(t,e,s,i,n,{paths:{lines:r,points:a},rotation:l,thickness:c}){const h=[];let d,f,p,b,g;switch(l){case 0:g=L._rescale,d=-t/s,f=e/i+1,p=1/s,b=-1/i;break;case 90:g=L._rescaleAndSwap,d=-e/i,f=-t/s,p=1/i,b=1/s;break;case 180:g=L._rescale,d=t/s+1,f=-e/i,p=-1/s,b=1/i;break;case 270:g=L._rescaleAndSwap,d=e/i+1,f=t/s+1,p=-1/i,b=-1/s;break}if(!r){r=[];for(const y of a){const x=y.length;if(x===2){r.push(new Float32Array([NaN,NaN,NaN,NaN,y[0],y[1]]));continue}if(x===4){r.push(new Float32Array([NaN,NaN,NaN,NaN,y[0],y[1],NaN,NaN,NaN,NaN,y[2],y[3]]));continue}const w=new Float32Array(3*(x-2));r.push(w);let[v,A,E,C]=y.subarray(0,4);w.set([NaN,NaN,NaN,NaN,v,A],0);for(let P=4;P<x;P+=2){const T=y[P],_=y[P+1];w.set(L.createBezierPoints(v,A,E,C,T,_),(P-2)*3),[v,A,E,C]=[E,C,T,_]}}}for(let y=0,x=r.length;y<x;y++)h.push({line:g(r[y].map(w=>w??NaN),d,f,p,b),points:g(a[y].map(w=>w??NaN),d,f,p,b)});const m=new this.prototype.constructor;return m.build(h,s,i,1,l,c,n),m}#l(t=this.#c){const e=this.#i+t/2*this.#n;return this.#o%180===0?[e/this.#a,e/this.#r]:[e/this.#r,e/this.#a]}#u(){const[t,e,s,i]=this.#t,[n,r]=this.#l(0);return[t+n,e+r,s-2*n,i-2*r]}#d(){const t=this.#t=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:i}of this.#s){if(i.length<=12){for(let a=4,l=i.length;a<l;a+=6)N.pointBoundingBox(i[a],i[a+1],t);continue}let n=i[4],r=i[5];for(let a=6,l=i.length;a<l;a+=6){const[c,h,d,f,p,b]=i.subarray(a,a+6);N.bezierBoundingBox(n,r,c,h,d,f,p,b,t),n=p,r=b}}const[e,s]=this.#l();t[0]=xt(t[0]-e,0,1),t[1]=xt(t[1]-s,0,1),t[2]=xt(t[2]+e,0,1),t[3]=xt(t[3]+s,0,1),t[2]-=t[0],t[3]-=t[1]}get box(){return this.#t}updateProperty(t,e){return t==="stroke-width"?this.#f(e):null}#f(t){const[e,s]=this.#l();this.#c=t;const[i,n]=this.#l(),[r,a]=[i-e,n-s],l=this.#t;return l[0]-=r,l[1]-=a,l[2]+=2*r,l[3]+=2*a,l}updateParentDimensions([t,e],s){const[i,n]=this.#l();this.#a=t,this.#r=e,this.#n=s;const[r,a]=this.#l(),l=r-i,c=a-n,h=this.#t;return h[0]-=l,h[1]-=c,h[2]+=2*l,h[3]+=2*c,h}updateRotation(t){return this.#e=t,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#t.map(L.svgRound).join(" ")}get defaultProperties(){const[t,e]=this.#t;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${L.svgRound(t)} ${L.svgRound(e)}`}}}get rotationTransform(){const[,,t,e]=this.#t;let s=0,i=0,n=0,r=0,a=0,l=0;switch(this.#e){case 90:i=e/t,n=-t/e,a=t;break;case 180:s=-1,r=-1,a=t,l=e;break;case 270:i=-e/t,n=t/e,l=e;break;default:return""}return`matrix(${s} ${i} ${n} ${r} ${L.svgRound(a)} ${L.svgRound(l)})`}getPathResizingSVGProperties([t,e,s,i]){const[n,r]=this.#l(),[a,l,c,h]=this.#t;if(Math.abs(c-n)<=L.PRECISION||Math.abs(h-r)<=L.PRECISION){const g=t+s/2-(a+c/2),m=e+i/2-(l+h/2);return{path:{"transform-origin":`${L.svgRound(t)} ${L.svgRound(e)}`,transform:`${this.rotationTransform} translate(${g} ${m})`}}}const d=(s-2*n)/(c-2*n),f=(i-2*r)/(h-2*r),p=c/s,b=h/i;return{path:{"transform-origin":`${L.svgRound(a)} ${L.svgRound(l)}`,transform:`${this.rotationTransform} scale(${p} ${b}) translate(${L.svgRound(n)} ${L.svgRound(r)}) scale(${d} ${f}) translate(${L.svgRound(-n)} ${L.svgRound(-r)})`}}}getPathResizedSVGProperties([t,e,s,i]){const[n,r]=this.#l(),a=this.#t,[l,c,h,d]=a;if(a[0]=t,a[1]=e,a[2]=s,a[3]=i,Math.abs(h-n)<=L.PRECISION||Math.abs(d-r)<=L.PRECISION){const m=t+s/2-(l+h/2),y=e+i/2-(c+d/2);for(const{line:x,points:w}of this.#s)L._translate(x,m,y,x),L._translate(w,m,y,w);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${L.svgRound(t)} ${L.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const f=(s-2*n)/(h-2*n),p=(i-2*r)/(d-2*r),b=-f*(l+n)+t+n,g=-p*(c+r)+e+r;if(f!==1||p!==1||b!==0||g!==0)for(const{line:m,points:y}of this.#s)L._rescale(m,b,g,f,p,m),L._rescale(y,b,g,f,p,y);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${L.svgRound(t)} ${L.svgRound(e)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,e],s){const[i,n]=s,r=this.#t,a=t-r[0],l=e-r[1];if(this.#a===i&&this.#r===n)for(const{line:c,points:h}of this.#s)L._translate(c,a,l,c),L._translate(h,a,l,h);else{const c=this.#a/i,h=this.#r/n;this.#a=i,this.#r=n;for(const{line:d,points:f}of this.#s)L._rescale(d,a,l,c,h,d),L._rescale(f,a,l,c,h,f);r[2]*=c,r[3]*=h}return r[0]=t,r[1]=e,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${L.svgRound(t)} ${L.svgRound(e)}`}}}get defaultSVGProperties(){const t=this.#t;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${L.svgRound(t[0])} ${L.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}class Js extends Va{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:F._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??=this["stroke-width"],e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new Js(this._viewParameters);return t.updateAll(this),t}}class cn extends q{static _type="ink";static _editorType=z.INK;static _defaultDrawingOptions=null;constructor(t){super({...t,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,e){F.initialize(t,e),this._defaultDrawingOptions=new Js(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!0}static get typesMap(){return H(this,"typesMap",new Map([[V.INK_THICKNESS,"stroke-width"],[V.INK_COLOR,"stroke"],[V.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,e,s,i,n){return new qd(t,e,s,i,n,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,e,s,i,n,r){return ds.deserialize(t,e,s,i,n,r)}static async deserialize(t,e,s){let i=null;if(t instanceof ln){const{data:{inkLists:r,rect:a,rotation:l,id:c,color:h,opacity:d,borderStyle:{rawWidth:f},popupRef:p,richText:b,contentsObj:g,creationDate:m,modificationDate:y},parent:{page:{pageNumber:x}}}=t;i=t={annotationType:z.INK,color:Array.from(h),thickness:f,opacity:d,paths:{points:r},boxes:null,pageIndex:x-1,rect:a.slice(0),rotation:l,annotationElementId:c,id:c,deleted:!1,popupRef:p,richText:b,comment:g?.str||null,creationDate:m,modificationDate:y}}const n=await super.deserialize(t,e,s);return n._initialData=i,t.comment&&n.setCommentData(t),n}get toolbarButtons(){return this._colorPicker||=new ss(this),[["colorPicker",this._colorPicker]]}get colorType(){return V.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:e,parent:s}=this;e.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(t,e.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:e,opacity:s}){this._drawingOptions=cn.getDefaultDrawingOptions({stroke:N.makeHexColor(...t),"stroke-width":e,"stroke-opacity":s})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:e,points:s}=this.serializeDraw(t),{_drawingOptions:{stroke:i,"stroke-opacity":n,"stroke-width":r}}=this,a=Object.assign(super.serialize(t),{color:F._colorManager.convert(i),opacity:n,thickness:r,paths:{lines:e,points:s}});return this.addComment(a),t?(a.isCopy=!0,a):this.annotationElementId&&!this.#t(a)?null:(a.id=this.annotationElementId,a)}#t(t){const{color:e,thickness:s,opacity:i,pageIndex:n}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((r,a)=>r!==e[a])||t.thickness!==s||t.opacity!==i||t.pageIndex!==n}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:e,rect:s}=this.serializeDraw(!1);return t.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:e,popup:this.comment}),null}}class Ii extends ds{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const Es=8,Ge=3;class ue{static#t={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#e(t,e,s,i){return s-=t,i-=e,s===0?i>0?0:4:s===1?i+6:2-i}static#i=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#s(t,e,s,i,n,r,a){const l=this.#e(s,i,n,r);for(let c=0;c<8;c++){const h=(-c+l-a+16)%8,d=this.#i[2*h],f=this.#i[2*h+1];if(t[(s+d)*e+(i+f)]!==0)return h}return-1}static#a(t,e,s,i,n,r,a){const l=this.#e(s,i,n,r);for(let c=0;c<8;c++){const h=(c+l+a+16)%8,d=this.#i[2*h],f=this.#i[2*h+1];if(t[(s+d)*e+(i+f)]!==0)return h}return-1}static#r(t,e,s,i){const n=t.length,r=new Int32Array(n);for(let h=0;h<n;h++)r[h]=t[h]<=i?1:0;for(let h=1;h<s-1;h++)r[h*e]=r[h*e+e-1]=0;for(let h=0;h<e;h++)r[h]=r[e*s-1-h]=0;let a=1,l;const c=[];for(let h=1;h<s-1;h++){l=1;for(let d=1;d<e-1;d++){const f=h*e+d,p=r[f];if(p===0)continue;let b=h,g=d;if(p===1&&r[f-1]===0)a+=1,g-=1;else if(p>=1&&r[f+1]===0)a+=1,g+=1,p>1&&(l=p);else{p!==1&&(l=Math.abs(p));continue}const m=[d,h],y=g===d+1,x={isHole:y,points:m,id:a,parent:0};c.push(x);let w;for(const k of c)if(k.id===l){w=k;break}w?w.isHole?x.parent=y?w.parent:l:x.parent=y?l:w.parent:x.parent=y?l:0;const v=this.#s(r,e,h,d,b,g,0);if(v===-1){r[f]=-a,r[f]!==1&&(l=Math.abs(r[f]));continue}let A=this.#i[2*v],E=this.#i[2*v+1];const C=h+A,P=d+E;b=C,g=P;let T=h,_=d;for(;;){const k=this.#a(r,e,T,_,b,g,1);A=this.#i[2*k],E=this.#i[2*k+1];const R=T+A,M=_+E;m.push(M,R);const O=T*e+_;if(r[O+1]===0?r[O]=-a:r[O]===1&&(r[O]=a),R===h&&M===d&&T===C&&_===P){r[f]!==1&&(l=Math.abs(r[f]));break}else b=T,g=_,T=R,_=M}}}return c}static#n(t,e,s,i){if(s-e<=4){for(let C=e;C<s-2;C+=2)i.push(t[C],t[C+1]);return}const n=t[e],r=t[e+1],a=t[s-4]-n,l=t[s-3]-r,c=Math.hypot(a,l),h=a/c,d=l/c,f=h*r-d*n,p=l/a,b=1/c,g=Math.atan(p),m=Math.cos(g),y=Math.sin(g),x=b*(Math.abs(m)+Math.abs(y)),w=b*(1-x+x**2),v=Math.max(Math.atan(Math.abs(y+m)*w),Math.atan(Math.abs(y-m)*w));let A=0,E=e;for(let C=e+2;C<s-2;C+=2){const P=Math.abs(f-h*t[C+1]+d*t[C]);P>A&&(E=C,A=P)}A>(c*v)**2?(this.#n(t,e,E+2,i),this.#n(t,E,s,i)):i.push(n,r)}static#o(t){const e=[],s=t.length;return this.#n(t,0,s,e),e.push(t[s-2],t[s-1]),e.length<=4?null:e}static#c(t,e,s,i,n,r){const a=new Float32Array(r**2),l=-2*i**2,c=r>>1;for(let g=0;g<r;g++){const m=(g-c)**2;for(let y=0;y<r;y++)a[g*r+y]=Math.exp((m+(y-c)**2)/l)}const h=new Float32Array(256),d=-2*n**2;for(let g=0;g<256;g++)h[g]=Math.exp(g**2/d);const f=t.length,p=new Uint8Array(f),b=new Uint32Array(256);for(let g=0;g<s;g++)for(let m=0;m<e;m++){const y=g*e+m,x=t[y];let w=0,v=0;for(let E=0;E<r;E++){const C=g+E-c;if(!(C<0||C>=s))for(let P=0;P<r;P++){const T=m+P-c;if(T<0||T>=e)continue;const _=t[C*e+T],k=a[E*r+P]*h[Math.abs(_-x)];w+=_*k,v+=k}}const A=p[y]=Math.round(w/v);b[A]++}return[p,b]}static#l(t){const e=new Uint32Array(256);for(const s of t)e[s]++;return e}static#u(t){const e=t.length,s=new Uint8ClampedArray(e>>2);let i=-1/0,n=1/0;for(let a=0,l=s.length;a<l;a++){const c=s[a]=t[a<<2];i=Math.max(i,c),n=Math.min(n,c)}const r=255/(i-n);for(let a=0,l=s.length;a<l;a++)s[a]=(s[a]-n)*r;return s}static#d(t){let e,s=-1/0,i=-1/0;const n=t.findIndex(l=>l!==0);let r=n,a=n;for(e=n;e<256;e++){const l=t[e];l>s&&(e-r>i&&(i=e-r,a=e-1),s=l,r=e)}for(e=a-1;e>=0&&!(t[e]>t[e+1]);e--);return e}static#f(t){const e=t,{width:s,height:i}=t,{maxDim:n}=this.#t;let r=s,a=i;if(s>n||i>n){let f=s,p=i,b=Math.log2(Math.max(s,i)/n);const g=Math.floor(b);b=b===g?g-1:g;for(let y=0;y<b;y++){r=Math.ceil(f/2),a=Math.ceil(p/2);const x=new OffscreenCanvas(r,a);x.getContext("2d").drawImage(t,0,0,f,p,0,0,r,a),f=r,p=a,t!==e&&t.close(),t=x.transferToImageBitmap()}const m=Math.min(n/r,n/a);r=Math.round(r*m),a=Math.round(a*m)}const c=new OffscreenCanvas(r,a).getContext("2d",{willReadFrequently:!0});c.fillStyle="white",c.fillRect(0,0,r,a),c.filter="grayscale(1)",c.drawImage(t,0,0,t.width,t.height,0,0,r,a);const h=c.getImageData(0,0,r,a).data;return[this.#u(h),r,a]}static extractContoursFromText(t,{fontFamily:e,fontStyle:s,fontWeight:i},n,r,a,l){let c=new OffscreenCanvas(1,1),h=c.getContext("2d",{alpha:!1});const d=200,f=h.font=`${s} ${i} ${d}px ${e}`,{actualBoundingBoxLeft:p,actualBoundingBoxRight:b,actualBoundingBoxAscent:g,actualBoundingBoxDescent:m,fontBoundingBoxAscent:y,fontBoundingBoxDescent:x,width:w}=h.measureText(t),v=1.5,A=Math.ceil(Math.max(Math.abs(p)+Math.abs(b)||0,w)*v),E=Math.ceil(Math.max(Math.abs(g)+Math.abs(m)||d,Math.abs(y)+Math.abs(x)||d)*v);c=new OffscreenCanvas(A,E),h=c.getContext("2d",{alpha:!0,willReadFrequently:!0}),h.font=f,h.filter="grayscale(1)",h.fillStyle="white",h.fillRect(0,0,A,E),h.fillStyle="black",h.fillText(t,A*(v-1)/2,E*(3-v)/2);const C=this.#u(h.getImageData(0,0,A,E).data),P=this.#l(C),T=this.#d(P),_=this.#r(C,A,E,T);return this.processDrawnLines({lines:{curves:_,width:A,height:E},pageWidth:n,pageHeight:r,rotation:a,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(t,e,s,i,n){const[r,a,l]=this.#f(t),[c,h]=this.#c(r,a,l,Math.hypot(a,l)*this.#t.sigmaSFactor,this.#t.sigmaR,this.#t.kernelSize),d=this.#d(h),f=this.#r(c,a,l,d);return this.processDrawnLines({lines:{curves:f,width:a,height:l},pageWidth:e,pageHeight:s,rotation:i,innerMargin:n,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:s,rotation:i,innerMargin:n,mustSmooth:r,areContours:a}){i%180!==0&&([e,s]=[s,e]);const{curves:l,width:c,height:h}=t,d=t.thickness??0,f=[],p=Math.min(e/c,s/h),b=p/e,g=p/s,m=[];for(const{points:x}of l){const w=r?this.#o(x):x;if(!w)continue;m.push(w);const v=w.length,A=new Float32Array(v),E=new Float32Array(3*(v===2?2:v-2));if(f.push({line:E,points:A}),v===2){A[0]=w[0]*b,A[1]=w[1]*g,E.set([NaN,NaN,NaN,NaN,A[0],A[1]],0);continue}let[C,P,T,_]=w;C*=b,P*=g,T*=b,_*=g,A.set([C,P,T,_],0),E.set([NaN,NaN,NaN,NaN,C,P],0);for(let k=4;k<v;k+=2){const R=A[k]=w[k]*b,M=A[k+1]=w[k+1]*g;E.set(L.createBezierPoints(C,P,T,_,R,M),(k-2)*3),[C,P,T,_]=[T,_,R,M]}}if(f.length===0)return null;const y=a?new Ii:new ds;return y.build(f,e,s,1,i,a?0:d,n),{outline:y,newCurves:m,areContours:a,thickness:d,width:c,height:h}}static async compressSignature({outlines:t,areContours:e,thickness:s,width:i,height:n}){let r=1/0,a=-1/0,l=0;for(const w of t){l+=w.length;for(let v=2,A=w.length;v<A;v++){const E=w[v]-w[v-2];r=Math.min(r,E),a=Math.max(a,E)}}let c;r>=-128&&a<=127?c=Int8Array:r>=-32768&&a<=32767?c=Int16Array:c=Int32Array;const h=t.length,d=Es+Ge*h,f=new Uint32Array(d);let p=0;f[p++]=d*Uint32Array.BYTES_PER_ELEMENT+(l-2*h)*c.BYTES_PER_ELEMENT,f[p++]=0,f[p++]=i,f[p++]=n,f[p++]=e?0:1,f[p++]=Math.max(0,Math.floor(s??0)),f[p++]=h,f[p++]=c.BYTES_PER_ELEMENT;for(const w of t)f[p++]=w.length-2,f[p++]=w[0],f[p++]=w[1];const b=new CompressionStream("deflate-raw"),g=b.writable.getWriter();await g.ready,g.write(f);const m=c.prototype.constructor;for(const w of t){const v=new m(w.length-2);for(let A=2,E=w.length;A<E;A++)v[A-2]=w[A]-w[A-2];g.write(v)}g.close();const y=await new Response(b.readable).arrayBuffer();return new Uint8Array(y).toBase64()}static async decompressSignature(t){try{const e=Uint8Array.fromBase64(t),{readable:s,writable:i}=new DecompressionStream("deflate-raw"),n=i.getWriter();await n.ready,n.write(e).then(async()=>{await n.ready,await n.close()}).catch(()=>{});let r=null,a=0;for await(const w of s)r||=new Uint8Array(new Uint32Array(w.buffer,0,4)[0]),r.set(w,a),a+=w.length;const l=new Uint32Array(r.buffer,0,r.length>>2),c=l[1];if(c!==0)throw new Error(`Invalid version: ${c}`);const h=l[2],d=l[3],f=l[4]===0,p=l[5],b=l[6],g=l[7],m=[],y=(Es+Ge*b)*Uint32Array.BYTES_PER_ELEMENT;let x;switch(g){case Int8Array.BYTES_PER_ELEMENT:x=new Int8Array(r.buffer,y);break;case Int16Array.BYTES_PER_ELEMENT:x=new Int16Array(r.buffer,y);break;case Int32Array.BYTES_PER_ELEMENT:x=new Int32Array(r.buffer,y);break}a=0;for(let w=0;w<b;w++){const v=l[Ge*w+Es],A=new Float32Array(v+2);m.push(A);for(let E=0;E<Ge-1;E++)A[E]=l[Ge*w+Es+E+1];for(let E=0;E<v;E++)A[E+2]=A[E]+x[a++]}return{areContours:f,thickness:p,outlines:m,width:h,height:d}}catch(e){return $(`decompressSignature: ${e}`),null}}}class hn extends Va{constructor(){super(),super.updateProperties({fill:F._defaultLineColor,"stroke-width":0})}clone(){const t=new hn;return t.updateAll(this),t}}class dn extends Js{constructor(t){super(t),super.updateProperties({stroke:F._defaultLineColor,"stroke-width":1})}clone(){const t=new dn(this._viewParameters);return t.updateAll(this),t}}class qt extends q{#t=!1;#e=null;#i=null;#s=null;static _type="signature";static _editorType=z.SIGNATURE;static _defaultDrawingOptions=null;constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#i=t.signatureData||null,this.#e=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,e){F.initialize(t,e),this._defaultDrawingOptions=new hn,this._defaultDrawnSignatureOptions=new dn(e.viewParameters)}static getDefaultDrawingOptions(t){const e=this._defaultDrawingOptions.clone();return e.updateProperties(t),e}static get supportMultipleDrawings(){return!1}static get typesMap(){return H(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#e}}static computeTelemetryFinalData(t){const e=t.get("hasDescription");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,e;const{_isCopy:s}=this;if(s&&(this._isCopy=!1,t=this.x,e=this.y),super.render(),this._drawId===null)if(this.#i){const{lines:i,mustSmooth:n,areContours:r,description:a,uuid:l,heightInPage:c}=this.#i,{rawDims:{pageWidth:h,pageHeight:d},rotation:f}=this.parent.viewport,p=ue.processDrawnLines({lines:i,pageWidth:h,pageHeight:d,rotation:f,innerMargin:qt._INNER_MARGIN,mustSmooth:n,areContours:r});this.addSignature(p,c,a,l)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#e||""}));return s&&(this._isCopy=!0,this._moveAfterPaste(t,e)),this.div}setUuid(t){this.#s=t,this.addEditToolbar()}getUuid(){return this.#s}get description(){return this.#e}set description(t){this.#e=t,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(e=>{e?.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:e,thickness:s,width:i,height:n}=this.#i,r=Math.max(i,n),a=ue.processDrawnLines({lines:{curves:t.map(l=>({points:l})),thickness:s,width:i,height:n},pageWidth:r,pageHeight:r,rotation:0,innerMargin:0,mustSmooth:!1,areContours:e});return{areContours:e,outline:a.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,e,s,i){const{x:n,y:r}=this,{outline:a}=this.#i=t;this.#t=a instanceof Ii,this.description=s;let l;this.#t?l=qt.getDefaultDrawingOptions():(l=qt._defaultDrawnSignatureOptions.clone(),l.updateProperties({"stroke-width":a.thickness})),this._addOutlines({drawOutlines:a,drawingOptions:l});const[,c]=this.pageDimensions;let h=e/c;h=h>=1?.5:h,this.width*=h/this.height,this.width>=1&&(h*=.9/this.width,this.width=.9),this.height=h,this.setDims(),this.x=n,this.y=r,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(i),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!i,hasDescription:!!s}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:e,pageHeight:s},rotation:i}=this.parent.viewport;return ue.process(t,e,s,i,qt._INNER_MARGIN)}getFromText(t,e){const{rawDims:{pageWidth:s,pageHeight:i},rotation:n}=this.parent.viewport;return ue.extractContoursFromText(t,e,s,i,n,qt._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:e,pageHeight:s},rotation:i}=this.parent.viewport;return ue.processDrawnLines({lines:t,pageWidth:e,pageHeight:s,rotation:i,innerMargin:qt._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:e}){t?this._drawingOptions=qt.getDefaultDrawingOptions():(this._drawingOptions=qt._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":e}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:e,points:s}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":i}}=this,n=Object.assign(super.serialize(t),{isSignature:!0,areContours:this.#t,color:[0,0,0],thickness:this.#t?0:i});return this.addComment(n),t?(n.paths={lines:e,points:s},n.uuid=this.#s,n.isCopy=!0):n.lines=e,this.#e&&(n.accessibilityData={type:"Figure",alt:this.#e}),n}static deserializeDraw(t,e,s,i,n,r){return r.areContours?Ii.deserialize(t,e,s,i,n,r):ds.deserialize(t,e,s,i,n,r)}static async deserialize(t,e,s){const i=await super.deserialize(t,e,s);return i.#t=t.areContours,i.description=t.accessibilityData?.alt||"",i.#s=t.uuid,i}}class Kd extends F{#t=null;#e=null;#i=null;#s=null;#a=null;#r="";#n=null;#o=!1;#c=null;#l=!1;#u=!1;static _type="stamp";static _editorType=z.STAMP;constructor(t){super({...t,name:"stampEditor"}),this.#s=t.bitmapUrl,this.#a=t.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,e){F.initialize(t,e)}static isHandlingMimeForPasting(t){return Ls.includes(t)}static paste(t,e){e.pasteEditor({mode:z.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(t){const e=t.get("hasAltText");return{hasAltText:e.get(!0)??0,hasNoAltText:e.get(!1)??0}}#d(t,e=!1){if(!t){this.remove();return}this.#t=t.bitmap,e||(this.#e=t.id,this.#l=t.isSvg),t.file&&(this.#r=t.file.name),this.#g()}#f(){if(this.#i=null,this._uiManager.enableWaiting(!1),!!this.#n){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#t){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(t=null,e=!0){if(this.hasAltTextData())return null;const{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:i,width:n,height:r}=t||this.copyCanvas(null,null,!0).imageData,a=await s.guess({name:"altText",request:{data:i,width:n,height:r,channels:i.length/(n*r)}});if(!a)throw new Error("No response from the AI service.");if(a.error)throw new Error("Error from the AI service.");if(a.cancel)return null;if(!a.output)throw new Error("No valid response from the AI service.");const l=a.output;return await this.setGuessedAltText(l),e&&!this.hasAltTextData()&&(this.altTextData={alt:l,decorative:!1}),l}#m(){if(this.#e){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#e).then(s=>this.#d(s,!0)).finally(()=>this.#f());return}if(this.#s){const s=this.#s;this.#s=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromUrl(s).then(i=>this.#d(i)).finally(()=>this.#f());return}if(this.#a){const s=this.#a;this.#a=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromFile(s).then(i=>this.#d(i)).finally(()=>this.#f());return}const t=document.createElement("input");t.type="file",t.accept=Ls.join(",");const e=this._uiManager._signal;this.#i=new Promise(s=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const i=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#d(i)}s()},{signal:e}),t.addEventListener("cancel",()=>{this.remove(),s()},{signal:e})}).finally(()=>this.#f()),t.click()}remove(){this.#e&&(this.#t=null,this._uiManager.imageManager.deleteId(this.#e),this.#n?.remove(),this.#n=null,this.#c&&(clearTimeout(this.#c),this.#c=null)),super.remove()}rebuild(){if(!this.parent){this.#e&&this.#m();return}super.rebuild(),this.div!==null&&(this.#e&&this.#n===null&&this.#m(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(this.#i||this.#t||this.#s||this.#a||this.#e||this.#o)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,e;return this._isCopy&&(t=this.x,e=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#o||(this.#t?this.#g():this.#m()),this._isCopy&&this._moveAfterPaste(t,e),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,e){const{id:s,bitmap:i}=this._uiManager.imageManager.getFromCanvas(t,e);e.remove(),s&&this._uiManager.imageManager.isValidId(s)&&(this.#e=s,i&&(this.#t=i),this.#o=!1,this.#g())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#c!==null&&clearTimeout(this.#c);const t=200;this.#c=setTimeout(()=>{this.#c=null,this.#p()},t)}#g(){const{div:t}=this;let{width:e,height:s}=this.#t;const[i,n]=this.pageDimensions,r=.75;if(this.width)e=this.width*i,s=this.height*n;else if(e>r*i||s>r*n){const l=Math.min(r*i/e,r*n/s);e*=l,s*=l}this._uiManager.enableWaiting(!1);const a=this.#n=document.createElement("canvas");a.setAttribute("role","img"),this.addContainer(a),this.width=e/i,this.height=s/n,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),this.#p(),this.#u||(this.parent.addUndoableEditor(this),this.#u=!0),this._reportTelemetry({action:"inserted_image"}),this.#r&&this.div.setAttribute("aria-description",this.#r),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(t,e,s=!1){t||(t=224);const{width:i,height:n}=this.#t,r=new zt;let a=this.#t,l=i,c=n,h=null;if(e){if(i>e||n>e){const E=Math.min(e/i,e/n);l=Math.floor(i*E),c=Math.floor(n*E)}h=document.createElement("canvas");const f=h.width=Math.ceil(l*r.sx),p=h.height=Math.ceil(c*r.sy);this.#l||(a=this.#h(f,p));const b=h.getContext("2d");b.filter=this._uiManager.hcmFilter;let g="white",m="#cfcfd8";this._uiManager.hcmFilter!=="none"?m="black":Sh.isDarkMode&&(g="#8f8f9d",m="#42414d");const y=15,x=y*r.sx,w=y*r.sy,v=new OffscreenCanvas(x*2,w*2),A=v.getContext("2d");A.fillStyle=g,A.fillRect(0,0,x*2,w*2),A.fillStyle=m,A.fillRect(0,0,x,w),A.fillRect(x,w,x,w),b.fillStyle=b.createPattern(v,"repeat"),b.fillRect(0,0,f,p),b.drawImage(a,0,0,a.width,a.height,0,0,f,p)}let d=null;if(s){let f,p;if(r.symmetric&&a.width<t&&a.height<t)f=a.width,p=a.height;else if(a=this.#t,i>t||n>t){const m=Math.min(t/i,t/n);f=Math.floor(i*m),p=Math.floor(n*m),this.#l||(a=this.#h(f,p))}const g=new OffscreenCanvas(f,p).getContext("2d",{willReadFrequently:!0});g.drawImage(a,0,0,a.width,a.height,0,0,f,p),d={width:f,height:p,data:g.getImageData(0,0,f,p).data}}return{canvas:h,width:l,height:c,imageData:d}}#h(t,e){const{width:s,height:i}=this.#t;let n=s,r=i,a=this.#t;for(;n>2*t||r>2*e;){const l=n,c=r;n>2*t&&(n=n>=16384?Math.floor(n/2)-1:Math.ceil(n/2)),r>2*e&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2));const h=new OffscreenCanvas(n,r);h.getContext("2d").drawImage(a,0,0,l,c,0,0,n,r),a=h.transferToImageBitmap()}return a}#p(){const[t,e]=this.parentDimensions,{width:s,height:i}=this,n=new zt,r=Math.ceil(s*t*n.sx),a=Math.ceil(i*e*n.sy),l=this.#n;if(!l||l.width===r&&l.height===a)return;l.width=r,l.height=a;const c=this.#l?this.#t:this.#h(r,a),h=l.getContext("2d");h.filter=this._uiManager.hcmFilter,h.drawImage(c,0,0,c.width,c.height,0,0,r,a)}#b(t){if(t){if(this.#l){const i=this._uiManager.imageManager.getSvgUrl(this.#e);if(i)return i}const e=document.createElement("canvas");return{width:e.width,height:e.height}=this.#t,e.getContext("2d").drawImage(this.#t,0,0),e.toDataURL()}if(this.#l){const[e,s]=this.pageDimensions,i=Math.round(this.width*e*ge.PDF_TO_CSS_UNITS),n=Math.round(this.height*s*ge.PDF_TO_CSS_UNITS),r=new OffscreenCanvas(i,n);return r.getContext("2d").drawImage(this.#t,0,0,this.#t.width,this.#t.height,0,0,i,n),r.transferToImageBitmap()}return structuredClone(this.#t)}static async deserialize(t,e,s){let i=null,n=!1;if(t instanceof Wa){const{data:{rect:g,rotation:m,id:y,structParent:x,popupRef:w,richText:v,contentsObj:A,creationDate:E,modificationDate:C},container:P,parent:{page:{pageNumber:T}},canvas:_}=t;let k,R;_?(delete t.canvas,{id:k,bitmap:R}=s.imageManager.getFromCanvas(P.id,_),_.remove()):(n=!0,t._hasNoCanvas=!0);const M=(await e._structTree.getAriaAttributes(`${Ee}${y}`))?.get("aria-label")||"";i=t={annotationType:z.STAMP,bitmapId:k,bitmap:R,pageIndex:T-1,rect:g.slice(0),rotation:m,annotationElementId:y,id:y,deleted:!1,accessibilityData:{decorative:!1,altText:M},isSvg:!1,structParent:x,popupRef:w,richText:v,comment:A?.str||null,creationDate:E,modificationDate:C}}const r=await super.deserialize(t,e,s),{rect:a,bitmap:l,bitmapUrl:c,bitmapId:h,isSvg:d,accessibilityData:f}=t;n?(s.addMissingCanvas(t.id,r),r.#o=!0):h&&s.imageManager.isValidId(h)?(r.#e=h,l&&(r.#t=l)):r.#s=c,r.#l=d;const[p,b]=r.pageDimensions;return r.width=(a[2]-a[0])/p,r.height=(a[3]-a[1])/b,f&&(r.altTextData=f),r._initialData=i,t.comment&&r.setCommentData(t),r.#u=!!i,r}serialize(t=!1,e=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=Object.assign(super.serialize(t),{bitmapId:this.#e,isSvg:this.#l});if(this.addComment(s),t)return s.bitmapUrl=this.#b(!0),s.accessibilityData=this.serializeAltText(!0),s.isCopy=!0,s;const{decorative:i,altText:n}=this.serializeAltText(!1);if(!i&&n&&(s.accessibilityData={type:"Figure",alt:n}),this.annotationElementId){const a=this.#x(s);return a.isSame?null:(a.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1,s.id=this.annotationElementId,delete s.bitmapId,s)}if(e===null)return s;e.stamps||=new Map;const r=this.#l?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!e.stamps.has(this.#e))e.stamps.set(this.#e,{area:r,serialized:s}),s.bitmap=this.#b(!1);else if(this.#l){const a=e.stamps.get(this.#e);r>a.area&&(a.area=r,a.serialized.bitmap.close(),a.serialized.bitmap=this.#b(!1))}return s}#x(t){const{pageIndex:e,accessibilityData:{altText:s}}=this._initialData,i=t.pageIndex===e,n=(t.accessibilityData?.alt||"")===s;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&i&&n,isSameAltText:n}}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class Jt{#t;#e=!1;#i=null;#s=null;#a=null;#r=new Map;#n=!1;#o=!1;#c=!1;#l=null;#u=null;#d=null;#f=null;#m=null;#g=-1;#h;static _initialized=!1;static#p=new Map([mt,cn,Kd,ct,qt].map(t=>[t._editorType,t]));constructor({uiManager:t,pageIndex:e,div:s,structTreeLayer:i,accessibilityManager:n,annotationLayer:r,drawLayer:a,textLayer:l,viewport:c,l10n:h}){const d=[...Jt.#p.values()];if(!Jt._initialized){Jt._initialized=!0;for(const f of d)f.initialize(h,t)}t.registerEditorTypes(d),this.#h=t,this.pageIndex=e,this.div=s,this.#t=n,this.#i=r,this.viewport=c,this.#d=l,this.drawLayer=a,this._structTree=i,this.#h.addLayer(this)}updatePageIndex(t){this.pageIndex=t}get isEmpty(){return this.#r.size===0}get isInvisible(){return this.isEmpty&&this.#h.getMode()===z.NONE}updateToolbar(t){this.#h.updateToolbar(t)}updateMode(t=this.#h.getMode()){switch(this.#v(),t){case z.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case z.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case z.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;if(e.toggle("nonEditing",!1),t===z.POPUP)e.toggle("commentEditing",!0);else{e.toggle("commentEditing",!1);for(const s of Jt.#p.values())e.toggle(`${s._type}Editing`,t===s._editorType)}this.div.hidden=!1}hasTextLayer(t){return t===this.#d?.div}setEditingState(t){this.#h.setEditingState(t)}addCommands(t){this.#h.addCommands(t)}cleanUndoStack(t){this.#h.cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){this.#i?.togglePointerEvents(t)}get#b(){return this.#r.size!==0?this.#r.values():this.#h.getEditors(this.pageIndex)}async enable(){this.#c=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#m?.abort(),this.#m=null;const t=new Set;for(const s of this.#b)s.enableEditing(),s.show(!0),s.annotationElementId&&(this.#h.removeChangedExistingAnnotation(s),t.add(s.annotationElementId));const e=this.#i;if(e)for(const s of e.getEditableAnnotations()){if(s.hide(),this.#h.isDeletedAnnotationElement(s.data.id)||t.has(s.data.id))continue;const i=await this.deserialize(s);i&&(this.addOrRebuild(i),i.enableEditing())}this.#c=!1,this.#h._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#d&&!this.#m){this.#m=new AbortController;const i=this.#h.combinedSignal(this.#m);this.#d.div.addEventListener("pointerdown",n=>{const{clientX:a,clientY:l,timeStamp:c}=n,h=this.#g;if(c-h>500){this.#g=c;return}this.#g=-1;const{classList:d}=this.div;d.toggle("getElements",!0);const f=document.elementsFromPoint(a,l);if(d.toggle("getElements",!1),!this.div.contains(f[0]))return;let p;const b=new RegExp(`^${Ze}[0-9]+$`);for(const m of f)if(b.test(m.id)){p=m.id;break}if(!p)return;const g=this.#r.get(p);g?.annotationElementId===null&&(n.stopPropagation(),n.preventDefault(),g.dblclick(n))},{signal:i,capture:!0})}const t=this.#i,e=[];if(t){const i=new Map,n=new Map;for(const a of this.#b){if(a.disableEditing(),!a.annotationElementId){e.push(a);continue}if(a.serialize()!==null){i.set(a.annotationElementId,a);continue}else n.set(a.annotationElementId,a);this.getEditableAnnotation(a.annotationElementId)?.show(),a.remove()}const r=t.getEditableAnnotations();for(const a of r){const{id:l}=a.data;if(this.#h.isDeletedAnnotationElement(l)){a.updateEdited({deleted:!0});continue}let c=n.get(l);if(c){c.resetAnnotationElement(a),c.show(!1),a.show();continue}c=i.get(l),c&&(this.#h.addChangedExistingAnnotation(c),c.renderAnnotationElement(a)&&c.show(!1)),a.show()}}this.#v(),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const i of Jt.#p.values())s.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),t?.updateFakeAnnotations(e),this.#o=!1}getEditableAnnotation(t){return this.#i?.getEditableAnnotation(t)||null}setActiveEditor(t){this.#h.getActive()!==t&&this.#h.setActiveEditor(t)}enableTextSelection(){if(this.div.tabIndex=-1,this.#d?.div&&!this.#f){this.#f=new AbortController;const t=this.#h.combinedSignal(this.#f);this.#d.div.addEventListener("pointerdown",this.#x.bind(this),{signal:t}),this.#d.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#d?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#d.div.classList.remove("highlighting"))}#x(t){this.#h.unselectAll();const{target:e}=t;if(e===this.#d.div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&this.#d.div.contains(e)){const{isMac:s}=ut.platform;if(t.button!==0||t.ctrlKey&&s)return;this.#h.showAllEditors("highlight",!0,!0),this.#d.div.classList.add("free"),this.toggleDrawing(),ct.startHighlighting(this,this.#h.direction==="ltr",{target:this.#d.div,x:t.x,y:t.y}),this.#d.div.addEventListener("pointerup",()=>{this.#d.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#h._signal}),t.preventDefault()}}enableClick(){if(this.#s)return;this.#s=new AbortController;const t=this.#h.combinedSignal(this.#s);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){this.#s?.abort(),this.#s=null}attach(t){this.#r.set(t.id,t);const{annotationElementId:e}=t;e&&this.#h.isDeletedAnnotationElement(e)&&this.#h.removeDeletedAnnotationElement(t)}detach(t){this.#r.delete(t.id),this.#t?.removePointerInTextLayer(t.contentDiv),!this.#o&&t.annotationElementId&&this.#h.addDeletedAnnotationElement(t)}remove(t){this.detach(t),this.#h.removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){t.parent!==this&&(t.parent&&t.annotationElementId&&(this.#h.addDeletedAnnotationElement(t),F.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),t.parent?.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),this.#h.addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!this.#c),this.#h.addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!this.#a&&(t._focusEventsAllowed=!1,this.#a=setTimeout(()=>{this.#a=null,t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this.#h._signal}),e.focus())},0)),t._structTreeParentId=this.#t?.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||=this,t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),s=()=>{t.remove()};this.addCommands({cmd:e,undo:s,mustExec:!1})}getEditorByUID(t){for(const e of this.#r.values())if(e.uid===t)return e;return null}getNextId(){return this.#h.getId()}get#y(){return Jt.#p.get(this.#h.getMode())}combinedSignal(t){return this.#h.combinedSignal(t)}#C(t){const e=this.#y;return e?new e.prototype.constructor(t):null}canCreateNewEmptyEditor(){return this.#y?.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await this.#h.updateMode(t.mode);const{offsetX:s,offsetY:i}=this.#S(),n=this.getNextId(),r=this.#C({parent:this,id:n,x:s,y:i,uiManager:this.#h,isCentered:!0,...e});r&&this.add(r)}async deserialize(t){return await Jt.#p.get(t.annotationType??t.annotationEditorType)?.deserialize(t,this,this.#h)||null}createAndAddNewEditor(t,e,s={}){const i=this.getNextId(),n=this.#C({parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:this.#h,isCentered:e,...s});return n&&this.add(n),n}get boundingClientRect(){return this.div.getBoundingClientRect()}#S(){const{x:t,y:e,width:s,height:i}=this.boundingClientRect,n=Math.max(0,t),r=Math.max(0,e),a=Math.min(window.innerWidth,t+s),l=Math.min(window.innerHeight,e+i),c=(n+a)/2-t,h=(r+l)/2-e,[d,f]=this.viewport.rotation%180===0?[c,h]:[h,c];return{offsetX:d,offsetY:f}}addNewEditor(t={}){this.createAndAddNewEditor(this.#S(),!0,t)}setSelected(t){this.#h.setSelected(t)}toggleSelected(t){this.#h.toggleSelected(t)}unselect(t){this.#h.unselect(t)}pointerup(t){const{isMac:e}=ut.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!this.#n||(this.#n=!1,this.#y?.isDrawer&&this.#y.supportMultipleDrawings))return;if(!this.#e){this.#e=!0;return}const s=this.#h.getMode();if(s===z.STAMP||s===z.SIGNATURE){this.#h.unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){if(this.#h.getMode()===z.HIGHLIGHT&&this.enableTextSelection(),this.#n){this.#n=!1;return}const{isMac:e}=ut.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(this.#n=!0,this.#y?.isDrawer){this.startDrawingSession(t);return}const s=this.#h.getActive();this.#e=!s||s.isEmpty()}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),this.#l){this.#y.startDrawing(this,this.#h,!1,t);return}this.#h.setCurrentDrawingSession(this),this.#l=new AbortController;const e=this.#h.combinedSignal(this.#l);this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(this.#u=null,this.commitOrRemove())},{signal:e}),this.#y.startDrawing(this,this.#h,!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&(this.#u=e);return}this.#u&&setTimeout(()=>{this.#u?.focus(),this.#u=null},0)}endDrawingSession(t=!1){return this.#l?(this.#h.setCurrentDrawingSession(null),this.#l.abort(),this.#l=null,this.#u=null,this.#y.endDrawing(t)):null}findNewParent(t,e,s){const i=this.#h.findParent(e,s);return i===null||i===this?!1:(i.changeParent(t),!0)}commitOrRemove(){return this.#l?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#l&&this.#y.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#h.getActive()?.parent===this&&(this.#h.commitOrRemove(),this.#h.setActiveEditor(null)),this.#a&&(clearTimeout(this.#a),this.#a=null);for(const t of this.#r.values())this.#t?.removePointerInTextLayer(t.contentDiv),t.setParent(null),t.isAttachedToDOM=!1,t.div.remove();this.div=null,this.#r.clear(),this.#h.removeLayer(this)}#v(){for(const t of this.#r.values())t.isEmpty()&&t.remove()}render({viewport:t}){this.viewport=t,oe(this.div,t);for(const e of this.#h.getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){this.#h.commitOrRemove(),this.#v();const e=this.viewport.rotation,s=t.rotation;if(this.viewport=t,oe(this.div,{rotation:s}),e!==s)for(const i of this.#r.values())i.rotate(s)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return this.#h.viewParameters.realScale}}class bt{#t=null;#e=new Map;#i=new Map;static#s=0;setParent(t){if(!this.#t){this.#t=t;return}if(this.#t!==t){if(this.#e.size>0)for(const e of this.#e.values())e.remove(),t.append(e);this.#t=t}}static get _svgFactory(){return H(this,"_svgFactory",new is)}static#a(t,[e,s,i,n]){const{style:r}=t;r.top=`${100*s}%`,r.left=`${100*e}%`,r.width=`${100*i}%`,r.height=`${100*n}%`}#r(){const t=bt._svgFactory.create(1,1,!0);return this.#t.append(t),t.setAttribute("aria-hidden",!0),t}#n(t,e){const s=bt._svgFactory.createElement("clipPath");t.append(s);const i=`clip_${e}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const n=bt._svgFactory.createElement("use");return s.append(n),n.setAttribute("href",`#${e}`),n.classList.add("clip"),i}#o(t,e){for(const[s,i]of Object.entries(e))i===null?t.removeAttribute(s):t.setAttribute(s,i)}draw(t,e=!1,s=!1){const i=bt.#s++,n=this.#r(),r=bt._svgFactory.createElement("defs");n.append(r);const a=bt._svgFactory.createElement("path");r.append(a);const l=`path_${i}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),e&&this.#i.set(i,a);const c=s?this.#n(r,l):null,h=bt._svgFactory.createElement("use");return n.append(h),h.setAttribute("href",`#${l}`),this.updateProperties(n,t),this.#e.set(i,n),{id:i,clipPathId:`url(#${c})`}}drawOutline(t,e){const s=bt.#s++,i=this.#r(),n=bt._svgFactory.createElement("defs");i.append(n);const r=bt._svgFactory.createElement("path");n.append(r);const a=`path_${s}`;r.setAttribute("id",a),r.setAttribute("vector-effect","non-scaling-stroke");let l;if(e){const d=bt._svgFactory.createElement("mask");n.append(d),l=`mask_${s}`,d.setAttribute("id",l),d.setAttribute("maskUnits","objectBoundingBox");const f=bt._svgFactory.createElement("rect");d.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const p=bt._svgFactory.createElement("use");d.append(p),p.setAttribute("href",`#${a}`),p.setAttribute("stroke","none"),p.setAttribute("fill","black"),p.setAttribute("fill-rule","nonzero"),p.classList.add("mask")}const c=bt._svgFactory.createElement("use");i.append(c),c.setAttribute("href",`#${a}`),l&&c.setAttribute("mask",`url(#${l})`);const h=c.cloneNode();return i.append(h),c.classList.add("mainOutline"),h.classList.add("secondaryOutline"),this.updateProperties(i,t),this.#e.set(s,i),s}finalizeDraw(t,e){this.#i.delete(t),this.updateProperties(t,e)}updateProperties(t,e){if(!e)return;const{root:s,bbox:i,rootClass:n,path:r}=e,a=typeof t=="number"?this.#e.get(t):t;if(a){if(s&&this.#o(a,s),i&&bt.#a(a,i),n){const{classList:l}=a;for(const[c,h]of Object.entries(n))l.toggle(c,h)}if(r){const c=a.firstElementChild.firstElementChild;this.#o(c,r)}}}updateParent(t,e){if(e===this)return;const s=this.#e.get(t);s&&(e.#t.append(s),this.#e.delete(t),e.#e.set(t,s))}remove(t){this.#i.delete(t),this.#t!==null&&(this.#e.get(t).remove(),this.#e.delete(t))}destroy(){this.#t=null;for(const t of this.#e.values())t.remove();this.#e.clear(),this.#i.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:Ni};globalThis.pdfjsLib={AbortException:ne,AnnotationEditorLayer:Jt,AnnotationEditorParamsType:V,AnnotationEditorType:z,AnnotationEditorUIManager:re,AnnotationLayer:Ks,AnnotationMode:ee,AnnotationType:lt,applyOpacity:ga,build:Ba,ColorPicker:Nt,createValidAbsoluteUrl:Xi,CSSConstants:pa,DOMSVGFactory:is,DrawLayer:bt,FeatureTest:ut,fetchData:Me,findContrastColor:ma,getDocument:Fa,getFilenameFromUrl:da,getPdfFilenameFromUrl:ua,getRGB:je,getUuid:qi,getXfaPageViewport:fa,GlobalWorkerOptions:pe,ImageKind:Ke,InvalidPDFException:Ds,isDataScheme:ls,isPdfFile:Ws,isValidExplicitDest:va,MathClamp:xt,noContextMenu:It,normalizeUnicode:ha,OPS:De,OutputScale:zt,PagesMapper:Y,PasswordResponses:ca,PDFDataRangeTransport:an,PDFDateString:Ns,PDFWorker:yt,PermissionFlag:la,PixelsPerInch:ge,RenderingCancelledException:zs,renderRichText:Ji,ResponseException:ts,setLayerDimensions:oe,shadow:H,SignatureExtractor:ue,stopEvent:nt,SupportedImageMimeTypes:Ls,TextLayer:_t,TouchManager:hs,updateUrlHash:Yi,Util:N,VerbosityLevel:as,version:Oa,XfaLayer:Ki};const Jd=Object.freeze(Object.defineProperty({__proto__:null,AbortException:ne,AnnotationEditorLayer:Jt,AnnotationEditorParamsType:V,AnnotationEditorType:z,AnnotationEditorUIManager:re,AnnotationLayer:Ks,AnnotationMode:ee,AnnotationType:lt,CSSConstants:pa,ColorPicker:Nt,DOMSVGFactory:is,DrawLayer:bt,FeatureTest:ut,GlobalWorkerOptions:pe,ImageKind:Ke,InvalidPDFException:Ds,MathClamp:xt,OPS:De,OutputScale:zt,PDFDataRangeTransport:an,PDFDateString:Ns,PDFWorker:yt,PagesMapper:Y,PasswordResponses:ca,PermissionFlag:la,PixelsPerInch:ge,RenderingCancelledException:zs,ResponseException:ts,SignatureExtractor:ue,SupportedImageMimeTypes:Ls,TextLayer:_t,TouchManager:hs,Util:N,VerbosityLevel:as,XfaLayer:Ki,applyOpacity:ga,build:Ba,createValidAbsoluteUrl:Xi,fetchData:Me,findContrastColor:ma,getDocument:Fa,getFilenameFromUrl:da,getPdfFilenameFromUrl:ua,getRGB:je,getUuid:qi,getXfaPageViewport:fa,isDataScheme:ls,isPdfFile:Ws,isValidExplicitDest:va,noContextMenu:It,normalizeUnicode:ha,renderRichText:Ji,setLayerDimensions:oe,shadow:H,stopEvent:nt,updateUrlHash:Yi,version:Oa},Symbol.toStringTag,{value:"Module"}));pe.workerPort=new Worker(new URL("/_astro/pdf.worker.min-CwpCpSQE.js",import.meta.url),{type:"module"});const cr=async o=>{try{let t="";for(let e=1;e<=o.numPages;e++){const n=(await(await o.getPage(e)).getTextContent()).items.map(r=>r.str).join(" ");t+=n+"\f"}return t}catch(t){return console.error("Error extracting text from PDF:",t),"PDF text content"}},hr=async o=>{let t;if(typeof o=="string")t=new TextEncoder().encode(o);else if(o instanceof ArrayBuffer)t=new Uint8Array(o);else if(o instanceof Uint8Array)t=o;else throw new Error("computeSHA256: unsupported input type");const e=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(e)).map(i=>i.toString(16).padStart(2,"0")).join("")};function Ms({pageCount:o,extractedText:t,pdfSizeBytes:e}){const s=String(t||""),n=s.split("\f").filter(r=>r!==void 0).slice(0,o).map(r=>String(r||"").trim().length);return{pageCount:o,charsPerPage:n,totalChars:s.replace(/\f/g,"").length,pdfSizeBytes:e||0}}const Xa=()=>{const[o,t]=S.useState(!1),[e,s]=S.useState(null),[i,n]=S.useState(null),[r,a]=S.useState(1),[l,c]=S.useState(1.5),[h,d]=S.useState(""),[f,p]=S.useState(null),[b,g]=S.useState(null),[m,y]=S.useState(!1),[x,w]=S.useState(""),[v,A]=S.useState(null);return S.useEffect(()=>{(async()=>{if(window.pdfjsLib){t(!0);return}try{const _=await Oi(()=>Promise.resolve().then(()=>Jd),[]);window.pdfjsLib=_,t(!0)}catch(_){console.error("Failed to load PDF.js:",_),A(_)}})()},[]),{pdfLibLoaded:o,pdfDoc:e,numPages:i,pageNumber:r,pageScale:l,pdfTextContent:h,docStats:f,docHash:b,isLoading:m,loadingMessage:x,loadError:v,loadPdfFromBlob:async T=>{if(!(!window.pdfjsLib||!T))try{y(!0),A(null);const _=T.name||"document";w(`Loading ${_}...`);const k=await T.arrayBuffer(),R=await hr(k);g(R);const O=await window.pdfjsLib.getDocument({data:k,onProgress:I=>{if(I.total>0){const W=Math.round(I.loaded/I.total*100);w(`Loading ${_}: ${W}%`)}}}).promise;s(O),n(O.numPages),w(`Extracting text from ${_}...`);const G=await cr(O);d(G);const D=Ms({pageCount:O.numPages,extractedText:G,pdfSizeBytes:k.byteLength});return p(D),a(1),w(""),{docHash:R,stats:D,text:G}}catch(_){throw console.error("Error loading PDF from blob:",_),A(_),w(""),_}finally{y(!1)}},loadTestPdf:async T=>{if(window.pdfjsLib)try{y(!0),A(null),w(`Loading ${T}...`);const _=`/test-docs/${T}`,k=await fetch(_);if(!k.ok)throw new Error(`Failed to fetch PDF: ${k.statusText}`);const R=await k.arrayBuffer(),M=await hr(R);g(M);const G=await window.pdfjsLib.getDocument({data:R,onProgress:W=>{if(W.total>0){const pt=Math.round(W.loaded/W.total*100);w(`Loading ${T}: ${pt}%`)}}}).promise;s(G),n(G.numPages),w(`Extracting text from ${T}...`);const D=await cr(G);d(D);const I=Ms({pageCount:G.numPages,extractedText:D,pdfSizeBytes:R.byteLength});return p(I),a(1),w(""),{docHash:M,stats:I,text:D,fileInfo:{name:T,size:R.byteLength,type:"application/pdf"}}}catch(_){throw console.error("Error loading test PDF:",_),A(_),w(""),_}finally{y(!1)}},navigation:{goToPreviousPage:()=>a(T=>Math.max(T-1,1)),goToNextPage:()=>a(T=>Math.min(T+1,i||1)),zoomIn:()=>c(T=>Math.min(T+.2,3)),zoomOut:()=>c(T=>Math.max(T-.2,.5)),setPageNumber:a,setPageScale:c}}};async function Qd({functions:o,docHash:t,text:e}){if(!o)throw new Error("Firebase functions not available");const s=Ut(o,"analyzeByType");if(typeof s!="function")throw new Error("analyzeByType callable not available");return(await s({docHash:t,text:e}))?.data}async function Zd({functions:o,docHash:t,stats:e}){if(!o)throw new Error("Firebase functions not available");const s=Ut(o,"preflightCheck");if(typeof s!="function")throw new Error("preflightCheck callable not available");return(await s({docHash:t,stats:e}))?.data}async function tu({functions:o,payload:t}){if(!o)throw new Error("Firebase functions not available");const e=Ut(o,"analyzeText");if(typeof e!="function")throw new Error("analyzeText callable not available");return await e(t)}const eu=({functions:o,authState:t,isMockMode:e})=>{const[s,i]=S.useState({}),[n,r]=S.useState(null),[a,l]=S.useState(!1),c=()=>e&&t.status==="authenticated"?!0:o&&t.status==="authenticated",h=async({pdfTextContent:m,numPages:y,selectedDocument:x,docHash:w})=>{if(!m||!y)return{ok:!0,classification:"OK"};if(e)return{ok:!0,classification:"OK"};if(!o)return console.error("Firebase functions not available. Returning default response."),{ok:!0,classification:"OK"};try{const v=Ms({pageCount:y,extractedText:m,pdfSizeBytes:x?.size||0});return await Zd({functions:o,docHash:w,stats:v})}catch(v){return console.error("Preflight check error:",v),{ok:!0,classification:"OK"}}};return{analysisResults:s,gate:n,setGate:r,isLoading:a,handleAnalyzeDocument:async({selectedDocument:m,pdfTextContent:y,docHash:x,numPages:w,updateAnnotations:v})=>{if(!(!m||!y||!x)){if(!c()){console.warn("Document analysis unavailable: Firebase services not accessible.");return}i(A=>({...A,[m.id]:{...A[m.id]||{},_meta:{status:"loading",message:"Running analysisâ€¦"}}})),l(!0);try{const A=await h({pdfTextContent:y,numPages:w,selectedDocument:m,docHash:x});if(!A.ok)throw console.error("Preflight check failed:",A),new Error(A.message||"Preflight check failed");if(A.classification==="PRO_REQUIRED"){const k=A.reasons?.map(R=>R.message).join(" ")||"This document requires Pro features (OCR / deeper processing).";i(R=>({...R,[m.id]:{...R[m.id]||{},_meta:{status:"error",message:k}}})),r({title:"Pro required",message:k,primaryLabel:"Upgrade to Pro",primaryTo:"/pricing",secondaryLabel:"Cancel",secondaryTo:null});return}const E=Ms({pageCount:w,extractedText:y,pdfSizeBytes:m?.size||0}),C=y.split("\f"),{charsPerPage:P,totalChars:T}=E;let _;if(e?_={data:await(await fetch("/analyzeText",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({docHash:x,stats:{pageCount:w,charsPerPage:P,totalChars:T,languageHint:"en"},text:{format:"paged",value:y},options:{tasks:["explain","caveats","inconsistencies"],targetLanguage:null}})})).json()}:_=await tu({functions:o,payload:{docHash:x,stats:{pageCount:w,charsPerPage:P,totalChars:T,languageHint:"en"},text:{format:"paged",value:y,pageTextIndex:C.map((k,R)=>({page:R+1,start:0,end:k.length}))},options:{tasks:["explain","caveats","inconsistencies"],targetLanguage:null}}}),_.data.ok){r(null);const k={_meta:{status:"success"},summary:_.data.result.plainExplanation,keyPoints:[],risks:_.data.result.risks.map(R=>({id:R.id,clause:R.title,riskLevel:R.severity,description:R.whyItMatters,explanation:R.whatToCheck.join("; ")})),recommendations:_.data.result.risks.flatMap(R=>R.whatToCheck||[])};i(R=>({...R,[m.id]:k})),v&&v(k)}else{const k=_.data.code;if(k==="SCAN_DETECTED_PRO_REQUIRED"){const R=_.data.message||"This PDF appears to be scanned. OCR is available on Pro.";i(M=>({...M,[m.id]:{...M[m.id]||{},_meta:{status:"error",message:R}}})),r({title:"Scanned PDF (OCR requires Pro)",message:R,primaryLabel:"Upgrade to Pro",primaryTo:"/pricing",secondaryLabel:"Cancel",secondaryTo:null});return}if(k==="ANON_TOKEN_LIMIT"){const R=_.data.message||"Anonymous token limit reached. Create a free account to continue.";i(M=>({...M,[m.id]:{...M[m.id]||{},_meta:{status:"error",message:R}}})),r({title:"Limit reached",message:R,primaryLabel:"Create free account",primaryTo:"/sign-in",secondaryLabel:"Cancel",secondaryTo:null});return}if(k==="FREE_TOKEN_LIMIT"){const R=_.data.message||"Daily token limit reached. Upgrade to Pro to continue.";i(M=>({...M,[m.id]:{...M[m.id]||{},_meta:{status:"error",message:R}}})),r({title:"Daily limit reached",message:R,primaryLabel:"Upgrade to Pro",primaryTo:"/pricing",secondaryLabel:"Cancel",secondaryTo:null});return}throw console.error("Analysis failed:",_.data),new Error(_.data.message||"Analysis failed")}}catch(A){console.error("Error analyzing document:",A),i(E=>({...E,[m.id]:{...E[m.id]||{},_meta:{status:"error",message:A?.message||"Analysis failed."}}})),r({title:"Analysis failed",message:A?.message||"Request failed.",primaryLabel:"OK",primaryTo:null,secondaryLabel:null,secondaryTo:null});return}finally{l(!1)}}},handleAnalyzeByType:async({selectedDocument:m,pdfTextContent:y,docHash:x})=>{if(!(!m||!y||!x)){if(!c()){console.warn("Type-specific analysis unavailable: Firebase services not accessible.");return}i(w=>({...w,[m.id]:{...w[m.id]||{},_meta:{status:"loading",message:"Running type-specific analysisâ€¦"}}})),l(!0);try{if(e){r({title:"Type-specific analysis (beta)",message:"Not available in mock mode yet.",primaryLabel:"OK",primaryTo:null,secondaryLabel:null,secondaryTo:null}),i(A=>({...A,[m.id]:{...A[m.id]||{},_meta:{status:"error",message:"Not available in mock mode yet."}}}));return}const w=await Qd({functions:o,docHash:x,text:y})||{},v={ok:!!w.ok,effectiveTypeId:w.effectiveTypeId||null,validationSlug:w.validationSlug||null,validationTitle:w.validationSpec?.title||null,message:w.message||null,result:w.result||null,usage:w.usage||null,requiredTier:w.requiredTier||null,code:w.code||null};i(A=>({...A,[m.id]:{...A[m.id]||{},_meta:{status:"success"},typeSpecific:v}})),r({title:"Type-specific analysis (beta)",message:`effectiveTypeId: ${v.effectiveTypeId||"null"}
validationSlug: ${v.validationSlug||"null"}

`+(v.validationTitle?`Spec: ${v.validationTitle}

`:"")+(v.message||""),primaryLabel:"OK",primaryTo:null,secondaryLabel:null,secondaryTo:null})}catch(w){console.error("analyzeByType error:",w),i(v=>({...v,[m.id]:{...v[m.id]||{},_meta:{status:"error",message:w?.message||"Request failed."}}})),r({title:"Type-specific analysis failed",message:w?.message||"Request failed.",primaryLabel:"OK",primaryTo:null,secondaryLabel:null,secondaryTo:null})}finally{l(!1)}}},handleExplainSelection:async({selectedDocument:m,docHash:y,pdfTextContent:x})=>{if(!m||!y)return;if(!c()){console.warn("Explain selection unavailable: Firebase services not accessible.");return}const w="Limitation of liability clause";try{let v;if(e?v={data:await(await fetch("/explainSelection",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({docHash:y,selection:w,documentContext:x})})).json()}:v=await Ut(o,"explainSelection")({docHash:y,selection:w,documentContext:x}),v.data.success)alert(`Explanation: ${v.data.explanation.plainExplanation}`);else throw console.error("Explanation failed:",v.data),new Error(v.data.error||"Explanation failed")}catch(v){throw console.error("Error explaining selection:",v),v}},handleHighlightRisks:async({selectedDocument:m,docHash:y,pdfTextContent:x,setRiskBadges:w})=>{if(!(!m||!y)){if(!c()){console.warn("Risk highlighting unavailable: Firebase services not accessible.");return}l(!0);try{let v;if(e?v={data:await(await fetch("/highlightRisks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({docHash:y,documentText:x,documentType:"contract"})})).json()}:v=await Ut(o,"highlightRisks")({docHash:y,documentText:x,documentType:"contract"}),v.data.success){alert(`Found ${v.data.risks.summary.totalRisks} risks in the document.`);const A=v.data.risks.items?.map((E,C)=>({id:C,pageNum:1,x:150+C*40,y:150+C*35,level:E.riskLevel,description:E.description,explanation:E.explanation}))||[];w(A)}else throw console.error("Risk highlighting failed:",v.data),new Error(v.data.error||"Risk highlighting failed")}catch(v){throw console.error("Error highlighting risks:",v),v}finally{l(!1)}}},handleTranslateToPlainEnglish:async({selectedDocument:m,docHash:y,pdfTextContent:x})=>{if(!(!m||!y)){if(!c()){console.warn("Translation unavailable: Firebase services not accessible.");return}try{const w=x.substring(0,500);let v;if(e?v={data:await(await fetch("/translateToPlainEnglish",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({docHash:y,legalText:w})})).json()}:v=await Ut(o,"translateToPlainEnglish")({docHash:y,legalText:w}),v.data.success)alert(`Original: ${v.data.translation.originalText}

Plain English: ${v.data.translation.plainEnglishTranslation}`);else throw console.error("Translation failed:",v.data),new Error(v.data.error||"Translation failed")}catch(w){throw console.error("Error translating to plain English:",w),w}}}}};async function su({functions:o,docHash:t,typeId:e}){if(!o)throw new Error("Firebase functions not available");const s=Ut(o,"saveDocTypeOverride");return typeof s!="function"?null:(await s({docHash:t,typeId:e}))?.data}async function iu({functions:o,docHash:t}){if(!o)throw new Error("Firebase functions not available");const e=Ut(o,"getDocumentTypeState");return typeof e!="function"?null:(await e({docHash:t}))?.data}async function nu({functions:o,docHash:t,stats:e,text:s}){if(!o)throw new Error("Firebase functions not available");const i=Ut(o,"detectDocumentType");return typeof i!="function"?null:(await i({docHash:t,stats:e,text:s}))?.data}const ru=({functions:o,isMockMode:t})=>{const[e,s]=S.useState("legal_contract_generic"),[i,n]=S.useState(null),[r,a]=S.useState(null),[l,c]=S.useState(null);return{detectedDocTypeId:e,detectedMeta:i,overrideDocTypeId:r,pendingOverride:l,setOverrideDocTypeId:a,setPendingOverride:c,loadServerTypeState:async b=>{if(!(!o||t))try{const g=await iu({functions:o,docHash:b})||{};g?.overrideTypeId&&a(g.overrideTypeId),g?.detected?.typeId&&s(g.detected.typeId),g?.detected&&n({intakeCategory:g.detected.intakeCategory||null,confidence:typeof g.detected.confidence=="number"?g.detected.confidence:null,model:g.detected.model||null,updatedAt:g.detected.updatedAt||null})}catch(g){console.warn("Failed to load server document type state",g)}},runServerDetection:async({docHashValue:b,stats:g,text:m})=>{if(!(!o||t))try{const y=await nu({functions:o,docHash:b,stats:g,text:m})||{};y?.typeId&&s(y.typeId),n({intakeCategory:y.intakeCategory||null,confidence:typeof y.confidence=="number"?y.confidence:null,model:y.model||"heuristic-v1",updatedAt:null})}catch(y){console.warn("Failed to detect document type",y)}},persistOverride:async(b,g)=>{try{localStorage.setItem(`decodocs:doctype:${b}`,String(g))}catch{}if(!(!o||t))try{await su({functions:o,docHash:b,typeId:g})}catch(m){console.warn("Failed to persist doc type override",m)}},loadLocalOverride:b=>{try{const g=localStorage.getItem(`decodocs:doctype:${b}`);g&&a(g)}catch{}},setDetectedDocTypeId:s}},au=async(o,t)=>{const s=await Ut(o,"storageCreateUploadUrl")(t);return s?.data||s},ou=async(o,t)=>{const s=await Ut(o,"storageCreateDownloadUrl")(t);return s?.data||s},lu=async({url:o,file:t,contentType:e})=>{const s=await fetch(o,{method:"PUT",headers:{"content-type":e},body:t});if(!s.ok)throw new Error(`Upload failed with status ${s.status}`)},cu=async o=>{const t=await fetch(o);if(!t.ok)throw new Error(`Download failed with status ${t.status}`);return t.blob()},mi=()=>{const{authState:o,app:t}=ce(),e=typeof window<"u"&&window.MOCK_AUTH,{documentId:s,fileName:i}=Hr(),n=At(),r=le(),a=S.useRef(null),l=t?ta(t):null,{pdfLibLoaded:c,pdfDoc:h,numPages:d,pageNumber:f,pageScale:p,pdfTextContent:b,docHash:g,isLoading:m,loadingMessage:y,loadPdfFromBlob:x,loadTestPdf:w,navigation:v}=Xa(),{analysisResults:A,gate:E,setGate:C,isLoading:P,handleAnalyzeDocument:T,handleAnalyzeByType:_,handleExplainSelection:k,handleHighlightRisks:R,handleTranslateToPlainEnglish:M}=eu({functions:l,authState:o,isMockMode:e}),{detectedDocTypeId:O,overrideDocTypeId:G,pendingOverride:D,setOverrideDocTypeId:I,setPendingOverride:W,loadServerTypeState:pt,runServerDetection:jt,persistOverride:at,loadLocalOverride:Z}=ru({functions:l,isMockMode:e}),[U,kt]=S.useState(null),[Gt,Qt]=S.useState([]),[ot,xe]=S.useState([]),[he,us]=S.useState([]),[Fe,de]=S.useState(!1),[Qs,un]=S.useState(!1),[fn,Ja]=S.useState(!0),[Pt,Ft]=S.useState("select"),[Qa,Za]=S.useState([]),[to,fs]=S.useState([]),[eo,pn]=S.useState(!1),[Oe,so]=S.useState(null),[gn,Zs]=S.useState(null),[ti,ps]=S.useState(!1),mn=m||P,{types:io}=oa(),bn=B=>io.find(j=>j.id===B)||null,yn=bn(G||O),no=bn(O),ro=yn?.validationSlug||null;hh(ro);const ao=B=>{v.setPageNumber(B)},oo=B=>{v.setPageNumber(B);const j=document.getElementById(`pdf-page-${B}`);j&&j.scrollIntoView({behavior:"smooth"})};S.useEffect(()=>{i&&c&&(async()=>{try{const j=await w(i);j&&(kt({id:i,name:i,type:"application/pdf",size:j.fileInfo?.size,file:null}),Z(j.docHash),await pt(j.docHash),jt({docHashValue:j.docHash,stats:j.stats,text:j.text}))}catch(j){C({title:"Could not load PDF",message:j?.message||"Failed to load test PDF.",primaryLabel:"OK",primaryTo:null,secondaryLabel:null,secondaryTo:null})}})()},[i,c]),S.useEffect(()=>{if(n.state?.document&&!i&&c){const B=n.state.document;kt(B),Zs(B?.cloudKey||null),(async()=>{try{const X=await x(B.file);X&&(Z(X.docHash),await pt(X.docHash),jt({docHashValue:X.docHash,stats:X.stats,text:X.text}))}catch{}})()}},[n,i,c]);const xn=B=>{const X=Array.from(B.target.files).filter(Rt=>Rt.type==="application/pdf");if(X.length>0){const Rt=X[0],ae={id:Date.now()+Math.random(),name:Rt.name,size:Rt.size,type:Rt.type,file:Rt};kt(ae),Zs(null),r("/view",{state:{document:ae}})}},lo=B=>String(B||"document.pdf").replace(/[^a-zA-Z0-9._-]/g,"_"),co=async()=>{if(l){if(!U?.file){C({title:"No local file to upload",message:"Open a local PDF first, then save it to DecoDocs cloud storage.",primaryLabel:"OK"});return}ps(!0);try{const B=`documents/${Date.now()}-${lo(U.name)}`,j=await au(l,{key:B,contentType:U.type||"application/pdf",expiresIn:600});await lu({url:j.url,file:U.file,contentType:U.type||"application/pdf"}),Zs(j.key),kt(X=>({...X||{},cloudKey:j.key})),C({title:"Saved to DecoDocs",message:`Document uploaded successfully.
Object key: ${j.key}`,primaryLabel:"OK"})}catch(B){const j=B?.code||"",X=String(j).includes("permission-denied");C({title:X?"Pro required":"Cloud upload failed",message:X?"Cloud storage is available for Pro plans. Upgrade to continue.":B?.message||"Unable to upload file to cloud storage.",primaryLabel:X?"View plans":"OK",primaryTo:X?"/pricing":null})}finally{ps(!1)}}},ho=async()=>{if(h){if(U?.file){const B=document.createElement("a");B.href=URL.createObjectURL(U.file),B.download=U?.name||"document.pdf",B.click();return}if(l&&gn){ps(!0);try{const B=await ou(l,{key:gn,expiresIn:600}),j=await cu(B.url),X=document.createElement("a");X.href=URL.createObjectURL(j),X.download=U?.name||"document.pdf",X.click();return}catch(B){C({title:"Download failed",message:B?.message||"Unable to download cloud document.",primaryLabel:"OK"})}finally{ps(!1)}}}},uo=()=>{U&&r(`/edit/${U.id}`,{state:{document:U}})},fo=B=>{const j=[];B.risks&&B.risks.length>0&&B.risks.forEach((X,Rt)=>{j.push({id:Rt,pageNum:1,x:100+Rt*50,y:100+Rt*40,level:X.riskLevel,description:X.description,explanation:X.explanation})}),us(j)},po=B=>{if(Pt==="select")return;const j=B.target.closest("[data-page-num]");if(!j)return;const X=parseInt(j.getAttribute("data-page-num"),10),Rt=j.getBoundingClientRect(),ae=B.clientX-Rt.left,Be=B.clientY-Rt.top;Pt==="signature"&&Oe?(Za(Zt=>[...Zt,{id:Date.now(),pageNum:X,x:ae,y:Be,width:Oe.width||200,height:Oe.height||60,...Oe}]),Ft("select")):Pt==="text"?(fs(Zt=>[...Zt,{id:Date.now(),pageNum:X,x:ae,y:Be,text:"Text",type:"text"}]),Ft("select")):Pt==="date"?(fs(Zt=>[...Zt,{id:Date.now(),pageNum:X,x:ae,y:Be,text:new Date().toLocaleDateString(),type:"date"}]),Ft("select")):Pt==="image"?(fs(Zt=>[...Zt,{id:Date.now(),pageNum:X,x:ae,y:Be,text:"ðŸ–¼ Image",type:"image"}]),Ft("select")):Pt==="checkmark"&&(fs(Zt=>[...Zt,{id:Date.now(),pageNum:X,x:ae,y:Be,text:"âœ“",type:"checkmark"}]),Ft("select"))},go=B=>u.jsxs(u.Fragment,{children:[Qa.filter(j=>j.pageNum===B).map(j=>u.jsx("div",{className:"absolute border-2 border-blue-500/40 bg-blue-50/20 flex items-center justify-center cursor-move rounded",style:{left:j.x,top:j.y,width:j.width,height:j.height,zIndex:50},onClick:X=>X.stopPropagation(),children:j.mode==="type"?u.jsx("span",{className:"text-slate-900 select-none",style:{fontFamily:j.fontFamily,fontSize:"1.5rem",lineHeight:1},children:j.text}):j.dataUrl?u.jsx("img",{src:j.dataUrl,alt:"Signature",className:"max-w-full max-h-full object-contain",draggable:!1}):u.jsx("span",{className:"text-blue-700 font-semibold italic text-lg",children:"Signature"})},j.id)),to.filter(j=>j.pageNum===B).map(j=>u.jsx("div",{className:`absolute px-2 py-1 text-sm shadow-sm cursor-move rounded ${j.type==="checkmark"?"text-green-700 text-2xl font-bold":j.type==="date"?"bg-amber-50 border border-amber-300 text-amber-800":j.type==="image"?"bg-purple-50 border border-purple-300 text-purple-700":"bg-yellow-100 border border-yellow-300 text-slate-800"}`,style:{left:j.x,top:j.y,zIndex:50},onClick:X=>X.stopPropagation(),children:j.text},j.id))]});return u.jsxs(Ht,{variant:"app",showFooter:!1,children:[u.jsx(ah,{open:eo,onClose:()=>pn(!1),onAdopt:B=>{so(B),Ft("signature")}}),E&&u.jsx("div",{id:"viewer-gate-dialog",role:"dialog","aria-modal":"true",className:"fixed inset-0 bg-slate-900/45 flex items-center justify-center z-[2000] p-4",onClick:()=>C(null),children:u.jsxs("div",{className:"bg-white rounded-xl border border-slate-200 max-w-[520px] w-full p-5 shadow-2xl",onClick:B=>B.stopPropagation(),children:[u.jsx("div",{className:"font-black text-base text-slate-900",children:E.title}),u.jsx("div",{className:"mt-2.5 text-slate-600 leading-relaxed whitespace-pre-wrap",children:E.message}),u.jsxs("div",{className:"mt-3.5 flex gap-2.5 flex-wrap justify-end",children:[E.secondaryLabel&&u.jsx("button",{type:"button",onClick:()=>{C(null),E.secondaryTo&&r(E.secondaryTo)},className:"px-3 py-2.5 rounded-xl border border-slate-200 bg-white font-black cursor-pointer hover:bg-slate-50 transition-colors",children:E.secondaryLabel}),E.primaryLabel&&u.jsx("button",{type:"button",onClick:async()=>{if(E._kind==="confirm-override"&&D&&g){const B=D.id;I(B),await at(g,B),W(null),C(null);return}C(null),E.primaryTo&&r(E.primaryTo)},className:"px-3 py-2.5 rounded-xl border border-slate-900 bg-slate-900 text-white font-black cursor-pointer hover:bg-slate-800 transition-colors",children:E.primaryLabel})]})]})}),u.jsx(ch,{open:Fe,detectedType:no,onClose:()=>de(!1),onPick:B=>{de(!1),W(B),C({title:"Confirm document type",message:`Set document type to â€œ${B.label}â€? This will change the actions/checks we show for this document.`,primaryLabel:"Confirm",primaryTo:null,secondaryLabel:"Cancel",secondaryTo:null,_kind:"confirm-override"})}}),u.jsxs("div",{id:"viewer-root",className:"flex flex-col flex-1 h-full overflow-hidden bg-slate-100",children:[h&&u.jsxs("div",{id:"viewer-toolbar",className:"flex flex-col bg-white border-b border-slate-200 z-20 relative",children:[u.jsxs("div",{id:"viewer-filename-bar",className:"h-11 px-4 flex items-center justify-between border-b border-slate-100/80",children:[u.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[u.jsx("span",{id:"viewer-filename",className:"font-semibold text-slate-800 text-sm truncate max-w-[320px]",children:U?.name||"Untitled Document"}),u.jsxs("div",{id:"viewer-quick-actions",className:"flex items-center gap-0.5 ml-1",children:[u.jsx("button",{id:"btn-share-link",onClick:()=>alert("Create a shareable link (coming soon)"),className:"p-1.5 rounded-md text-slate-400 hover:text-blue-600 hover:bg-blue-50 transition-colors",title:"Create a shareable link",children:u.jsx(vr,{className:"w-4 h-4"})}),u.jsx("button",{id:"btn-save-decodocs",onClick:co,className:"p-1.5 rounded-md text-slate-400 hover:text-emerald-600 hover:bg-emerald-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:ti?"Working...":"Save to DecoDocs",disabled:ti,children:u.jsx(xr,{className:"w-4 h-4"})})]})]}),u.jsxs("div",{id:"viewer-primary-actions",className:"flex items-center gap-2",children:[u.jsxs("button",{id:"btn-download",onClick:ho,className:"flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-xs font-semibold rounded-lg transition-colors shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",disabled:ti,children:[u.jsx(Ar,{className:"w-3.5 h-3.5"}),"Download"]}),u.jsxs("button",{id:"btn-finish",onClick:()=>{kt(null),r("/view")},className:"flex items-center gap-1.5 px-3 py-1.5 bg-slate-800 hover:bg-slate-900 text-white text-xs font-semibold rounded-lg transition-colors shadow-sm",children:["Finish",u.jsx(Co,{className:"w-3.5 h-3.5"})]})]})]}),u.jsxs("div",{id:"viewer-tools-bar",className:"h-10 px-4 flex items-center bg-slate-50/60",children:[u.jsx("div",{id:"viewer-doctype-bar",className:"flex items-center",children:u.jsxs("button",{id:"viewer-doctype-chip",onClick:()=>de(!0),className:"flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs font-medium text-slate-500 hover:text-slate-700 hover:bg-slate-100 transition-colors",title:"Click to change document type",children:[u.jsx("svg",{className:"w-3.5 h-3.5 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),u.jsx("span",{children:yn?.label||"Contract / agreement (general)"}),u.jsx("svg",{className:"w-3 h-3 text-slate-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]})}),u.jsx("div",{className:"w-px h-5 bg-slate-200 mx-3"}),u.jsxs("div",{id:"viewer-signing-tools",className:"flex items-center gap-0.5",children:[u.jsx(ve,{active:Pt==="select",icon:Sr,label:"Select",onClick:()=>Ft("select")}),u.jsx("div",{className:"w-px h-4 bg-slate-200 mx-1"}),u.jsx(ve,{active:Pt==="signature",icon:Mi,label:"Sign",onClick:()=>{Oe?Ft("signature"):pn(!0)}}),u.jsx(ve,{active:Pt==="text",icon:Er,label:"Text",onClick:()=>Ft("text")}),u.jsx(ve,{active:Pt==="date",icon:To,label:"Date",onClick:()=>Ft("date")}),u.jsx(ve,{active:Pt==="image",icon:js,label:"Image",onClick:()=>Ft("image")}),u.jsx(ve,{active:Pt==="checkmark",icon:_o,label:"Check",onClick:()=>Ft("checkmark")})]})]})]}),u.jsxs("div",{id:"viewer-content",className:"flex flex-1 overflow-hidden relative",children:[u.jsxs("div",{id:"viewer-canvas-area",className:"flex-1 flex flex-col items-center justify-start overflow-hidden relative",children:[h?u.jsxs("div",{className:"w-full flex-1 relative flex overflow-hidden",children:[u.jsx(aa,{pdfDoc:h,numPages:d,currentPage:f,onPageClick:oo}),u.jsx("div",{id:"viewer-scroll-area",className:`flex-1 overflow-auto bg-slate-100/50 relative ${Pt!=="select"?"cursor-crosshair":""}`,onClick:po,children:u.jsx(na,{pdfDoc:h,numPages:d,pageScale:p,isLoading:mn,loadingMessage:y,onPageVisible:ao,highlights:Gt,clauseMarkers:ot,riskBadges:he,renderPageOverlay:go})})]}):u.jsx("div",{className:"flex-1 flex items-center justify-center w-full",children:u.jsx(ra,{onFileSelect:xn})}),h&&u.jsx(ia,{onFileSelect:xn,onEdit:uo,pageNumber:f,numPages:d,pageScale:p,onPreviousPage:v.goToPreviousPage,onNextPage:v.goToNextPage,onZoomIn:v.zoomIn,onZoomOut:v.zoomOut,fileInputRef:a})]}),u.jsx(Zc,{isOpen:fn,onToggle:()=>Ja(!fn),onAnalyzeDocument:()=>T({selectedDocument:U,pdfTextContent:b,docHash:g,numPages:d,updateAnnotations:fo}),onAnalyzeByType:()=>_({selectedDocument:U,pdfTextContent:b,docHash:g}),onExplainSelection:()=>k({selectedDocument:U,docHash:g,pdfTextContent:b}),onHighlightRisks:()=>R({selectedDocument:U,docHash:g,pdfTextContent:b,setRiskBadges:us}),onTranslateToPlainEnglish:()=>M({selectedDocument:U,docHash:g,pdfTextContent:b}),isLoading:mn,isAuthenticated:o.status==="authenticated",hasDocument:!!U,selectedDocument:U,analysisResults:A})]})]})]})},ve=({active:o,icon:t,label:e,onClick:s})=>u.jsxs("button",{onClick:s,title:e,className:`flex items-center gap-1 px-2 py-1.5 rounded-md text-xs font-medium transition-all ${o?"bg-slate-200/80 text-slate-800":"text-slate-400 hover:bg-slate-100 hover:text-slate-700"}`,children:[u.jsx(t,{className:"w-4 h-4"}),u.jsx("span",{className:"hidden sm:inline",children:e})]}),dr=()=>{const{documentId:o}=Hr(),t=At(),e=le(),s=S.useRef(null),{pdfLibLoaded:i,pdfDoc:n,numPages:r,pageNumber:a,pageScale:l,isLoading:c,loadingMessage:h,loadPdfFromBlob:d,loadTestPdf:f,navigation:p}=Xa(),[b,g]=S.useState(null),[m,y]=S.useState("select"),[x,w]=S.useState([]),[v,A]=S.useState([]),[E]=S.useState({width:150,height:50});S.useEffect(()=>{if(t.state?.document&&!n&&i){const _=t.state.document;g(_),_.file&&d(_.file).catch(console.error)}else if(t.pathname.includes("test-docs")&&i&&!n){t.pathname.split("/");const _=t.pathname.split("/").pop();_.endsWith(".pdf")&&f(_).then(k=>{k&&g({name:_,id:"test-doc",type:"application/pdf"})})}else if(o&&i&&!n&&!t.pathname.includes("test-docs")){const _={id:o,name:`Document_${o}.pdf`,type:"application/pdf",file:null};g(_)}},[t,o,i,n,d,f]);const C=_=>{if(m==="select")return;const k=_.target.closest("[data-page-num]");if(!k)return;const R=parseInt(k.getAttribute("data-page-num"),10),M=k.getBoundingClientRect(),O=_.clientX-M.left,G=_.clientY-M.top;if(m==="signature"){const D={id:Date.now(),pageNum:R,x:O,y:G,width:E.width,height:E.height,text:"John Doe",type:"signature"};w([...x,D]),y("select")}else if(m==="text"){const D={id:Date.now(),pageNum:R,x:O,y:G,text:"Type something...",type:"text"};A([...v,D]),y("select")}else if(m==="date"){const D={id:Date.now(),pageNum:R,x:O,y:G,text:new Date().toLocaleDateString(),type:"date"};A([...v,D]),y("select")}},P=_=>{const R=Array.from(_.target.files).filter(M=>M.type==="application/pdf");if(R.length>0){const M=R[0],O={id:Date.now(),name:M.name,size:M.size,type:M.type,file:M};g(O),d(M)}},T=_=>u.jsxs(u.Fragment,{children:[x.filter(k=>k.pageNum===_).map(k=>u.jsx("div",{className:"absolute border-2 border-blue-500 bg-blue-50/20 flex items-center justify-center cursor-move",style:{left:k.x,top:k.y,width:k.width,height:k.height,zIndex:50},onClick:R=>R.stopPropagation(),children:u.jsx("span",{className:"text-blue-700 font-script text-xl font-bold",children:k.text})},k.id)),v.filter(k=>k.pageNum===_).map(k=>u.jsx("div",{className:"absolute bg-yellow-100 border border-yellow-300 px-2 py-1 text-sm shadow-sm cursor-move",style:{left:k.x,top:k.y,zIndex:50},onClick:R=>R.stopPropagation(),children:k.text},k.id))]});return u.jsx(Ht,{variant:"app",showFooter:!1,children:u.jsxs("div",{className:"flex flex-col h-full bg-slate-100",children:[u.jsxs("div",{className:"flex flex-col bg-white border-b border-slate-200 z-20 relative font-sans",children:[u.jsxs("div",{className:"h-14 px-4 flex items-center justify-between border-b border-slate-100",children:[u.jsx("div",{className:"flex items-center gap-3 min-w-0",children:u.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[u.jsx("span",{className:"font-bold text-slate-800 text-base truncate max-w-[250px]",children:b?.name||"Untitled Document"}),u.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[u.jsxs("button",{onClick:()=>alert("Upgrade to Pro to share links!"),className:"flex items-center gap-1.5 px-2.5 py-1 text-xs font-semibold text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors border border-blue-100",children:[u.jsx(vr,{className:"w-3.5 h-3.5"})," Share"]}),u.jsxs("button",{onClick:()=>alert("Upgrade to Pro to upload to cloud!"),className:"flex items-center gap-1.5 px-2.5 py-1 text-xs font-semibold text-slate-600 bg-slate-50 hover:bg-slate-100 rounded-lg transition-colors border border-slate-200",children:[u.jsx(mr,{className:"w-3.5 h-3.5"})," Upload"]})]})]})}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("button",{onClick:()=>e("/view"),className:"px-3 py-1.5 text-slate-600 text-sm font-semibold hover:bg-slate-100 rounded-lg transition-colors",children:"Cancel"}),u.jsxs("button",{className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg transition-all shadow-sm",children:["Finish & Download ",u.jsx(Ar,{className:"w-4 h-4"})]})]})]}),u.jsxs("div",{className:"h-12 flex items-center justify-center gap-1 bg-slate-50/50",children:[u.jsx(Ve,{active:m==="select",icon:Sr,label:"Select",onClick:()=>y("select"),tooltip:"Select & Move"}),u.jsx("div",{className:"w-px h-5 bg-slate-300 mx-1"}),u.jsx(Ve,{active:m==="text",icon:Er,label:"Text",onClick:()=>y("text"),tooltip:"Add Text"}),u.jsx(Ve,{active:m==="signature",icon:Mi,label:"Sign",onClick:()=>y("signature"),tooltip:"Create Signature"}),u.jsx(Ve,{active:m==="image",icon:js,label:"Image",onClick:()=>y("image"),tooltip:"Insert Image"}),u.jsx(Ve,{active:m==="shape",icon:ko,label:"Shapes",onClick:()=>y("shape"),tooltip:"Add Shapes"})]})]}),u.jsxs("div",{className:"flex-1 flex overflow-hidden relative",children:[n&&u.jsx(aa,{pdfDoc:n,numPages:r,currentPage:a,onPageClick:_=>{p.setPageNumber(_);const k=document.getElementById(`pdf-page-${_}`);k&&k.scrollIntoView({behavior:"smooth"})}}),u.jsx("div",{className:"flex-1 overflow-auto p-8 flex justify-center relative bg-slate-100/50",children:n?u.jsx("div",{className:"w-full flex justify-center",style:{minHeight:"100%"},onClick:C,children:u.jsx(na,{pdfDoc:n,numPages:r,pageScale:l,isLoading:c,loadingMessage:h,onPageVisible:_=>p.setPageNumber(_),renderPageOverlay:T})}):u.jsx("div",{className:"flex-1 flex items-center justify-center w-full",children:u.jsx(ra,{onFileSelect:P})})}),u.jsx(ia,{onFileSelect:P,onEdit:()=>{},pageNumber:a,numPages:r,pageScale:l,onPreviousPage:p.goToPreviousPage,onNextPage:p.goToNextPage,onZoomIn:p.zoomIn,onZoomOut:p.zoomOut,fileInputRef:s})]})]})})},Ve=({active:o,icon:t,label:e,onClick:s,tooltip:i})=>u.jsx("button",{onClick:s,title:i||e,className:`flex items-center justify-center p-2.5 rounded-lg transition-all relative ${o?"bg-slate-200/80 text-slate-800":"bg-transparent text-slate-500 hover:bg-slate-200/50 hover:text-slate-800"}`,children:u.jsx(t,{className:"w-5 h-5"})}),hu=()=>u.jsx("section",{className:"about-page",children:u.jsx("div",{className:"about-main",children:u.jsxs("div",{className:"about-container",children:[u.jsxs("section",{className:"about-header",children:[u.jsx("h1",{children:"About DecoDocs"}),u.jsx("p",{children:"DecoDocs is a document intelligence product designed to help people understand what they are about to sign. Before any signature, DecoDocs explains documents in plain language, highlights caveats and unfair conditions, flags logical inconsistencies, and provides translations when needed. Our focus is clarity before commitment."})]}),u.jsxs("section",{className:"product-philosophy",children:[u.jsx("h2",{children:"What We Believe"}),u.jsxs("ul",{className:"philosophy-list",children:[u.jsx("li",{children:"Documents should be understood before being signed"}),u.jsx("li",{children:"AI should reduce information asymmetry, not introduce new ones"}),u.jsx("li",{children:"Free users deserve real value, not crippled features"}),u.jsx("li",{children:"We charge only for real costs: deeper analysis and storage"}),u.jsx("li",{children:"Documents belong to users, not platforms"})]})]}),u.jsxs("section",{className:"scope-definition",children:[u.jsx("h2",{children:"What DecoDocs Is â€” and Is Not"}),u.jsxs("div",{className:"scope-columns",children:[u.jsxs("div",{className:"scope-column",children:[u.jsx("h3",{children:"Is"}),u.jsxs("ul",{children:[u.jsx("li",{children:"Pre-signature document analysis"}),u.jsx("li",{children:"Plain-language explanation"}),u.jsx("li",{children:"Caveat and unfair-condition detection"}),u.jsx("li",{children:"Logical inconsistency checks"}),u.jsx("li",{children:"Ephemeral processing by default"})]})]}),u.jsxs("div",{className:"scope-column",children:[u.jsx("h3",{children:"Is Not"}),u.jsxs("ul",{children:[u.jsx("li",{children:"A document editor"}),u.jsx("li",{children:"A document management system"}),u.jsx("li",{children:'A "sign now, think later" tool'}),u.jsx("li",{children:"A storage-first SaaS"}),u.jsx("li",{children:"A replacement for legal advice"})]})]})]})]}),u.jsxs("section",{className:"decodocs-clarification",children:[u.jsx("h2",{children:"How It Relates To SnapSign"}),u.jsx("p",{children:"Snap Sign Pty Ltd builds DecoDocs. SnapSign is the company brand and broader product family; DecoDocs is the document understanding and analysis product in that family."})]}),u.jsxs("section",{className:"team-company",children:[u.jsx("h2",{children:"Company"}),u.jsx("p",{children:"SnapSign is built by a small, focused team with backgrounds in software engineering, automation, and privacy-first systems. We prioritize correctness, transparency, and long-term maintainability."}),u.jsxs("div",{className:"legal-block",children:[u.jsx("p",{children:"Snap Sign Pty Ltd"}),u.jsx("p",{children:"ABN 72 679 570 757"}),u.jsx("p",{children:"Australia"})]})]}),u.jsxs("section",{className:"collaboration-contact",children:[u.jsx("h2",{children:"Collaboration"}),u.jsx("p",{children:"We welcome serious collaboration and partnership enquiries. For certain discussions, a Non-Disclosure Agreement (NDA) may be required before sharing internal details."}),u.jsx("div",{className:"contact-info",children:u.jsxs("p",{children:["Email: ",u.jsx("a",{href:"mailto:partnerships@snapsign.com.au",children:"partnerships@snapsign.com.au"})]})})]})]})})}),du=()=>u.jsxs("section",{className:"mx-auto w-full max-w-4xl px-6 py-16",children:[u.jsx("h1",{className:"text-3xl font-semibold text-slate-900",children:"Privacy Policy"}),u.jsx("p",{className:"mt-4 text-sm text-slate-600",children:"Last updated: 1 February 2026"}),u.jsxs("div",{className:"mt-10 space-y-6 text-slate-700 leading-relaxed",children:[u.jsx("p",{children:'DecoDocs ("we", "us") is built by Snap Sign Pty Ltd. This policy explains what data is processed when you use DecoDocs, what is stored, and what choices you have.'}),u.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"What we process"}),u.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[u.jsx("li",{children:"PDF file metadata (filename, size) and content needed to render and analyze the document."}),u.jsx("li",{children:"Extracted text used to generate summaries, explanations, and risk highlights."}),u.jsx("li",{children:"Basic usage events (e.g. button clicks) to understand product performance."})]}),u.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Storage (Free vs Pro)"}),u.jsxs("p",{children:[u.jsx("strong",{children:"Free:"})," we aim to avoid storing your files. Documents are opened for viewing and analysis without persistent storage."]}),u.jsxs("p",{children:[u.jsx("strong",{children:"Pro (optional):"})," secure storage may be available for users who explicitly choose to save documents for later access."]}),u.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Retention"}),u.jsx("p",{children:"We retain only what is necessary to operate the service. Where storage is enabled (e.g. Pro), retention and deletion controls will be provided."}),u.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Your controls"}),u.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[u.jsx("li",{children:"You can choose whether to use free (no-storage) workflows or paid storage features when available."}),u.jsx("li",{children:"You can contact us to request deletion or export of stored data where applicable."})]}),u.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Contact"}),u.jsxs("p",{children:["Questions or requests: ",u.jsx("a",{className:"underline",href:"mailto:team@snapsign.com.au",children:"team@snapsign.com.au"})]})]})]}),uu=()=>u.jsxs("section",{className:"mx-auto w-full max-w-4xl px-6 py-16",children:[u.jsx("h1",{className:"text-3xl font-semibold text-slate-900",children:"Terms of Service"}),u.jsx("p",{className:"mt-4 text-sm text-slate-600",children:"Last updated: 1 February 2026"}),u.jsxs("div",{className:"mt-10 space-y-6 text-slate-700 leading-relaxed",children:[u.jsx("p",{children:"These terms govern use of DecoDocs provided by Snap Sign Pty Ltd. By using the service, you agree to these terms."}),u.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Not legal advice"}),u.jsx("p",{children:"DecoDocs provides informational analysis and is not legal advice. For legal decisions, consult a qualified professional."}),u.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Acceptable use"}),u.jsxs("ul",{className:"list-disc pl-6 space-y-2",children:[u.jsx("li",{children:"Do not upload content you do not have the right to process."}),u.jsx("li",{children:"Do not attempt to abuse, probe, or disrupt the service."}),u.jsx("li",{children:"Do not use the service for illegal activity."})]}),u.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Availability and changes"}),u.jsx("p",{children:"The service may change over time. We may add, modify, or remove features. We may suspend access to protect the service or comply with law."}),u.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Limitation of liability"}),u.jsx("p",{children:"To the maximum extent permitted by law, Snap Sign Pty Ltd is not liable for indirect or consequential losses arising from use of the service."}),u.jsx("h2",{className:"text-xl font-semibold text-slate-900",children:"Contact"}),u.jsxs("p",{children:["Questions: ",u.jsx("a",{className:"underline",href:"mailto:team@snapsign.com.au",children:"team@snapsign.com.au"})]})]})]}),fu=()=>{const o="mailto:contact@snapsign.com?subject="+encodeURIComponent("DecoDocs signing waitlist");return u.jsxs("section",{className:"mx-auto w-full max-w-3xl px-6 py-16",children:[u.jsx("h1",{className:"text-3xl font-semibold text-slate-900",children:"Contact"}),u.jsxs("p",{className:"mt-4 text-slate-700",children:["For support, partnerships, or product feedback, email us at"," ",u.jsx("a",{className:"underline",href:"mailto:team@snapsign.com.au",children:"team@snapsign.com.au"}),"."]}),u.jsxs("div",{className:"mt-10 rounded-2xl border border-slate-200 bg-white p-6",children:[u.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Signing waitlist"}),u.jsx("p",{className:"mt-2 text-slate-700",children:"Want the signing workflow? Join the waitlist and tell us your use case."}),u.jsx("a",{className:"mt-4 inline-flex rounded-full bg-slate-900 px-5 py-2 text-sm font-semibold text-white",href:o,children:"Join the waitlist"})]})]})},Xe=o=>{try{return new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD",maximumFractionDigits:0}).format(o)}catch{return`$${o} AUD`}},bi=({items:o})=>u.jsx("ul",{style:{margin:0,paddingLeft:18,color:"#0f172a",lineHeight:1.7},children:o.map(t=>u.jsx("li",{style:{marginBottom:6},children:t},t))});function pu(){const t="test".toLowerCase()!=="live",e=le(),s=At(),{authState:i}=ce(),n=S.useMemo(()=>new URLSearchParams(s.search),[s.search]),r=n.get("billing")==="annual"?"annual":"monthly",[a,l]=S.useState(r),[c,h]=S.useState(null),[d,f]=S.useState(null),p=S.useRef(!1),b=S.useMemo(()=>{const v=a==="annual"?{label:Xe(60),suffix:"/year"}:{label:Xe(5),suffix:"/month"},A=a==="annual"?{label:Xe(600),suffix:"/year"}:{label:Xe(50),suffix:"/month"};return{pro:v,business:A}},[a]),g=async(v,A=a)=>{if(f(null),h(v),!i?.user||i?.user?.isAnonymous){const E=new URLSearchParams({intent:"upgrade",plan:v,billing:A});t&&E.set("sandbox","1"),e(`/sign-in?${E.toString()}`),h(null);return}try{const{getFunctions:E,httpsCallable:C}=await Oi(async()=>{const{getFunctions:R,httpsCallable:M}=await Promise.resolve().then(()=>sa);return{getFunctions:R,httpsCallable:M}},void 0),P=E(),k=(await C(P,"stripeCreateCheckoutSession")({billing:A,plan:v}))?.data?.url;if(!k)throw new Error("No checkout URL returned");window.location.assign(k)}catch(E){f(`Could not start Stripe checkout: ${E?.message||E}`),h(null)}};S.useEffect(()=>{const v=n.get("stripe");if(v==="cancel"){f("Stripe checkout was canceled. Your account was not charged.");return}if(v==="success"){f("Stripe checkout completed. We are finalizing your subscription status from webhook events.");return}if(t||n.get("sandbox")==="1"){f("Sandbox mode is active. Use Stripe test cards only.");return}f(null)},[t,n]),S.useEffect(()=>{if(p.current||n.get("autoCheckout")!=="1")return;const v=n.get("plan")==="business"?"business":"pro",A=n.get("billing")==="annual"?"annual":"monthly";a!==A&&l(A),p.current=!0,g(v,A)},[i?.user,a,n]);const m=()=>e("/sign-in"),y={padding:"2.5rem 1.5rem",maxWidth:1100,margin:"0 auto"},x={border:"1px solid #e2e8f0",borderRadius:14,background:"#fff",padding:18},w=v=>({padding:"8px 12px",borderRadius:999,border:`1px solid ${v?"#0f172a":"#e2e8f0"}`,background:v?"#0f172a":"#ffffff",color:v?"#ffffff":"#0f172a",fontWeight:700,fontSize:13,cursor:"pointer"});return u.jsxs("div",{style:y,children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,flexWrap:"wrap",alignItems:"center"},children:[u.jsxs("div",{children:[u.jsx("h1",{style:{margin:0},children:"Pricing"}),u.jsx("p",{style:{marginTop:10,marginBottom:0,color:"#334155",lineHeight:1.6},children:"Compare Free, Pro, and Business plans. Enterprise is available for larger teams."})]}),u.jsxs("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[u.jsx("button",{type:"button",onClick:()=>l("monthly"),style:w(a==="monthly"),children:"Monthly"}),u.jsx("button",{type:"button",onClick:()=>l("annual"),style:w(a==="annual"),children:"Annual"})]})]}),u.jsx("div",{style:{marginTop:16,padding:14,borderRadius:12,background:"#eff6ff",border:"1px solid #bfdbfe",color:"#1e3a8a",lineHeight:1.65},children:"DecoDocs is publicly available for anonymous trial use. You can open a PDF and test the core experience instantly, then create a free account when you want higher daily limits and cross-device continuity."}),d&&u.jsx("div",{style:{marginTop:16,padding:12,borderRadius:12,background:"#fff7ed",border:"1px solid #fed7aa",color:"#9a3412"},children:d}),u.jsxs("div",{style:{marginTop:22,display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(260px, 1fr))",gap:14},children:[u.jsxs("div",{style:x,children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"},children:[u.jsx("div",{style:{fontWeight:800,fontSize:16},children:"Free"}),u.jsxs("div",{style:{fontWeight:800,fontSize:18},children:[Xe(0),u.jsx("span",{style:{color:"#64748b",fontWeight:600,fontSize:12},children:"/forever"})]})]}),u.jsx("p",{style:{marginTop:10,color:"#475569",lineHeight:1.6},children:"Create an account to get a bigger daily budget and manage linked sign-in methods."}),u.jsx("button",{type:"button",onClick:m,style:{width:"100%",marginTop:8,padding:"10px 14px",borderRadius:12,border:"1px solid #0f172a",background:"#0f172a",color:"#fff",fontWeight:900,cursor:"pointer"},children:"Continue for free"}),u.jsx("div",{style:{marginTop:14},children:u.jsx(bi,{items:["AI analysis: 40k tokens/day per uid","Text-only PDFs (no OCR)","No storage with us (browser-only)","Link providers (Google/Email/Apple/Microsoft)"]})})]}),u.jsxs("div",{style:{...x,borderColor:"#0f172a"},children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"},children:[u.jsx("div",{style:{fontWeight:900,fontSize:16},children:"Pro"}),u.jsxs("div",{style:{fontWeight:900,fontSize:18},children:[b.pro.label,u.jsx("span",{style:{color:"#64748b",fontWeight:600,fontSize:12},children:b.pro.suffix})]})]}),u.jsx("p",{style:{marginTop:10,color:"#475569",lineHeight:1.6},children:"OCR for scanned PDFs, unlimited analysis (for now), better model, and 5GB storage."}),u.jsx("button",{type:"button",onClick:()=>g("pro",a),disabled:c!==null,style:{width:"100%",marginTop:8,padding:"10px 14px",borderRadius:12,border:"1px solid #0f172a",background:"#0f172a",color:"#fff",fontWeight:900,cursor:"pointer"},children:c==="pro"?"Opening checkout...":"Upgrade to Pro"}),u.jsx("div",{style:{marginTop:14},children:u.jsx(bi,{items:["Unlimited AI (until abuse policy exists)","OCR / vision model for scanned PDFs","5GB storage (Contabo VPS)","Receipts + subscription management in /profile"]})})]}),u.jsxs("div",{style:x,children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"baseline"},children:[u.jsx("div",{style:{fontWeight:900,fontSize:16},children:"Business"}),u.jsxs("div",{style:{fontWeight:900,fontSize:18},children:[b.business.label,u.jsx("span",{style:{color:"#64748b",fontWeight:600,fontSize:12},children:b.business.suffix})]})]}),u.jsx("p",{style:{marginTop:10,color:"#475569",lineHeight:1.6},children:"Team plan for up to 5 worker accounts with shared billing and team visibility."}),u.jsx("button",{type:"button",onClick:()=>g("business",a),disabled:c!==null,style:{width:"100%",marginTop:8,padding:"10px 14px",borderRadius:12,border:"1px solid #0f172a",background:"#0f172a",color:"#fff",fontWeight:900,cursor:"pointer"},children:c==="business"?"Opening checkout...":"Start Business"}),u.jsx("div",{style:{marginTop:14},children:u.jsx(bi,{items:["Everything in Pro","Up to 5 worker accounts","Shared billing + seat management","Admin visibility across team docs"]})})]})]}),u.jsxs("div",{style:{marginTop:18,padding:16,borderRadius:12,background:"#f8fafc",border:"1px solid #e2e8f0"},children:[u.jsx("div",{style:{fontWeight:900,marginBottom:8},children:"Enterprise"}),u.jsxs("div",{style:{color:"#475569",lineHeight:1.7},children:["Need more than ",u.jsx("strong",{children:"5 worker accounts"}),"? Enterprise is for larger teams that need custom security, controls, and contracting. Contact us for seat-based pricing."]}),u.jsx("div",{style:{marginTop:8},children:u.jsx(ht,{to:"/contact",style:{color:"#0f172a",fontWeight:800},children:"Contact sales"})})]}),u.jsxs("div",{style:{marginTop:22,display:"flex",gap:12,flexWrap:"wrap"},children:[u.jsx(ht,{to:"/view",style:{color:"#0f172a",fontWeight:800},children:"Start anonymous trial"}),u.jsx(ht,{to:"/profile",style:{color:"#0f172a",fontWeight:800},children:"Go to profile"}),u.jsx(ht,{to:"/terms",style:{color:"#475569",fontWeight:700},children:"Terms"}),u.jsx(ht,{to:"/privacy",style:{color:"#475569",fontWeight:700},children:"Privacy"})]}),u.jsxs("div",{style:{marginTop:22,padding:16,borderRadius:12,background:"#f8fafc",border:"1px solid #e2e8f0"},children:[u.jsx("div",{style:{fontWeight:900,marginBottom:8},children:"Notes"}),u.jsxs("div",{style:{color:"#475569",lineHeight:1.7},children:["Weâ€™ll prompt you to upgrade when you hit limits or when a scanned/OCR-required document is detected. Paid checkout requires a non-anonymous account, and account linking is handled via ",u.jsx("code",{children:"/sign-in"}),"."]})]})]})}function Ya(o){return ji({attr:{version:"1.1",x:"0px",y:"0px",viewBox:"0 0 48 48",enableBackground:"new 0 0 48 48"},child:[{tag:"path",attr:{fill:"#FFC107",d:`M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12\r
	c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24\r
	c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z`},child:[]},{tag:"path",attr:{fill:"#FF3D00",d:`M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657\r
	C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z`},child:[]},{tag:"path",attr:{fill:"#4CAF50",d:`M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36\r
	c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z`},child:[]},{tag:"path",attr:{fill:"#1976D2",d:`M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571\r
	c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z`},child:[]}]})(o)}function qa(o){return ji({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M747.4 535.7c-.4-68.2 30.5-119.6 92.9-157.5-34.9-50-87.7-77.5-157.3-82.8-65.9-5.2-138 38.4-164.4 38.4-27.9 0-91.7-36.6-141.9-36.6C273.1 298.8 163 379.8 163 544.6c0 48.7 8.9 99 26.7 150.8 23.8 68.2 109.6 235.3 199.1 232.6 46.8-1.1 79.9-33.2 140.8-33.2 59.1 0 89.7 33.2 141.9 33.2 90.3-1.3 167.9-153.2 190.5-221.6-121.1-57.1-114.6-167.2-114.6-170.7zm-105.1-305c50.7-60.2 46.1-115 44.6-134.7-44.8 2.6-96.6 30.5-126.1 64.8-32.5 36.8-51.6 82.3-47.5 133.6 48.4 3.7 92.6-21.2 129-63.7z"},child:[]}]})(o)}function Ka(o){return ji({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 32h214.6v214.6H0V32zm233.4 0H448v214.6H233.4V32zM0 265.4h214.6V480H0V265.4zm233.4 0H448V480H233.4V265.4z"},child:[]}]})(o)}const gu=()=>{const{search:o}=At();return S.useMemo(()=>new URLSearchParams(o),[o])},ur=({children:o})=>u.jsx("div",{style:{border:"1px solid #e2e8f0",borderRadius:14,background:"#fff",padding:18},children:o});function mu(){const{authState:o,auth:t,signInWithGoogle:e,signInWithMicrosoft:s,signInWithApple:i,signInWithEmail:n,signUpWithEmail:r,resetPassword:a}=ce(),l=le(),c=gu(),[h,d]=S.useState(""),[f,p]=S.useState(""),[b,g]=S.useState({kind:"idle",message:""}),m=o?.user||null,y=!!m?.isAnonymous,x=c.get("intent"),w=c.get("plan")==="business"?"business":"pro",v=c.get("billing")==="annual"?"annual":"monthly",A=c.get("sandbox")==="1"?"1":null,E=S.useMemo(()=>{if(x!=="upgrade")return"/profile";const R=new URLSearchParams({autoCheckout:"1",plan:w,billing:v});return A&&R.set("sandbox",A),`/pricing?${R.toString()}`},[x,A,v,w]),C=async(R,M)=>{g({kind:"loading",message:"Opening sign-inâ€¦"});try{if(!t)throw new Error("Auth is not available");if(t.currentUser)await kr(t.currentUser,R);else if(M)await M();else throw new Error("No active session. Refresh and try again.");g({kind:"ok",message:"Signed in. Your accounts are linked."}),l(E)}catch(O){const G=O?.code||"";if(G==="auth/credential-already-in-use"||G==="auth/email-already-in-use"){g({kind:"error",message:"That account is already used elsewhere. Please sign out and sign in with that provider, then link the others from your profile."});return}g({kind:"error",message:O?.message||"Sign-in failed."})}},P=async()=>{g({kind:"loading",message:"Signing inâ€¦"});try{if(!h||!f)throw new Error("Email and password are required.");if(t.currentUser&&y){const R=Pr.credential(h,f);await Rr(t.currentUser,R),g({kind:"ok",message:"Email linked and signed in."})}else await n(h,f),g({kind:"ok",message:"Signed in."});l(E)}catch(R){g({kind:"error",message:R?.message||"Email sign-in failed."})}},T=async()=>{g({kind:"loading",message:"Creating accountâ€¦"});try{if(!h||!f)throw new Error("Email and password are required.");if(String(f).length<10)throw new Error("Password must be at least 10 characters.");await r(h,f),g({kind:"ok",message:"Account created and signed in."}),l(E)}catch(R){g({kind:"error",message:R?.message||"Email sign-up failed."})}},_=async()=>{g({kind:"loading",message:"Sending reset emailâ€¦"});try{if(!h)throw new Error("Enter your email first.");await a(h),g({kind:"ok",message:"Password reset email sent (if the account exists)."})}catch(R){g({kind:"error",message:R?.message||"Password reset failed."})}},k=x==="upgrade"?"Sign in to upgrade":"Sign in";return S.useEffect(()=>{o.status==="authenticated"&&!y&&l(E,{replace:!0})},[o.status,y,l,E]),o.status==="authenticated"&&!y?u.jsx("div",{children:"Redirecting..."}):u.jsxs("div",{style:{padding:"2.5rem 1.5rem",maxWidth:900,margin:"0 auto"},children:[u.jsx("h1",{style:{marginTop:0},children:k}),u.jsx("p",{style:{marginTop:10,color:"#475569",lineHeight:1.6},children:"We support Google, Email, Apple, and Microsoft. Linking is universal â€” you can attach multiple providers to one account."}),x==="upgrade"&&u.jsxs("p",{style:{marginTop:8,color:"#1e3a8a",lineHeight:1.6},children:["Next step after sign-in: start ",w==="business"?"Business":"Pro"," checkout (",v," billing)."]}),b.kind!=="idle"&&u.jsx("div",{className:"error",style:{marginTop:14,padding:12,borderRadius:12,border:"1px solid "+(b.kind==="error"?"#fecaca":"#bbf7d0"),background:b.kind==="error"?"#fef2f2":"#f0fdf4",color:b.kind==="error"?"#991b1b":"#166534"},children:b.message}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(260px, 1fr))",gap:14,marginTop:16},children:[u.jsxs(ur,{children:[u.jsx("div",{style:{fontWeight:900},children:"Continue with a provider"}),u.jsxs("div",{style:{marginTop:12,display:"grid",gap:10},children:[u.jsxs("button",{type:"button",onClick:()=>C(new _r,e),style:{padding:"10px 12px",borderRadius:12,border:"1px solid #e2e8f0",background:"#fff",color:"#0f172a",fontWeight:800,cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx(Ya,{size:20}),"Continue with Google"]}),u.jsxs("button",{type:"button",onClick:()=>C(new _s("apple.com"),i),style:{padding:"10px 12px",borderRadius:12,border:"1px solid #e2e8f0",background:"#fff",color:"#0f172a",fontWeight:800,cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx(qa,{size:20}),"Continue with Apple"]}),u.jsxs("button",{type:"button",onClick:()=>C(new _s("microsoft.com"),s),style:{padding:"10px 12px",borderRadius:12,border:"1px solid #e2e8f0",background:"#fff",color:"#0f172a",fontWeight:800,cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx(Ka,{size:20}),"Continue with Microsoft"]})]})]}),u.jsxs(ur,{children:[u.jsx("div",{style:{fontWeight:900},children:"Sign in with email"}),u.jsxs("div",{style:{marginTop:10,display:"grid",gap:10},children:[u.jsx("input",{value:h,onChange:R=>d(R.target.value),placeholder:"Email",style:{padding:10,borderRadius:12,border:"1px solid #e2e8f0"}}),u.jsx("input",{value:f,onChange:R=>p(R.target.value),placeholder:"Password",type:"password",style:{padding:10,borderRadius:12,border:"1px solid #e2e8f0"}}),u.jsxs("div",{style:{display:"grid",gap:10},children:[u.jsx("button",{type:"button",onClick:P,style:{padding:"10px 12px",borderRadius:12,border:"1px solid #0f172a",background:"#0f172a",color:"#fff",fontWeight:900,cursor:"pointer"},children:"Sign In"}),u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",fontSize:14},children:[u.jsx("button",{type:"button",onClick:T,style:{background:"none",border:"none",color:"#0f172a",textDecoration:"underline",cursor:"pointer",fontWeight:600},children:"Create account"}),u.jsx("button",{type:"button",onClick:_,style:{background:"none",border:"none",color:"#0f172a",textDecoration:"underline",cursor:"pointer",fontWeight:600},children:"Reset password"})]})]})]})]})]}),u.jsxs("div",{style:{marginTop:18,display:"flex",gap:12,flexWrap:"wrap"},children:[u.jsx(ht,{to:"/pricing",style:{color:"#0f172a",fontWeight:800},children:"Back to pricing"}),u.jsx(ht,{to:"/",style:{color:"#475569",fontWeight:700},children:"Home"})]}),u.jsxs("div",{style:{marginTop:18,padding:14,borderRadius:12,background:"#f8fafc",border:"1px solid #e2e8f0"},children:[u.jsx("div",{style:{fontWeight:900,marginBottom:6},children:"Current session"}),u.jsxs("div",{style:{color:"#475569",lineHeight:1.7},children:["Status: ",u.jsx("strong",{children:o?.status}),u.jsx("br",{}),"UID: ",u.jsx("code",{children:m?.uid||"n/a"}),u.jsx("br",{}),"Anonymous: ",u.jsx("strong",{children:String(y)})]})]})]})}const bu=()=>{const{search:o}=At();return S.useMemo(()=>new URLSearchParams(o),[o])},fr=({children:o})=>u.jsx("div",{style:{border:"1px solid #e2e8f0",borderRadius:14,background:"#fff",padding:18},children:o});function yu(){const{authState:o,auth:t,signInWithGoogle:e,signInWithMicrosoft:s,signInWithApple:i,signUpWithEmail:n}=ce(),r=le(),a=bu(),[l,c]=S.useState(""),[h,d]=S.useState(""),[f,p]=S.useState(""),[b,g]=S.useState({kind:"idle",message:""}),m=o?.user||null,y=!!m?.isAnonymous,x=a.get("intent"),w=a.get("plan")==="business"?"business":"pro",v=a.get("billing")==="annual"?"annual":"monthly",A=a.get("sandbox")==="1"?"1":null,E=S.useMemo(()=>{if(x!=="upgrade")return"/profile";const T=new URLSearchParams({autoCheckout:"1",plan:w,billing:v});return A&&T.set("sandbox",A),`/pricing?${T.toString()}`},[x,A,v,w]),C=async(T,_)=>{g({kind:"loading",message:"Opening sign-inâ€¦"});try{if(!t)throw new Error("Auth is not available");if(t.currentUser)await kr(t.currentUser,T);else if(_)await _();else throw new Error("No active session. Refresh and try again.");g({kind:"ok",message:"Signed in. Your accounts are linked."}),r(E)}catch(k){const R=k?.code||"";if(R==="auth/credential-already-in-use"||R==="auth/email-already-in-use"){g({kind:"error",message:"That account is already used elsewhere. Please sign out and sign in with that provider, then link the others from your profile."});return}g({kind:"error",message:k?.message||"Sign-in failed."})}};if(S.useEffect(()=>{o.status==="authenticated"&&!y&&r(E,{replace:!0})},[o.status,y,r,E]),o.status==="authenticated"&&!y)return u.jsx("div",{children:"Redirecting..."});const P=async()=>{g({kind:"loading",message:"Creating accountâ€¦"});try{if(!l||!h||!f)throw new Error("Email and passwords are required.");if(h!==f)throw new Error("Passwords do not match.");if(String(h).length<10)throw new Error("Password must be at least 10 characters.");if(t.currentUser&&y){const T=Pr.credential(l,h);await Rr(t.currentUser,T),g({kind:"ok",message:"Account created and linked."})}else await n(l,h),g({kind:"ok",message:"Account created."});r(E)}catch(T){g({kind:"error",message:T?.message||"Account creation failed."})}};return u.jsxs("div",{style:{padding:"2.5rem 1.5rem",maxWidth:900,margin:"0 auto"},children:[u.jsx("h1",{style:{marginTop:0},children:"Sign up"}),u.jsx("p",{style:{marginTop:10,color:"#475569",lineHeight:1.6},children:"Create your DecoDocs account to get started."}),x==="upgrade"&&u.jsxs("p",{style:{marginTop:8,color:"#1e3a8a",lineHeight:1.6},children:["Next step after sign-up: start ",w==="business"?"Business":"Pro"," checkout (",v," billing)."]}),u.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(260px, 1fr))",gap:14,marginTop:16},children:[u.jsxs(fr,{children:[u.jsx("div",{style:{fontWeight:900},children:"Continue with a provider"}),u.jsxs("div",{style:{marginTop:12,display:"grid",gap:10},children:[u.jsxs("button",{type:"button",onClick:()=>C(new _r,e),style:{padding:"10px 12px",borderRadius:12,border:"1px solid #e2e8f0",background:"#fff",color:"#0f172a",fontWeight:800,cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx(Ya,{size:20}),"Continue with Google"]}),u.jsxs("button",{type:"button",onClick:()=>C(new _s("apple.com"),i),style:{padding:"10px 12px",borderRadius:12,border:"1px solid #e2e8f0",background:"#fff",color:"#0f172a",fontWeight:800,cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx(qa,{size:20}),"Continue with Apple"]}),u.jsxs("button",{type:"button",onClick:()=>C(new _s("microsoft.com"),s),style:{padding:"10px 12px",borderRadius:12,border:"1px solid #e2e8f0",background:"#fff",color:"#0f172a",fontWeight:800,cursor:"pointer",display:"flex",alignItems:"center",gap:"8px"},children:[u.jsx(Ka,{size:20}),"Continue with Microsoft"]})]})]}),u.jsxs(fr,{children:[u.jsx("div",{style:{fontWeight:900},children:"Create account"}),u.jsxs("div",{style:{marginTop:10,display:"grid",gap:10},children:[u.jsx("input",{value:l,onChange:T=>c(T.target.value),placeholder:"Email",style:{padding:10,borderRadius:12,border:"1px solid #e2e8f0"}}),u.jsx("input",{value:h,onChange:T=>d(T.target.value),placeholder:"Password",type:"password",style:{padding:10,borderRadius:12,border:"1px solid #e2e8f0"}}),u.jsx("input",{value:f,onChange:T=>p(T.target.value),placeholder:"Confirm password",type:"password",style:{padding:10,borderRadius:12,border:"1px solid #e2e8f0"}}),u.jsx("button",{type:"button",onClick:P,style:{padding:"10px 12px",borderRadius:12,border:"1px solid #0f172a",background:"#0f172a",color:"#fff",fontWeight:900,cursor:"pointer"},children:"Create account"})]}),u.jsx("div",{style:{color:"#64748b",fontSize:13,lineHeight:1.5,marginTop:10},children:"Recommended password minimum: 10 chars. If an email already exists and linking fails, sign out then sign in using that email."})]})]}),b.kind!=="idle"&&u.jsx("div",{className:"error",style:{marginTop:14,padding:12,borderRadius:12,border:"1px solid "+(b.kind==="error"?"#fecaca":"#bbf7d0"),background:b.kind==="error"?"#fef2f2":"#f0fdf4",color:b.kind==="error"?"#991b1b":"#166534"},children:b.message}),u.jsxs("div",{style:{marginTop:18,display:"flex",gap:12,flexWrap:"wrap"},children:[u.jsx(ht,{to:"/pricing",style:{color:"#0f172a",fontWeight:800},children:"Back to pricing"}),u.jsx(ht,{to:"/",style:{color:"#475569",fontWeight:700},children:"Home"})]}),u.jsxs("div",{style:{marginTop:18,padding:14,borderRadius:12,background:"#f8fafc",border:"1px solid #e2e8f0"},children:[u.jsx("div",{style:{fontWeight:900,marginBottom:6},children:"Current session"}),u.jsxs("div",{style:{color:"#475569",lineHeight:1.7},children:["Status: ",u.jsx("strong",{children:o?.status}),u.jsx("br",{}),"UID: ",u.jsx("code",{children:m?.uid||"n/a"}),u.jsx("br",{}),"Anonymous: ",u.jsx("strong",{children:String(y)})]})]})]})}function xu(){const{authState:o,auth:t}=ce(),e=le(),s=At(),i=S.useMemo(()=>new URLSearchParams(s.search),[s.search]),n=o?.user,[r,a]=S.useState(null);S.useEffect(()=>{const h=i.get("stripe");if(h==="success"){a("Stripe checkout completed. If billing status does not update yet, wait a few seconds for webhook sync and refresh.");return}if(h==="cancel"){a("Stripe checkout was canceled.");return}a(null)},[i]);const l=async()=>{t&&(await Wo(t),window.location.reload())},c=async()=>{a(null);try{const{getFunctions:h,httpsCallable:d}=await Oi(async()=>{const{getFunctions:m,httpsCallable:y}=await Promise.resolve().then(()=>sa);return{getFunctions:m,httpsCallable:y}},void 0),f=h(),g=(await d(f,"stripeCreatePortalSession")({}))?.data?.url;if(!g)throw new Error("No portal URL returned");window.location.assign(g)}catch(h){a(`Could not open Stripe portal: ${h?.message||h}`)}};return u.jsxs("div",{style:{padding:"2.5rem 1.5rem",maxWidth:900,margin:"0 auto"},children:[u.jsx("h1",{style:{marginTop:0},children:"Profile"}),u.jsx("p",{style:{marginTop:10,color:"#475569",lineHeight:1.6},children:"Manage linked accounts and subscription. Receipts and subscription management use Stripe Customer Portal."}),r&&u.jsx("div",{style:{marginTop:16,padding:12,borderRadius:12,background:"#fff7ed",border:"1px solid #fed7aa",color:"#9a3412"},children:r}),u.jsxs("div",{style:{marginTop:16,padding:16,borderRadius:14,border:"1px solid #e2e8f0",background:"#fff"},children:[u.jsx("div",{style:{fontWeight:900},children:"Session"}),u.jsxs("div",{style:{marginTop:10,color:"#0f172a",lineHeight:1.7},children:["Status: ",u.jsx("strong",{children:o?.status}),u.jsx("br",{}),"UID: ",u.jsx("code",{children:n?.uid||"n/a"}),u.jsx("br",{}),"Anonymous: ",u.jsx("strong",{children:String(!!n?.isAnonymous)})]}),u.jsxs("div",{style:{marginTop:12,color:"#475569"},children:["Linked providers: ",n?.providerData?.length?u.jsx("ul",{style:{margin:"6px 0 0",paddingLeft:18},children:n.providerData.map(h=>u.jsxs("li",{children:[u.jsx("code",{children:h.providerId}),h.email?` â€” ${h.email}`:""]},h.providerId))}):u.jsx("span",{children:"none (anonymous)"})]}),u.jsxs("div",{style:{marginTop:14,display:"flex",gap:10,flexWrap:"wrap"},children:[u.jsx("button",{type:"button",onClick:()=>e("/sign-in"),style:{padding:"10px 12px",borderRadius:12,border:"1px solid #0f172a",background:"#0f172a",color:"#fff",fontWeight:900,cursor:"pointer"},children:"Link accounts"}),u.jsx("button",{type:"button",onClick:c,style:{padding:"10px 12px",borderRadius:12,border:"1px solid #0f172a",background:"#fff",fontWeight:900,cursor:"pointer"},children:"Billing & receipts"}),u.jsx("button",{type:"button",onClick:l,style:{padding:"10px 12px",borderRadius:12,border:"1px solid #e2e8f0",background:"#fff",fontWeight:900,cursor:"pointer"},children:"Sign out"})]})]}),u.jsxs("div",{style:{marginTop:18,display:"flex",gap:12,flexWrap:"wrap"},children:[u.jsx(ht,{to:"/pricing",style:{color:"#0f172a",fontWeight:800},children:"Pricing"}),u.jsx(ht,{to:"/view",style:{color:"#475569",fontWeight:700},children:"Analyze a PDF"})]})]})}class wu extends Fi.Component{constructor(t){super(t),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(t){return{hasError:!0}}componentDidCatch(t,e){console.error("ErrorBoundary caught an error:",t,e),this.setState({error:t,errorInfo:e})}render(){return this.state.hasError?u.jsxs("div",{style:{padding:"2rem",textAlign:"center",minHeight:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:"#f5f5f5"},children:[u.jsx("h1",{children:"Oops! Something went wrong"}),u.jsx("p",{style:{color:"#666",marginBottom:"1rem"},children:"We encountered an unexpected error. Please try refreshing the page."}),!1,u.jsx("button",{onClick:()=>window.location.href="/",style:{marginTop:"1rem",padding:"0.5rem 1rem",backgroundColor:"#007acc",color:"white",border:"none",borderRadius:"4px",cursor:"pointer",fontSize:"1rem"},children:"Go to Home"})]}):this.props.children}}const vu=()=>{const{authState:o}=ce(),[t,e]=Fi.useState(!1);return o.status!=="error"||t?null:u.jsx("div",{style:{position:"fixed",top:"20px",right:"20px",backgroundColor:"#fff3cd",border:"1px solid #ffc107",borderRadius:"4px",padding:"1rem",maxWidth:"400px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)",zIndex:1e3,fontFamily:"sans-serif"},role:"alert",children:u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[u.jsxs("div",{children:[u.jsx("h4",{style:{margin:"0 0 0.5rem 0",color:"#856404"},children:"Authentication Unavailable"}),u.jsxs("div",{style:{margin:0,color:"#856404",fontSize:"0.9rem",lineHeight:1.4},children:[u.jsx("div",{children:"Some features may be limited, but you can still view documents."}),!1]})]}),u.jsx("button",{onClick:()=>e(!0),style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",color:"#856404",padding:0,marginLeft:"1rem",flexShrink:0},"aria-label":"Dismiss notification",children:"Ã—"})]})})},yi=({children:o})=>{const{authState:t}=ce();return t.status==="pending"?u.jsx("div",{children:"Loading..."}):t.status!=="authenticated"?u.jsx(wi,{to:"/sign-in",replace:!0}):o},Au=()=>{const o=[{title:"Signature placement UI",detail:"Place a signature field on a PDF with drag/drop + resize."},{title:"Identity & consent",detail:"Signer authentication + explicit consent."},{title:"Audit trail",detail:"Record who signed, when, and what hash."}];return u.jsxs("div",{style:{padding:"2.5rem 1.5rem",maxWidth:900,margin:"0 auto"},children:[u.jsx("h1",{children:"Sign PDFs"}),u.jsx("p",{children:"Signing is not ready yet. This is a roadmap placeholder."}),u.jsx("ul",{children:o.map(t=>u.jsxs("li",{children:[u.jsx("strong",{children:t.title}),": ",t.detail]},t.title))})]})},Su=()=>u.jsxs(Wl,{children:[u.jsx(wt,{path:"/pricing",element:u.jsx(Ht,{children:u.jsx(pu,{})})}),u.jsx(wt,{path:"/about",element:u.jsx(Ht,{children:u.jsx(hu,{})})}),u.jsx(wt,{path:"/privacy",element:u.jsx(Ht,{children:u.jsx(du,{})})}),u.jsx(wt,{path:"/terms",element:u.jsx(Ht,{children:u.jsx(uu,{})})}),u.jsx(wt,{path:"/contact",element:u.jsx(Ht,{children:u.jsx(fu,{})})}),u.jsx(wt,{path:"/sign-in",element:u.jsx(Ht,{children:u.jsx(mu,{})})}),u.jsx(wt,{path:"/sign-up",element:u.jsx(Ht,{children:u.jsx(yu,{})})}),u.jsx(wt,{path:"/view",element:u.jsx(mi,{})}),u.jsx(wt,{path:"/view/:documentId",element:u.jsx(mi,{})}),u.jsx(wt,{path:"/view/test-docs/:fileName",element:u.jsx(mi,{})}),u.jsx(wt,{path:"/profile",element:u.jsx(yi,{children:u.jsx(Ht,{variant:"app",children:u.jsx(xu,{})})})}),u.jsx(wt,{path:"/edit/:documentId",element:u.jsx(yi,{children:u.jsx(dr,{})})}),u.jsx(wt,{path:"/edit/test-docs/:fileName",element:u.jsx(yi,{children:u.jsx(dr,{})})}),u.jsx(wt,{path:"/sign",element:u.jsx(Ht,{children:u.jsx(Au,{})})}),u.jsx(wt,{path:"/app",element:u.jsx(wi,{to:"/view",replace:!0})}),u.jsx(wt,{path:"*",element:u.jsx(wi,{to:"/view",replace:!0})})]}),Eu=({basename:o="/"})=>u.jsx(wu,{children:u.jsxs(zc,{children:[u.jsx(vu,{}),u.jsx(pc,{basename:o,children:u.jsx(Su,{})})]})}),Du=({basename:o="/"})=>u.jsxs(u.Fragment,{children:[u.jsx(Xo,{}),u.jsx(Eu,{basename:o})]});export{Du as default};
