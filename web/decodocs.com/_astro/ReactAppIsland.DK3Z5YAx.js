const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/index.C3hS-p31.js","_astro/index.Ba4_ASc-.js"])))=>i.map(i=>d[i]);
import{j as u}from"./jsx-runtime.D_zvdyIk.js";import{r as T,R as ls,c as Ys,g as Tl}from"./index.Ba4_ASc-.js";import{i as Nl,C as Pl,r as xr,g as Rl,x as _n,F as Dl,H as ka,e as Il,T as jl,m as Ll,M as Ml,N as Fl}from"./index.esm.DAC6xlWs.js";import{l as ts,u as Zn,H as Cs,a as Ol,b as Li,c as pn,d as En,e as Mi,f as Bl,g as Ul,h as zl,i as Ca,G as Pt,j as Ta,k as Na,m as Hl,n as $l,o as Pa,p as Wl,q as Gl,r as Vl,s as Xl,t as Yl,v as ql,w as Ra,x as Kl,y as Fi,z as kn,A as Cn,B as Da,C as bi,D as Ia,E as ja,F as Zl,I as La,J as Ma,K as Tn,L as Jl,M as Ql}from"./DecoDocsLogo.DihwHr7f.js";import{GoogleAuthProvider as Fa,OAuthProvider as mn,linkWithPopup as Oa,EmailAuthProvider as Ba,linkWithCredential as Ua,signOut as ec}from"./index.esm.BpoIeuRg.js";import{s as za,a as tc,f as sc,b as nc,c as ic,_ as Nn}from"./authStore.Buaj28wK.js";/**
 * react-router v7.13.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var wr="popstate";function rc(o={}){function e(s,n){let{pathname:i,search:r,hash:a}=s.location;return yi("",{pathname:i,search:r,hash:a},n.state&&n.state.usr||null,n.state&&n.state.key||"default")}function t(s,n){return typeof n=="string"?n:Ts(n)}return oc(e,t,null,o)}function Te(o,e){if(o===!1||o===null||typeof o>"u")throw new Error(e)}function ut(o,e){if(!o){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function ac(){return Math.random().toString(36).substring(2,10)}function vr(o,e){return{usr:o.state,key:o.key,idx:e}}function yi(o,e,t=null,s){return{pathname:typeof o=="string"?o:o.pathname,search:"",hash:"",...typeof e=="string"?cs(e):e,state:t,key:e&&e.key||s||ac()}}function Ts({pathname:o="/",search:e="",hash:t=""}){return e&&e!=="?"&&(o+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(o+=t.charAt(0)==="#"?t:"#"+t),o}function cs(o){let e={};if(o){let t=o.indexOf("#");t>=0&&(e.hash=o.substring(t),o=o.substring(0,t));let s=o.indexOf("?");s>=0&&(e.search=o.substring(s),o=o.substring(0,s)),o&&(e.pathname=o)}return e}function oc(o,e,t,s={}){let{window:n=document.defaultView,v5Compat:i=!1}=s,r=n.history,a="POP",l=null,c=d();c==null&&(c=0,r.replaceState({...r.state,idx:c},""));function d(){return(r.state||{idx:null}).idx}function h(){a="POP";let y=d(),g=y==null?null:y-c;c=y,l&&l({action:a,location:m.location,delta:g})}function f(y,g){a="PUSH";let x=yi(m.location,y,g);c=d()+1;let w=vr(x,c),v=m.createHref(x);try{r.pushState(w,"",v)}catch(_){if(_ instanceof DOMException&&_.name==="DataCloneError")throw _;n.location.assign(v)}i&&l&&l({action:a,location:m.location,delta:1})}function p(y,g){a="REPLACE";let x=yi(m.location,y,g);c=d();let w=vr(x,c),v=m.createHref(x);r.replaceState(w,"",v),i&&l&&l({action:a,location:m.location,delta:0})}function b(y){return lc(y)}let m={get action(){return a},get location(){return o(n,r)},listen(y){if(l)throw new Error("A history only accepts one active listener");return n.addEventListener(wr,h),l=y,()=>{n.removeEventListener(wr,h),l=null}},createHref(y){return e(n,y)},createURL:b,encodeLocation(y){let g=b(y);return{pathname:g.pathname,search:g.search,hash:g.hash}},push:f,replace:p,go(y){return r.go(y)}};return m}function lc(o,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Te(t,"No window.location.(origin|href) available to create URL");let s=typeof o=="string"?o:Ts(o);return s=s.replace(/ $/,"%20"),!e&&s.startsWith("//")&&(s=t+s),new URL(s,t)}function Ha(o,e,t="/"){return cc(o,e,t,!1)}function cc(o,e,t,s){let n=typeof e=="string"?cs(e):e,i=kt(n.pathname||"/",t);if(i==null)return null;let r=$a(o);dc(r);let a=null;for(let l=0;a==null&&l<r.length;++l){let c=vc(i);a=xc(r[l],c,s)}return a}function $a(o,e=[],t=[],s="",n=!1){let i=(r,a,l=n,c)=>{let d={relativePath:c===void 0?r.path||"":c,caseSensitive:r.caseSensitive===!0,childrenIndex:a,route:r};if(d.relativePath.startsWith("/")){if(!d.relativePath.startsWith(s)&&l)return;Te(d.relativePath.startsWith(s),`Absolute route path "${d.relativePath}" nested under path "${s}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),d.relativePath=d.relativePath.slice(s.length)}let h=Et([s,d.relativePath]),f=t.concat(d);r.children&&r.children.length>0&&(Te(r.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${h}".`),$a(r.children,e,f,h,l)),!(r.path==null&&!r.index)&&e.push({path:h,score:bc(h,r.index),routesMeta:f})};return o.forEach((r,a)=>{if(r.path===""||!r.path?.includes("?"))i(r,a);else for(let l of Wa(r.path))i(r,a,!0,l)}),e}function Wa(o){let e=o.split("/");if(e.length===0)return[];let[t,...s]=e,n=t.endsWith("?"),i=t.replace(/\?$/,"");if(s.length===0)return n?[i,""]:[i];let r=Wa(s.join("/")),a=[];return a.push(...r.map(l=>l===""?i:[i,l].join("/"))),n&&a.push(...r),a.map(l=>o.startsWith("/")&&l===""?"/":l)}function dc(o){o.sort((e,t)=>e.score!==t.score?t.score-e.score:yc(e.routesMeta.map(s=>s.childrenIndex),t.routesMeta.map(s=>s.childrenIndex)))}var hc=/^:[\w-]+$/,uc=3,fc=2,pc=1,mc=10,gc=-2,Ar=o=>o==="*";function bc(o,e){let t=o.split("/"),s=t.length;return t.some(Ar)&&(s+=gc),e&&(s+=fc),t.filter(n=>!Ar(n)).reduce((n,i)=>n+(hc.test(i)?uc:i===""?pc:mc),s)}function yc(o,e){return o.length===e.length&&o.slice(0,-1).every((s,n)=>s===e[n])?o[o.length-1]-e[e.length-1]:0}function xc(o,e,t=!1){let{routesMeta:s}=o,n={},i="/",r=[];for(let a=0;a<s.length;++a){let l=s[a],c=a===s.length-1,d=i==="/"?e:e.slice(i.length)||"/",h=gn({path:l.relativePath,caseSensitive:l.caseSensitive,end:c},d),f=l.route;if(!h&&c&&t&&!s[s.length-1].route.index&&(h=gn({path:l.relativePath,caseSensitive:l.caseSensitive,end:!1},d)),!h)return null;Object.assign(n,h.params),r.push({params:n,pathname:Et([i,h.pathname]),pathnameBase:Ec(Et([i,h.pathnameBase])),route:f}),h.pathnameBase!=="/"&&(i=Et([i,h.pathnameBase]))}return r}function gn(o,e){typeof o=="string"&&(o={path:o,caseSensitive:!1,end:!0});let[t,s]=wc(o.path,o.caseSensitive,o.end),n=e.match(t);if(!n)return null;let i=n[0],r=i.replace(/(.)\/+$/,"$1"),a=n.slice(1);return{params:s.reduce((c,{paramName:d,isOptional:h},f)=>{if(d==="*"){let b=a[f]||"";r=i.slice(0,i.length-b.length).replace(/(.)\/+$/,"$1")}const p=a[f];return h&&!p?c[d]=void 0:c[d]=(p||"").replace(/%2F/g,"/"),c},{}),pathname:i,pathnameBase:r,pattern:o}}function wc(o,e=!1,t=!0){ut(o==="*"||!o.endsWith("*")||o.endsWith("/*"),`Route path "${o}" will be treated as if it were "${o.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${o.replace(/\*$/,"/*")}".`);let s=[],n="^"+o.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(r,a,l)=>(s.push({paramName:a,isOptional:l!=null}),l?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return o.endsWith("*")?(s.push({paramName:"*"}),n+=o==="*"||o==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?n+="\\/*$":o!==""&&o!=="/"&&(n+="(?:(?=\\/|$))"),[new RegExp(n,e?void 0:"i"),s]}function vc(o){try{return o.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return ut(!1,`The URL path "${o}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),o}}function kt(o,e){if(e==="/")return o;if(!o.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,s=o.charAt(t);return s&&s!=="/"?null:o.slice(t)||"/"}var Ac=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function Sc(o,e="/"){let{pathname:t,search:s="",hash:n=""}=typeof o=="string"?cs(o):o,i;return t?(t=t.replace(/\/\/+/g,"/"),t.startsWith("/")?i=Sr(t.substring(1),"/"):i=Sr(t,e)):i=e,{pathname:i,search:kc(s),hash:Cc(n)}}function Sr(o,e){let t=e.replace(/\/+$/,"").split("/");return o.split("/").forEach(n=>{n===".."?t.length>1&&t.pop():n!=="."&&t.push(n)}),t.length>1?t.join("/"):"/"}function Jn(o,e,t,s){return`Cannot include a '${o}' character in a manually specified \`to.${e}\` field [${JSON.stringify(s)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function _c(o){return o.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Oi(o){let e=_c(o);return e.map((t,s)=>s===e.length-1?t.pathname:t.pathnameBase)}function Bi(o,e,t,s=!1){let n;typeof o=="string"?n=cs(o):(n={...o},Te(!n.pathname||!n.pathname.includes("?"),Jn("?","pathname","search",n)),Te(!n.pathname||!n.pathname.includes("#"),Jn("#","pathname","hash",n)),Te(!n.search||!n.search.includes("#"),Jn("#","search","hash",n)));let i=o===""||n.pathname==="",r=i?"/":n.pathname,a;if(r==null)a=t;else{let h=e.length-1;if(!s&&r.startsWith("..")){let f=r.split("/");for(;f[0]==="..";)f.shift(),h-=1;n.pathname=f.join("/")}a=h>=0?e[h]:"/"}let l=Sc(n,a),c=r&&r!=="/"&&r.endsWith("/"),d=(i||r===".")&&t.endsWith("/");return!l.pathname.endsWith("/")&&(c||d)&&(l.pathname+="/"),l}var Et=o=>o.join("/").replace(/\/\/+/g,"/"),Ec=o=>o.replace(/\/+$/,"").replace(/^\/*/,"/"),kc=o=>!o||o==="?"?"":o.startsWith("?")?o:"?"+o,Cc=o=>!o||o==="#"?"":o.startsWith("#")?o:"#"+o,Tc=class{constructor(o,e,t,s=!1){this.status=o,this.statusText=e||"",this.internal=s,t instanceof Error?(this.data=t.toString(),this.error=t):this.data=t}};function Nc(o){return o!=null&&typeof o.status=="number"&&typeof o.statusText=="string"&&typeof o.internal=="boolean"&&"data"in o}function Pc(o){return o.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Ga=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function Va(o,e){let t=o;if(typeof t!="string"||!Ac.test(t))return{absoluteURL:void 0,isExternal:!1,to:t};let s=t,n=!1;if(Ga)try{let i=new URL(window.location.href),r=t.startsWith("//")?new URL(i.protocol+t):new URL(t),a=kt(r.pathname,e);r.origin===i.origin&&a!=null?t=a+r.search+r.hash:n=!0}catch{ut(!1,`<Link to="${t}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}return{absoluteURL:s,isExternal:n,to:t}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var Xa=["POST","PUT","PATCH","DELETE"];new Set(Xa);var Rc=["GET",...Xa];new Set(Rc);var ds=T.createContext(null);ds.displayName="DataRouter";var Pn=T.createContext(null);Pn.displayName="DataRouterState";var Dc=T.createContext(!1),Ya=T.createContext({isTransitioning:!1});Ya.displayName="ViewTransition";var Ic=T.createContext(new Map);Ic.displayName="Fetchers";var jc=T.createContext(null);jc.displayName="Await";var ot=T.createContext(null);ot.displayName="Navigation";var Fs=T.createContext(null);Fs.displayName="Location";var pt=T.createContext({outlet:null,matches:[],isDataRoute:!1});pt.displayName="Route";var Ui=T.createContext(null);Ui.displayName="RouteError";var qa="REACT_ROUTER_ERROR",Lc="REDIRECT",Mc="ROUTE_ERROR_RESPONSE";function Fc(o){if(o.startsWith(`${qa}:${Lc}:{`))try{let e=JSON.parse(o.slice(28));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.location=="string"&&typeof e.reloadDocument=="boolean"&&typeof e.replace=="boolean")return e}catch{}}function Oc(o){if(o.startsWith(`${qa}:${Mc}:{`))try{let e=JSON.parse(o.slice(40));if(typeof e=="object"&&e&&typeof e.status=="number"&&typeof e.statusText=="string")return new Tc(e.status,e.statusText,e.data)}catch{}}function Bc(o,{relative:e}={}){Te(hs(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:s}=T.useContext(ot),{hash:n,pathname:i,search:r}=Os(o,{relative:e}),a=i;return t!=="/"&&(a=i==="/"?t:Et([t,i])),s.createHref({pathname:a,search:r,hash:n})}function hs(){return T.useContext(Fs)!=null}function Ge(){return Te(hs(),"useLocation() may be used only in the context of a <Router> component."),T.useContext(Fs).location}var Ka="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function Za(o){T.useContext(ot).static||T.useLayoutEffect(o)}function Rt(){let{isDataRoute:o}=T.useContext(pt);return o?Jc():Uc()}function Uc(){Te(hs(),"useNavigate() may be used only in the context of a <Router> component.");let o=T.useContext(ds),{basename:e,navigator:t}=T.useContext(ot),{matches:s}=T.useContext(pt),{pathname:n}=Ge(),i=JSON.stringify(Oi(s)),r=T.useRef(!1);return Za(()=>{r.current=!0}),T.useCallback((l,c={})=>{if(ut(r.current,Ka),!r.current)return;if(typeof l=="number"){t.go(l);return}let d=Bi(l,JSON.parse(i),n,c.relative==="path");o==null&&e!=="/"&&(d.pathname=d.pathname==="/"?e:Et([e,d.pathname])),(c.replace?t.replace:t.push)(d,c.state,c)},[e,t,i,n,o])}T.createContext(null);function zi(){let{matches:o}=T.useContext(pt),e=o[o.length-1];return e?e.params:{}}function Os(o,{relative:e}={}){let{matches:t}=T.useContext(pt),{pathname:s}=Ge(),n=JSON.stringify(Oi(t));return T.useMemo(()=>Bi(o,JSON.parse(n),s,e==="path"),[o,n,s,e])}function zc(o,e){return Ja(o,e)}function Ja(o,e,t,s,n){Te(hs(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:i}=T.useContext(ot),{matches:r}=T.useContext(pt),a=r[r.length-1],l=a?a.params:{},c=a?a.pathname:"/",d=a?a.pathnameBase:"/",h=a&&a.route;{let x=h&&h.path||"";eo(c,!h||x.endsWith("*")||x.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${c}" (under <Route path="${x}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${x}"> to <Route path="${x==="/"?"*":`${x}/*`}">.`)}let f=Ge(),p;if(e){let x=typeof e=="string"?cs(e):e;Te(d==="/"||x.pathname?.startsWith(d),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${d}" but pathname "${x.pathname}" was given in the \`location\` prop.`),p=x}else p=f;let b=p.pathname||"/",m=b;if(d!=="/"){let x=d.replace(/^\//,"").split("/");m="/"+b.replace(/^\//,"").split("/").slice(x.length).join("/")}let y=Ha(o,{pathname:m});ut(h||y!=null,`No routes matched location "${p.pathname}${p.search}${p.hash}" `),ut(y==null||y[y.length-1].route.element!==void 0||y[y.length-1].route.Component!==void 0||y[y.length-1].route.lazy!==void 0,`Matched leaf route at location "${p.pathname}${p.search}${p.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let g=Vc(y&&y.map(x=>Object.assign({},x,{params:Object.assign({},l,x.params),pathname:Et([d,i.encodeLocation?i.encodeLocation(x.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:x.pathname]),pathnameBase:x.pathnameBase==="/"?d:Et([d,i.encodeLocation?i.encodeLocation(x.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:x.pathnameBase])})),r,t,s,n);return e&&g?T.createElement(Fs.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...p},navigationType:"POP"}},g):g}function Hc(){let o=Zc(),e=Nc(o)?`${o.status} ${o.statusText}`:o instanceof Error?o.message:JSON.stringify(o),t=o instanceof Error?o.stack:null,s="rgba(200,200,200, 0.5)",n={padding:"0.5rem",backgroundColor:s},i={padding:"2px 4px",backgroundColor:s},r=null;return console.error("Error handled by React Router default ErrorBoundary:",o),r=T.createElement(T.Fragment,null,T.createElement("p",null,"ðŸ’¿ Hey developer ðŸ‘‹"),T.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",T.createElement("code",{style:i},"ErrorBoundary")," or"," ",T.createElement("code",{style:i},"errorElement")," prop on your route.")),T.createElement(T.Fragment,null,T.createElement("h2",null,"Unexpected Application Error!"),T.createElement("h3",{style:{fontStyle:"italic"}},e),t?T.createElement("pre",{style:n},t):null,r)}var $c=T.createElement(Hc,null),Qa=class extends T.Component{constructor(o){super(o),this.state={location:o.location,revalidation:o.revalidation,error:o.error}}static getDerivedStateFromError(o){return{error:o}}static getDerivedStateFromProps(o,e){return e.location!==o.location||e.revalidation!=="idle"&&o.revalidation==="idle"?{error:o.error,location:o.location,revalidation:o.revalidation}:{error:o.error!==void 0?o.error:e.error,location:e.location,revalidation:o.revalidation||e.revalidation}}componentDidCatch(o,e){this.props.onError?this.props.onError(o,e):console.error("React Router caught the following error during render",o)}render(){let o=this.state.error;if(this.context&&typeof o=="object"&&o&&"digest"in o&&typeof o.digest=="string"){const t=Oc(o.digest);t&&(o=t)}let e=o!==void 0?T.createElement(pt.Provider,{value:this.props.routeContext},T.createElement(Ui.Provider,{value:o,children:this.props.component})):this.props.children;return this.context?T.createElement(Wc,{error:o},e):e}};Qa.contextType=Dc;var Qn=new WeakMap;function Wc({children:o,error:e}){let{basename:t}=T.useContext(ot);if(typeof e=="object"&&e&&"digest"in e&&typeof e.digest=="string"){let s=Fc(e.digest);if(s){let n=Qn.get(e);if(n)throw n;let i=Va(s.location,t);if(Ga&&!Qn.get(e))if(i.isExternal||s.reloadDocument)window.location.href=i.absoluteURL||i.to;else{const r=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(i.to,{replace:s.replace}));throw Qn.set(e,r),r}return T.createElement("meta",{httpEquiv:"refresh",content:`0;url=${i.absoluteURL||i.to}`})}}return o}function Gc({routeContext:o,match:e,children:t}){let s=T.useContext(ds);return s&&s.static&&s.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=e.route.id),T.createElement(pt.Provider,{value:o},t)}function Vc(o,e=[],t=null,s=null,n=null){if(o==null){if(!t)return null;if(t.errors)o=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)o=t.matches;else return null}let i=o,r=t?.errors;if(r!=null){let d=i.findIndex(h=>h.route.id&&r?.[h.route.id]!==void 0);Te(d>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(r).join(",")}`),i=i.slice(0,Math.min(i.length,d+1))}let a=!1,l=-1;if(t)for(let d=0;d<i.length;d++){let h=i[d];if((h.route.HydrateFallback||h.route.hydrateFallbackElement)&&(l=d),h.route.id){let{loaderData:f,errors:p}=t,b=h.route.loader&&!f.hasOwnProperty(h.route.id)&&(!p||p[h.route.id]===void 0);if(h.route.lazy||b){a=!0,l>=0?i=i.slice(0,l+1):i=[i[0]];break}}}let c=t&&s?(d,h)=>{s(d,{location:t.location,params:t.matches?.[0]?.params??{},unstable_pattern:Pc(t.matches),errorInfo:h})}:void 0;return i.reduceRight((d,h,f)=>{let p,b=!1,m=null,y=null;t&&(p=r&&h.route.id?r[h.route.id]:void 0,m=h.route.errorElement||$c,a&&(l<0&&f===0?(eo("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),b=!0,y=null):l===f&&(b=!0,y=h.route.hydrateFallbackElement||null)));let g=e.concat(i.slice(0,f+1)),x=()=>{let w;return p?w=m:b?w=y:h.route.Component?w=T.createElement(h.route.Component,null):h.route.element?w=h.route.element:w=d,T.createElement(Gc,{match:h,routeContext:{outlet:d,matches:g,isDataRoute:t!=null},children:w})};return t&&(h.route.ErrorBoundary||h.route.errorElement||f===0)?T.createElement(Qa,{location:t.location,revalidation:t.revalidation,component:m,error:p,children:x(),routeContext:{outlet:null,matches:g,isDataRoute:!0},onError:c}):x()},null)}function Hi(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Xc(o){let e=T.useContext(ds);return Te(e,Hi(o)),e}function Yc(o){let e=T.useContext(Pn);return Te(e,Hi(o)),e}function qc(o){let e=T.useContext(pt);return Te(e,Hi(o)),e}function $i(o){let e=qc(o),t=e.matches[e.matches.length-1];return Te(t.route.id,`${o} can only be used on routes that contain a unique "id"`),t.route.id}function Kc(){return $i("useRouteId")}function Zc(){let o=T.useContext(Ui),e=Yc("useRouteError"),t=$i("useRouteError");return o!==void 0?o:e.errors?.[t]}function Jc(){let{router:o}=Xc("useNavigate"),e=$i("useNavigate"),t=T.useRef(!1);return Za(()=>{t.current=!0}),T.useCallback(async(n,i={})=>{ut(t.current,Ka),t.current&&(typeof n=="number"?await o.navigate(n):await o.navigate(n,{fromRouteId:e,...i}))},[o,e])}var _r={};function eo(o,e,t){!e&&!_r[o]&&(_r[o]=!0,ut(!1,t))}T.memo(Qc);function Qc({routes:o,future:e,state:t,onError:s}){return Ja(o,void 0,t,s,e)}function xi({to:o,replace:e,state:t,relative:s}){Te(hs(),"<Navigate> may be used only in the context of a <Router> component.");let{static:n}=T.useContext(ot);ut(!n,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:i}=T.useContext(pt),{pathname:r}=Ge(),a=Rt(),l=Bi(o,Oi(i),r,s==="path"),c=JSON.stringify(l);return T.useEffect(()=>{a(JSON.parse(c),{replace:e,state:t,relative:s})},[a,c,s,e,t]),null}function Fe(o){Te(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function ed({basename:o="/",children:e=null,location:t,navigationType:s="POP",navigator:n,static:i=!1,unstable_useTransitions:r}){Te(!hs(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let a=o.replace(/^\/*/,"/"),l=T.useMemo(()=>({basename:a,navigator:n,static:i,unstable_useTransitions:r,future:{}}),[a,n,i,r]);typeof t=="string"&&(t=cs(t));let{pathname:c="/",search:d="",hash:h="",state:f=null,key:p="default"}=t,b=T.useMemo(()=>{let m=kt(c,a);return m==null?null:{location:{pathname:m,search:d,hash:h,state:f,key:p},navigationType:s}},[a,c,d,h,f,p,s]);return ut(b!=null,`<Router basename="${a}"> is not able to match the URL "${c}${d}${h}" because it does not start with the basename, so the <Router> won't render anything.`),b==null?null:T.createElement(ot.Provider,{value:l},T.createElement(Fs.Provider,{children:e,value:b}))}function td({children:o,location:e}){return zc(wi(o),e)}function wi(o,e=[]){let t=[];return T.Children.forEach(o,(s,n)=>{if(!T.isValidElement(s))return;let i=[...e,n];if(s.type===T.Fragment){t.push.apply(t,wi(s.props.children,i));return}Te(s.type===Fe,`[${typeof s.type=="string"?s.type:s.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Te(!s.props.index||!s.props.children,"An index route cannot have child routes.");let r={id:s.props.id||i.join("-"),caseSensitive:s.props.caseSensitive,element:s.props.element,Component:s.props.Component,index:s.props.index,path:s.props.path,middleware:s.props.middleware,loader:s.props.loader,action:s.props.action,hydrateFallbackElement:s.props.hydrateFallbackElement,HydrateFallback:s.props.HydrateFallback,errorElement:s.props.errorElement,ErrorBoundary:s.props.ErrorBoundary,hasErrorBoundary:s.props.hasErrorBoundary===!0||s.props.ErrorBoundary!=null||s.props.errorElement!=null,shouldRevalidate:s.props.shouldRevalidate,handle:s.props.handle,lazy:s.props.lazy};s.props.children&&(r.children=wi(s.props.children,i)),t.push(r)}),t}var dn="get",hn="application/x-www-form-urlencoded";function Rn(o){return typeof HTMLElement<"u"&&o instanceof HTMLElement}function sd(o){return Rn(o)&&o.tagName.toLowerCase()==="button"}function nd(o){return Rn(o)&&o.tagName.toLowerCase()==="form"}function id(o){return Rn(o)&&o.tagName.toLowerCase()==="input"}function rd(o){return!!(o.metaKey||o.altKey||o.ctrlKey||o.shiftKey)}function ad(o,e){return o.button===0&&(!e||e==="_self")&&!rd(o)}var qs=null;function od(){if(qs===null)try{new FormData(document.createElement("form"),0),qs=!1}catch{qs=!0}return qs}var ld=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function ei(o){return o!=null&&!ld.has(o)?(ut(!1,`"${o}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${hn}"`),null):o}function cd(o,e){let t,s,n,i,r;if(nd(o)){let a=o.getAttribute("action");s=a?kt(a,e):null,t=o.getAttribute("method")||dn,n=ei(o.getAttribute("enctype"))||hn,i=new FormData(o)}else if(sd(o)||id(o)&&(o.type==="submit"||o.type==="image")){let a=o.form;if(a==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let l=o.getAttribute("formaction")||a.getAttribute("action");if(s=l?kt(l,e):null,t=o.getAttribute("formmethod")||a.getAttribute("method")||dn,n=ei(o.getAttribute("formenctype"))||ei(a.getAttribute("enctype"))||hn,i=new FormData(a,o),!od()){let{name:c,type:d,value:h}=o;if(d==="image"){let f=c?`${c}.`:"";i.append(`${f}x`,"0"),i.append(`${f}y`,"0")}else c&&i.append(c,h)}}else{if(Rn(o))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=dn,s=null,n=hn,r=o}return i&&n==="text/plain"&&(r=i,i=void 0),{action:s,method:t.toLowerCase(),encType:n,formData:i,body:r}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Wi(o,e){if(o===!1||o===null||typeof o>"u")throw new Error(e)}function dd(o,e,t,s){let n=typeof o=="string"?new URL(o,typeof window>"u"?"server://singlefetch/":window.location.origin):o;return t?n.pathname.endsWith("/")?n.pathname=`${n.pathname}_.${s}`:n.pathname=`${n.pathname}.${s}`:n.pathname==="/"?n.pathname=`_root.${s}`:e&&kt(n.pathname,e)==="/"?n.pathname=`${e.replace(/\/$/,"")}/_root.${s}`:n.pathname=`${n.pathname.replace(/\/$/,"")}.${s}`,n}async function hd(o,e){if(o.id in e)return e[o.id];try{let t=await import(o.module);return e[o.id]=t,t}catch(t){return console.error(`Error loading route module \`${o.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function ud(o){return o==null?!1:o.href==null?o.rel==="preload"&&typeof o.imageSrcSet=="string"&&typeof o.imageSizes=="string":typeof o.rel=="string"&&typeof o.href=="string"}async function fd(o,e,t){let s=await Promise.all(o.map(async n=>{let i=e.routes[n.route.id];if(i){let r=await hd(i,t);return r.links?r.links():[]}return[]}));return bd(s.flat(1).filter(ud).filter(n=>n.rel==="stylesheet"||n.rel==="preload").map(n=>n.rel==="stylesheet"?{...n,rel:"prefetch",as:"style"}:{...n,rel:"prefetch"}))}function Er(o,e,t,s,n,i){let r=(l,c)=>t[c]?l.route.id!==t[c].route.id:!0,a=(l,c)=>t[c].pathname!==l.pathname||t[c].route.path?.endsWith("*")&&t[c].params["*"]!==l.params["*"];return i==="assets"?e.filter((l,c)=>r(l,c)||a(l,c)):i==="data"?e.filter((l,c)=>{let d=s.routes[l.route.id];if(!d||!d.hasLoader)return!1;if(r(l,c)||a(l,c))return!0;if(l.route.shouldRevalidate){let h=l.route.shouldRevalidate({currentUrl:new URL(n.pathname+n.search+n.hash,window.origin),currentParams:t[0]?.params||{},nextUrl:new URL(o,window.origin),nextParams:l.params,defaultShouldRevalidate:!0});if(typeof h=="boolean")return h}return!0}):[]}function pd(o,e,{includeHydrateFallback:t}={}){return md(o.map(s=>{let n=e.routes[s.route.id];if(!n)return[];let i=[n.module];return n.clientActionModule&&(i=i.concat(n.clientActionModule)),n.clientLoaderModule&&(i=i.concat(n.clientLoaderModule)),t&&n.hydrateFallbackModule&&(i=i.concat(n.hydrateFallbackModule)),n.imports&&(i=i.concat(n.imports)),i}).flat(1))}function md(o){return[...new Set(o)]}function gd(o){let e={},t=Object.keys(o).sort();for(let s of t)e[s]=o[s];return e}function bd(o,e){let t=new Set;return new Set(e),o.reduce((s,n)=>{let i=JSON.stringify(gd(n));return t.has(i)||(t.add(i),s.push({key:i,link:n})),s},[])}function to(){let o=T.useContext(ds);return Wi(o,"You must render this element inside a <DataRouterContext.Provider> element"),o}function yd(){let o=T.useContext(Pn);return Wi(o,"You must render this element inside a <DataRouterStateContext.Provider> element"),o}var Gi=T.createContext(void 0);Gi.displayName="FrameworkContext";function so(){let o=T.useContext(Gi);return Wi(o,"You must render this element inside a <HydratedRouter> element"),o}function xd(o,e){let t=T.useContext(Gi),[s,n]=T.useState(!1),[i,r]=T.useState(!1),{onFocus:a,onBlur:l,onMouseEnter:c,onMouseLeave:d,onTouchStart:h}=e,f=T.useRef(null);T.useEffect(()=>{if(o==="render"&&r(!0),o==="viewport"){let m=g=>{g.forEach(x=>{r(x.isIntersecting)})},y=new IntersectionObserver(m,{threshold:.5});return f.current&&y.observe(f.current),()=>{y.disconnect()}}},[o]),T.useEffect(()=>{if(s){let m=setTimeout(()=>{r(!0)},100);return()=>{clearTimeout(m)}}},[s]);let p=()=>{n(!0)},b=()=>{n(!1),r(!1)};return t?o!=="intent"?[i,f,{}]:[i,f,{onFocus:gs(a,p),onBlur:gs(l,b),onMouseEnter:gs(c,p),onMouseLeave:gs(d,b),onTouchStart:gs(h,p)}]:[!1,f,{}]}function gs(o,e){return t=>{o&&o(t),t.defaultPrevented||e(t)}}function wd({page:o,...e}){let{router:t}=to(),s=T.useMemo(()=>Ha(t.routes,o,t.basename),[t.routes,o,t.basename]);return s?T.createElement(Ad,{page:o,matches:s,...e}):null}function vd(o){let{manifest:e,routeModules:t}=so(),[s,n]=T.useState([]);return T.useEffect(()=>{let i=!1;return fd(o,e,t).then(r=>{i||n(r)}),()=>{i=!0}},[o,e,t]),s}function Ad({page:o,matches:e,...t}){let s=Ge(),{future:n,manifest:i,routeModules:r}=so(),{basename:a}=to(),{loaderData:l,matches:c}=yd(),d=T.useMemo(()=>Er(o,e,c,i,s,"data"),[o,e,c,i,s]),h=T.useMemo(()=>Er(o,e,c,i,s,"assets"),[o,e,c,i,s]),f=T.useMemo(()=>{if(o===s.pathname+s.search+s.hash)return[];let m=new Set,y=!1;if(e.forEach(x=>{let w=i.routes[x.route.id];!w||!w.hasLoader||(!d.some(v=>v.route.id===x.route.id)&&x.route.id in l&&r[x.route.id]?.shouldRevalidate||w.hasClientLoader?y=!0:m.add(x.route.id))}),m.size===0)return[];let g=dd(o,a,n.unstable_trailingSlashAwareDataRequests,"data");return y&&m.size>0&&g.searchParams.set("_routes",e.filter(x=>m.has(x.route.id)).map(x=>x.route.id).join(",")),[g.pathname+g.search]},[a,n.unstable_trailingSlashAwareDataRequests,l,s,i,d,e,o,r]),p=T.useMemo(()=>pd(h,i),[h,i]),b=vd(h);return T.createElement(T.Fragment,null,f.map(m=>T.createElement("link",{key:m,rel:"prefetch",as:"fetch",href:m,...t})),p.map(m=>T.createElement("link",{key:m,rel:"modulepreload",href:m,...t})),b.map(({key:m,link:y})=>T.createElement("link",{key:m,nonce:t.nonce,...y,crossOrigin:y.crossOrigin??t.crossOrigin})))}function Sd(...o){return e=>{o.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var _d=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{_d&&(window.__reactRouterVersion="7.13.0")}catch{}function Ed({basename:o,children:e,unstable_useTransitions:t,window:s}){let n=T.useRef();n.current==null&&(n.current=rc({window:s,v5Compat:!0}));let i=n.current,[r,a]=T.useState({action:i.action,location:i.location}),l=T.useCallback(c=>{t===!1?a(c):T.startTransition(()=>a(c))},[t]);return T.useLayoutEffect(()=>i.listen(l),[i,l]),T.createElement(ed,{basename:o,children:e,location:r.location,navigationType:r.action,navigator:i,unstable_useTransitions:t})}var no=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ye=T.forwardRef(function({onClick:e,discover:t="render",prefetch:s="none",relative:n,reloadDocument:i,replace:r,state:a,target:l,to:c,preventScrollReset:d,viewTransition:h,unstable_defaultShouldRevalidate:f,...p},b){let{basename:m,unstable_useTransitions:y}=T.useContext(ot),g=typeof c=="string"&&no.test(c),x=Va(c,m);c=x.to;let w=Bc(c,{relative:n}),[v,_,E]=xd(s,p),k=Nd(c,{replace:r,state:a,target:l,preventScrollReset:d,relative:n,viewTransition:h,unstable_defaultShouldRevalidate:f,unstable_useTransitions:y});function D(R){e&&e(R),R.defaultPrevented||k(R)}let N=T.createElement("a",{...p,...E,href:x.absoluteURL||w,onClick:x.isExternal||i?e:D,ref:Sd(b,_),target:l,"data-discover":!g&&t==="render"?"true":void 0});return v&&!g?T.createElement(T.Fragment,null,N,T.createElement(wd,{page:w})):N});ye.displayName="Link";var kd=T.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:s="",end:n=!1,style:i,to:r,viewTransition:a,children:l,...c},d){let h=Os(r,{relative:c.relative}),f=Ge(),p=T.useContext(Pn),{navigator:b,basename:m}=T.useContext(ot),y=p!=null&&jd(h)&&a===!0,g=b.encodeLocation?b.encodeLocation(h).pathname:h.pathname,x=f.pathname,w=p&&p.navigation&&p.navigation.location?p.navigation.location.pathname:null;t||(x=x.toLowerCase(),w=w?w.toLowerCase():null,g=g.toLowerCase()),w&&m&&(w=kt(w,m)||w);const v=g!=="/"&&g.endsWith("/")?g.length-1:g.length;let _=x===g||!n&&x.startsWith(g)&&x.charAt(v)==="/",E=w!=null&&(w===g||!n&&w.startsWith(g)&&w.charAt(g.length)==="/"),k={isActive:_,isPending:E,isTransitioning:y},D=_?e:void 0,N;typeof s=="function"?N=s(k):N=[s,_?"active":null,E?"pending":null,y?"transitioning":null].filter(Boolean).join(" ");let R=typeof i=="function"?i(k):i;return T.createElement(ye,{...c,"aria-current":D,className:N,ref:d,style:R,to:r,viewTransition:a},typeof l=="function"?l(k):l)});kd.displayName="NavLink";var Cd=T.forwardRef(({discover:o="render",fetcherKey:e,navigate:t,reloadDocument:s,replace:n,state:i,method:r=dn,action:a,onSubmit:l,relative:c,preventScrollReset:d,viewTransition:h,unstable_defaultShouldRevalidate:f,...p},b)=>{let{unstable_useTransitions:m}=T.useContext(ot),y=Dd(),g=Id(a,{relative:c}),x=r.toLowerCase()==="get"?"get":"post",w=typeof a=="string"&&no.test(a),v=_=>{if(l&&l(_),_.defaultPrevented)return;_.preventDefault();let E=_.nativeEvent.submitter,k=E?.getAttribute("formmethod")||r,D=()=>y(E||_.currentTarget,{fetcherKey:e,method:k,navigate:t,replace:n,state:i,relative:c,preventScrollReset:d,viewTransition:h,unstable_defaultShouldRevalidate:f});m&&t!==!1?T.startTransition(()=>D()):D()};return T.createElement("form",{ref:b,method:x,action:g,onSubmit:s?l:v,...p,"data-discover":!w&&o==="render"?"true":void 0})});Cd.displayName="Form";function Td(o){return`${o} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function io(o){let e=T.useContext(ds);return Te(e,Td(o)),e}function Nd(o,{target:e,replace:t,state:s,preventScrollReset:n,relative:i,viewTransition:r,unstable_defaultShouldRevalidate:a,unstable_useTransitions:l}={}){let c=Rt(),d=Ge(),h=Os(o,{relative:i});return T.useCallback(f=>{if(ad(f,e)){f.preventDefault();let p=t!==void 0?t:Ts(d)===Ts(h),b=()=>c(o,{replace:p,state:s,preventScrollReset:n,relative:i,viewTransition:r,unstable_defaultShouldRevalidate:a});l?T.startTransition(()=>b()):b()}},[d,c,h,t,s,e,o,n,i,r,a,l])}var Pd=0,Rd=()=>`__${String(++Pd)}__`;function Dd(){let{router:o}=io("useSubmit"),{basename:e}=T.useContext(ot),t=Kc(),s=o.fetch,n=o.navigate;return T.useCallback(async(i,r={})=>{let{action:a,method:l,encType:c,formData:d,body:h}=cd(i,e);if(r.navigate===!1){let f=r.fetcherKey||Rd();await s(f,t,r.action||a,{unstable_defaultShouldRevalidate:r.unstable_defaultShouldRevalidate,preventScrollReset:r.preventScrollReset,formData:d,body:h,formMethod:r.method||l,formEncType:r.encType||c,flushSync:r.flushSync})}else await n(r.action||a,{unstable_defaultShouldRevalidate:r.unstable_defaultShouldRevalidate,preventScrollReset:r.preventScrollReset,formData:d,body:h,formMethod:r.method||l,formEncType:r.encType||c,replace:r.replace,state:r.state,fromRouteId:t,flushSync:r.flushSync,viewTransition:r.viewTransition})},[s,n,e,t])}function Id(o,{relative:e}={}){let{basename:t}=T.useContext(ot),s=T.useContext(pt);Te(s,"useFormAction must be used inside a RouteContext");let[n]=s.matches.slice(-1),i={...Os(o||".",{relative:e})},r=Ge();if(o==null){i.search=r.search;let a=new URLSearchParams(i.search),l=a.getAll("index");if(l.some(d=>d==="")){a.delete("index"),l.filter(h=>h).forEach(h=>a.append("index",h));let d=a.toString();i.search=d?`?${d}`:""}}return(!o||o===".")&&n.route.index&&(i.search=i.search?i.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(i.pathname=i.pathname==="/"?t:Et([t,i.pathname])),Ts(i)}function jd(o,{relative:e}={}){let t=T.useContext(Ya);Te(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:s}=io("useViewTransitionState"),n=Os(o,{relative:e});if(!t.isTransitioning)return!1;let i=kt(t.currentLocation.pathname,s)||t.currentLocation.pathname,r=kt(t.nextLocation.pathname,s)||t.nextLocation.pathname;return gn(n.pathname,r)!=null||gn(n.pathname,i)!=null}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ld="type.googleapis.com/google.protobuf.Int64Value",Md="type.googleapis.com/google.protobuf.UInt64Value";function ro(o,e){const t={};for(const s in o)o.hasOwnProperty(s)&&(t[s]=e(o[s]));return t}function bn(o){if(o==null)return null;if(o instanceof Number&&(o=o.valueOf()),typeof o=="number"&&isFinite(o)||o===!0||o===!1||Object.prototype.toString.call(o)==="[object String]")return o;if(o instanceof Date)return o.toISOString();if(Array.isArray(o))return o.map(e=>bn(e));if(typeof o=="function"||typeof o=="object")return ro(o,e=>bn(e));throw new Error("Data cannot be encoded in JSON: "+o)}function as(o){if(o==null)return o;if(o["@type"])switch(o["@type"]){case Ld:case Md:{const e=Number(o.value);if(isNaN(e))throw new Error("Data cannot be decoded from JSON: "+o);return e}default:throw new Error("Data cannot be decoded from JSON: "+o)}return Array.isArray(o)?o.map(e=>as(e)):typeof o=="function"||typeof o=="object"?ro(o,e=>as(e)):o}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vi="functions";/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const kr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ze extends Dl{constructor(e,t,s){super(`${Vi}/${e}`,t||""),this.details=s,Object.setPrototypeOf(this,Ze.prototype)}}function Fd(o){if(o>=200&&o<300)return"ok";switch(o){case 0:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 500:return"internal";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}function yn(o,e){let t=Fd(o),s=t,n;try{const i=e&&e.error;if(i){const r=i.status;if(typeof r=="string"){if(!kr[r])return new Ze("internal","internal");t=kr[r],s=r}const a=i.message;typeof a=="string"&&(s=a),n=i.details,n!==void 0&&(n=as(n))}}catch{}return t==="ok"?null:new Ze(t,s,n)}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Od{constructor(e,t,s,n){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,Rl(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=s.getImmediate({optional:!0}),this.auth||t.get().then(i=>this.auth=i,()=>{}),this.messaging||s.get().then(i=>this.messaging=i,()=>{}),this.appCheck||n?.get().then(i=>this.appCheck=i,()=>{})}async getAuthToken(){if(this.auth)try{return(await this.auth.getToken())?.accessToken}catch{return}}async getMessagingToken(){if(!(!this.messaging||!("Notification"in self)||Notification.permission!=="granted"))try{return await this.messaging.getToken()}catch{return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){const t=await this.getAuthToken(),s=await this.getMessagingToken(),n=await this.getAppCheckToken(e);return{authToken:t,messagingToken:s,appCheckToken:n}}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vi="us-central1",Bd=/^data: (.*?)(?:\n|$)/;function Ud(o){let e=null;return{promise:new Promise((t,s)=>{e=setTimeout(()=>{s(new Ze("deadline-exceeded","deadline-exceeded"))},o)}),cancel:()=>{e&&clearTimeout(e)}}}class zd{constructor(e,t,s,n,i=vi,r=(...a)=>fetch(...a)){this.app=e,this.fetchImpl=r,this.emulatorOrigin=null,this.contextProvider=new Od(e,t,s,n),this.cancelAllRequests=new Promise(a=>{this.deleteService=()=>Promise.resolve(a())});try{const a=new URL(i);this.customDomain=a.origin+(a.pathname==="/"?"":a.pathname),this.region=vi}catch{this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;return this.emulatorOrigin!==null?`${this.emulatorOrigin}/${t}/${this.region}/${e}`:this.customDomain!==null?`${this.customDomain}/${e}`:`https://${this.region}-${t}.cloudfunctions.net/${e}`}}function Hd(o,e,t){const s=ka(e);o.emulatorOrigin=`http${s?"s":""}://${e}:${t}`,s&&(Ml(o.emulatorOrigin+"/backends"),Fl("Functions",!0))}function $d(o,e,t){const s=n=>Vd(o,e,n,t||{});return s.stream=(n,i)=>Xd(o,e,n,i),s}function Wd(o,e,t){const s=n=>lo(o,e,n,t||{});return s.stream=(n,i)=>co(o,e,n,i||{}),s}function ao(o){return o.emulatorOrigin&&ka(o.emulatorOrigin)?"include":void 0}async function Gd(o,e,t,s,n){t["Content-Type"]="application/json";let i;try{i=await s(o,{method:"POST",body:JSON.stringify(e),headers:t,credentials:ao(n)})}catch{return{status:0,json:null}}let r=null;try{r=await i.json()}catch{}return{status:i.status,json:r}}async function oo(o,e){const t={},s=await o.contextProvider.getContext(e.limitedUseAppCheckTokens);return s.authToken&&(t.Authorization="Bearer "+s.authToken),s.messagingToken&&(t["Firebase-Instance-ID-Token"]=s.messagingToken),s.appCheckToken!==null&&(t["X-Firebase-AppCheck"]=s.appCheckToken),t}function Vd(o,e,t,s){const n=o._url(e);return lo(o,n,t,s)}async function lo(o,e,t,s){t=bn(t);const n={data:t},i=await oo(o,s),r=s.timeout||7e4,a=Ud(r),l=await Promise.race([Gd(e,n,i,o.fetchImpl,o),a.promise,o.cancelAllRequests]);if(a.cancel(),!l)throw new Ze("cancelled","Firebase Functions instance was deleted.");const c=yn(l.status,l.json);if(c)throw c;if(!l.json)throw new Ze("internal","Response is not valid JSON object.");let d=l.json.data;if(typeof d>"u"&&(d=l.json.result),typeof d>"u")throw new Ze("internal","Response is missing data field.");return{data:as(d)}}function Xd(o,e,t,s){const n=o._url(e);return co(o,n,t,s||{})}async function co(o,e,t,s){t=bn(t);const n={data:t},i=await oo(o,s);i["Content-Type"]="application/json",i.Accept="text/event-stream";let r;try{r=await o.fetchImpl(e,{method:"POST",body:JSON.stringify(n),headers:i,signal:s?.signal,credentials:ao(o)})}catch(f){if(f instanceof Error&&f.name==="AbortError"){const b=new Ze("cancelled","Request was cancelled.");return{data:Promise.reject(b),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(b)}}}}}}const p=yn(0,null);return{data:Promise.reject(p),stream:{[Symbol.asyncIterator](){return{next(){return Promise.reject(p)}}}}}}let a,l;const c=new Promise((f,p)=>{a=f,l=p});s?.signal?.addEventListener("abort",()=>{const f=new Ze("cancelled","Request was cancelled.");l(f)});const d=r.body.getReader(),h=Yd(d,a,l,s?.signal);return{stream:{[Symbol.asyncIterator](){const f=h.getReader();return{async next(){const{value:p,done:b}=await f.read();return{value:p,done:b}},async return(){return await f.cancel(),{done:!0,value:void 0}}}}},data:c}}function Yd(o,e,t,s){const n=(r,a)=>{const l=r.match(Bd);if(!l)return;const c=l[1];try{const d=JSON.parse(c);if("result"in d){e(as(d.result));return}if("message"in d){a.enqueue(as(d.message));return}if("error"in d){const h=yn(0,d);a.error(h),t(h);return}}catch(d){if(d instanceof Ze){a.error(d),t(d);return}}},i=new TextDecoder;return new ReadableStream({start(r){let a="";return l();async function l(){if(s?.aborted){const c=new Ze("cancelled","Request was cancelled");return r.error(c),t(c),Promise.resolve()}try{const{value:c,done:d}=await o.read();if(d){a.trim()&&n(a.trim(),r),r.close();return}if(s?.aborted){const f=new Ze("cancelled","Request was cancelled");r.error(f),t(f),await o.cancel();return}a+=i.decode(c,{stream:!0});const h=a.split(`
`);a=h.pop()||"";for(const f of h)f.trim()&&n(f.trim(),r);return l()}catch(c){const d=c instanceof Ze?c:yn(0,null);r.error(d),t(d)}}},cancel(){return o.cancel()}})}const Cr="@firebase/functions",Tr="0.13.1";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qd="auth-internal",Kd="app-check-internal",Zd="messaging-internal";function Jd(o){const e=(t,{instanceIdentifier:s})=>{const n=t.getProvider("app").getImmediate(),i=t.getProvider(qd),r=t.getProvider(Zd),a=t.getProvider(Kd);return new zd(n,i,r,a,s)};Nl(new Pl(Vi,e,"PUBLIC").setMultipleInstances(!0)),xr(Cr,Tr,o),xr(Cr,Tr,"esm2020")}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dn(o=Ll(),e=vi){const s=Il(_n(o),Vi).getImmediate({identifier:e}),n=jl("functions");return n&&ho(s,...n),s}function ho(o,e,t){Hd(_n(o),e,t)}function st(o,e,t){return $d(_n(o),e,t)}function Qd(o,e,t){return Wd(_n(o),e,t)}Jd();const uo=Object.freeze(Object.defineProperty({__proto__:null,FunctionsError:Ze,connectFunctionsEmulator:ho,getFunctions:Dn,httpsCallable:st,httpsCallableFromURL:Qd},Symbol.toStringTag,{value:"Module"})),eh=["Northwind Legal","Acme Ventures","Solaris Health","Beacon Realty","Atlas Finance","Bluebird Energy"],th=[{label:"Docs decoded",value:"42k+"},{label:"Average time saved",value:"3.4 hrs"},{label:"Risk flags identified",value:"128k+"}],sh=[{title:"Upload or open a PDF",description:"Drop in a contract, policy, or report. No setup required."},{title:"Decode with AI",description:"We translate the text, highlight obligations, and surface risks."},{title:"Act with clarity",description:"Export notes or send for signature only when you are ready."}],nh=[{title:"Plain-language summaries",description:"Every section is rewritten into clear, actionable language."},{title:"Risk and obligation flags",description:"Spot penalties, expiry traps, and one-sided clauses fast."},{title:"Side-by-side evidence",description:"See the original text next to the AI explanation."},{title:"Shareable decision reports",description:"Create a clean, board-ready summary in one click."},{title:"Structured highlights",description:"Tag sections as financial, legal, or operational."},{title:"Secure by design",description:"Free mode never stores files. Pro adds private vaults."}],un=[{slug:"procurement-teams",title:"Procurement teams",description:"Speed up vendor contract review across procurement, operations, and vendor teams.",audience:"Procurement",heroTitle:"Review supplier contracts with less back-and-forth",heroDescription:"Get clear obligations, risk hotspots, and negotiation points before legal and finance sign-off.",documentTypes:["Master service agreements","Order forms and pricing schedules","Security and data processing addenda","Renewal and termination terms"],painPoints:["Commercial terms are spread across annexes and riders.","Auto-renewal and notice periods are easy to miss.","Risk language is hard to summarize for non-legal stakeholders.","Vendor redlines can hide one-sided liabilities."],workflow:[{step:"Collect the vendor packet",detail:"Open the MSA, order form, and policy addenda in one review flow."},{step:"Surface obligations by category",detail:"Map payment, liability, security, and termination clauses into clear buckets."},{step:"Export a negotiation brief",detail:"Share key risks, fallback language, and decision notes with legal and budget owners."}],deliverables:["Clause-level summary for internal approvals","Priority list of terms to negotiate","Renewal and notice-date watchlist","Decision-ready brief for leadership"],highlights:[{label:"Main outcome",value:"Faster contract triage"},{label:"Best for",value:"High-volume vendor intake"},{label:"Team fit",value:"Procurement + Legal + Finance"}],cta:{primaryLabel:"Open procurement review",primaryTo:"/view",secondaryLabel:"Talk to the team",secondaryTo:"/contact"}},{slug:"startup-founders",title:"Startup founders",description:"Understand term sheets and SaaS agreements fast.",audience:"Founders",heroTitle:"Get investor and vendor terms into plain language quickly",heroDescription:"Move faster in fundraising and operations without signing unclear clauses under pressure.",documentTypes:["SAFE notes and term sheets","SaaS contracts and procurement agreements","Partnership and channel agreements","Advisory and contractor contracts"],painPoints:["Legal wording slows decisions during fundraising windows.","Operational agreements include hidden lock-ins.","Founders need to brief co-founders and advisors quickly.","Critical downside terms are buried in dense clauses."],workflow:[{step:"Open the latest draft",detail:"Load investor or vendor documents without changing your existing process."},{step:"Identify non-standard terms",detail:"Highlight liquidation preferences, assignment terms, and exclusivity language."},{step:"Prepare founder decision notes",detail:"Capture what to accept, what to renegotiate, and what needs external counsel."}],deliverables:["Executive summary for co-founders","Negotiation checklist before signature","Risk flags with source text evidence","Clear list of terms requiring legal review"],highlights:[{label:"Main outcome",value:"Higher decision confidence"},{label:"Best for",value:"Lean teams with limited legal bandwidth"},{label:"Team fit",value:"Founders + Advisors"}],cta:{primaryLabel:"Open founder workflow",primaryTo:"/view",secondaryLabel:"Ask a question",secondaryTo:"/contact"}},{slug:"freelancers-agencies",title:"Freelancers & agencies",description:"Review client contracts faster and protect scope, payment, and IP before work starts.",audience:"Freelancers",heroTitle:"Contract review for freelancers and agencies who need clear terms before they deliver",heroDescription:"Decode client agreements, statements of work, and retainers in plain language so you can avoid scope creep, payment disputes, and hidden liability.",documentTypes:["Master service agreements and statements of work","Retainer and project contracts","Creative and marketing service agreements","Subcontractor and collaboration agreements"],painPoints:["Scope language is often vague, leading to unpaid revisions and delivery disputes.","Payment terms and late-fee clauses are easy to miss in long contracts.","IP ownership and usage rights are frequently unclear until after delivery.","Termination and liability terms can expose small teams to outsized risk."],workflow:[{step:"Upload the client contract pack",detail:"Review the MSA, SOW, and attachment terms together so context is not lost across files."},{step:"Surface payment, scope, and IP risk",detail:"Highlight revision limits, acceptance criteria, ownership rights, and liability boundaries in one summary."},{step:"Share a negotiation-ready checklist",detail:"Send clear contract notes to your team or client before kickoff so expectations are aligned."}],deliverables:["Scope and change-request risk summary","Payment and renewal term checklist","IP ownership and licensing clarification notes","Negotiation points before project kickoff"],highlights:[{label:"Main outcome",value:"Fewer scope and payment surprises"},{label:"Best for",value:"Freelancers and small agencies"},{label:"Team fit",value:"Founder + Client delivery team"}],cta:{primaryLabel:"Open freelancer review",primaryTo:"/view",secondaryLabel:"See pricing",secondaryTo:"/pricing"}},{slug:"small-business-owners",title:"Small business owners",description:"Understand supplier, service, and lease contracts before they impact cash flow.",audience:"Small Business",heroTitle:"Contract analysis for small business owners who cannot afford hidden terms",heroDescription:"Decode vendor agreements, leases, loans, and service contracts quickly so you can protect margin, cash flow, and daily operations.",documentTypes:["Supplier and vendor agreements","Commercial leases and property terms","Loan, equipment finance, and credit agreements","Operational service contracts and maintenance agreements"],painPoints:["Hidden renewals and fee escalators can erode margin over time.","Owners often sign under time pressure without clear legal interpretation.","Operational obligations are spread across clauses that are hard to compare.","One unclear term can create downstream cash flow and delivery risk."],workflow:[{step:"Upload your agreement",detail:"Open contracts in one review flow before approval or renewal deadlines."},{step:"Highlight cost and obligation terms",detail:"Surface renewal windows, payment triggers, liability terms, and exit conditions in plain English."},{step:"Decide with confidence",detail:"Share clear notes with partners, advisors, or legal support before committing your business."}],deliverables:["Contract risk summary tied to business impact","Renewal and notice-date checklist","Clause list for legal escalation","Decision-ready owner brief"],highlights:[{label:"Main outcome",value:"Better cash-flow protection"},{label:"Best for",value:"Owner-operators and lean teams"},{label:"Team fit",value:"Owner + Ops + Finance"}],cta:{primaryLabel:"Open business contract review",primaryTo:"/view",secondaryLabel:"Talk to us",secondaryTo:"/contact"}},{slug:"hr-people-ops",title:"HR & people ops",description:"Review contracts, handbooks, and compliance updates with confidence.",audience:"People Ops",heroTitle:"Reduce people-risk in employment documentation",heroDescription:"Keep employment terms consistent and understandable across contracts, policies, and updates.",documentTypes:["Employment contracts and offer letters","Employee handbook updates","Workplace policy and compliance notices","Contractor and consultant agreements"],painPoints:["Policy updates are difficult to compare release to release.","Employment terms can drift across templates and locations.","Managers need concise summaries for practical application.","Risk language must be tracked before rollout."],workflow:[{step:"Review policy or contract drafts",detail:"Analyze updates before distribution or employee signature."},{step:"Spot inconsistencies and edge cases",detail:"Flag conflicting obligations, unclear wording, and potential compliance risk."},{step:"Ship a manager-friendly summary",detail:"Provide plain-language guidance for leaders and HR business partners."}],deliverables:["Policy change summary in plain language","Inconsistency and ambiguity report","Manager communication draft points","Pre-release checklist for HR approval"],highlights:[{label:"Main outcome",value:"More consistent policy rollouts"},{label:"Best for",value:"Distributed teams and frequent updates"},{label:"Team fit",value:"HR + Legal + Operations"}],cta:{primaryLabel:"Open HR review flow",primaryTo:"/view",secondaryLabel:"Contact us",secondaryTo:"/contact"}},{slug:"property-managers",title:"Property managers",description:"Decode leases, maintenance agreements, and building policies.",audience:"Property",heroTitle:"Handle lease and building terms with fewer surprises",heroDescription:"Understand obligations across tenants, vendors, and owners before commitments become operational issues.",documentTypes:["Commercial and residential lease agreements","Maintenance and service contracts","Building compliance and policy documents","Owner and tenant amendments"],painPoints:["Obligations vary by lease template and special conditions.","Maintenance responsibility language is often ambiguous.","Penalty and default terms are hard to track at scale.","Team handoffs create context loss between operations and legal."],workflow:[{step:"Open lease and service agreements",detail:"Review clauses that directly impact operations, timelines, and cost."},{step:"Map obligations by stakeholder",detail:"Separate owner, tenant, and vendor responsibilities into clear action items."},{step:"Create an operational handoff",detail:"Export key terms for facilities, finance, and portfolio managers."}],deliverables:["Responsibility matrix by party","Critical date and notice summary","Risk flags for penalties and defaults","Operations-ready implementation notes"],highlights:[{label:"Main outcome",value:"Clearer cross-team execution"},{label:"Best for",value:"Multi-site lease portfolios"},{label:"Team fit",value:"Property + Facilities + Finance"}],cta:{primaryLabel:"Open lease review",primaryTo:"/view",secondaryLabel:"Discuss your workflow",secondaryTo:"/contact"}},{slug:"legal-teams",title:"Legal teams",description:"Review NDAs, IP agreements, and litigation documents.",audience:"Legal",heroTitle:"Accelerate first-pass review without sacrificing control",heroDescription:"Triage high-volume legal documents so counsel can focus on strategy, exceptions, and negotiation.",documentTypes:["NDAs and confidentiality agreements","IP assignment and license contracts","Supplier and customer agreements","Pre-litigation and dispute documentation"],painPoints:["Document volume delays turnaround for business teams.","Standard clauses still require repetitive first-pass checks.","Counsel time is consumed by low-value extraction work.","Stakeholders need evidence-backed summaries, not guesses."],workflow:[{step:"Run first-pass analysis",detail:"Extract obligations, carve-outs, and unusual terms across drafts."},{step:"Prioritize legal attention",detail:"Escalate clauses by materiality so counsel focuses where judgment is required."},{step:"Deliver stakeholder brief",detail:"Share concise legal findings with commercial and operational owners."}],deliverables:["First-pass clause extraction pack","Material-risk escalation shortlist","Source-linked summary for business partners","Review trail for team collaboration"],highlights:[{label:"Main outcome",value:"Better legal throughput"},{label:"Best for",value:"High-volume contract teams"},{label:"Team fit",value:"Legal + Procurement + Sales Ops"}],cta:{primaryLabel:"Open legal review",primaryTo:"/view",secondaryLabel:"Contact legal support",secondaryTo:"/contact"}},{slug:"finance-teams",title:"Finance teams",description:"Analyze investment docs, loan agreements, and financial contracts.",audience:"Finance",heroTitle:"Understand financial obligations before they hit your model",heroDescription:"Turn dense agreements into structured obligations that finance teams can validate and plan against.",documentTypes:["Loan and debt agreements","Investment and shareholder documents","Revenue-share and pricing contracts","Guarantee and covenant schedules"],painPoints:["Covenants and triggers are hard to map into planning cycles.","Fee and penalty terms are easy to underestimate.","Finance needs clear inputs from legal language.","Decision deadlines are tight when documents are complex."],workflow:[{step:"Analyze obligations and covenants",detail:"Highlight repayment terms, reporting duties, and breach triggers."},{step:"Convert clauses into finance inputs",detail:"Translate legal language into assumptions your team can model."},{step:"Share a risk-aware decision memo",detail:"Align CFO, legal, and leadership on impact before acceptance."}],deliverables:["Covenant and trigger register","Financial risk summary with evidence","Decision memo for leadership review","Checklist for post-signature monitoring"],highlights:[{label:"Main outcome",value:"Cleaner planning inputs"},{label:"Best for",value:"Debt and investment document review"},{label:"Team fit",value:"Finance + Legal + Executive"}],cta:{primaryLabel:"Open finance review",primaryTo:"/view",secondaryLabel:"Talk to us",secondaryTo:"/contact"}}],Ks={product:[{label:"How it works",href:"#how-it-works"},{label:"Use cases",href:"/uses-cases"},{label:"Pricing",href:"/pricing"}],company:[{label:"About",href:"/about"},{label:"Contact",href:"/contact"}],docs:[{label:"Docs home",href:"https://docs.decodocs.com/"},{label:"Getting started",href:"https://docs.decodocs.com/#getting-started"},{label:"Use cases",href:"/uses-cases"},{label:"Privacy",href:"/privacy"},{label:"Contact support",href:"/contact"}],legal:[{label:"Privacy",href:"/privacy"},{label:"Terms",href:"/terms"}]},ih="0.1.3+3ae98fd-2026-02-22T13:58:24.519Z",Zs=({href:o,children:e})=>{const t=typeof o=="string"&&/^https?:\/\//.test(o),s=typeof o=="string"&&o.startsWith("#");return t||(o==="/privacy"||o==="/terms")?u.jsx("a",{className:"text-slate-600 no-underline hover:text-slate-900 hover:underline",href:o,children:e}):s?u.jsx(ye,{className:"text-slate-600 no-underline hover:text-slate-900 hover:underline",to:{pathname:"/",hash:o},children:e}):u.jsx(ye,{className:"text-slate-600 no-underline hover:text-slate-900 hover:underline",to:o,children:e})},rh=()=>{const o=typeof ts=="string"?ts:ts.src,t=Ge().pathname==="/";return u.jsx("footer",{className:"border-t border-slate-200 bg-white px-6 py-12",children:u.jsxs("div",{className:"mx-auto grid w-full max-w-6xl gap-10 md:grid-cols-2 lg:grid-cols-[1.2fr_0.8fr_0.8fr_0.8fr_1fr]",children:[u.jsxs("div",{className:"flex flex-col gap-4",children:[u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsx("img",{src:o,alt:"DecoDocs",className:"h-10 w-10"}),u.jsxs("div",{children:[u.jsx("p",{className:"text-base font-semibold text-slate-900",children:"DecoDocs"}),u.jsx("p",{className:"text-xs text-slate-500",children:"Understand documents before you sign"})]})]}),u.jsx("div",{className:"mt-2",children:u.jsx(ye,{to:"/view",className:"inline-flex rounded-full bg-slate-900 px-4 py-2 text-sm font-semibold text-white no-underline hover:bg-slate-800","aria-label":"Open DecoDocs Web App",children:"Open DecoDocs Web App"})}),u.jsx("p",{className:"text-sm text-slate-600",children:"Privacy-first document understanding by Snap Sign Pty Ltd."}),u.jsxs("p",{className:"text-xs text-slate-500",children:["Â© ",new Date().getFullYear()," Snap Sign Pty Ltd. All rights reserved."]}),u.jsxs("p",{className:"text-xs text-slate-400",children:["Version: ",ih]})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Product"}),u.jsx("ul",{className:"mt-4 space-y-3 text-sm text-slate-600 list-none p-0 m-0",children:Ks.product.map(s=>u.jsx("li",{className:"m-0",children:t&&typeof s.href=="string"&&s.href.startsWith("#")?u.jsx("a",{className:"text-slate-600 no-underline hover:text-slate-900 hover:underline",href:s.href,children:s.label}):u.jsx(Zs,{href:s.href,children:s.label})},s.label))})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Company"}),u.jsx("ul",{className:"mt-4 space-y-3 text-sm text-slate-600 list-none p-0 m-0",children:Ks.company.map(s=>u.jsx("li",{className:"m-0",children:u.jsx(Zs,{href:s.href,children:s.label})},s.label))})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Docs"}),u.jsx("ul",{className:"mt-4 space-y-3 text-sm text-slate-600 list-none p-0 m-0",children:Ks.docs.map(s=>u.jsx("li",{className:"m-0",children:u.jsx(Zs,{href:s.href,children:s.label})},s.label))})]}),u.jsxs("div",{children:[u.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Legal"}),u.jsx("ul",{className:"mt-4 space-y-3 text-sm text-slate-600 list-none p-0 m-0",children:Ks.legal.map(s=>u.jsx("li",{className:"m-0",children:u.jsx(Zs,{href:s.href,children:s.label})},s.label))})]})]})})},ah=({children:o})=>(T.useEffect(()=>{za()},[]),o),lt=()=>{const o=Zn(tc),e=Zn(sc),t=Zn(nc);return T.useEffect(()=>{za()},[]),{authState:o,app:e,auth:t,...ic}},ss=(o,e={})=>{typeof window>"u"||typeof window.gtag=="function"&&window.gtag("event",o,e)};function oh(){const{authState:o,auth:e}=lt();return T.useRef(!1),T.useEffect(()=>{},[o?.status,o?.user?.isAnonymous,e]),null}const Nr={primary:"bg-slate-900 text-white border border-transparent hover:bg-slate-800 shadow-lg shadow-slate-900/20",secondary:"bg-white text-slate-900 border border-slate-200 hover:bg-slate-50 shadow-sm",outline:"bg-transparent text-slate-600 border border-slate-200 hover:border-slate-300 hover:text-slate-900",ghost:"bg-transparent text-slate-600 border border-transparent hover:bg-slate-100 hover:text-slate-900"},Pr={sm:"px-4 py-2 text-sm",md:"px-6 py-3 text-sm",lg:"px-8 py-4 text-base"},_t=({variant:o="primary",size:e="md",className:t="",href:s,to:n,onClick:i,children:r,type:a="button",...l})=>{const c="inline-flex items-center justify-center font-bold rounded-full transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-slate-400 focus:ring-offset-2 disabled:opacity-50 disabled:pointer-events-none",d=Nr[o]||Nr.primary,h=Pr[e]||Pr.md,f=`${c} ${d} ${h} ${t}`;return n?u.jsx(ye,{to:n,className:f,...l,children:r}):s?u.jsx("a",{href:s,className:f,...l,children:r}):u.jsx("button",{type:a,onClick:i,className:f,...l,children:r})},Rr=[{label:"How it works",href:"#how-it-works"},{label:"Features",href:"#features"},{label:"Use cases",to:"/use-cases",external:!0},{label:"Pricing",to:"/pricing",external:!0},{label:"About",to:"/about"}],lh=({variant:o="marketing",onOpenPdf:e,sticky:t=!1,children:s})=>{const n=typeof ts=="string"?ts:ts.src,i=Ge(),{authState:r}=lt(),[a,l]=T.useState(!1),c=o==="app",d=i.pathname==="/"||i.pathname==="/app",h=i.pathname==="/sign-in"||i.pathname==="/sign-up",f=r?.status==="authenticated"&&!r?.user?.isAnonymous,p=c?"hidden items-center gap-5 text-sm font-semibold text-slate-600 lg:flex":"hidden items-center gap-8 text-sm font-semibold text-slate-600 md:flex";T.useEffect(()=>{l(!1)},[i.pathname,i.hash]);const b=h?i.pathname==="/sign-in"?{label:"Sign Up",to:"/sign-up"}:{label:"Sign In",to:"/sign-in"}:e?{label:"Open PDF",onClick:e}:f?{label:"Profile",to:"/profile"}:{label:"Sign In",to:"/sign-in"},m=h?null:e?f?{label:"Profile",to:"/profile",variant:"outline"}:{label:"Sign In",to:"/sign-in",variant:"outline"}:null,y=()=>l(v=>!v),g=()=>l(!1),x=v=>{const _="hover:text-slate-900 transition-colors no-underline text-slate-600";return v.href&&v.href.startsWith("#")?d?u.jsx("a",{className:_,href:v.href,onClick:g,children:v.label}):u.jsx(ye,{className:_,to:{pathname:"/",hash:v.href},onClick:g,children:v.label}):v.external?u.jsx("a",{className:_,href:v.to,onClick:g,children:v.label}):u.jsx(ye,{className:_,to:v.to,onClick:g,children:v.label})},w=(v,_="")=>{if(!v)return null;const{label:E,to:k,onClick:D,variant:N="primary"}=v,R=D?()=>{g(),D()}:void 0;return u.jsx(_t,{variant:N,size:"sm",to:k,onClick:R,className:_,children:E})};return u.jsxs("header",{className:`z-30 w-full border-b border-white/40 bg-white/70 backdrop-blur-xl ${t?"sticky top-0":""}`,children:[u.jsxs("div",{className:`mx-auto flex w-full items-center justify-between px-5 sm:px-6 ${c?"h-14 py-2":"max-w-6xl py-3 sm:py-4"}`,children:[u.jsxs(ye,{to:"/",className:"flex items-center gap-2.5 text-base font-bold tracking-tight text-slate-900 no-underline sm:gap-3 sm:text-lg",children:[u.jsx("img",{src:n,alt:"DecoDocs",className:"h-8 w-8 sm:h-9 sm:w-9"}),u.jsx("span",{className:"hidden sm:inline",children:"DecoDocs"})]}),u.jsx("nav",{className:p,children:Rr.map(v=>u.jsx("span",{children:x(v)},v.label))}),u.jsxs("div",{className:"flex items-center gap-3",children:[!c&&u.jsxs("div",{className:"hidden items-center gap-3 md:flex",children:[w(m,"bg-white/50"),w(b)]}),c&&u.jsxs("div",{id:"header-app-actions",className:"flex items-center gap-2",children:[u.jsxs(ye,{to:"/pricing",className:"flex items-center gap-1.5 px-3 py-1.5 text-xs font-bold text-amber-700 bg-amber-50 hover:bg-amber-100 rounded-full transition-colors no-underline border border-amber-200/60",children:[u.jsx(Cs,{className:"w-3.5 h-3.5"}),"Upgrade"]}),f?u.jsx(ye,{to:"/profile",className:"flex items-center justify-center w-8 h-8 rounded-full bg-slate-100 hover:bg-slate-200 transition-colors border border-slate-200/60",title:r?.user?.email||"Profile",children:r?.user?.photoURL?u.jsx("img",{src:r.user.photoURL,alt:"",className:"w-8 h-8 rounded-full object-cover"}):u.jsx(Ol,{className:"w-4 h-4 text-slate-500"})}):u.jsx(ye,{to:"/sign-in",className:"inline-flex items-center justify-center rounded-full border border-slate-200 bg-white px-3 py-1.5 text-xs font-semibold text-slate-800 no-underline hover:bg-slate-50",children:"Sign In"})]}),u.jsxs("button",{type:"button",className:"inline-flex items-center justify-center rounded-full border border-slate-200 bg-white/80 p-2 text-slate-700 shadow-sm transition hover:border-slate-300 lg:hidden","aria-expanded":a,"aria-controls":"site-mobile-menu",onClick:y,children:[u.jsx("span",{className:"sr-only",children:"Toggle menu"}),a?u.jsxs("svg",{"aria-hidden":"true",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:[u.jsx("path",{d:"M5 5L15 15",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round"}),u.jsx("path",{d:"M15 5L5 15",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round"})]}):u.jsxs("svg",{"aria-hidden":"true",width:"20",height:"20",viewBox:"0 0 20 20",fill:"none",children:[u.jsx("path",{d:"M3 5H17",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round"}),u.jsx("path",{d:"M3 10H17",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round"}),u.jsx("path",{d:"M3 15H17",stroke:"currentColor",strokeWidth:"1.8",strokeLinecap:"round"})]})]})]})]}),u.jsx("div",{id:"site-mobile-menu",className:`lg:hidden ${a?"block":"hidden"}`,children:u.jsxs("div",{className:"px-6 pb-4 pt-2",children:[u.jsx("div",{className:"flex flex-col gap-3 text-sm font-semibold text-slate-700",children:Rr.map(v=>u.jsx("span",{children:x(v)},v.label))}),u.jsx("div",{className:"mt-4 flex flex-col gap-3",children:c?u.jsxs(u.Fragment,{children:[u.jsxs(ye,{to:"/pricing",onClick:g,className:"inline-flex items-center justify-center gap-1.5 rounded-full border border-amber-200/60 bg-amber-50 px-4 py-2 text-sm font-bold text-amber-700 no-underline hover:bg-amber-100",children:[u.jsx(Cs,{className:"h-4 w-4"}),"Upgrade"]}),f?u.jsx(ye,{to:"/profile",onClick:g,className:"inline-flex items-center justify-center rounded-full border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-800 no-underline hover:bg-slate-50",children:"Profile"}):u.jsx(ye,{to:"/sign-in",onClick:g,className:"inline-flex items-center justify-center rounded-full border border-slate-200 bg-white px-4 py-2 text-sm font-semibold text-slate-800 no-underline hover:bg-slate-50",children:"Sign In"})]}):u.jsxs(u.Fragment,{children:[w(m,"w-full justify-center bg-white/60"),w(b,"w-full justify-center")]})})]})}),s]})},ch=async(o,e)=>(await st(o,"submitUserReport")(e))?.data||{ok:!1},dh=async(o,e)=>(await st(o,"submitClientCrash")(e))?.data||{ok:!1},hh=[{id:"feedback",label:"Leave feedback"},{id:"bug",label:"Report a bug"}],uh="inline-flex items-center justify-center rounded-full px-4 py-2 text-xs font-semibold shadow-sm transition hover:translate-y-[-1px]";function fh(){const{app:o}=lt(),e=T.useMemo(()=>o?Dn(o):null,[o]),[t,s]=T.useState(null),[n,i]=T.useState(""),[r,a]=T.useState(0),[l,c]=T.useState(!1),[d,h]=T.useState(""),[f,p]=T.useState(""),b=g=>{s(g),i(""),a(0),c(!1),h(""),p("")},m=()=>{s(null),i(""),a(0),c(!1),h(""),p("")},y=async g=>{if(g.preventDefault(),h(""),p(""),!e){h("Reporting is temporarily unavailable. Please refresh and try again.");return}const x=n.trim();if(x.length<8){h("Please provide at least 8 characters.");return}if(t==="feedback"&&(r<1||r>5)){h("Please rate your experience from 1 to 5 stars.");return}try{c(!0),await ch(e,{kind:t,ratingStars:t==="feedback"?r:void 0,message:x,pageUrl:window.location.href,userAgent:navigator.userAgent,extra:{viewport:`${window.innerWidth}x${window.innerHeight}`}}),p("Submitted. Thank you."),i("")}catch(w){h(w?.message||"Failed to submit report.")}finally{c(!1)}};return u.jsxs(u.Fragment,{children:[u.jsx("div",{className:"fixed bottom-4 right-4 z-40 flex flex-col gap-2",children:hh.map(g=>u.jsx("button",{type:"button",onClick:()=>b(g.id),className:`${uh} ${g.id==="feedback"?"bg-white text-slate-900 border border-slate-300":"bg-slate-900 text-white border border-slate-900"}`,children:g.label},g.id))}),t?u.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-slate-950/45 px-4",children:u.jsxs("div",{className:"w-full max-w-lg rounded-2xl border border-slate-200 bg-white p-5 shadow-xl",children:[u.jsx("h3",{className:"text-lg font-semibold text-slate-900",children:t==="feedback"?"Leave feedback":"Report a bug"}),u.jsx("p",{className:"mt-1 text-sm text-slate-600",children:"This goes to the admin reports dashboard."}),u.jsxs("form",{onSubmit:y,className:"mt-4",children:[t==="feedback"?u.jsxs("div",{className:"mb-3",children:[u.jsx("p",{className:"mb-2 text-sm font-medium text-slate-800",children:"Rate your experience"}),u.jsx("div",{className:"flex items-center gap-2",role:"radiogroup","aria-label":"Rate your experience from 1 to 5 stars",children:[1,2,3,4,5].map(g=>{const x=r===g;return u.jsxs("button",{type:"button",role:"radio","aria-checked":x,onClick:()=>a(g),className:`rounded-full border px-3 py-1.5 text-xs font-semibold transition ${x?"border-slate-900 bg-slate-900 text-white":"border-slate-300 bg-white text-slate-700 hover:border-slate-400"}`,children:[g," star",g===1?"":"s"]},g)})})]}):null,u.jsx("textarea",{value:n,onChange:g=>i(g.target.value),rows:6,className:"w-full rounded-xl border border-slate-300 px-3 py-2 text-sm text-slate-900 focus:border-slate-500 focus:outline-none",placeholder:t==="feedback"?"Tell us what would make DecoDocs better...":"What happened? Include expected vs actual behavior."}),d?u.jsx("div",{className:"mt-2 text-sm text-rose-700",children:d}):null,f?u.jsx("div",{className:"mt-2 text-sm text-emerald-700",children:f}):null,u.jsxs("div",{className:"mt-4 flex gap-2",children:[u.jsx("button",{type:"button",onClick:m,className:"rounded-full border border-slate-300 bg-white px-4 py-2 text-sm font-semibold text-slate-800",children:"Close"}),u.jsx("button",{type:"submit",disabled:l,className:"rounded-full border border-slate-900 bg-slate-900 px-4 py-2 text-sm font-semibold text-white disabled:opacity-60",children:l?"Submitting...":"Submit"})]})]})]})}):null]})}const Xi=({children:o,showHeader:e=!0,showFooter:t=!0,showOneTap:s=!1,showDecor:n=!1,variant:i="marketing",onOpenPdf:r})=>{const a=i==="app",l=Ge(),c=l?.pathname?.startsWith("/view")||l?.pathname?.startsWith("/edit"),d=a?"h-screen overflow-hidden":"";return u.jsxs("div",{className:`min-h-screen bg-[#f7f6f2] text-slate-900 flex flex-col ${d}`,children:[s?u.jsx(oh,{}):null,u.jsxs("div",{className:`relative flex min-h-0 flex-1 flex-col ${n?"overflow-hidden":""}`,children:[n?u.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[u.jsx("div",{className:"absolute -top-32 -right-20 h-72 w-72 rounded-full bg-[#d8e6ff] blur-3xl opacity-60 animate-float-slow"}),u.jsx("div",{className:"absolute top-40 -left-24 h-72 w-72 rounded-full bg-[#fde4c7] blur-3xl opacity-50 animate-float-slow"})]}):null,e?u.jsx(lh,{variant:i,onOpenPdf:r,sticky:a&&c}):null,u.jsx("main",{className:`flex-1 flex flex-col min-h-0 ${n?"relative z-10":""}`,children:o}),t?u.jsx(rh,{}):null]}),u.jsx(fh,{})]})},jt=({children:o,showOneTap:e=!1,showDecor:t=!1,onOpenPdf:s})=>u.jsx(Xi,{variant:"marketing",showHeader:!0,showFooter:!0,showOneTap:e,showDecor:t,onOpenPdf:s,children:o}),ph=({onOpenPdf:o})=>u.jsx("section",{id:"hero",className:"px-5 pb-14 pt-12 sm:px-6 sm:pb-16 sm:pt-16 lg:pb-24 lg:pt-28",children:u.jsxs("div",{className:"mx-auto grid w-full max-w-6xl items-center gap-10 sm:gap-12 lg:grid-cols-[1.1fr_0.9fr] lg:gap-16",children:[u.jsxs("div",{className:"flex flex-col gap-5 sm:gap-6 lg:gap-8",children:[u.jsx("span",{className:"w-fit rounded-full border border-slate-200 bg-white px-4 py-1.5 text-xs font-bold uppercase tracking-wider text-slate-600 shadow-sm",children:"Modern document intelligence"}),u.jsxs("h1",{className:"text-4xl font-bold leading-[1.08] tracking-tight text-slate-900 sm:text-5xl lg:text-6xl",children:["Decode documents ",u.jsx("br",{className:"hidden lg:block"}),u.jsx("span",{className:"text-transparent bg-clip-text bg-gradient-to-r from-slate-900 to-slate-600",children:"before you sign."})]}),u.jsx("p",{className:"max-w-xl text-base leading-relaxed text-slate-600 sm:text-lg lg:text-xl",children:"DecoDocs turns dense PDFs into clear decisions with AI summaries, risk flags, and evidence-backed explanations."}),u.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:gap-4",children:[u.jsx(_t,{variant:"primary",size:"lg",onClick:o,className:"w-full sm:w-auto",children:"Analyse a PDF Document"}),u.jsx(_t,{variant:"secondary",size:"lg",to:"/edit",className:"w-full sm:w-auto",children:"Correct a PDF Document"})]}),u.jsxs("div",{className:"mt-1 flex flex-wrap gap-3 text-xs font-medium text-slate-500 sm:mt-2 sm:gap-6 sm:text-sm",children:[u.jsxs("span",{className:"flex items-center gap-2.5",children:[u.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-emerald-500 shadow-[0_0_8px_rgba(16,185,129,0.4)]"}),"Free mode never stores files"]}),u.jsxs("span",{className:"flex items-center gap-2.5",children:[u.jsx("span",{className:"h-2.5 w-2.5 rounded-full bg-slate-900"}),"Pro includes vaults & history"]})]})]}),u.jsxs("div",{className:"relative mx-auto w-full max-w-[32rem] overflow-hidden rounded-3xl max-[390px]:max-h-[25rem] sm:max-h-[30rem] lg:max-h-none",children:[u.jsx("div",{className:"absolute -right-8 -top-8 h-48 w-48 rounded-full bg-purple-100 opacity-60 blur-3xl animate-float-slow sm:-right-12 sm:-top-12 sm:h-64 sm:w-64"}),u.jsx("div",{className:"absolute -bottom-8 -left-8 h-48 w-48 rounded-full bg-amber-100 opacity-60 blur-3xl animate-float-slow sm:-bottom-12 sm:-left-12 sm:h-64 sm:w-64",style:{animationDelay:"2s"}}),u.jsxs("div",{className:"relative rounded-3xl border border-white/60 bg-white/80 p-4 shadow-2xl shadow-slate-900/10 ring-1 ring-slate-900/5 backdrop-blur-xl transition-transform duration-500 hover:scale-[1.01] sm:p-6 lg:p-8",children:[u.jsxs("div",{className:"mb-4 flex items-center justify-between text-[11px] font-bold uppercase tracking-wider text-slate-400 sm:mb-6 sm:text-xs",children:[u.jsx("span",{children:"Contract Review"}),u.jsx("span",{children:"12 pages"})]}),u.jsxs("div",{className:"space-y-3 sm:space-y-4 lg:space-y-5",children:[u.jsxs("div",{className:"rounded-2xl border border-amber-100/50 bg-amber-50 p-4 sm:p-5",children:[u.jsxs("div",{className:"mb-2 flex gap-3",children:[u.jsx("div",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-amber-100 text-xs font-bold text-amber-600",children:"!"}),u.jsx("span",{className:"pt-0.5 text-xs font-bold uppercase tracking-wide text-amber-700",children:"Risk Flagged"})]}),u.jsx("p",{className:"text-sm font-medium leading-snug text-slate-800 sm:text-base",children:"Termination clause requires 90-day notice and carries a 3x fee."})]}),u.jsxs("div",{className:"rounded-2xl border border-slate-100 bg-white p-4 shadow-sm sm:p-5",children:[u.jsxs("div",{className:"mb-2 flex gap-3",children:[u.jsx("div",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-blue-50 text-xs font-bold text-blue-600",children:"i"}),u.jsx("span",{className:"pt-0.5 text-xs font-bold uppercase tracking-wide text-slate-500",children:"Plain English"})]}),u.jsx("p",{className:"text-xs leading-relaxed text-slate-600 sm:text-sm",children:"You must give three months notice or pay a penalty equal to three months of fees."})]}),u.jsxs("div",{className:"hidden rounded-2xl bg-slate-900 p-5 text-white shadow-lg shadow-slate-900/10 sm:block",children:[u.jsxs("div",{className:"mb-2 flex gap-3",children:[u.jsx("div",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-slate-700 text-xs font-bold text-white",children:"âœ“"}),u.jsx("span",{className:"pt-0.5 text-xs font-bold uppercase tracking-wide text-slate-400",children:"Recommendation"})]}),u.jsx("p",{className:"text-sm font-medium leading-relaxed",children:"Renegotiate the termination period to 30 days or cap the penalty at 1x fee."})]})]}),u.jsxs("div",{className:"mt-4 flex items-center justify-between rounded-2xl border border-slate-100 bg-slate-50 px-4 py-3 text-[11px] sm:mt-6 sm:px-5 sm:py-4 sm:text-xs lg:mt-8",children:[u.jsxs("span",{className:"flex items-center gap-2 text-slate-500",children:[u.jsx("span",{className:"w-2 h-2 rounded-full bg-emerald-500"}),"AI decode complete"]}),u.jsx("span",{className:"rounded-full border border-slate-200 bg-white px-2.5 py-1 font-bold text-slate-900 shadow-sm sm:px-3",children:"Ready to review"})]})]})]})]})}),us=({eyebrow:o,title:e,description:t,align:s="center"})=>{const n=s==="left"?"items-start text-left":"items-center text-center";return u.jsxs("div",{className:`flex flex-col gap-3 ${n}`,children:[o?u.jsx("span",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:o}):null,u.jsx("h2",{className:"text-3xl md:text-4xl font-semibold text-slate-900",children:e}),t?u.jsx("p",{className:"text-base md:text-lg text-slate-600 max-w-2xl",children:t}):null]})},mh=()=>u.jsx("section",{className:"px-6 py-16",children:u.jsxs("div",{className:"mx-auto flex w-full max-w-6xl flex-col gap-10",children:[u.jsx(us,{eyebrow:"Trusted teams",title:"Teams use DecoDocs to review faster",description:"From startups to procurement teams, we help busy leaders move faster without missing critical terms."}),u.jsx("div",{className:"grid gap-4 md:grid-cols-3",children:th.map(o=>u.jsxs("div",{className:"rounded-3xl border border-white/60 bg-white/80 p-6 shadow-lg shadow-slate-900/5",children:[u.jsx("p",{className:"text-2xl font-semibold text-slate-900",children:o.value}),u.jsx("p",{className:"mt-2 text-sm text-slate-500",children:o.label})]},o.label))}),u.jsx("div",{className:"flex flex-wrap items-center justify-center gap-4 rounded-3xl border border-white/50 bg-white/70 px-6 py-5 text-xs uppercase tracking-[0.2em] text-slate-400",children:eh.map(o=>u.jsx("span",{children:o},o))})]})}),gh=()=>{const o=[Li,Cs,pn];return u.jsx("section",{id:"how-it-works",className:"px-6 py-16",children:u.jsxs("div",{className:"mx-auto flex w-full max-w-6xl flex-col gap-10",children:[u.jsx(us,{eyebrow:"How it works",title:"Three steps to clarity",description:"No onboarding, no templates. Drop in a document and get structured insights within seconds.",align:"left"}),u.jsx("div",{className:"grid gap-6 md:grid-cols-3",children:sh.map((e,t)=>u.jsxs("div",{className:"rounded-3xl border border-slate-100 bg-white p-6 shadow-lg shadow-slate-900/5",children:[u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("span",{className:"text-xs font-semibold uppercase tracking-[0.3em] text-slate-400",children:["Step ",t+1]}),ls.createElement(o[t],{className:"w-6 h-6 text-slate-400"})]}),u.jsx("h3",{className:"mt-6 text-xl font-semibold text-slate-900",children:e.title}),u.jsx("p",{className:"mt-3 text-sm text-slate-600",children:e.description})]},e.title))})]})})},bh=()=>{const o=[En,Mi,Bl,Ul,zl,Ca];return u.jsx("section",{id:"features",className:"px-6 py-16",children:u.jsxs("div",{className:"mx-auto flex w-full max-w-6xl flex-col gap-10",children:[u.jsx(us,{eyebrow:"Product",title:"Every insight you need to move faster",description:"Built for modern teams that need clarity, speed, and secure workflows."}),u.jsx("div",{className:"grid gap-6 md:grid-cols-2 lg:grid-cols-3",children:nh.map((e,t)=>u.jsxs("div",{className:"group rounded-3xl border border-slate-100 bg-white p-6 shadow-lg shadow-slate-900/5 transition hover:-translate-y-1",children:[u.jsx("div",{className:"flex h-10 w-10 items-center justify-center rounded-2xl bg-slate-900 text-white",children:ls.createElement(o[t],{className:"w-5 h-5"})}),u.jsx("h3",{className:"mt-5 text-lg font-semibold text-slate-900",children:e.title}),u.jsx("p",{className:"mt-3 text-sm text-slate-600",children:e.description})]},e.title))})]})})},yh=()=>{const o=e=>e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"");return u.jsx("section",{id:"use-cases",className:"px-6 py-24 bg-slate-50",children:u.jsxs("div",{className:"mx-auto flex w-full max-w-6xl flex-col gap-12",children:[u.jsx(us,{eyebrow:"Use cases",title:"Built for high-stakes decisions",description:"DecoDocs supports every team that needs clean answers before signing or committing.",align:"left"}),u.jsx("div",{className:"grid gap-8 md:grid-cols-2 lg:grid-cols-3",children:un.map((e,t)=>u.jsxs("div",{className:"group relative flex flex-col rounded-3xl border border-slate-200 bg-white p-8 shadow-sm hover:shadow-xl hover:border-slate-300 transition-all duration-300",children:[u.jsxs("div",{className:"flex items-center justify-between text-xs font-bold uppercase tracking-wider text-slate-400 mb-6 group-hover:text-slate-600 transition-colors",children:[u.jsx("span",{children:e.audience||"Use case"}),u.jsx("span",{children:String(t+1).padStart(2,"0")})]}),u.jsx("h3",{className:"text-2xl font-bold text-slate-900 mb-4 group-hover:text-amber-600 transition-colors",children:e.title}),u.jsx("p",{className:"text-base text-slate-600 leading-relaxed",children:e.description}),u.jsxs(ye,{to:`/use-cases/${e.slug||o(e.title)}`,className:"mt-8 pt-6 border-t border-slate-100 flex items-center text-sm font-bold text-slate-900 opacity-60 group-hover:opacity-100 transition-opacity no-underline hover:text-slate-900",children:[u.jsx("span",{children:"Learn more"}),u.jsx("svg",{className:"w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17 8l4 4m0 0l-4 4m4-4H3"})})]})]},e.title))})]})})};function xh(o){return Pt({attr:{version:"1.1",viewBox:"0 0 16 16"},child:[{tag:"path",attr:{d:"M5.482 12.944c-0.942-0.235-1.466-0.984-1.468-2.095-0-0.355 0.025-0.525 0.114-0.754 0.217-0.56 0.793-0.982 1.55-1.138 0.377-0.077 0.493-0.16 0.493-0.353 0-0.060 0.045-0.24 0.1-0.399 0.249-0.724 0.71-1.327 1.202-1.573 0.515-0.258 0.776-0.316 1.399-0.313 0.886 0.005 1.327 0.197 1.945 0.846l0.34 0.357 0.304-0.105c1.473-0.51 2.942 0.358 3.061 1.809l0.032 0.397 0.29 0.104c0.829 0.297 1.218 0.92 1.148 1.837-0.046 0.599-0.326 1.078-0.77 1.315l-0.209 0.112-4.638 0.009c-3.564 0.007-4.697-0.006-4.893-0.055v0zM1.613 12.281c-0.565-0.142-1.164-0.67-1.445-1.273-0.159-0.342-0.168-0.393-0.168-0.998 0-0.576 0.014-0.668 0.14-0.954 0.267-0.603 0.78-1.038 1.422-1.21 0.136-0.036 0.263-0.094 0.283-0.128s0.043-0.221 0.050-0.415c0.045-1.206 0.794-2.269 1.839-2.61 0.565-0.184 1.306-0.202 1.92 0.058 0.195 0.082 0.173 0.1 0.585-0.471 0.244-0.338 0.705-0.695 1.108-0.909 0.435-0.231 0.887-0.337 1.428-0.336 1.512 0.004 2.815 1.003 3.297 2.529 0.154 0.487 0.146 0.624-0.035 0.628-0.079 0.002-0.306 0.048-0.505 0.102l-0.361 0.099-0.329-0.348c-0.928-0.98-2.441-1.192-3.728-0.522-0.514 0.268-0.927 0.652-1.239 1.153-0.222 0.357-0.506 1.024-0.506 1.189 0 0.117-0.090 0.176-0.474 0.309-1.189 0.412-1.883 1.364-1.882 2.582 0 0.443 0.108 0.986 0.258 1.296 0.057 0.117 0.088 0.228 0.070 0.247-0.046 0.049-1.525 0.032-1.73-0.019v0z"},child:[]}]})(o)}function wh(o){return Pt({attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M.959 5.523c-.54 0-.959.42-.959.899v7.549a4.59 4.59 0 004.613 4.494 4.717 4.717 0 004.135-2.457c.779 1.438 2.337 2.457 4.074 2.457 2.577 0 4.674-2.037 4.674-4.613.06-2.457-2.037-4.495-4.613-4.495-1.738 0-3.295.959-4.074 2.397-.78-1.438-2.338-2.397-4.135-2.397-1.079 0-2.038.36-2.817.899V6.422a.92.92 0 00-.898-.899zM17.602 9.26a.95.95 0 00-.704.158c-.36.3-.479.899-.18 1.318l2.397 3.116-2.396 3.115c-.3.42-.24.96.18 1.26.419.3 1.016.298 1.316-.122l2.039-2.636 2.096 2.697c.3.36.899.419 1.318.12.36-.3.42-.84.121-1.259l-2.338-3.115 2.338-3.057c.3-.419.298-1.018-.121-1.318-.48-.3-1.019-.24-1.318.18l-2.096 2.576-2.04-2.695c-.149-.18-.373-.3-.612-.338zM4.613 11.154c1.558 0 2.817 1.26 2.817 2.758 0 1.558-1.259 2.756-2.817 2.756-1.558 0-2.816-1.198-2.816-2.756 0-1.498 1.258-2.758 2.816-2.758zm8.27 0c1.558 0 2.816 1.26 2.816 2.758-.06 1.558-1.318 2.756-2.816 2.756-1.558 0-2.817-1.198-2.817-2.756 0-1.498 1.259-2.758 2.817-2.758Z"},child:[]}]})(o)}function vh(o){return Pt({attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M6 1.807L0 5.629l6 3.822 6.001-3.822L6 1.807zM18 1.807l-6 3.822 6 3.822 6-3.822-6-3.822zM0 13.274l6 3.822 6.001-3.822L6 9.452l-6 3.822zM18 9.452l-6 3.822 6 3.822 6-3.822-6-3.822zM6 18.371l6.001 3.822 6-3.822-6-3.822L6 18.371z"},child:[]}]})(o)}function Ah(o){return Pt({attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M12.01 1.485c-2.082 0-3.754.02-3.743.047.01.02 1.708 3.001 3.774 6.62l3.76 6.574h3.76c2.081 0 3.753-.02 3.742-.047-.005-.02-1.708-3.001-3.775-6.62l-3.76-6.574zm-4.76 1.73a789.828 789.861 0 0 0-3.63 6.319L0 15.868l1.89 3.298 1.885 3.297 3.62-6.335 3.618-6.33-1.88-3.287C8.1 4.704 7.255 3.22 7.25 3.214zm2.259 12.653-.203.348c-.114.198-.96 1.672-1.88 3.287a423.93 423.948 0 0 1-1.698 2.97c-.01.026 3.24.042 7.222.042h7.244l1.796-3.157c.992-1.734 1.85-3.23 1.906-3.323l.104-.167h-7.249z"},child:[]}]})(o)}function Sh(o){return Pt({attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M18.164 7.93V5.084a2.198 2.198 0 001.267-1.978v-.067A2.2 2.2 0 0017.238.845h-.067a2.2 2.2 0 00-2.193 2.193v.067a2.196 2.196 0 001.252 1.973l.013.006v2.852a6.22 6.22 0 00-2.969 1.31l.012-.01-7.828-6.095A2.497 2.497 0 104.3 4.656l-.012.006 7.697 5.991a6.176 6.176 0 00-1.038 3.446c0 1.343.425 2.588 1.147 3.607l-.013-.02-2.342 2.343a1.968 1.968 0 00-.58-.095h-.002a2.033 2.033 0 102.033 2.033 1.978 1.978 0 00-.1-.595l.005.014 2.317-2.317a6.247 6.247 0 104.782-11.134l-.036-.005zm-.964 9.378a3.206 3.206 0 113.215-3.207v.002a3.206 3.206 0 01-3.207 3.207z"},child:[]}]})(o)}function _h(o){return Pt({attr:{role:"img",viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M13.762 4.29a6.51 6.51 0 0 0-5.669 3.332 3.571 3.571 0 0 0-1.558-.36 3.571 3.571 0 0 0-3.516 3A4.918 4.918 0 0 0 0 14.796a4.918 4.918 0 0 0 4.92 4.914 4.93 4.93 0 0 0 .617-.045h14.42c2.305-.272 4.041-2.258 4.043-4.589v-.009a4.594 4.594 0 0 0-3.727-4.508 6.51 6.51 0 0 0-6.511-6.27z"},child:[]}]})(o)}const Eh=[{name:"Google Drive",icon:Ah,color:"#4285F4"},{name:"Dropbox",icon:vh,color:"#0061FE"},{name:"OneDrive",icon:xh,color:"#0078D4"},{name:"iCloud",icon:_h,color:"#3693F3"},{name:"Box",icon:wh,color:"#0061D5"},{name:"HubSpot",icon:Sh,color:"#FF7A59"}],kh=()=>u.jsx("section",{className:"px-6 py-24 bg-white",children:u.jsx("div",{className:"mx-auto w-full max-w-6xl",children:u.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-12",children:[u.jsxs("div",{className:"flex-1 space-y-8",children:[u.jsx(us,{eyebrow:"Integrations",title:"Connects with your workflow in one click",description:"DecoDocs integrates seamlessly with the tools you already use. Analyze documents directly from your cloud storage or email.",align:"left"}),u.jsxs("div",{className:"flex flex-col gap-4",children:[u.jsxs("div",{className:"flex items-center gap-3 text-slate-700 font-medium",children:[u.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-emerald-100 text-emerald-600 text-xs text-bold",children:"âœ“"}),"Works with all file types"]}),u.jsxs("div",{className:"flex items-center gap-3 text-slate-700 font-medium",children:[u.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-emerald-100 text-emerald-600 text-xs text-bold",children:"âœ“"}),"Secure OAuth connection"]}),u.jsxs("div",{className:"flex items-center gap-3 text-slate-700 font-medium",children:[u.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-emerald-100 text-emerald-600 text-xs text-bold",children:"âœ“"}),"No file duplication"]})]})]}),u.jsx("div",{className:"flex-1 flex justify-center",children:u.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-6",children:Eh.map(o=>u.jsxs("div",{className:"flex flex-col items-center justify-center p-6 bg-slate-50 border border-slate-100 rounded-2xl shadow-sm w-32 h-32 hover:shadow-md transition-shadow group",children:[u.jsx(o.icon,{size:40,color:o.color,className:"mb-3 transition-transform group-hover:scale-110"}),u.jsx("span",{className:"text-xs font-semibold text-slate-600",children:o.name})]},o.name))})})]})})}),Ch=[{title:"Your data is never used for training",description:"We and our AI partners never use your documents to train models. Your data remains yours, contractually guaranteed.",icon:u.jsx("svg",{className:"w-6 h-6 text-slate-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})})},{title:"Locked down, end-to-end",description:"Your data is encrypted at rest (AES-256) and in transit (TLS 1.3). Only you can access your documents.",icon:u.jsx("svg",{className:"w-6 h-6 text-slate-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})},{title:"Privacy-first architecture",description:"DecoDocs is built with privacy as a core principle. Anonymous mode never stores files on our servers.",icon:u.jsx("svg",{className:"w-6 h-6 text-slate-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})},{title:"Built for enterprise IT",description:"Single Sign-On (SSO), audit logs, and custom retention polices available for enterprise teams.",icon:u.jsx("svg",{className:"w-6 h-6 text-slate-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}],Th=()=>u.jsx("section",{className:"px-6 py-24 bg-slate-50",children:u.jsxs("div",{className:"mx-auto w-full max-w-6xl flex flex-col gap-12",children:[u.jsx(us,{eyebrow:"Security",title:"Secure by design. Trusted by teams.",description:"We take security seriously. Your documents are your business, keeping them safe is ours.",align:"center"}),u.jsx("div",{className:"grid md:grid-cols-2 gap-8",children:Ch.map(o=>u.jsxs("div",{className:"bg-white p-8 rounded-3xl border border-slate-100 shadow-sm flex flex-col gap-4 hover:shadow-md transition-shadow",children:[u.jsx("div",{className:"w-12 h-12 rounded-2xl bg-slate-100 flex items-center justify-center",children:o.icon}),u.jsxs("div",{children:[u.jsx("h3",{className:"text-xl font-bold text-slate-900 mb-2",children:o.title}),u.jsx("p",{className:"text-slate-600 leading-relaxed",children:o.description})]})]},o.title))}),u.jsxs("div",{className:"mt-8 p-8 bg-slate-900 rounded-3xl text-white text-center",children:[u.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Ready to start?"}),u.jsx("p",{className:"text-slate-300 mb-8 max-w-2xl mx-auto",children:"Join thousands of professionals who trust DecoDocs to understand their documents faster."}),u.jsx("div",{className:"flex justify-center gap-4",children:u.jsx("a",{href:"#hero",className:"inline-flex items-center justify-center font-bold rounded-full px-8 py-4 text-base bg-white text-slate-900 hover:bg-slate-100 transition-colors",children:"Get Started for Free"})})]})]})}),Ye=({children:o,className:e=""})=>u.jsx("div",{className:`dd-card ${e}`,children:o}),Yi=({dialog:o,onConfirm:e,onCancel:t})=>o?u.jsx("div",{id:"viewer-gate-dialog",role:"dialog","aria-modal":"true",className:"fixed inset-0 bg-slate-900/45 flex items-center justify-center z-[2000] p-4",onClick:t,children:u.jsxs(Ye,{className:"max-w-[520px] w-full p-4 sm:p-5 max-h-[85vh] overflow-y-auto",children:[u.jsx("div",{className:"font-black text-base text-slate-900",children:o.title}),u.jsx("div",{className:"mt-2.5 text-slate-600 leading-relaxed whitespace-pre-wrap",children:o.message}),u.jsxs("div",{className:"mt-3.5 flex gap-2.5 flex-wrap justify-end",children:[o.secondaryLabel&&u.jsx(_t,{variant:"secondary",size:"sm",onClick:t,children:o.secondaryLabel}),o.primaryLabel&&u.jsx(_t,{variant:"primary",size:"sm",onClick:e,children:o.primaryLabel})]})]})}):null,Nh=()=>{const o=Rt(),e=T.useRef(null),[t,s]=T.useState(null),n=()=>{e.current&&e.current.click()},i=r=>{const a=r.target.files?.[0];if(a){if(a.type!=="application/pdf"){s({title:"Unsupported file",message:"Please select a valid PDF file.",primaryLabel:"OK",primaryTo:null}),r.target.value="";return}window.gtag&&window.gtag("event","home_open_pdf_click",{event_category:"engagement",event_label:"landing_open_pdf"}),o("/view",{state:{document:{id:Date.now()+Math.random(),name:a.name,size:a.size,type:a.type,file:a}}}),r.target.value=""}};return u.jsxs(jt,{showOneTap:!0,showDecor:!0,onOpenPdf:n,children:[u.jsx(Yi,{dialog:t,onCancel:()=>s(null),onConfirm:()=>s(null)}),u.jsx("input",{ref:e,type:"file",accept:".pdf,application/pdf",onChange:i,style:{display:"none"}}),u.jsx(ph,{onOpenPdf:n}),u.jsx(mh,{}),u.jsx(gh,{}),u.jsx(kh,{}),u.jsx(bh,{}),u.jsx("section",{className:"px-6 pb-4",children:u.jsx("div",{className:"mx-auto w-full max-w-6xl rounded-2xl border border-amber-200 bg-amber-50 px-5 py-4 text-sm text-amber-900",children:"DecoDocs provides informational analysis and is not legal advice. For legal decisions, consult a qualified professional."})}),u.jsx(yh,{}),u.jsx(Th,{})]})},fo=({onFileSelect:o,onEdit:e,pageNumber:t,numPages:s,pageScale:n,onPreviousPage:i,onNextPage:r,onZoomIn:a,onZoomOut:l,fileInputRef:c})=>u.jsxs("div",{id:"viewer-page-controls",className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex items-center gap-2 bg-slate-800/85 backdrop-blur-md px-3 py-1.5 rounded-full shadow-lg border border-white/10 z-30 text-white text-xs",children:[u.jsx("button",{onClick:()=>c.current?.click(),className:"p-1 bg-transparent text-slate-300 hover:text-white hover:bg-white/10 rounded-full transition-colors",title:"Open PDF",children:u.jsx(Li,{className:"w-3.5 h-3.5"})}),u.jsx("div",{className:"w-px h-3.5 bg-white/20"}),u.jsx("button",{onClick:i,disabled:t<=1,className:"p-0.5 bg-transparent rounded-full hover:bg-white/10 disabled:opacity-30 transition-colors text-white",children:u.jsx(Ta,{className:"w-3.5 h-3.5"})}),u.jsxs("span",{className:"font-medium text-white min-w-[3ch] text-center select-none tabular-nums",children:[t," ",u.jsxs("span",{className:"text-slate-400",children:["/ ",s||"-"]})]}),u.jsx("button",{onClick:r,disabled:t>=s,className:"p-0.5 bg-transparent rounded-full hover:bg-white/10 disabled:opacity-30 transition-colors text-white",children:u.jsx(Na,{className:"w-3.5 h-3.5"})}),u.jsx("div",{className:"w-px h-3.5 bg-white/20"}),u.jsx("button",{onClick:l,className:"p-0.5 bg-transparent text-slate-300 hover:text-white hover:bg-white/10 rounded-full transition-colors",title:"Zoom Out",children:u.jsx(Hl,{className:"w-3.5 h-3.5"})}),u.jsxs("span",{className:"font-medium text-slate-400 w-8 text-center select-none tabular-nums",children:[Math.round(n*100),"%"]}),u.jsx("button",{onClick:a,className:"p-0.5 bg-transparent text-slate-300 hover:text-white hover:bg-white/10 rounded-full transition-colors",title:"Zoom In",children:u.jsx($l,{className:"w-3.5 h-3.5"})}),u.jsx("input",{type:"file",ref:c,accept:".pdf",onChange:o,className:"hidden"})]}),Dr=o=>{const e=String(o?.message||o||"");return o?.name==="RenderingCancelledException"||e.includes("Rendering cancelled")},Ph=(o,e)=>{const t=T.useRef(null),s=T.useRef(null),n=T.useRef(null),i=(f,p)=>{typeof window>"u"||typeof window.dispatchEvent!="function"||window.dispatchEvent(new CustomEvent("decodocs:show-gate",{detail:{title:f,message:p,primaryLabel:"OK",primaryTo:null}}))},r=f=>{i("Clause",`${f.text}

${f.details||"No details available."}`)},a=f=>{i("Risk",`${f.description}

${f.explanation||"No explanation available."}`)},l=T.useCallback(async(f,p)=>{if(s.current){s.current.innerHTML="";try{const m=(await f.getTextContent()).items,y=p.transform;for(const g of m){const x=document.createElement("span");x.textContent=g.str,x.style.position="absolute",x.style.color="transparent",x.style.whiteSpace="pre",x.style.fontSize=`${g.height}px`,x.style.fontFamily="sans-serif",x.style.lineHeight="1";const w=y[0]*g.transform[4]+y[2]*g.transform[5]+y[4],v=y[1]*g.transform[4]+y[3]*g.transform[5]+y[5];x.style.left=`${w}px`,x.style.top=`${v}px`,x.style.width=`${g.width*y[0]}px`,x.style.height=`${g.height*y[3]}px`,s.current.appendChild(x)}}catch(b){if(Dr(b))return;console.error("Error rendering text layer:",b),console.error("Error rendering text layer message:",b?.message||b)}}},[]),c=T.useCallback((f,p,b,m,y)=>{n.current&&(n.current.innerHTML="",b.filter(g=>g.pageNum===f).forEach(g=>{const x=document.createElement("div");x.className="highlight-overlay",x.style.position="absolute",x.style.backgroundColor="rgba(255, 255, 0, 0.3)",x.style.border="1px solid rgba(255, 255, 0, 0.5)",x.style.left=`${g.x}px`,x.style.top=`${g.y}px`,x.style.width=`${g.width}px`,x.style.height=`${g.height}px`,x.style.pointerEvents="none",x.dataset.page=f,n.current.appendChild(x)}),m.filter(g=>g.pageNum===f).forEach(g=>{const x=document.createElement("div");x.className="clause-marker",x.style.position="absolute",x.style.left=`${g.x}px`,x.style.top=`${g.y}px`,x.style.width="20px",x.style.height="20px",x.style.borderRadius="50%",x.style.backgroundColor="rgba(0, 123, 255, 0.7)",x.style.cursor="pointer",x.style.zIndex="10",x.title=g.text,x.onclick=()=>r(g),n.current.appendChild(x)}),y.filter(g=>g.pageNum===f).forEach(g=>{const x=document.createElement("div");x.className="risk-badge",x.style.position="absolute",x.style.left=`${g.x}px`,x.style.top=`${g.y}px`,x.style.padding="2px 6px",x.style.borderRadius="10px",x.style.fontSize="12px",x.style.fontWeight="bold",x.style.color="white",x.style.backgroundColor=g.level==="high"?"#dc3545":g.level==="medium"?"#fd7e14":"#ffc107",x.style.cursor="pointer",x.style.zIndex="10",x.title=g.description,x.onclick=()=>a(g),x.textContent=g.level.toUpperCase(),n.current.appendChild(x)}))},[]),d=T.useRef(null);T.useEffect(()=>()=>{try{d.current?.cancel?.()}catch{}d.current=null},[]);const h=T.useCallback(async(f,p=[],b=[],m=[])=>{if(!(!o||!t.current)){try{d.current&&typeof d.current.cancel=="function"&&(d.current.cancel(),d.current=null)}catch{}try{const y=await o.getPage(f),g=t.current;if(!g)return;const x=g.getContext&&g.getContext("2d")||null;if(!x)return;const w=e,v=y.getViewport({scale:w});g.height=v.height,g.width=v.width,x.clearRect(0,0,g.width,g.height);const _={canvasContext:x,viewport:v},E=y.render(_);d.current=E,await E.promise,d.current=null,await l(y,v),c(f,v,p,b,m)}catch(y){if(Dr(y))return;console.error("Error rendering page:",y),console.error("Error rendering page message:",y?.message||y)}finally{d.current=null}}},[o,e,l,c]);return{canvasRef:t,textLayerRef:s,annotationsRef:n,renderPage:h}},Rh=({pdfDoc:o,pageNum:e,scale:t,highlights:s=[],clauseMarkers:n=[],riskBadges:i=[],id:r,children:a})=>{const{canvasRef:l,textLayerRef:c,annotationsRef:d,renderPage:h}=Ph(o,t);return T.useEffect(()=>{o&&e&&h(e,s,n,i)},[o,e,t,s,n,i,h]),u.jsxs("div",{id:r,className:"relative bg-white shadow-lg mb-8 transition-transform origin-top",style:{width:"fit-content",height:"fit-content"},children:[u.jsx("canvas",{ref:l,className:"block"}),u.jsx("div",{ref:c,className:"absolute top-0 left-0 w-full h-full overflow-hidden opacity-0 leading-none"}),u.jsx("div",{ref:d,className:"absolute top-0 left-0 w-full h-full pointer-events-none"}),a]})},po=({pdfDoc:o,numPages:e,pageScale:t,isLoading:s,loadingMessage:n,onPageVisible:i,highlights:r=[],clauseMarkers:a=[],riskBadges:l=[],renderPageOverlay:c})=>{const d=T.useRef(null);return T.useEffect(()=>{if(!o||!d.current||!i)return;const h=new IntersectionObserver(p=>{p.forEach(b=>{if(b.isIntersecting){const m=parseInt(b.target.getAttribute("data-page-num"),10);i(m)}})},{root:d.current,threshold:.5});return d.current.querySelectorAll(".page-wrapper").forEach(p=>h.observe(p)),()=>h.disconnect()},[o,e,i]),s?u.jsx("div",{className:"flex-1 flex items-center justify-center border border-dashed border-gray-300 rounded bg-gray-50 text-gray-600 h-full",children:u.jsxs("div",{className:"text-center",children:[u.jsx("div",{className:"w-10 h-10 border-4 border-gray-200 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"}),u.jsx("p",{children:n||"Loading PDF..."})]})}):o?u.jsx("div",{className:"flex flex-col items-center gap-8 py-8 w-full",children:Array.from({length:e},(h,f)=>f+1).map(h=>u.jsx("div",{className:"page-wrapper","data-page-num":h,children:u.jsx(Rh,{id:`pdf-page-${h}`,pdfDoc:o,pageNum:h,scale:t,highlights:r,clauseMarkers:a,riskBadges:l,children:c?c(h):null})},h))}):null},mo=({onFileSelect:o})=>{const[e,t]=T.useState(!1),s=T.useRef(null),n=a=>{a.preventDefault(),t(!0)},i=a=>{a.preventDefault(),t(!1)},r=a=>{a.preventDefault(),t(!1),a.dataTransfer.files&&a.dataTransfer.files.length>0&&o({target:{files:a.dataTransfer.files}})};return u.jsxs("div",{className:`flex flex-col items-center justify-center w-full max-w-2xl mx-auto h-96 border-2 border-dashed rounded-3xl transition-all duration-300 ${e?"border-blue-500 bg-blue-50/50 scale-105 shadow-xl":"border-slate-300 bg-white/50 hover:border-blue-400 hover:bg-slate-50"}`,onDragOver:n,onDragLeave:i,onDrop:r,children:[u.jsx("div",{className:`p-6 rounded-full mb-6 transition-colors ${e?"bg-blue-100 text-blue-600":"bg-slate-100 text-slate-400"}`,children:u.jsx(Pa,{className:"w-16 h-16"})}),u.jsx("h3",{className:"text-2xl font-bold text-slate-800 mb-2",children:"Upload a PDF or .snapsign file"}),u.jsx("p",{className:"text-slate-500 mb-8 text-center max-w-md px-4",children:"Drag and drop your file here, or click the button below to browse your computer."}),u.jsxs("button",{onClick:()=>s.current?.click(),className:"px-8 py-4 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl shadow-lg shadow-blue-600/20 transition-all hover:-translate-y-1 active:translate-y-0 flex items-center gap-3",children:[u.jsx(Wl,{className:"w-6 h-6"}),"Choose File"]}),u.jsx("input",{type:"file",ref:s,onChange:o,accept:".pdf,.snapsign,application/pdf",className:"hidden"})]})},Dh=o=>{if(!o)return!1;const e=String(o?.message||o);return o?.name==="RenderingCancelledException"||e.includes("Rendering cancelled")},Ih=({pdfDoc:o,pageNum:e,onClick:t,isActive:s})=>{const n=T.useRef(null),i=T.useRef(null);return T.useEffect(()=>{if(!o||!n.current)return;let r=!1;return(async()=>{try{const l=await o.getPage(e);if(r)return;const c=l.getViewport({scale:.15}),d=n.current;if(!d)return;const h=d.getContext&&d.getContext("2d")||null;if(!h)return;const f=i.current;if(f)try{f.cancel?.(),await f.promise}catch{}finally{i.current===f&&(i.current=null)}if(r)return;d.height=c.height,d.width=c.width;const p=l.render({canvasContext:h,viewport:c});i.current=p,await p.promise}catch(l){if(Dh(l))return;console.error("Error rendering thumbnail:",l?.message||l)}finally{i.current=null}})(),()=>{r=!0;try{i.current?.cancel?.()}catch{}i.current=null}},[o,e]),u.jsxs("button",{id:`thumb-${e}`,onClick:t,className:`flex flex-col items-center gap-1 w-full rounded-md p-1 transition-all ${s?"bg-blue-50 ring-1 ring-blue-400":"hover:bg-slate-100"}`,children:[u.jsx("div",{className:"shadow-sm bg-white rounded-sm overflow-hidden",children:u.jsx("canvas",{ref:n,className:"block w-16 h-auto"})}),u.jsx("span",{className:`text-[10px] tabular-nums ${s?"text-blue-600 font-semibold":"text-slate-400"}`,children:e})]})},go=({pdfDoc:o,numPages:e,currentPage:t,onPageClick:s})=>!o||!e?null:u.jsx("div",{id:"viewer-thumbnails",className:"w-24 bg-white/80 backdrop-blur-sm border-r border-slate-200/60 h-full overflow-y-auto py-2 px-1.5 flex flex-col gap-1",children:Array.from({length:e},(n,i)=>i+1).map(n=>u.jsx(Ih,{pdfDoc:o,pageNum:n,isActive:t===n,onClick:()=>s(n)},n))}),jh=({risk:o})=>u.jsxs("div",{"data-testid":"risk-flagged-card",className:"rounded-xl border border-orange-200 bg-gradient-to-br from-orange-50 to-amber-50 p-4 shadow-sm",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[u.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-orange-500 text-white",children:u.jsx(Mi,{className:"w-4 h-4"})}),u.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-orange-600",children:"Risk Flagged"})]}),u.jsx("p",{className:"text-slate-800 font-semibold text-sm leading-snug m-0",children:o.clause||o.description}),o.description&&o.clause&&u.jsx("p",{className:"text-slate-600 text-xs mt-1 m-0",children:o.description})]}),Lh=({text:o})=>u.jsxs("div",{"data-testid":"plain-english-card",className:"rounded-xl border border-blue-100 bg-blue-50/60 p-4 shadow-sm ml-4",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[u.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-blue-400 text-white",children:u.jsx(Gl,{className:"w-4 h-4"})}),u.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-blue-500",children:"Plain English"})]}),u.jsx("p",{className:"text-slate-700 text-sm leading-snug m-0",children:o})]}),Mh=({text:o})=>u.jsxs("div",{"data-testid":"recommendation-card",className:"rounded-xl border border-emerald-200 bg-gradient-to-br from-emerald-50 to-teal-50 p-4 shadow-sm",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[u.jsx("span",{className:"flex items-center justify-center w-6 h-6 rounded-full bg-emerald-500 text-white",children:u.jsx(pn,{className:"w-4 h-4"})}),u.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-emerald-600",children:"Recommendation"})]}),u.jsx("p",{className:"text-slate-800 text-sm leading-snug m-0",children:o})]}),Ir=({label:o,variant:e})=>{const t={success:"bg-emerald-100 text-emerald-700 border-emerald-200",loading:"bg-blue-100 text-blue-700 border-blue-200",idle:"bg-slate-100 text-slate-500 border-slate-200"};return u.jsxs("span",{className:`inline-flex items-center gap-1.5 text-xs font-medium px-2.5 py-1 rounded-full border ${t[e]||t.idle}`,children:[e==="success"&&u.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-emerald-500"}),e==="loading"&&u.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse"}),o]})},Fh=({analysis:o})=>{const e=o?._meta||{status:o?"success":"idle"},t=()=>u.jsx("p",{className:"text-[10px] text-slate-400 m-0 mt-4 leading-tight",children:"DecoDocs provides informational analysis only. This is not legal advice. For legal decisions consult a qualified professional."});if(!o||e.status==="idle")return u.jsxs("div",{"data-testid":"analysis-results",className:"rounded-2xl bg-gradient-to-b from-amber-50/40 to-white border border-slate-200 p-5 shadow-sm mt-2",children:[u.jsx("div",{className:"flex items-center justify-between mb-4",children:u.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-blue-600",children:"Contract Review"})}),u.jsxs("p",{className:"text-sm text-slate-500 m-0",children:["No analysis yet. Tap ",u.jsx("strong",{children:"Deep Analysis"})," on the Tools tab to review this document."]}),u.jsx(t,{})]});if(e.status==="loading")return u.jsxs("div",{"data-testid":"analysis-results",className:"rounded-2xl bg-gradient-to-b from-amber-50/40 to-white border border-slate-200 p-5 shadow-sm mt-2",children:[u.jsxs("div",{className:"flex items-center justify-between mb-4",children:[u.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-blue-600",children:"Contract Review"}),u.jsx(Ir,{label:"Analysingâ€¦",variant:"loading"})]}),u.jsxs("div",{className:"flex items-center gap-3 text-slate-600 py-6",children:[u.jsx("div",{className:"w-5 h-5 border-2 border-slate-200 border-t-blue-500 rounded-full animate-spin"}),u.jsx("span",{className:"text-sm",children:e.message||"Running AI analysisâ€¦"})]}),u.jsx(t,{})]});if(e.status==="error")return u.jsxs("div",{"data-testid":"analysis-results",className:"rounded-2xl bg-gradient-to-b from-red-50/30 to-white border border-red-200 p-5 shadow-sm mt-2",children:[u.jsx("div",{className:"flex items-center justify-between mb-4",children:u.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-red-600",children:"Analysis Error"})}),u.jsxs("div",{className:"rounded-lg border border-red-200 bg-red-50 p-3 text-sm text-red-900",children:[u.jsx("div",{className:"font-semibold",children:"Analysis failed"}),u.jsx("div",{className:"mt-1",children:e.message||"Request failed."})]}),u.jsx(t,{})]});const s=typeof o.summary=="string"&&o.summary.trim().length>0,n=Array.isArray(o.risks)&&o.risks.length>0,i=Array.isArray(o.recommendations)&&o.recommendations.length>0,r=o.pageCount||o.typeSpecific?.result?.extracted?.pageCount||null;return u.jsxs("div",{"data-testid":"analysis-results",className:"rounded-2xl bg-gradient-to-b from-amber-50/40 to-white border border-slate-200 p-5 shadow-sm mt-2",children:[u.jsxs("div",{className:"flex items-center justify-between mb-5",children:[u.jsx("span",{className:"text-xs font-bold uppercase tracking-wider text-blue-600",children:"Contract Review"}),r&&u.jsxs("span",{className:"text-xs font-semibold text-slate-400 uppercase tracking-wide",children:[r," Pages"]})]}),s&&u.jsx("div",{className:"mb-4",children:u.jsx("p",{className:"text-sm text-slate-700 leading-relaxed m-0",children:o.summary})}),n&&u.jsx("div",{className:"flex flex-col gap-3 mb-4",children:o.risks.map(a=>u.jsxs(ls.Fragment,{children:[u.jsx(jh,{risk:a}),a.explanation&&u.jsx(Lh,{text:a.explanation})]},a.id))}),i&&u.jsx("div",{className:"flex flex-col gap-3 mb-4",children:o.recommendations.map((a,l)=>u.jsx(Mh,{text:a},l))}),o.typeSpecific&&u.jsxs("details",{className:"mb-4 group",children:[u.jsx("summary",{className:"text-xs font-semibold text-slate-500 cursor-pointer hover:text-slate-700 select-none",children:"Type-specific details (beta)"}),u.jsxs("div",{className:"mt-2 text-xs text-slate-600 space-y-1 pl-2 border-l-2 border-slate-200",children:[u.jsxs("div",{children:[u.jsx("strong",{children:"Type:"})," ",o.typeSpecific.effectiveTypeId||"â€”"]}),o.typeSpecific.validationTitle&&u.jsxs("div",{children:[u.jsx("strong",{children:"Spec:"})," ",o.typeSpecific.validationTitle]}),o.typeSpecific.result?.plainExplanation&&u.jsxs("div",{className:"mt-2",children:[u.jsx("strong",{children:"Explanation:"}),u.jsx("p",{className:"m-0 mt-1 text-slate-700",children:o.typeSpecific.result.plainExplanation})]}),o.typeSpecific.result?.checks?.length>0&&u.jsxs("div",{className:"mt-2",children:[u.jsx("strong",{children:"Checks:"}),u.jsx("ul",{className:"list-none p-0 mt-1 space-y-1",children:o.typeSpecific.result.checks.map(a=>u.jsxs("li",{className:"flex items-start gap-1.5",children:[u.jsx("span",{className:a.ok?"text-emerald-600":"text-red-600",children:a.ok?"âœ“":"âœ—"}),u.jsx("span",{children:a.message})]},a.id))})]}),o.typeSpecific.ok===!1&&o.typeSpecific.code&&u.jsxs("div",{className:"mt-2 text-red-700",children:[u.jsx("strong",{children:"Blocked:"})," ",o.typeSpecific.code,o.typeSpecific.requiredTier?` (requires ${o.typeSpecific.requiredTier})`:""]}),o.typeSpecific.usage&&u.jsxs("div",{className:"mt-2 text-slate-500",children:["Tokens: ",o.typeSpecific.usage.estimatedTokens??"â€”"," used Â· ",o.typeSpecific.usage.remainingTokens??"â€”"," remaining"]})]})]}),u.jsxs("div",{className:"flex items-center justify-between pt-3 border-t border-slate-100",children:[u.jsx(Ir,{label:"AI decode complete",variant:"success"}),u.jsx("span",{className:"text-xs font-medium text-slate-500 border border-slate-200 rounded-md px-2.5 py-1 cursor-default",children:"Ready to review"})]}),u.jsx(t,{})]})},Oh=({isOpen:o,onToggle:e,onAnalyzeDocument:t,onAnalyzeByType:s,onExplainSelection:n,onHighlightRisks:i,onTranslateToPlainEnglish:r,onSummarizeKeyPoints:a,onSuggestImprovements:l,isLoading:c,isAuthenticated:d,hasDocument:h,selectedDocument:f,analysisResults:p,textSelection:b})=>{const g=()=>Math.min(900,Math.floor(window.innerWidth*.9)),x=R=>Math.max(340,Math.min(R,g())),[w,v]=T.useState(420),[_,E]=T.useState(!1),k=!h||!d||c;let D=null;c?D="Workingâ€¦":h?d||(D="Sign in to enable AI analysis (Free) and unlock Pro upgrades (OCR / deeper processing)."):D="Open a PDF to enable analysis tools.";const N=[{id:"deep-analysis",icon:Vl,label:"Deep Analysis",railLabel:"Deep Analysis",sublabel:"Identify risks, obligations & summary",disabled:k,onClick:s},{id:"highlight-risks",icon:Xl,label:"Highlight Risks",railLabel:"Highlight Risks",disabled:k,onClick:i},{id:"explain-selection",icon:Yl,label:b?"Explain Selection":"Explain Selection (Select text first)",railLabel:"Explain Selection",sublabel:b?`"${b.text.substring(0,30)}..."`:null,disabled:k||!b,onClick:n},{id:"plain-english",icon:ql,label:"Plain English",railLabel:"Plain English",disabled:k,onClick:r},{id:"summarize",icon:En,label:"Summarize Key Points",railLabel:"Summarize Key Points",disabled:k,onClick:a},{id:"suggest-improvements",icon:Ra,label:"Suggest Improvements",railLabel:"Suggest Improvements",disabled:k,onClick:l}];return T.useEffect(()=>{const R=()=>v(j=>x(j));return window.addEventListener("resize",R),()=>window.removeEventListener("resize",R)},[]),T.useEffect(()=>{if(!_)return;const R=C=>{v(x(window.innerWidth-C.clientX))},j=()=>E(!1);return document.body.style.userSelect="none",document.addEventListener("mousemove",R),document.addEventListener("mouseup",j),()=>{document.body.style.userSelect="",document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",j)}},[_]),o?u.jsxs("div",{className:"bg-white border-l border-slate-200 flex flex-col h-full shadow-xl transition-all relative z-20",style:{width:`${w}px`,minWidth:"340px",maxWidth:"900px"},children:[u.jsx("button",{type:"button",onMouseDown:()=>E(!0),className:"absolute left-0 top-0 h-full w-2 -translate-x-1/2 cursor-col-resize bg-transparent","aria-label":"Resize AI sidebar",title:"Drag to resize"}),u.jsxs("div",{className:"h-14 border-b border-slate-200 flex items-center justify-between px-4 bg-slate-50/50",children:[u.jsxs("h3",{className:"font-semibold text-slate-800 flex items-center gap-2",children:[u.jsx(Cs,{className:"text-purple-600"}),"AI Assistant"]}),u.jsx("button",{onClick:e,className:"p-1 hover:bg-slate-200 rounded",children:u.jsx(Na,{className:"w-5 h-5 text-slate-500"})})]}),u.jsx("div",{className:"flex-1 overflow-y-auto p-5",children:u.jsxs("div",{className:"flex flex-col gap-3",children:[u.jsx("div",{children:u.jsx("h4",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Tools"})}),D&&u.jsxs("div",{className:"rounded-lg border border-slate-200 bg-slate-50 p-4 text-sm text-slate-700",children:[u.jsx("div",{className:"font-semibold text-slate-900",children:"Why are buttons disabled?"}),u.jsx("div",{className:"mt-1",children:D}),!d&&h&&!c&&u.jsxs("div",{className:"mt-3 flex gap-2.5 flex-wrap",children:[u.jsx(ye,{to:"/sign-in",className:"rounded-full bg-slate-900 px-3 py-1.5 text-xs font-semibold text-white no-underline",children:"Sign in"}),u.jsx(ye,{to:"/pricing",className:"rounded-full border border-slate-300 bg-white px-3 py-1.5 text-xs font-semibold text-slate-700 no-underline",children:"See Free vs Pro"})]})]}),N.map((R,j)=>u.jsxs(ls.Fragment,{children:[u.jsx(Bh,{icon:R.icon,label:R.label,sublabel:R.sublabel,onClick:R.onClick,disabled:R.disabled,primary:j===0}),j===0||j===1?u.jsx("div",{className:"h-px bg-slate-100 my-2"}):null]},R.id)),u.jsx("div",{className:"h-px bg-slate-200 my-3"}),u.jsx("div",{children:u.jsx("h4",{className:"text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Results"})}),u.jsx("div",{className:"prose prose-sm max-w-none",children:f&&p[f.id]?u.jsx(Fh,{analysis:p[f.id]}):u.jsx("div",{className:"text-center text-slate-500 mt-6",children:"No analysis results yet. Run a tool to see output here."})})]})})]}):u.jsxs("aside",{className:"w-12 shrink-0 self-stretch border-l border-slate-200 bg-white/80 backdrop-blur-xl flex flex-col items-center py-2 gap-2 relative z-20","aria-label":"AI tools",children:[u.jsx("button",{onClick:e,className:"w-9 h-9 flex items-center justify-center rounded-lg border border-slate-200 bg-white shadow-sm hover:bg-slate-50",title:"Open tools","aria-label":"Open tools",children:u.jsx(Ta,{className:"w-5 h-5 text-slate-600"})}),u.jsx("div",{className:"w-8 h-px bg-slate-200/70 my-1"}),N.map((R,j)=>u.jsx(Uh,{icon:R.icon,label:R.railLabel||R.label,index:j,disabled:R.disabled,onClick:()=>{e(),R.disabled||setTimeout(()=>R.onClick(),0)}},R.id))]})},Bh=({icon:o,label:e,sublabel:t,onClick:s,disabled:n,primary:i})=>u.jsxs("button",{onClick:s,disabled:n,className:`w-full flex items-start gap-3 p-3 rounded-xl border text-left transition-all ${i?"bg-slate-900 border-slate-900 text-white hover:bg-slate-800 shadow-md":"bg-white border-slate-200 text-slate-700 hover:border-slate-300 hover:bg-slate-50"} ${n?"opacity-50 cursor-not-allowed":""}`,children:[u.jsx("div",{className:`p-2 rounded-lg ${i?"bg-white/10":"bg-slate-100"} shrink-0`,children:u.jsx(o,{className:`w-5 h-5 ${i?"text-white":"text-slate-600"}`})}),u.jsxs("div",{children:[u.jsx("div",{className:"font-semibold text-sm",children:e}),t&&u.jsx("div",{className:`text-xs mt-0.5 ${i?"text-slate-300":"text-slate-500"}`,children:t})]})]}),Uh=({icon:o,label:e,index:t,disabled:s,onClick:n})=>{const i=(e||"").trim().slice(0,1).toUpperCase()||String(t+1);return u.jsx("button",{type:"button",onClick:n,"aria-disabled":s,className:`w-9 h-9 flex items-center justify-center rounded-lg border transition-colors ${s?"border-slate-200 bg-slate-50 text-slate-400":"border-slate-200 bg-white text-slate-700 hover:bg-slate-50"}`,title:e,"aria-label":e,children:o?u.jsx(o,{className:`w-5 h-5 ${s?"text-slate-400":"text-slate-600"}`}):u.jsx("span",{className:"text-xs font-bold text-slate-600",children:i})})},Ai=[{id:"dancing-script",label:"Dancing Script",family:"'Dancing Script', cursive"},{id:"great-vibes",label:"Great Vibes",family:"'Great Vibes', cursive"},{id:"allura",label:"Allura",family:"'Allura', cursive"},{id:"parisienne",label:"Parisienne",family:"'Parisienne', cursive"},{id:"sacramento",label:"Sacramento",family:"'Sacramento', cursive"},{id:"alex-brush",label:"Alex Brush",family:"'Alex Brush', cursive"}];let jr=!1;function zh(){if(jr)return;jr=!0;const o=Ai.map(t=>t.label.replace(/ /g,"+")).join("&family="),e=document.createElement("link");e.rel="stylesheet",e.href=`https://fonts.googleapis.com/css2?family=${o}&display=swap`,document.head.appendChild(e)}function Hh({displayName:o,font:e}){return{version:1,kind:"type",displayName:o,fontId:e.id,fontFamily:e.family,createdAt:new Date().toISOString()}}const $h=({onResult:o})=>{const e=T.useRef(null),[t,s]=T.useState(!1),[n,i]=T.useState(!1),r=()=>e.current?.getContext("2d"),a=T.useCallback(f=>{const p=r();if(!p)return;s(!0);const b=e.current.getBoundingClientRect(),m=(f.clientX??f.touches?.[0]?.clientX)-b.left,y=(f.clientY??f.touches?.[0]?.clientY)-b.top;p.beginPath(),p.moveTo(m,y)},[]),l=T.useCallback(f=>{if(!t)return;const p=r();if(!p)return;f.preventDefault();const b=e.current.getBoundingClientRect(),m=(f.clientX??f.touches?.[0]?.clientX)-b.left,y=(f.clientY??f.touches?.[0]?.clientY)-b.top;p.lineTo(m,y),p.stroke(),i(!0)},[t]),c=T.useCallback(()=>{s(!1)},[]),d=()=>{const f=r();f&&(f.clearRect(0,0,e.current.width,e.current.height),i(!1),o(null))},h=()=>{if(!n)return;const f=e.current.toDataURL("image/png");o({mode:"draw",dataUrl:f,width:200,height:60,persistence:{kind:"ephemeral-data-url",canPersist:!1,reason:"free-tier-no-server-storage"}})};return T.useEffect(()=>{const f=r();f&&(f.strokeStyle="#1e293b",f.lineWidth=2.5,f.lineCap="round",f.lineJoin="round")},[]),u.jsxs("div",{className:"flex flex-col gap-3",children:[u.jsxs("div",{className:"relative border border-slate-200 rounded-lg bg-white overflow-hidden",children:[u.jsx("canvas",{ref:e,width:440,height:140,className:"w-full cursor-crosshair touch-none",onMouseDown:a,onMouseMove:l,onMouseUp:c,onMouseLeave:c,onTouchStart:a,onTouchMove:l,onTouchEnd:c}),!n&&u.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-slate-300 text-sm pointer-events-none select-none",children:"Draw your signature here"}),u.jsx("div",{className:"absolute bottom-8 left-4 right-4 border-b border-dashed border-slate-200 pointer-events-none"})]}),u.jsxs("div",{className:"flex items-center justify-between",children:[u.jsxs("button",{onClick:d,className:"flex items-center gap-1 px-3 py-1.5 text-xs text-slate-500 hover:text-red-600 hover:bg-red-50 rounded-md transition-colors",children:[u.jsx(Cn,{className:"w-3.5 h-3.5"})," Clear"]}),u.jsx("button",{onClick:h,disabled:!n,className:"flex items-center gap-1.5 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-200 disabled:text-slate-400 text-white text-sm font-semibold rounded-lg transition-colors",children:"Adopt signature"})]})]})},Wh=({onResult:o})=>{const[e,t]=T.useState(""),[s,n]=T.useState(Ai[0]);T.useEffect(()=>{zh()},[]);const i=()=>{if(!e.trim())return;const r=e.trim();o({mode:"type",text:r,fontFamily:s.family,fontId:s.id,width:200,height:50,persistence:{kind:"candidate-profile",canPersist:!0,target:"firestore-signature-profiles"},profileDraft:Hh({displayName:r,font:s})})};return u.jsxs("div",{className:"flex flex-col gap-4",children:[u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-1",children:"Your name"}),u.jsx("input",{type:"text",value:e,onChange:r=>t(r.target.value),placeholder:"Full name",className:"w-full px-3 py-2 border border-slate-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent",autoFocus:!0})]}),u.jsx("div",{className:"border border-slate-200 rounded-lg bg-white p-6 min-h-[90px] flex items-center justify-center",children:e.trim()?u.jsx("span",{className:"text-3xl text-slate-800 select-none",style:{fontFamily:s.family},children:e}):u.jsx("span",{className:"text-slate-300 text-sm",children:"Preview"})}),u.jsxs("div",{children:[u.jsx("label",{className:"block text-xs font-medium text-slate-600 mb-2",children:"Style"}),u.jsx("div",{className:"grid grid-cols-3 gap-2",children:Ai.map(r=>u.jsxs("button",{onClick:()=>n(r),className:`px-3 py-2.5 rounded-lg border text-left transition-all ${s.id===r.id?"border-blue-500 bg-blue-50 ring-1 ring-blue-400":"border-slate-200 hover:border-slate-300 hover:bg-slate-50"}`,children:[u.jsx("span",{className:"text-lg text-slate-700 block truncate",style:{fontFamily:r.family},children:e.trim()||"Signature"}),u.jsx("span",{className:"text-[10px] text-slate-400 mt-0.5 block",children:r.label})]},r.id))})]}),u.jsx("div",{className:"flex justify-end",children:u.jsx("button",{onClick:i,disabled:!e.trim(),className:"flex items-center gap-1.5 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-200 disabled:text-slate-400 text-white text-sm font-semibold rounded-lg transition-colors",children:"Adopt signature"})})]})},Gh=({onResult:o})=>{const[e,t]=T.useState(null),[s,n]=T.useState(null),i=T.useRef(null),r=c=>{const d=c.target.files?.[0];if(!d||!d.type.startsWith("image/"))return;const h=new FileReader;h.onload=()=>{t(h.result),n({fileName:d.name,mimeType:d.type||null,sizeBytes:d.size||null})},h.readAsDataURL(d)},a=()=>{e&&o({mode:"upload",dataUrl:e,width:200,height:60,uploadMeta:s,persistence:{kind:"ephemeral-data-url",canPersist:!1,reason:"free-tier-no-server-storage"}})},l=()=>{t(null),n(null),i.current&&(i.current.value=""),o(null)};return u.jsxs("div",{className:"flex flex-col gap-3",children:[e?u.jsx("div",{className:"border border-slate-200 rounded-lg bg-white p-4 flex items-center justify-center min-h-[140px]",children:u.jsx("img",{src:e,alt:"Signature",className:"max-h-[120px] max-w-full object-contain"})}):u.jsxs("button",{onClick:()=>i.current?.click(),className:"border-2 border-dashed border-slate-300 rounded-lg bg-slate-50 hover:bg-slate-100 p-8 flex flex-col items-center gap-2 transition-colors cursor-pointer",children:[u.jsx(kn,{className:"w-8 h-8 text-slate-400"}),u.jsx("span",{className:"text-sm text-slate-500",children:"Click to upload signature image"}),u.jsx("span",{className:"text-[10px] text-slate-400",children:"PNG, JPG, or SVG â€” transparent background recommended"})]}),u.jsx("input",{ref:i,type:"file",accept:"image/*",onChange:r,className:"hidden"}),u.jsxs("div",{className:"flex items-center justify-between",children:[e&&u.jsxs("button",{onClick:l,className:"flex items-center gap-1 px-3 py-1.5 text-xs text-slate-500 hover:text-red-600 hover:bg-red-50 rounded-md transition-colors",children:[u.jsx(Cn,{className:"w-3.5 h-3.5"})," Remove"]}),u.jsx("div",{className:"flex-1"}),u.jsx("button",{onClick:a,disabled:!e,className:"flex items-center gap-1.5 px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-slate-200 disabled:text-slate-400 text-white text-sm font-semibold rounded-lg transition-colors",children:"Adopt signature"})]})]})},Vh=[{id:"draw",label:"Draw",icon:Fi},{id:"type",label:"Type",icon:En},{id:"upload",label:"Upload",icon:kn}],Xh=({open:o,onClose:e,onAdopt:t,savedSignatures:s=[]})=>{const[n,i]=T.useState("draw");if(!o)return null;const r=a=>{a&&(t(a),e())};return u.jsx("div",{id:"signature-modal-backdrop",className:"fixed inset-0 bg-slate-900/40 flex items-center justify-center z-[2000] p-4",onClick:e,children:u.jsxs("div",{id:"signature-modal",className:"bg-white rounded-2xl border border-slate-200 shadow-2xl w-full max-w-[520px] max-h-[90vh] overflow-y-auto",onClick:a=>a.stopPropagation(),children:[u.jsxs("div",{className:"flex items-center justify-between px-5 py-4 border-b border-slate-100",children:[u.jsx("h2",{className:"text-base font-bold text-slate-900",children:"Create your signature"}),u.jsx("button",{onClick:e,className:"p-1.5 rounded-lg text-slate-400 hover:text-slate-600 hover:bg-slate-100 transition-colors",children:u.jsx(Kl,{className:"w-5 h-5"})})]}),u.jsx("div",{className:"mx-5 mt-4 rounded-lg border border-amber-200 bg-amber-50 px-3 py-2 text-[11px] leading-relaxed text-amber-800",children:"Self-sign only in this version. No multi-party recipients, signee roles, or signing order are supported."}),u.jsx("div",{className:"flex border-b border-slate-100",children:Vh.map(a=>{const l=a.icon,c=n===a.id;return u.jsxs("button",{onClick:()=>i(a.id),className:`flex-1 flex items-center justify-center gap-1.5 py-3 text-sm font-medium transition-colors ${c?"text-blue-600 border-b-2 border-blue-600":"text-slate-400 hover:text-slate-600"}`,children:[u.jsx(l,{className:"w-4 h-4"}),a.label]},a.id)})}),u.jsxs("div",{className:"p-5",children:[n==="draw"&&u.jsx($h,{onResult:r}),n==="type"&&u.jsx(Wh,{onResult:r}),n==="upload"&&u.jsx(Gh,{onResult:r})]}),u.jsx("div",{className:"px-5 pb-4 text-[11px] text-slate-400 leading-snug",children:"Consent: By adopting this signature, you confirm this is for your own self-sign use and that you are authorized to create and apply it."})]})})},Pe={UNREADABLE:"UNREADABLE",GENERAL:"GENERAL",BUSINESS_LEGAL:"BUSINESS_LEGAL"},Yh=[{id:"unreadable_broken",label:"Unreadable / broken file",category:Pe.UNREADABLE,synonyms:["corrupt","broken","invalid pdf","cannot open","damaged"]},{id:"unreadable_encrypted",label:"Password-protected / encrypted",category:Pe.UNREADABLE,synonyms:["encrypted","password","protected"]},{id:"unreadable_empty",label:"Empty / blank document",category:Pe.UNREADABLE,synonyms:["blank","empty","no text"]},{id:"general_letter",label:"Letter (general / personal)",category:Pe.GENERAL,synonyms:["letter","correspondence","personal letter"]},{id:"general_police_letter",label:"Police letter / notice",category:Pe.GENERAL,synonyms:["police","notice","infringement","fine","offence"]},{id:"general_presentation",label:"Presentation / pitch deck",category:Pe.GENERAL,synonyms:["deck","slides","presentation","pitch"]},{id:"general_marketing",label:"Flyer / advertisement / marketing",category:Pe.GENERAL,synonyms:["flyer","ad","advertisement","brochure","marketing"]},{id:"general_book",label:"Book / long-form text",category:Pe.GENERAL,synonyms:["book","chapter","novel","story","longform"]},{id:"general_notes",label:"Notes / diary / journal",category:Pe.GENERAL,synonyms:["notes","diary","journal","private notes"]},{id:"general_schedule",label:"Schedule / timetable",category:Pe.GENERAL,synonyms:["schedule","timetable","calendar","rota"]},{id:"general_sop_procedure",label:"SOP / procedure",category:Pe.GENERAL,synonyms:["sop","procedure","runbook","work instruction","instructions","guide"],validationSlug:"sop-procedure"},{id:"general_resume_cv",label:"Resume / CV",category:Pe.GENERAL,synonyms:["resume","cv","curriculum vitae","work experience","education","skills"]},{id:"legal_job_offer",label:"Job offer / offer letter",category:Pe.BUSINESS_LEGAL,synonyms:["offer letter","job offer","employment offer","compensation","salary","starting date"],validationSlug:"job-offer"},{id:"legal_contract_generic",label:"Contract / agreement (general)",category:Pe.BUSINESS_LEGAL,synonyms:["agreement","contract","terms","conditions"]},{id:"legal_employment_contract",label:"Employment contract",category:Pe.BUSINESS_LEGAL,synonyms:["employment","employee","employer","salary","position"]},{id:"legal_nda",label:"NDA / confidentiality agreement",category:Pe.BUSINESS_LEGAL,synonyms:["nda","non-disclosure","confidentiality"]},{id:"legal_lease_residential",label:"Residential lease / tenancy agreement",category:Pe.BUSINESS_LEGAL,synonyms:["lease","tenancy","rent","bond","landlord","tenant"]},{id:"legal_lease_commercial",label:"Commercial lease",category:Pe.BUSINESS_LEGAL,synonyms:["commercial lease","premises","outgoings"]},{id:"business_invoice",label:"Invoice",category:Pe.BUSINESS_LEGAL,synonyms:["invoice","tax invoice","payment due"],validationSlug:"invoice"},{id:"business_purchase_order",label:"Purchase order",category:Pe.BUSINESS_LEGAL,synonyms:["purchase order","po","order"]},{id:"policy_privacy",label:"Privacy policy",category:Pe.BUSINESS_LEGAL,synonyms:["privacy policy","personal information","data collection"],validationSlug:"company-policy"},{id:"policy_terms",label:"Terms of service / website terms",category:Pe.BUSINESS_LEGAL,synonyms:["terms of service","terms","conditions","website terms"]}];function bo(){const[o,e]=T.useState(null);T.useEffect(()=>{let i=!1;return(async()=>{try{const a=await fetch("/classifications/document-types.index.json",{cache:"force-cache"});if(!a.ok)throw new Error(`Failed to load document types: ${a.status}`);const l=await a.json(),c=Array.isArray(l?.types)?l.types:null;if(c)for(const d of c)"validationSlug"in d||(d.validationSlug=null);if(!c)throw new Error("Invalid document-types.index.json");i||e(c)}catch{i||e(null)}})(),()=>{i=!0}},[]);const t=T.useMemo(()=>Array.isArray(o)&&o.length?o:Yh,[o]),s=T.useMemo(()=>i=>{const r=String(i||"").trim().toLowerCase();if(!r)return t;const a=l=>{const c=String(l.label||"").toLowerCase(),d=Array.isArray(l.synonyms)?l.synonyms.join(" ").toLowerCase():"";if(c.includes(r))return 100;if(d.includes(r))return 80;const h=r.split(/\s+/).filter(Boolean);return h.length&&h.every(f=>c.includes(f)||d.includes(f))?60:0};return t.map(l=>({t:l,s:a(l)})).filter(l=>l.s>0).sort((l,c)=>c.s-l.s).map(l=>l.t)},[t]);return{types:t,find:s,categories:Pe,source:Array.isArray(o)&&o.length?"remote":"bundled"}}const qh=(o,e)=>o===e.BUSINESS_LEGAL?"Business & legal":o===e.GENERAL?"General documents":o===e.UNREADABLE?"Unreadable / special cases":"Other";function Kh({open:o,onClose:e,detectedType:t,onPick:s}){const[n,i]=T.useState(""),[r,a]=T.useState(0),l=T.useRef(null),{types:c,find:d,categories:h,source:f}=bo();T.useEffect(()=>{o&&(i(""),a(0),setTimeout(()=>l.current?.focus(),0))},[o]);const p=T.useMemo(()=>{const x=d(n);return n?x.slice(0,30):c.slice(0,25)},[n,d,c]),b=T.useMemo(()=>{const x=new Map;for(const w of p){const v=w.category;x.has(v)||x.set(v,[]),x.get(v).push(w)}return Array.from(x.entries())},[p]),m=T.useMemo(()=>p,[p]),y=x=>{const w=m[x];w&&s?.(w)},g=x=>{if(x.key==="Escape"){e?.();return}if(x.key==="ArrowDown"){x.preventDefault(),a(w=>Math.min(w+1,m.length-1));return}if(x.key==="ArrowUp"){x.preventDefault(),a(w=>Math.max(w-1,0));return}x.key==="Enter"&&(x.preventDefault(),y(r))};return o?u.jsx("div",{role:"dialog","aria-modal":"true",style:{position:"fixed",inset:0,background:"rgba(15, 23, 42, 0.45)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2500,padding:16},onClick:()=>e?.(),children:u.jsxs("div",{style:{background:"#fff",borderRadius:14,border:"1px solid #e2e8f0",maxWidth:760,width:"100%",padding:18,boxShadow:"0 10px 30px rgba(0,0,0,0.2)"},onClick:x=>x.stopPropagation(),onKeyDown:g,children:[u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:12,alignItems:"flex-start"},children:[u.jsxs("div",{children:[u.jsx("div",{style:{fontWeight:900,fontSize:16,color:"#0f172a"},children:"Change document type"}),u.jsx("div",{style:{marginTop:6,color:"#475569",lineHeight:1.4},children:"We use this to decide which actions/checks to show. You can override the AI classification."}),t&&u.jsxs("div",{style:{marginTop:8,color:"#64748b",fontSize:13},children:["Detected: ",u.jsx("strong",{children:t.label})]})]}),u.jsx("button",{type:"button",onClick:()=>e?.(),style:{background:"none",border:"none",fontSize:22,cursor:"pointer",color:"#0f172a",padding:0,lineHeight:1},"aria-label":"Close",children:"Ã—"})]}),u.jsx("input",{ref:l,value:n,onChange:x=>{i(x.target.value),a(0)},placeholder:"Start typing (e.g. lease, invoice, police letter)â€¦",style:{marginTop:14,width:"100%",padding:12,borderRadius:12,border:"1px solid #e2e8f0"}}),u.jsxs("div",{style:{marginTop:14,maxHeight:360,overflow:"auto"},children:[b.map(([x,w])=>u.jsxs("div",{style:{marginBottom:14},children:[u.jsxs("div",{style:{fontWeight:900,color:"#0f172a",fontSize:13,marginBottom:8},children:[qh(x,h),u.jsxs("span",{style:{marginLeft:8,color:"#94a3b8",fontWeight:800},children:["(",f,")"]})]}),u.jsx("div",{style:{display:"grid",gap:8},children:w.map(v=>{const _=m.findIndex(k=>k.id===v.id),E=_===r;return u.jsxs("button",{type:"button",onClick:()=>s?.(v),onMouseEnter:()=>a(_),style:{textAlign:"left",padding:"10px 12px",borderRadius:12,border:"1px solid "+(E?"#0f172a":"#e2e8f0"),background:E?"#f8fafc":"#fff",cursor:"pointer"},children:[u.jsx("div",{style:{fontWeight:900,color:"#0f172a"},children:v.label}),u.jsx("div",{style:{color:"#64748b",fontSize:12,marginTop:2},children:v.id})]},v.id)})})]},x)),!b.length&&u.jsx("div",{style:{color:"#64748b"},children:"No matches."})]})]})}):null}const yo={select:{label:"Select",tooltip:"Select & Move â€” click to select placed items, then drag to reposition them",hint:"Click on any placed element to select it. Drag to reposition."},signature:{label:"Sign",tooltip:"Add Signature â€” create or place your signature on the document",hint:"Click anywhere on the document to place your signature."},text:{label:"Text",tooltip:"Add Text â€” insert a text field at the desired location",hint:"Click on the document where you want to insert text."},date:{label:"Date",tooltip:"Insert Date â€” click to place today's date; then adjust its position if needed",hint:"Click where you want the date. After placement: click the date to select it and drag to reposition."},image:{label:"Image",tooltip:"Insert Image â€” add a photo or image to the document",hint:"Click on the document where you want to place the image."},checkmark:{label:"Check",tooltip:"Add Checkmark â€” insert a check mark (âœ“) on the document",hint:"Click on a checkbox or field to place a checkmark."}},Zh={select:Tn,signature:Fi,text:Ma,date:La,image:kn,checkmark:Zl},Vt=({active:o,toolId:e,onClick:t})=>{const s=yo[e]||{label:e,tooltip:e,hint:""},n=Zh[e]||Tn;return u.jsxs("div",{className:"relative group/vtool",children:[u.jsxs("button",{onClick:t,title:s.tooltip,"data-testid":`viewer-tool-${e}`,"aria-label":s.tooltip,className:`flex items-center gap-1 px-2 py-1.5 rounded-md text-xs font-medium transition-all ${o?"bg-slate-200/80 text-slate-800":"text-slate-400 hover:bg-slate-100 hover:text-slate-700"}`,children:[u.jsx(n,{className:"w-4 h-4"}),u.jsx("span",{className:"hidden sm:inline",children:s.label})]}),u.jsxs("div",{role:"tooltip","data-testid":`viewer-tool-tooltip-${e}`,className:"pointer-events-none absolute z-[300] top-full left-1/2 -translate-x-1/2 mt-2 w-52 origin-top opacity-0 scale-95 group-hover/vtool:opacity-100 group-hover/vtool:scale-100 transition-all duration-150 bg-slate-800 text-white rounded-lg shadow-xl",children:[u.jsxs("div",{className:"px-3 py-2.5",children:[u.jsx("p",{className:"font-semibold text-xs leading-tight",children:s.label}),u.jsx("p",{className:"text-slate-300 text-[11px] leading-snug mt-1",children:s.hint})]}),u.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 border-[5px] border-transparent border-b-slate-800"})]})]})},Jh=({activeTool:o})=>{if(o==="select")return null;const e=yo[o];return e?u.jsxs("div",{"data-testid":"tool-hint-bar",className:"h-8 px-4 flex items-center bg-blue-50 border-b border-blue-100 text-xs text-blue-700 gap-2 transition-all",children:[u.jsxs("span",{className:"font-semibold",children:[e.label,":"]}),u.jsx("span",{children:e.hint})]}):null},Qh=({fileName:o,onShare:e,onSaveCloud:t,onDownload:s,onEdit:n,onFinish:i,isCloudBusy:r,effectiveDocType:a,onOpenDocTypeSelector:l,activeTool:c,setActiveTool:d,onSignClick:h,canUndo:f=!1,canRedo:p=!1,hasSelection:b=!1,onUndo:m,onRedo:y,onDelete:g})=>u.jsxs("div",{id:"viewer-toolbar",className:"flex flex-col bg-white border-b border-slate-200 z-20 relative",children:[u.jsxs("div",{id:"viewer-filename-bar",className:"h-11 px-4 flex items-center justify-between border-b border-slate-100/80",children:[u.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[u.jsx("span",{id:"viewer-filename",className:"font-semibold text-slate-800 text-sm truncate max-w-[320px]",children:o||"Untitled Document"}),u.jsxs("div",{id:"viewer-quick-actions",className:"flex items-center gap-0.5 ml-1",children:[u.jsx("button",{type:"button",onClick:m,disabled:!f,className:"p-1.5 rounded-md text-slate-400 hover:text-slate-700 hover:bg-slate-100 transition-colors disabled:opacity-40 disabled:hover:bg-transparent",title:"Undo (Ctrl/âŒ˜+Z)","aria-label":"Undo",children:u.jsx(Da,{className:"w-4 h-4"})}),u.jsx("button",{type:"button",onClick:y,disabled:!p,className:"p-1.5 rounded-md text-slate-400 hover:text-slate-700 hover:bg-slate-100 transition-colors disabled:opacity-40 disabled:hover:bg-transparent",title:"Redo (Ctrl/âŒ˜+Shift+Z)","aria-label":"Redo",children:u.jsx(bi,{className:"w-4 h-4"})}),u.jsx("button",{type:"button",onClick:g,disabled:!b,className:"p-1.5 rounded-md text-slate-400 hover:text-rose-600 hover:bg-rose-50 transition-colors disabled:opacity-40 disabled:hover:bg-transparent",title:"Delete selected (Del/Backspace)","aria-label":"Delete selected",children:u.jsx(Cn,{className:"w-4 h-4"})}),u.jsx("div",{className:"w-px h-5 bg-slate-200 mx-1"}),u.jsx("button",{id:"btn-share-link",onClick:e,className:"p-1.5 rounded-md text-slate-400 hover:text-blue-600 hover:bg-blue-50 transition-colors",title:"Send for signature â€” share this document with others for signing",children:u.jsx(Ia,{className:"w-4 h-4"})}),u.jsx("button",{id:"btn-save-decodocs",onClick:t,className:"p-1.5 rounded-md text-slate-400 hover:text-emerald-600 hover:bg-emerald-50 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:r?"Savingâ€¦":"Save to DecoDocs cloud â€” store a copy in your DecoDocs account",disabled:r,children:u.jsx(Pa,{className:"w-4 h-4"})})]})]}),u.jsxs("div",{id:"viewer-primary-actions",className:"flex items-center gap-2",children:[u.jsxs("button",{type:"button",onClick:n,className:"flex items-center gap-1.5 px-3 py-1.5 bg-white hover:bg-slate-50 text-slate-700 text-xs font-semibold rounded-lg transition-colors shadow-sm border border-slate-200",title:"Edit â€” switch to edit mode",children:[u.jsx(Ra,{className:"w-3.5 h-3.5"}),"Edit"]}),u.jsxs("button",{id:"btn-download",onClick:s,className:"flex items-center gap-1.5 px-3 py-1.5 bg-blue-600 hover:bg-blue-700 text-white text-xs font-semibold rounded-lg transition-colors shadow-sm disabled:opacity-50 disabled:cursor-not-allowed",title:"Download â€” save the document with your annotations as a PDF",disabled:r,children:[u.jsx(ja,{className:"w-3.5 h-3.5"}),"Download"]}),u.jsxs("button",{id:"btn-finish",onClick:i,className:"flex items-center gap-1.5 px-3 py-1.5 bg-slate-800 hover:bg-slate-900 text-white text-xs font-semibold rounded-lg transition-colors shadow-sm",title:"Finish â€” finalise and close the document",children:["Finish",u.jsx(bi,{className:"w-3.5 h-3.5"})]})]})]}),u.jsxs("div",{id:"viewer-tools-bar",className:"h-10 px-4 flex items-center bg-slate-50/60",children:[u.jsx("div",{id:"viewer-doctype-bar",className:"flex items-center",children:u.jsxs("button",{id:"viewer-doctype-chip",onClick:l,className:"flex items-center gap-1.5 px-2.5 py-1 rounded-md text-xs font-medium text-slate-500 hover:text-slate-700 hover:bg-slate-100 transition-colors",title:"Change document type â€” affects which checks and analysis are run",children:[u.jsx("svg",{className:"w-3.5 h-3.5 text-slate-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),u.jsx("span",{children:a?.label||"Contract / agreement (general)"}),u.jsx("svg",{className:"w-3 h-3 text-slate-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:u.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19 9l-7 7-7-7"})})]})}),u.jsx("div",{className:"w-px h-5 bg-slate-200 mx-3"}),u.jsxs("div",{id:"viewer-signing-tools",className:"flex items-center gap-0.5",children:[u.jsx(Vt,{active:c==="select",toolId:"select",onClick:()=>d("select")}),u.jsx("div",{className:"w-px h-4 bg-slate-200 mx-1"}),u.jsx(Vt,{active:c==="signature",toolId:"signature",onClick:h}),u.jsx(Vt,{active:c==="text",toolId:"text",onClick:()=>d("text")}),u.jsx(Vt,{active:c==="date",toolId:"date",onClick:()=>d("date")}),u.jsx(Vt,{active:c==="image",toolId:"image",onClick:()=>d("image")}),u.jsx(Vt,{active:c==="checkmark",toolId:"checkmark",onClick:()=>d("checkmark")})]})]}),u.jsx(Jh,{activeTool:c})]}),eu=({annotation:o})=>{const e=o?.dataUrl||"";return u.jsx("div",{className:"w-full h-full flex items-center justify-center bg-white/60",children:e?u.jsx("img",{src:e,alt:o?.text||"Image",className:"w-full h-full object-contain pointer-events-none select-none",draggable:!1}):u.jsx("span",{className:"text-purple-700 text-xs font-semibold pointer-events-none",children:"Image"})})},tu=({pageNum:o,signatures:e,annotations:t,selectedItemId:s,onStartDrag:n,onSelect:i})=>u.jsxs(u.Fragment,{children:[e.filter(r=>r.pageNum===o).map(r=>u.jsx("div",{"data-testid":`overlay-signature-${r.id}`,className:`absolute border-2 ${s===r.id?"border-blue-500 ring-2 ring-blue-300":"border-blue-500/40"} bg-blue-50/20 flex items-center justify-center cursor-move rounded select-none`,style:{left:r.x,top:r.y,width:r.width,height:r.height,zIndex:50,touchAction:"none"},onClick:a=>{a.stopPropagation(),i&&i(r.id)},onMouseDown:a=>{typeof window<"u"&&"PointerEvent"in window||n&&n(a,r,"signature")},onPointerDown:a=>n&&n(a,r,"signature"),children:r.mode==="type"?u.jsx("span",{className:"text-slate-900 select-none pointer-events-none",style:{fontFamily:r.fontFamily,fontSize:"1.5rem",lineHeight:1},children:r.text}):r.dataUrl?u.jsx("img",{src:r.dataUrl,alt:"Signature",className:"max-w-full max-h-full object-contain pointer-events-none",draggable:!1}):u.jsx("span",{className:"text-blue-700 font-semibold italic text-lg pointer-events-none",children:"Signature"})},r.id)),t.filter(r=>r.pageNum===o).map(r=>u.jsx("div",{"data-testid":`overlay-annotation-${r.id}`,className:`absolute shadow-sm cursor-move rounded select-none overflow-hidden ${s===r.id?"ring-2 ring-blue-400":""} ${r.type==="checkmark"?"px-2 py-1 text-green-700 text-2xl font-bold":r.type==="date"?"px-2 py-1 bg-amber-50 border border-amber-300 text-amber-800":r.type==="image"?"border border-purple-300 bg-purple-50/30":"px-2 py-1 bg-yellow-100 border border-yellow-300 text-slate-800"}`,style:{left:r.x,top:r.y,zIndex:50,touchAction:"none",width:r.type==="image"?r.width||180:void 0,height:r.type==="image"?r.height||120:void 0},onClick:a=>{a.stopPropagation(),i&&i(r.id)},onMouseDown:a=>{typeof window<"u"&&"PointerEvent"in window||n&&n(a,r,"annotation")},onPointerDown:a=>n&&n(a,r,"annotation"),children:r.type==="image"?u.jsx(eu,{annotation:r}):r.text},r.id))]});function su(o){const[e,t]=T.useState({status:"idle",spec:null,error:null});return T.useEffect(()=>{if(!o){t({status:"idle",spec:null,error:null});return}let s=!1;return(async()=>{t({status:"loading",spec:null,error:null});try{const i=await fetch(`/classifications/validation/${o}.json`,{cache:"force-cache"});if(!i.ok)throw new Error(`Failed to load validation spec: ${i.status}`);const r=await i.json();s||t({status:"ready",spec:r,error:null})}catch(i){s||t({status:"error",spec:null,error:i})}})(),()=>{s=!0}},[o]),e}const Ke=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),Si=[.001,0,0,.001,0,0],ti=1.35,nt={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},St={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Ns="pdfjs_internal_editor_",pe={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},ge={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},xo={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},_i={TRIANGLES:1,LATTICE:2},Be={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},ks={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},je={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Kt={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Bs={ERRORS:0,WARNINGS:1,INFOS:5},os={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},bs={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},wo={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let In=Bs.WARNINGS;function nu(o){Number.isInteger(o)&&(In=o)}function iu(){return In}function jn(o){In>=Bs.INFOS&&console.info(`Info: ${o}`)}function fe(o){In>=Bs.WARNINGS&&console.warn(`Warning: ${o}`)}function Se(o){throw new Error(o)}function Ae(o,e){o||Se(e)}function ru(o){switch(o?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function qi(o,e=null,t=null){if(!o)return null;if(t&&typeof o=="string"&&(t.addDefaultProtocol&&o.startsWith("www.")&&o.match(/\./g)?.length>=2&&(o=`http://${o}`),t.tryConvertEncoding))try{o=hu(o)}catch{}const s=e?URL.parse(o,e):URL.parse(o);return ru(s)?s:null}function Ki(o,e,t=!1){const s=URL.parse(o);return s?(s.hash=e,s.href):t&&qi(o,"http://example.com")?o.split("#",1)[0]+`${e?`#${e}`:""}`:""}function ue(o,e,t,s=!1){return Object.defineProperty(o,e,{value:t,enumerable:!s,configurable:!0,writable:!1}),t}const $t=(function(){function e(t,s){this.message=t,this.name=s}return e.prototype=new Error,e.constructor=e,e})();class Lr extends $t{constructor(e,t){super(e,"PasswordException"),this.code=t}}class si extends $t{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class xn extends $t{constructor(e){super(e,"InvalidPDFException")}}class Ps extends $t{constructor(e,t,s){super(e,"ResponseException"),this.status=t,this.missing=s}}class au extends $t{constructor(e){super(e,"FormatError")}}class Ct extends $t{constructor(e){super(e,"AbortException")}}function ou(o){(typeof o!="object"||o?.length===void 0)&&Se("Invalid argument for bytesToString");const e=o.length,t=8192;if(e<t)return String.fromCharCode.apply(null,o);const s=[];for(let n=0;n<e;n+=t){const i=Math.min(n+t,e),r=o.subarray(n,i);s.push(String.fromCharCode.apply(null,r))}return s.join("")}function Ln(o){typeof o!="string"&&Se("Invalid argument for stringToBytes");const e=o.length,t=new Uint8Array(e);for(let s=0;s<e;++s)t[s]=o.charCodeAt(s)&255;return t}function lu(o){return String.fromCharCode(o>>24&255,o>>16&255,o>>8&255,o&255)}function cu(){const o=new Uint8Array(4);return o[0]=1,new Uint32Array(o.buffer,0,1)[0]===1}function du(){try{return new Function(""),!0}catch{return!1}}class Oe{static get isLittleEndian(){return ue(this,"isLittleEndian",cu())}static get isEvalSupported(){return ue(this,"isEvalSupported",du())}static get isOffscreenCanvasSupported(){return ue(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return ue(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return ue(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return ue(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return ue(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){return ue(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const ni=Array.from(Array(256).keys(),o=>o.toString(16).padStart(2,"0"));class se{static makeHexColor(e,t,s){return`#${ni[e]}${ni[t]}${ni[s]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let s;e[0]?(e[0]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[3],t[3]*=e[3]):(s=t[0],t[0]=t[1],t[1]=s,s=t[2],t[2]=t[3],t[3]=s,e[1]<0&&(s=t[1],t[1]=t[3],t[3]=s),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(s=t[0],t[0]=t[2],t[2]=s),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,s=0){const n=e[s],i=e[s+1];e[s]=n*t[0]+i*t[2]+t[4],e[s+1]=n*t[1]+i*t[3]+t[5]}static applyTransformToBezier(e,t,s=0){const n=t[0],i=t[1],r=t[2],a=t[3],l=t[4],c=t[5];for(let d=0;d<6;d+=2){const h=e[s+d],f=e[s+d+1];e[s+d]=h*n+f*r+l,e[s+d+1]=h*i+f*a+c}}static applyInverseTransform(e,t){const s=e[0],n=e[1],i=t[0]*t[3]-t[1]*t[2];e[0]=(s*t[3]-n*t[2]+t[2]*t[5]-t[4]*t[3])/i,e[1]=(-s*t[1]+n*t[0]+t[4]*t[1]-t[5]*t[0])/i}static axialAlignedBoundingBox(e,t,s){const n=t[0],i=t[1],r=t[2],a=t[3],l=t[4],c=t[5],d=e[0],h=e[1],f=e[2],p=e[3];let b=n*d+l,m=b,y=n*f+l,g=y,x=a*h+c,w=x,v=a*p+c,_=v;if(i!==0||r!==0){const E=i*d,k=i*f,D=r*h,N=r*p;b+=D,g+=D,y+=N,m+=N,x+=E,_+=E,v+=k,w+=k}s[0]=Math.min(s[0],b,y,m,g),s[1]=Math.min(s[1],x,v,w,_),s[2]=Math.max(s[2],b,y,m,g),s[3]=Math.max(s[3],x,v,w,_)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const s=e[0],n=e[1],i=e[2],r=e[3],a=s**2+n**2,l=s*i+n*r,c=i**2+r**2,d=(a+c)/2,h=Math.sqrt(d**2-(a*c-l**2));t[0]=Math.sqrt(d+h||1),t[1]=Math.sqrt(d-h||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const s=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),n=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(s>n)return null;const i=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),r=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return i>r?null:[s,i,n,r]}static pointBoundingBox(e,t,s){s[0]=Math.min(s[0],e),s[1]=Math.min(s[1],t),s[2]=Math.max(s[2],e),s[3]=Math.max(s[3],t)}static rectBoundingBox(e,t,s,n,i){i[0]=Math.min(i[0],e,s),i[1]=Math.min(i[1],t,n),i[2]=Math.max(i[2],e,s),i[3]=Math.max(i[3],t,n)}static#e(e,t,s,n,i,r,a,l,c,d){if(c<=0||c>=1)return;const h=1-c,f=c*c,p=f*c,b=h*(h*(h*e+3*c*t)+3*f*s)+p*n,m=h*(h*(h*i+3*c*r)+3*f*a)+p*l;d[0]=Math.min(d[0],b),d[1]=Math.min(d[1],m),d[2]=Math.max(d[2],b),d[3]=Math.max(d[3],m)}static#t(e,t,s,n,i,r,a,l,c,d,h,f){if(Math.abs(c)<1e-12){Math.abs(d)>=1e-12&&this.#e(e,t,s,n,i,r,a,l,-h/d,f);return}const p=d**2-4*h*c;if(p<0)return;const b=Math.sqrt(p),m=2*c;this.#e(e,t,s,n,i,r,a,l,(-d+b)/m,f),this.#e(e,t,s,n,i,r,a,l,(-d-b)/m,f)}static bezierBoundingBox(e,t,s,n,i,r,a,l,c){c[0]=Math.min(c[0],e,a),c[1]=Math.min(c[1],t,l),c[2]=Math.max(c[2],e,a),c[3]=Math.max(c[3],t,l),this.#t(e,s,i,a,t,n,r,l,3*(-e+3*(s-i)+a),6*(e-2*s+i),3*(s-e),c),this.#t(e,s,i,a,t,n,r,l,3*(-t+3*(n-r)+l),6*(t-2*n+r),3*(n-t),c)}}function hu(o){return decodeURIComponent(escape(o))}let ii=null,Mr=null;function vo(o){return ii||(ii=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Mr=new Map([["ï¬…","Å¿t"]])),o.replaceAll(ii,(e,t,s)=>t?t.normalize("NFKC"):Mr.get(s))}function Zi(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const o=new Uint8Array(32);return crypto.getRandomValues(o),ou(o)}const Jt="pdfjs_internal_id_";function uu(o,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[s,n,...i]=t;if(!o(s)&&!Number.isInteger(s)||!e(n))return!1;const r=i.length;let a=!0;switch(n.name){case"XYZ":if(r<2||r>3)return!1;break;case"Fit":case"FitB":return r===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(r>1)return!1;break;case"FitR":if(r!==4)return!1;a=!1;break;default:return!1}for(const l of i)if(!(typeof l=="number"||a&&l===null))return!1;return!0}function We(o,e,t){return Math.min(Math.max(o,e),t)}typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(o){return o.reduce((e,t)=>e+t,0)});class Rs{static textContent(e){const t=[],s={items:t,styles:Object.create(null)};function n(i){if(!i)return;let r=null;const a=i.name;if(a==="#text")r=i.value;else if(Rs.shouldBuildText(a))i?.attributes?.textContent?r=i.attributes.textContent:i.value&&(r=i.value);else return;if(r!==null&&t.push({str:r}),!!i.children)for(const l of i.children)n(l)}return n(e),s}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}class Ji{static setupStorage(e,t,s,n,i){const r=n.getValue(t,{value:null});switch(s.name){case"textarea":if(r.value!==null&&(e.textContent=r.value),i==="print")break;e.addEventListener("input",a=>{n.setValue(t,{value:a.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(r.value===s.attributes.xfaOn?e.setAttribute("checked",!0):r.value===s.attributes.xfaOff&&e.removeAttribute("checked"),i==="print")break;e.addEventListener("change",a=>{n.setValue(t,{value:a.target.checked?a.target.getAttribute("xfaOn"):a.target.getAttribute("xfaOff")})})}else{if(r.value!==null&&e.setAttribute("value",r.value),i==="print")break;e.addEventListener("input",a=>{n.setValue(t,{value:a.target.value})})}break;case"select":if(r.value!==null){e.setAttribute("value",r.value);for(const a of s.children)a.attributes.value===r.value?a.attributes.selected=!0:a.attributes.hasOwnProperty("selected")&&delete a.attributes.selected}e.addEventListener("input",a=>{const l=a.target.options,c=l.selectedIndex===-1?"":l[l.selectedIndex].value;n.setValue(t,{value:c})});break}}static setAttributes({html:e,element:t,storage:s=null,intent:n,linkService:i}){const{attributes:r}=t,a=e instanceof HTMLAnchorElement;r.type==="radio"&&(r.name=`${r.name}-${n}`);for(const[l,c]of Object.entries(r))if(c!=null)switch(l){case"class":c.length&&e.setAttribute(l,c.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",c);break;case"style":Object.assign(e.style,c);break;case"textContent":e.textContent=c;break;default:(!a||l!=="href"&&l!=="newWindow")&&e.setAttribute(l,c)}a&&i.addLinkAttributes(e,r.href,r.newWindow),s&&r.dataId&&this.setupStorage(e,r.dataId,t,s)}static render(e){const t=e.annotationStorage,s=e.linkService,n=e.xfaHtml,i=e.intent||"display",r=document.createElement(n.name);n.attributes&&this.setAttributes({html:r,element:n,intent:i,linkService:s});const a=i!=="richText",l=e.div;if(l.append(r),e.viewport){const h=`matrix(${e.viewport.transform.join(",")})`;l.style.transform=h}a&&l.setAttribute("class","xfaLayer xfaFont");const c=[];if(n.children.length===0){if(n.value){const h=document.createTextNode(n.value);r.append(h),a&&Rs.shouldBuildText(n.name)&&c.push(h)}return{textDivs:c}}const d=[[n,-1,r]];for(;d.length>0;){const[h,f,p]=d.at(-1);if(f+1===h.children.length){d.pop();continue}const b=h.children[++d.at(-1)[1]];if(b===null)continue;const{name:m}=b;if(m==="#text"){const g=document.createTextNode(b.value);c.push(g),p.append(g);continue}const y=b?.attributes?.xmlns?document.createElementNS(b.attributes.xmlns,m):document.createElement(m);if(p.append(y),b.attributes&&this.setAttributes({html:y,element:b,storage:t,intent:i,linkService:s}),b.children?.length>0)d.push([b,-1,y]);else if(b.value){const g=document.createTextNode(b.value);a&&Rs.shouldBuildText(m)&&c.push(g),y.append(g)}}for(const h of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))h.setAttribute("readOnly",!0);return{textDivs:c}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const At="http://www.w3.org/2000/svg";class Ut{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function fs(o,e="text"){if(_s(o,document.baseURI)){const t=await fetch(o);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,s)=>{const n=new XMLHttpRequest;n.open("GET",o,!0),n.responseType=e,n.onreadystatechange=()=>{if(n.readyState===XMLHttpRequest.DONE){if(n.status===200||n.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(n.response);return}t(n.responseText);return}s(new Error(n.statusText))}},n.send(null)})}class Us{constructor({viewBox:e,userUnit:t,scale:s,rotation:n,offsetX:i=0,offsetY:r=0,dontFlip:a=!1}){this.viewBox=e,this.userUnit=t,this.scale=s,this.rotation=n,this.offsetX=i,this.offsetY=r,s*=t;const l=(e[2]+e[0])/2,c=(e[3]+e[1])/2;let d,h,f,p;switch(n%=360,n<0&&(n+=360),n){case 180:d=-1,h=0,f=0,p=1;break;case 90:d=0,h=1,f=1,p=0;break;case 270:d=0,h=-1,f=-1,p=0;break;case 0:d=1,h=0,f=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}a&&(f=-f,p=-p);let b,m,y,g;d===0?(b=Math.abs(c-e[1])*s+i,m=Math.abs(l-e[0])*s+r,y=(e[3]-e[1])*s,g=(e[2]-e[0])*s):(b=Math.abs(l-e[0])*s+i,m=Math.abs(c-e[1])*s+r,y=(e[2]-e[0])*s,g=(e[3]-e[1])*s),this.transform=[d*s,h*s,f*s,p*s,b-d*s*l-f*s*c,m-h*s*l-p*s*c],this.width=y,this.height=g}get rawDims(){const e=this.viewBox;return ue(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:s=this.offsetX,offsetY:n=this.offsetY,dontFlip:i=!1}={}){return new Us({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:n,dontFlip:i})}convertToViewportPoint(e,t){const s=[e,t];return se.applyTransform(s,this.transform),s}convertToViewportRectangle(e){const t=[e[0],e[1]];se.applyTransform(t,this.transform);const s=[e[2],e[3]];return se.applyTransform(s,this.transform),[t[0],t[1],s[0],s[1]]}convertToPdfPoint(e,t){const s=[e,t];return se.applyInverseTransform(s,this.transform),s}}class Mn extends $t{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function zs(o){const e=o.length;let t=0;for(;t<e&&o[t].trim()==="";)t++;return o.substring(t,t+5).toLowerCase()==="data:"}function Fn(o){return typeof o=="string"&&/\.pdf$/i.test(o)}function Ao(o){return[o]=o.split(/[#?]/,1),o.substring(o.lastIndexOf("/")+1)}function So(o,e="document.pdf"){if(typeof o!="string")return e;if(zs(o))return fe('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const s=(a=>{try{return new URL(a)}catch{try{return new URL(decodeURIComponent(a))}catch{try{return new URL(a,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(a),"https://foo.bar")}catch{return null}}}}})(o);if(!s)return e;const n=a=>{try{let l=decodeURIComponent(a);return l.includes("/")?(l=l.split("/").at(-1),l.test(/^\.pdf$/i)?l:a):l}catch{return a}},i=/\.pdf$/i,r=s.pathname.split("/").at(-1);if(i.test(r))return n(r);if(s.searchParams.size>0){const a=Array.from(s.searchParams.values()).reverse();for(const c of a)if(i.test(c))return n(c);const l=Array.from(s.searchParams.keys()).reverse();for(const c of l)if(i.test(c))return n(c)}if(s.hash){const l=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(s.hash);if(l)return n(l[0])}return e}class Fr{started=Object.create(null);times=[];time(e){e in this.started&&fe(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||fe(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:s}of this.times)t=Math.max(s.length,t);for(const{name:s,start:n,end:i}of this.times)e.push(`${s.padEnd(t)} ${i-n}ms
`);return e.join("")}}function _s(o,e){const t=e?URL.parse(o,e):URL.parse(o);return t?.protocol==="http:"||t?.protocol==="https:"}function at(o){o.preventDefault()}function De(o){o.preventDefault(),o.stopPropagation()}function fu(o){console.log("Deprecated API usage: "+o)}class wn{static#e;static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!="string")return null;this.#e||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const t=this.#e.exec(e);if(!t)return null;const s=parseInt(t[1],10);let n=parseInt(t[2],10);n=n>=1&&n<=12?n-1:0;let i=parseInt(t[3],10);i=i>=1&&i<=31?i:1;let r=parseInt(t[4],10);r=r>=0&&r<=23?r:0;let a=parseInt(t[5],10);a=a>=0&&a<=59?a:0;let l=parseInt(t[6],10);l=l>=0&&l<=59?l:0;const c=t[7]||"Z";let d=parseInt(t[8],10);d=d>=0&&d<=23?d:0;let h=parseInt(t[9],10)||0;return h=h>=0&&h<=59?h:0,c==="-"?(r+=d,a+=h):c==="+"&&(r-=d,a-=h),new Date(Date.UTC(s,n,i,r,a,l))}}function _o(o,{scale:e=1,rotation:t=0}){const{width:s,height:n}=o.attributes.style,i=[0,0,parseInt(s),parseInt(n)];return new Us({viewBox:i,userUnit:1,scale:e,rotation:t})}function ps(o){if(o.startsWith("#")){const e=parseInt(o.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return o.startsWith("rgb(")?o.slice(4,-1).split(",").map(e=>parseInt(e)):o.startsWith("rgba(")?o.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(fe(`Not a valid color format: "${o}"`),[0,0,0])}function pu(o){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of o.keys()){e.style.color=t;const s=window.getComputedStyle(e).color;o.set(t,ps(s))}e.remove()}function Re(o){const{a:e,b:t,c:s,d:n,e:i,f:r}=o.getTransform();return[e,t,s,n,i,r]}function gt(o){const{a:e,b:t,c:s,d:n,e:i,f:r}=o.getTransform().invertSelf();return[e,t,s,n,i,r]}function Lt(o,e,t=!1,s=!0){if(e instanceof Us){const{pageWidth:n,pageHeight:i}=e.rawDims,{style:r}=o,a=Oe.isCSSRoundSupported,l=`var(--total-scale-factor) * ${n}px`,c=`var(--total-scale-factor) * ${i}px`,d=a?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,h=a?`round(down, ${c}, var(--scale-round-y))`:`calc(${c})`;!t||e.rotation%180===0?(r.width=d,r.height=h):(r.width=h,r.height=d)}s&&o.setAttribute("data-main-rotation",e.rotation)}class ft{constructor(){const{pixelRatio:e}=ft;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,s,n,i=-1){let r=1/0,a=1/0,l=1/0;s=ft.capPixels(s,i),s>0&&(r=Math.sqrt(s/(e*t))),n!==-1&&(a=n/e,l=n/t);const c=Math.min(r,a,l);return this.sx>c||this.sy>c?(this.sx=c,this.sy=c,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const s=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,s):s}return e}}const vn=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class mu{static get isDarkMode(){return ue(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class Eo{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:s}=window.getComputedStyle(e);return e.remove(),ue(this,"commentForegroundColor",ps(s))}}function ko(o,e,t,s){s=Math.min(Math.max(s??1,0),1);const n=255*(1-s);return o=Math.round(o*s+n),e=Math.round(e*s+n),t=Math.round(t*s+n),[o,e,t]}function Or(o,e){const t=o[0]/255,s=o[1]/255,n=o[2]/255,i=Math.max(t,s,n),r=Math.min(t,s,n),a=(i+r)/2;if(i===r)e[0]=e[1]=0;else{const l=i-r;switch(e[1]=a<.5?l/(i+r):l/(2-i-r),i){case t:e[0]=((s-n)/l+(s<n?6:0))*60;break;case s:e[0]=((n-t)/l+2)*60;break;case n:e[0]=((t-s)/l+4)*60;break}}e[2]=a}function Ei(o,e){const t=o[0],s=o[1],n=o[2],i=(1-Math.abs(2*n-1))*s,r=i*(1-Math.abs(t/60%2-1)),a=n-i/2;switch(Math.floor(t/60)){case 0:e[0]=i+a,e[1]=r+a,e[2]=a;break;case 1:e[0]=r+a,e[1]=i+a,e[2]=a;break;case 2:e[0]=a,e[1]=i+a,e[2]=r+a;break;case 3:e[0]=a,e[1]=r+a,e[2]=i+a;break;case 4:e[0]=r+a,e[1]=a,e[2]=i+a;break;case 5:case 6:e[0]=i+a,e[1]=a,e[2]=r+a;break}}function Br(o){return o<=.03928?o/12.92:((o+.055)/1.055)**2.4}function Ur(o,e,t){Ei(o,t),t.map(Br);const s=.2126*t[0]+.7152*t[1]+.0722*t[2];Ei(e,t),t.map(Br);const n=.2126*t[0]+.7152*t[1]+.0722*t[2];return s>n?(s+.05)/(n+.05):(n+.05)/(s+.05)}const zr=new Map;function Co(o,e){const t=o[0]+o[1]*256+o[2]*65536+e[0]*16777216+e[1]*4294967296+e[2]*1099511627776;let s=zr.get(t);if(s)return s;const n=new Float32Array(9),i=n.subarray(0,3),r=n.subarray(3,6);Or(o,r);const a=n.subarray(6,9);Or(e,a);const l=a[2]<.5,c=l?12:4.5;if(r[2]=l?Math.sqrt(r[2]):1-Math.sqrt(1-r[2]),Ur(r,a,i)<c){let d,h;l?(d=r[2],h=1):(d=0,h=r[2]);const f=.005;for(;h-d>f;){const p=r[2]=(d+h)/2;l===Ur(r,a,i)<c?d=p:h=p}r[2]=l?h:d}return Ei(r,i),s=se.makeHexColor(Math.round(i[0]*255),Math.round(i[1]*255),Math.round(i[2]*255)),zr.set(t,s),s}function Qi({html:o,dir:e,className:t},s){const n=document.createDocumentFragment();if(typeof o=="string"){const i=document.createElement("p");i.dir=e||"auto";const r=o.split(/(?:\r\n?|\n)/);for(let a=0,l=r.length;a<l;++a){const c=r[a];i.append(document.createTextNode(c)),a<l-1&&i.append(document.createElement("br"))}n.append(i)}else Ji.render({xfaHtml:o,div:n,intent:"richText"});n.firstElementChild.classList.add("richText",t),s.append(n)}function To(o){const e=new Path2D;if(!o)return e;for(let t=0,s=o.length;t<s;)switch(o[t++]){case bs.moveTo:e.moveTo(o[t++],o[t++]);break;case bs.lineTo:e.lineTo(o[t++],o[t++]);break;case bs.curveTo:e.bezierCurveTo(o[t++],o[t++],o[t++],o[t++],o[t++],o[t++]);break;case bs.quadraticCurveTo:e.quadraticCurveTo(o[t++],o[t++],o[t++],o[t++]);break;case bs.closePath:e.closePath();break;default:fe(`Unrecognized drawing path operator: ${o[t-1]}`);break}return e}class xe{static#e=null;static#t=null;static#n=null;static#s=0;static#a=[];get pagesNumber(){return xe.#s}set pagesNumber(e){xe.#s!==e&&(xe.#s=e,e===0&&(xe.#t=null,xe.#e=null))}addListener(e){xe.#a.push(e)}removeListener(e){const t=xe.#a.indexOf(e);t>=0&&xe.#a.splice(t,1)}#r(){for(const e of xe.#a)e()}#i(e){if(xe.#t)return;const t=xe.#s,s=new Uint32Array(3*t),n=xe.#t=s.subarray(0,t),i=xe.#e=s.subarray(t,2*t);if(e)for(let r=0;r<t;r++)n[r]=i[r]=r+1;xe.#n=s.subarray(2*t)}movePages(e,t,s){this.#i(!0);const n=xe.#t,i=xe.#e;xe.#n.set(i);const r=t.length,a=new Uint32Array(r);let l=0;for(let p=0;p<r;p++){const b=t[p]-1;a[p]=n[b],b<s&&(l+=1)}const c=xe.#s;let d=s-l;const h=c-r;d=We(d,0,h);for(let p=0,b=0;p<c;p++)e.has(p+1)||(n[b++]=n[p]);n.copyWithin(d+r,d,h),n.set(a,d);let f=!1;for(let p=0,b=c;p<b;p++){const m=n[p];f||=m!==p+1,i[m-1]=p+1}this.#r(),f||(this.pagesNumber=0)}hasBeenAltered(){return xe.#t!==null}getPageMappingForSaving(){return{pageIndices:xe.#e?xe.#e.map(e=>e-1):null}}getPrevPageNumber(e){return xe.#n[xe.#t[e-1]-1]}getPageNumber(e){return xe.#e?.[e-1]??e}getPageId(e){return xe.#t?.[e-1]??e}static get instance(){return ue(this,"instance",new xe)}getMapping(){return xe.#t.subarray(0,this.pagesNumber)}}let gu=class fn{#e=null;#t=null;#n;#s=null;#a=null;#r=null;#i=null;#o=null;static#c=null;constructor(e){this.#n=e,fn.#c||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const e=this.#e=document.createElement("div");e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=this.#n._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",at,{signal:t}),e.addEventListener("pointerdown",fn.#l,{signal:t}));const s=this.#s=document.createElement("div");s.className="buttons",e.append(s);const n=this.#n.toolbarPosition;if(n){const{style:i}=e,r=this.#n._uiManager.direction==="ltr"?1-n[0]:n[0];i.insetInlineEnd=`${100*r}%`,i.top=`calc(${100*n[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return this.#e}static#l(e){e.stopPropagation()}#u(e){this.#n._focusEventsAllowed=!1,De(e)}#h(e){this.#n._focusEventsAllowed=!0,De(e)}#f(e){const t=this.#n._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener("focusin",this.#u.bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",this.#h.bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",at,{signal:t}),!0)}hide(){this.#e.classList.add("hidden"),this.#t?.hideDropdown()}show(){this.#e.classList.remove("hidden"),this.#a?.shown(),this.#r?.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=this.#n,s=document.createElement("button");s.classList.add("basic","deleteButton"),s.tabIndex=0,s.setAttribute("data-l10n-id",fn.#c[e]),this.#f(s)&&s.addEventListener("click",n=>{t.delete()},{signal:t._signal}),this.#s.append(s)}get#g(){const e=document.createElement("div");return e.className="divider",e}async addAltText(e){const t=await e.render();this.#f(t),this.#s.append(t,this.#g),this.#a=e}addComment(e,t=null){if(this.#r)return;const s=e.renderForToolbar();if(!s)return;this.#f(s);const n=this.#i=this.#g;t?(this.#s.insertBefore(s,t),this.#s.insertBefore(n,t)):this.#s.append(s,n),this.#r=e,e.toolbar=this}addColorPicker(e){if(this.#t)return;this.#t=e;const t=e.renderButton();this.#f(t),this.#s.append(t,this.#g)}async addEditSignatureButton(e){const t=this.#o=await e.renderEditButton(this.#n);this.#f(t),this.#s.append(t,this.#g)}removeButton(e){switch(e){case"comment":this.#r?.removeToolbarCommentButton(),this.#r=null,this.#i?.remove(),this.#i=null;break}}async addButton(e,t){switch(e){case"colorPicker":t&&this.addColorPicker(t);break;case"altText":t&&await this.addAltText(t);break;case"editSignature":t&&await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":t&&this.addComment(t);break}}async addButtonBefore(e,t,s){if(!t&&e==="comment")return;const n=this.#s.querySelector(s);n&&e==="comment"&&this.addComment(t,n)}updateEditSignatureButton(e){this.#o&&(this.#o.title=e)}remove(){this.#e.remove(),this.#t?.destroy(),this.#t=null}};class bu{#e=null;#t=null;#n;constructor(e){this.#n=e}#s(){const e=this.#t=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar");const t=this.#n._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",at,{signal:t});const s=this.#e=document.createElement("div");return s.className="buttons",e.append(s),this.#n.hasCommentManager()&&this.#r("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#n.commentSelection("floating_button")}),this.#r("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#n.highlightSelection("floating_button")}),e}#a(e,t){let s=0,n=0;for(const i of e){const r=i.y+i.height;if(r<s)continue;const a=i.x+(t?i.width:0);if(r>s){n=a,s=r;continue}t?a>n&&(n=a):a<n&&(n=a)}return[t?1-n:n,s]}show(e,t,s){const[n,i]=this.#a(t,s),{style:r}=this.#t||=this.#s();e.append(this.#t),r.insetInlineEnd=`${100*n}%`,r.top=`calc(${100*i}% + var(--editor-toolbar-vert-offset))`}hide(){this.#t.remove()}#r(e,t,s,n){const i=document.createElement("button");i.classList.add("basic",e),i.tabIndex=0,i.setAttribute("data-l10n-id",t);const r=document.createElement("span");i.append(r),r.className="visuallyHidden",r.setAttribute("data-l10n-id",s);const a=this.#n._signal;a instanceof AbortSignal&&!a.aborted&&(i.addEventListener("contextmenu",at,{signal:a}),i.addEventListener("click",n,{signal:a})),this.#e.append(i)}}function No(o,e,t){for(const s of t)e.addEventListener(s,o[s].bind(o))}class ve{static#e=NaN;static#t=null;static#n=NaN;static#s=null;static initializeAndAddPointerId(e){(ve.#t||=new Set).add(e)}static setPointer(e,t){ve.#e||=t,ve.#s??=e}static setTimeStamp(e){ve.#n=e}static isSamePointerId(e){return ve.#e===e}static isSamePointerIdOrRemove(e){return ve.#e===e?!0:(ve.#t?.delete(e),!1)}static isSamePointerType(e){return ve.#s===e}static isInitializedAndDifferentPointerType(e){return ve.#s!==null&&!ve.isSamePointerType(e)}static isSameTimeStamp(e){return ve.#n===e}static isUsingMultiplePointers(){return ve.#t?.size>=1}static clearPointerType(){ve.#s=null}static clearPointerIds(){ve.#e=NaN,ve.#t=null}static clearTimeStamp(){ve.#n=NaN}}class yu{#e=0;get id(){return`${Ns}${this.#e++}`}}class er{#e=Zi();#t=0;#n=null;static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),n=new Image;n.src=e;const i=n.decode().then(()=>(s.drawImage(n,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return ue(this,"_isSVGFittingCanvas",i)}async#s(e,t){this.#n||=new Map;let s=this.#n.get(e);if(s===null)return null;if(s?.bitmap)return s.refCounter+=1,s;try{s||={bitmap:null,id:`image_${this.#e}_${this.#t++}`,refCounter:0,isSvg:!1};let n;if(typeof t=="string"?(s.url=t,n=await fs(t,"blob")):t instanceof File?n=s.file=t:t instanceof Blob&&(n=t),n.type==="image/svg+xml"){const i=er._isSVGFittingCanvas,r=new FileReader,a=new Image,l=new Promise((c,d)=>{a.onload=()=>{s.bitmap=a,s.isSvg=!0,c()},r.onload=async()=>{const h=s.svgUrl=r.result;a.src=await i?`${h}#svgView(preserveAspectRatio(none))`:h},a.onerror=r.onerror=d});r.readAsDataURL(n),await l}else s.bitmap=await createImageBitmap(n);s.refCounter=1}catch(n){fe(n),s=null}return this.#n.set(e,s),s&&this.#n.set(s.id,s),s}async getFromFile(e){const{lastModified:t,name:s,size:n,type:i}=e;return this.#s(`${t}_${s}_${n}_${i}`,e)}async getFromUrl(e){return this.#s(e,e)}async getFromBlob(e,t){const s=await t;return this.#s(e,s)}async getFromId(e){this.#n||=new Map;const t=this.#n.get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:s}=t;return delete t.blobPromise,this.getFromBlob(t.id,s)}return this.getFromUrl(t.url)}getFromCanvas(e,t){this.#n||=new Map;let s=this.#n.get(e);if(s?.bitmap)return s.refCounter+=1,s;const n=new OffscreenCanvas(t.width,t.height);return n.getContext("2d").drawImage(t,0,0),s={bitmap:n.transferToImageBitmap(),id:`image_${this.#e}_${this.#t++}`,refCounter:1,isSvg:!1},this.#n.set(e,s),this.#n.set(s.id,s),s}getSvgUrl(e){const t=this.#n.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#n||=new Map;const t=this.#n.get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:s}=t;if(!t.url&&!t.file){const n=new OffscreenCanvas(s.width,s.height);n.getContext("bitmaprenderer").transferFromImageBitmap(s),t.blobPromise=n.convertToBlob()}s.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#e}_`)}}class xu{#e=[];#t=!1;#n;#s=-1;constructor(e=128){this.#n=e}add({cmd:e,undo:t,post:s,mustExec:n,type:i=NaN,overwriteIfSameType:r=!1,keepUndo:a=!1}){if(n&&e(),this.#t)return;const l={cmd:e,undo:t,post:s,type:i};if(this.#s===-1){this.#e.length>0&&(this.#e.length=0),this.#s=0,this.#e.push(l);return}if(r&&this.#e[this.#s].type===i){a&&(l.undo=this.#e[this.#s].undo),this.#e[this.#s]=l;return}const c=this.#s+1;c===this.#n?this.#e.splice(0,1):(this.#s=c,c<this.#e.length&&this.#e.splice(c)),this.#e.push(l)}undo(){if(this.#s===-1)return;this.#t=!0;const{undo:e,post:t}=this.#e[this.#s];e(),t?.(),this.#t=!1,this.#s-=1}redo(){if(this.#s<this.#e.length-1){this.#s+=1,this.#t=!0;const{cmd:e,post:t}=this.#e[this.#s];e(),t?.(),this.#t=!1}}hasSomethingToUndo(){return this.#s!==-1}hasSomethingToRedo(){return this.#s<this.#e.length-1}cleanType(e){if(this.#s!==-1){for(let t=this.#s;t>=0;t--)if(this.#e[t].type!==e){this.#e.splice(t+1,this.#s-t),this.#s=t;return}this.#e.length=0,this.#s=-1}}destroy(){this.#e=null}}class Hs{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Oe.platform;for(const[s,n,i={}]of e)for(const r of s){const a=r.startsWith("mac+");t&&a?(this.callbacks.set(r.slice(4),{callback:n,options:i}),this.allKeys.add(r.split("+").at(-1))):!t&&!a&&(this.callbacks.set(r,{callback:n,options:i}),this.allKeys.add(r.split("+").at(-1)))}}#e(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;const s=this.callbacks.get(this.#e(t));if(!s)return;const{callback:n,options:{bubbles:i=!1,args:r=[],checker:a=null}}=s;a&&!a(e,t)||(n.bind(e,...r,t)(),i||De(t))}}class tr{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return pu(e),ue(this,"_colors",e)}convert(e){const t=ps(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[s,n]of this._colors)if(n.every((i,r)=>i===t[r]))return tr._colorsMapping.get(s);return t}getHexCode(e){const t=this._colors.get(e);return t?se.makeHexColor(...t):e}}class Tt{#e=new AbortController;#t=null;#n=null;#s=new Map;#a=new Map;#r=null;#i=null;#o=null;#c=new xu;#l=null;#u=null;#h=null;#f=0;#g=new Set;#m=null;#d=null;#p=new Set;_editorUndoBar=null;#b=!1;#x=!1;#y=!1;#E=null;#S=null;#v=null;#C=null;#w=!1;#_=null;#P=new yu;#T=!1;#N=!1;#F=!1;#D=null;#j=null;#O=null;#L=null;#W=null;#k=pe.NONE;#A=new Set;#I=null;#B=null;#z=null;#X=null;#V=null;#Y={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#H=[0,0];#M=null;#G=null;#J=null;#Q=null;#U=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=Tt.prototype,t=r=>r.#G.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&r.hasSomethingToControl(),s=(r,{target:a})=>{if(a instanceof HTMLInputElement){const{type:l}=a;return l!=="text"&&l!=="number"}return!0},n=this.TRANSLATE_SMALL,i=this.TRANSLATE_BIG;return ue(this,"_keyboardManager",new Hs([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],e.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:s}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&r.#G.contains(a)&&!r.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(r,{target:a})=>!(a instanceof HTMLButtonElement)&&r.#G.contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-n,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[n,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-n],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,n],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}]]))}constructor(e,t,s,n,i,r,a,l,c,d,h,f,p,b,m,y){const g=this._signal=this.#e.signal;this.#G=e,this.#J=t,this.#Q=s,this.#r=n,this.#l=i,this.#B=r,this.#V=l,this._eventBus=a,a._on("editingaction",this.onEditingAction.bind(this),{signal:g}),a._on("pagechanging",this.onPageChanging.bind(this),{signal:g}),a._on("scalechanging",this.onScaleChanging.bind(this),{signal:g}),a._on("rotationchanging",this.onRotationChanging.bind(this),{signal:g}),a._on("setpreference",this.onSetPreference.bind(this),{signal:g}),a._on("switchannotationeditorparams",x=>this.updateParams(x.type,x.value),{signal:g}),a._on("pagesedited",this.onPagesEdited.bind(this),{signal:g}),window.addEventListener("pointerdown",()=>{this.#N=!0},{capture:!0,signal:g}),window.addEventListener("pointerup",()=>{this.#N=!1},{capture:!0,signal:g}),this.#ae(),this.#ue(),this.#te(),this.#i=l.annotationStorage,this.#E=l.filterFactory,this.#z=c,this.#C=d||null,this.#b=h,this.#x=f,this.#y=p,this.#W=b||null,this.viewParameters={realScale:Ut.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=m||null,this._supportsPinchToZoom=y!==!1,i?.setSidebarUiManager(this)}destroy(){this.#U?.resolve(),this.#U=null,this.#e?.abort(),this.#e=null,this._signal=null;for(const e of this.#a.values())e.destroy();this.#a.clear(),this.#s.clear(),this.#p.clear(),this.#L?.clear(),this.#t=null,this.#A.clear(),this.#c.destroy(),this.#r?.destroy(),this.#l?.destroy(),this.#B?.destroy(),this.#_?.hide(),this.#_=null,this.#O?.destroy(),this.#O=null,this.#n=null,this.#S&&(clearTimeout(this.#S),this.#S=null),this.#M&&(clearTimeout(this.#M),this.#M=null),this._editorUndoBar?.destroy(),this.#V=null}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return this.#W}get useNewAltTextFlow(){return this.#x}get useNewAltTextWhenAddingImage(){return this.#y}get hcmFilter(){return ue(this,"hcmFilter",this.#z?this.#E.addHCMFilter(this.#z.foreground,this.#z.background):"none")}get direction(){return ue(this,"direction",getComputedStyle(this.#G).direction)}get _highlightColors(){return ue(this,"_highlightColors",this.#C?new Map(this.#C.split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return ue(this,"highlightColors",null);const t=new Map,s=!!this.#z;for(const[n,i]of e){const r=n.endsWith("_HCM");if(s&&r){t.set(n.replace("_HCM",""),i);continue}!s&&!r&&t.set(n,i)}return ue(this,"highlightColors",t)}get highlightColorNames(){return ue(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#h=e}setMainHighlightColorPicker(e){this.#O=e}editAltText(e,t=!1){this.#r?.editAltText(this,e,t)}hasCommentManager(){return!!this.#l}editComment(e,t,s,n){this.#l?.showDialog(this,e,t,s,n)}selectComment(e,t){this.#a.get(e)?.getEditorByUID(t)?.toggleComment(!0,!0)}updateComment(e){this.#l?.updateComment(e.getData())}updatePopupColor(e){this.#l?.updatePopupColor(e)}removeComment(e){this.#l?.removeComments([e.uid])}deleteComment(e,t){const s=()=>{e.comment=t},n=()=>{this._editorUndoBar?.show(s,"comment"),this.toggleComment(null),e.comment=null};this.addCommands({cmd:n,undo:s,mustExec:!0})}toggleComment(e,t,s=void 0){this.#l?.toggleCommentPopup(e,t,s)}makeCommentColor(e,t){return e&&this.#l?.makeCommentColor(e,t)||null}getCommentDialogElement(){return this.#l?.dialogElement||null}async waitForEditorsRendered(e){if(this.#a.has(e-1))return;const{resolve:t,promise:s}=Promise.withResolvers(),n=i=>{i.pageNumber===e&&(this._eventBus._off("editorsrendered",n),t())};this._eventBus.on("editorsrendered",n),await s}getSignature(e){this.#B?.getSignature({uiManager:this,editor:e})}get signatureManager(){return this.#B}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":this.#y=t;break}}onPagesEdited({pagesMapper:e}){for(const n of this.#s.values())n.updatePageIndex(e.getPrevPageNumber(n.pageIndex+1)-1);const t=this.#a,s=this.#a=new Map;for(const[n,i]of t){const r=e.getPrevPageNumber(n+1)-1;if(r===-1){i.destroy();continue}s.set(r,i),i.updatePageIndex(r)}}onPageChanging({pageNumber:e}){this.#f=e-1}focusMainContainer(){this.#G.focus()}findParent(e,t){for(const s of this.#a.values()){const{x:n,y:i,width:r,height:a}=s.div.getBoundingClientRect();if(e>=n&&e<=n+r&&t>=i&&t<=i+a)return s}return null}disableUserSelect(e=!1){this.#J.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#p.add(e)}removeShouldRescale(e){this.#p.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*Ut.PDF_TO_CSS_UNITS;for(const t of this.#p)t.onScaleChanging();this.#h?.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}#Z({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e}#ee(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const s of this.#a.values())if(s.hasTextLayer(e))return s;return null}highlightSelection(e="",t=!1){const s=document.getSelection();if(!s||s.isCollapsed)return;const{anchorNode:n,anchorOffset:i,focusNode:r,focusOffset:a}=s,l=s.toString(),d=this.#Z(s).closest(".textLayer"),h=this.getSelectionBoxes(d);if(!h)return;s.empty();const f=this.#ee(d),p=this.#k===pe.NONE,b=()=>{const m=f?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:h,anchorNode:n,anchorOffset:i,focusNode:r,focusOffset:a,text:l});p&&this.showAllEditors("highlight",!0,!0),t&&m?.editComment()};if(p){this.switchToMode(pe.HIGHLIGHT,b);return}b()}commentSelection(e=""){this.highlightSelection(e,!0)}#ie(){const e=document.getSelection();if(!e||e.isCollapsed)return;const s=this.#Z(e).closest(".textLayer"),n=this.getSelectionBoxes(s);n&&(this.#_||=new bu(this),this.#_.show(s,n,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(e){if(!this.#i)return null;const t=`${Ns}${e}`,s=this.#i.getRawValue(t);return s&&this.#i.remove(t),s}addToAnnotationStorage(e){!e.isEmpty()&&this.#i&&!this.#i.has(e.id)&&this.#i.setValue(e.id,e)}a11yAlert(e,t=null){const s=this.#Q;s&&(s.setAttribute("data-l10n-id",e),t?s.setAttribute("data-l10n-args",JSON.stringify(t)):s.removeAttribute("data-l10n-args"))}#re(){const e=document.getSelection();if(!e||e.isCollapsed){this.#I&&(this.#_?.hide(),this.#I=null,this.#R({hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===this.#I)return;const n=this.#Z(e).closest(".textLayer");if(!n){this.#I&&(this.#_?.hide(),this.#I=null,this.#R({hasSelectedText:!1}));return}if(this.#_?.hide(),this.#I=t,this.#R({hasSelectedText:!0}),!(this.#k!==pe.HIGHLIGHT&&this.#k!==pe.NONE)&&(this.#k===pe.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#w=this.isShiftKeyDown,!this.isShiftKeyDown)){const i=this.#k===pe.HIGHLIGHT?this.#ee(n):null;if(i?.toggleDrawing(),this.#N){const r=new AbortController,a=this.combinedSignal(r),l=c=>{c.type==="pointerup"&&c.button!==0||(r.abort(),i?.toggleDrawing(!0),c.type==="pointerup"&&this.#q("main_toolbar"))};window.addEventListener("pointerup",l,{signal:a}),window.addEventListener("blur",l,{signal:a})}else i?.toggleDrawing(!0),this.#q("main_toolbar")}}#q(e=""){this.#k===pe.HIGHLIGHT?this.highlightSelection(e):this.#b&&this.#ie()}#ae(){document.addEventListener("selectionchange",this.#re.bind(this),{signal:this._signal})}#oe(){if(this.#v)return;this.#v=new AbortController;const e=this.combinedSignal(this.#v);window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})}#le(){this.#v?.abort(),this.#v=null}blur(){if(this.isShiftKeyDown=!1,this.#w&&(this.#w=!1,this.#q("main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of this.#A)if(t.div.contains(e)){this.#j=[t,e],t._focusEventsAllowed=!1;break}}focus(){if(!this.#j)return;const[e,t]=this.#j;this.#j=null,t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}#te(){if(this.#D)return;this.#D=new AbortController;const e=this.combinedSignal(this.#D);window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})}#ce(){this.#D?.abort(),this.#D=null}#de(){if(this.#u)return;this.#u=new AbortController;const e=this.combinedSignal(this.#u);document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})}#he(){this.#u?.abort(),this.#u=null}#ue(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})}addEditListeners(){this.#te(),this.setEditingState(!0)}removeEditListeners(){this.#ce(),this.setEditingState(!1)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const s of this.#d)if(s.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const s of this.#d)if(s.isHandlingMimeForPasting(t.type)){s.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){if(e.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const t=[];for(const s of this.#A){const n=s.serialize(!0);n&&t.push(n)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const i of t.items)for(const r of this.#d)if(r.isHandlingMimeForPasting(i.type)){r.paste(i,this.currentLayer);return}let s=t.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(i){fe(`paste: "${i.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const n=this.currentLayer;try{const i=[];for(const l of s){const c=await n.deserialize(l);if(!c)return;i.push(c)}const r=()=>{for(const l of i)this.#se(l);this.#ne(i)},a=()=>{for(const l of i)l.remove()};this.addCommands({cmd:r,undo:a,mustExec:!0})}catch(i){fe(`paste: "${i.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),this.#k!==pe.NONE&&!this.isEditorHandlingKeyboard&&Tt._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,this.#w&&(this.#w=!1,this.#q("main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#R(e){Object.entries(e).some(([s,n])=>this.#Y[s]!==n)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#Y,e)}),this.#k===pe.HIGHLIGHT&&e.hasSelectedEditor===!1&&this.#$([[ge.HIGHLIGHT_FREE,!0]]))}#$(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#oe(),this.#de(),this.#R({isEditing:this.#k!==pe.NONE,isEmpty:this.#K(),hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:this.#c.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#le(),this.#he(),this.#R({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#d){this.#d=e;for(const t of this.#d)this.#$(t.defaultPropertiesToUpdate)}}getId(){return this.#P.id}get currentLayer(){return this.#a.get(this.#f)}getLayer(e){return this.#a.get(e)}get currentPageIndex(){return this.#f}addLayer(e){this.#a.set(e.pageIndex,e),this.#T?e.enable():e.disable()}removeLayer(e){this.#a.delete(e.pageIndex)}async updateMode(e,t=null,s=!1,n=!1,i=!1,r=!1){if(this.#k!==e&&!(this.#U&&(await this.#U.promise,!this.#U))){if(this.#U=Promise.withResolvers(),this.#h?.commitOrRemove(),this.#k===pe.POPUP&&this.#l?.hideSidebar(),this.#l?.destroyPopup(),this.#k=e,e===pe.NONE){this.setEditingState(!1),this.#pe();for(const a of this.#s.values())a.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#U.resolve();return}for(const a of this.#s.values())a.addStandaloneCommentButton();e===pe.SIGNATURE&&await this.#B?.loadSignatures(),s&&ve.clearPointerType(),this.setEditingState(!0),await this.#fe(),this.unselectAll();for(const a of this.#a.values())a.updateMode(e);if(e===pe.POPUP){this.#n||=await this.#V.getAnnotationsByType(new Set(this.#d.map(c=>c._editorType)));const a=new Set,l=[];for(const c of this.#s.values()){const{annotationElementId:d,hasComment:h,deleted:f}=c;d&&a.add(d),h&&!f&&l.push(c.getData())}for(const c of this.#n){const{id:d,popupRef:h,contentsObj:f}=c;h&&f?.str&&!a.has(d)&&!this.#g.has(d)&&l.push(c)}this.#l?.showSidebar(l)}if(!t){n&&this.addNewEditorFromKeyboard(),this.#U.resolve();return}for(const a of this.#s.values())a.uid===t?(this.setSelected(a),r?a.editComment():i?a.enterInEditMode():a.focus()):a.unselect();this.#U.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==this.#k&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(this.#d){switch(e){case ge.CREATE:this.currentLayer.addNewEditor(t);return;case ge.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#X||=new Map).set(e,t),this.showAllEditors("highlight",t);break}if(this.hasSelection)for(const s of this.#A)s.updateParams(e,t);else for(const s of this.#d)s.updateDefaultParams(e,t)}}showAllEditors(e,t,s=!1){for(const i of this.#s.values())i.editorType===e&&i.show(t);(this.#X?.get(ge.HIGHLIGHT_SHOW_ALL)??!0)!==t&&this.#$([[ge.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(this.#F!==e){this.#F=e;for(const t of this.#a.values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}async#fe(){if(!this.#T){this.#T=!0;const e=[];for(const t of this.#a.values())e.push(t.enable());await Promise.all(e);for(const t of this.#s.values())t.enable()}}#pe(){if(this.unselectAll(),this.#T){this.#T=!1;for(const e of this.#a.values())e.disable();for(const e of this.#s.values())e.disable()}}*getEditors(e){for(const t of this.#s.values())t.pageIndex===e&&(yield t)}getEditor(e){return this.#s.get(e)}addEditor(e){this.#s.set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(this.#S&&clearTimeout(this.#S),this.#S=setTimeout(()=>{this.focusMainContainer(),this.#S=null},0)),this.#s.delete(e.id),e.annotationElementId&&this.#L?.delete(e.annotationElementId),this.unselect(e),(!e.annotationElementId||!this.#g.has(e.annotationElementId))&&this.#i?.remove(e.id)}addDeletedAnnotationElement(e){this.#g.add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return this.#g.has(e)}removeDeletedAnnotationElement(e){this.#g.delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}#se(e){const t=this.#a.get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}setActiveEditor(e){this.#t!==e&&(this.#t=e,e&&this.#$(e.propertiesToUpdate))}get#me(){let e=null;for(e of this.#A);return e}updateUI(e){this.#me===e&&this.#$(e.propertiesToUpdate)}updateUIForDefaultProperties(e){this.#$(e.defaultPropertiesToUpdate)}toggleSelected(e){if(this.#A.has(e)){this.#A.delete(e),e.unselect(),this.#R({hasSelectedEditor:this.hasSelection});return}this.#A.add(e),e.select(),this.#$(e.propertiesToUpdate),this.#R({hasSelectedEditor:!0})}setSelected(e){this.updateToolbar({mode:e.mode,editId:e.uid}),this.#h?.commitOrRemove();for(const t of this.#A)t!==e&&t.unselect();this.#A.clear(),this.#A.add(e),e.select(),this.#$(e.propertiesToUpdate),this.#R({hasSelectedEditor:!0})}isSelected(e){return this.#A.has(e)}get firstSelectedEditor(){return this.#A.values().next().value}unselect(e){e.unselect(),this.#A.delete(e),this.#R({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#A.size!==0}get isEnterHandled(){return this.#A.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#c.undo(),this.#R({hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#K()}),this._editorUndoBar?.hide()}redo(){this.#c.redo(),this.#R({hasSomethingToUndo:!0,hasSomethingToRedo:this.#c.hasSomethingToRedo(),isEmpty:this.#K()})}addCommands(e){this.#c.add(e),this.#R({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#K()})}cleanUndoStack(e){this.#c.cleanType(e)}#K(){if(this.#s.size===0)return!0;if(this.#s.size===1)for(const e of this.#s.values())return e.isEmpty();return!1}delete(){this.commitOrRemove();const e=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...this.#A],s=()=>{this._editorUndoBar?.show(n,t.length===1?t[0].editorType:t.length);for(const i of t)i.remove()},n=()=>{for(const i of t)this.#se(i)};this.addCommands({cmd:s,undo:n,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#ne(e){for(const t of this.#A)t.unselect();this.#A.clear();for(const t of e)t.isEmpty()||(this.#A.add(t),t.select());this.#R({hasSelectedEditor:this.hasSelection})}selectAll(){for(const e of this.#A)e.commit();this.#ne(this.#s.values())}unselectAll(){if(!(this.#t&&(this.#t.commitOrRemove(),this.#k!==pe.NONE))&&!this.#h?.commitOrRemove()&&this.hasSelection){for(const e of this.#A)e.unselect();this.#A.clear(),this.#R({hasSelectedEditor:!1})}}translateSelectedEditors(e,t,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;this.#H[0]+=e,this.#H[1]+=t;const[n,i]=this.#H,r=[...this.#A],a=1e3;this.#M&&clearTimeout(this.#M),this.#M=setTimeout(()=>{this.#M=null,this.#H[0]=this.#H[1]=0,this.addCommands({cmd:()=>{for(const l of r)this.#s.has(l.id)&&(l.translateInPage(n,i),l.translationDone())},undo:()=>{for(const l of r)this.#s.has(l.id)&&(l.translateInPage(-n,-i),l.translationDone())},mustExec:!1})},a);for(const l of r)l.translateInPage(e,t),l.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#m=new Map;for(const e of this.#A)this.#m.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#m)return!1;this.disableUserSelect(!1);const e=this.#m;this.#m=null;let t=!1;for(const[{x:n,y:i,pageIndex:r},a]of e)a.newX=n,a.newY=i,a.newPageIndex=r,t||=n!==a.savedX||i!==a.savedY||r!==a.savedPageIndex;if(!t)return!1;const s=(n,i,r,a)=>{if(this.#s.has(n.id)){const l=this.#a.get(a);l?n._setParentAndPosition(l,i,r):(n.pageIndex=a,n.x=i,n.y=r)}};return this.addCommands({cmd:()=>{for(const[n,{newX:i,newY:r,newPageIndex:a}]of e)s(n,i,r,a)},undo:()=>{for(const[n,{savedX:i,savedY:r,savedPageIndex:a}]of e)s(n,i,r,a)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(this.#m)for(const s of this.#m.keys())s.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#A.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return this.#t===e}getActive(){return this.#t}getMode(){return this.#k}isEditingMode(){return this.#k!==pe.NONE}get imageManager(){return ue(this,"imageManager",new er)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let c=0,d=t.rangeCount;c<d;c++)if(!e.contains(t.getRangeAt(c).commonAncestorContainer))return null;const{x:s,y:n,width:i,height:r}=e.getBoundingClientRect();let a;switch(e.getAttribute("data-main-rotation")){case"90":a=(c,d,h,f)=>({x:(d-n)/r,y:1-(c+h-s)/i,width:f/r,height:h/i});break;case"180":a=(c,d,h,f)=>({x:1-(c+h-s)/i,y:1-(d+f-n)/r,width:h/i,height:f/r});break;case"270":a=(c,d,h,f)=>({x:1-(d+f-n)/r,y:(c-s)/i,width:f/r,height:h/i});break;default:a=(c,d,h,f)=>({x:(c-s)/i,y:(d-n)/r,width:h/i,height:f/r});break}const l=[];for(let c=0,d=t.rangeCount;c<d;c++){const h=t.getRangeAt(c);if(!h.collapsed)for(const{x:f,y:p,width:b,height:m}of h.getClientRects())b===0||m===0||l.push(a(f,p,b,m))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:e,id:t}){(this.#o||=new Map).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){this.#o?.delete(e)}renderAnnotationElement(e){const t=this.#o?.get(e.data.id);if(!t)return;const s=this.#i.getRawValue(t);s&&(this.#k===pe.NONE&&!s.hasBeenModified||s.renderAnnotationElement(e))}setMissingCanvas(e,t,s){const n=this.#L?.get(e);n&&(n.setCanvas(t,s),this.#L.delete(e))}addMissingCanvas(e,t){(this.#L||=new Map).set(e,t)}}class xt{#e=null;#t=!1;#n=null;#s=null;#a=null;#r=null;#i=!1;#o=null;#c=null;#l=null;#u=null;#h=!1;static#f=null;static _l10n=null;constructor(e){this.#c=e,this.#h=e._uiManager.useNewAltTextFlow,xt.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(e){xt._l10n??=e}async render(){const e=this.#n=document.createElement("button");e.className="altText",e.tabIndex="0";const t=this.#s=document.createElement("span");e.append(t),this.#h?(e.classList.add("new"),e.setAttribute("data-l10n-id",xt.#f.missing),t.setAttribute("data-l10n-id",xt.#f["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=this.#c._uiManager._signal;e.addEventListener("contextmenu",at,{signal:s}),e.addEventListener("pointerdown",i=>i.stopPropagation(),{signal:s});const n=i=>{i.preventDefault(),this.#c._uiManager.editAltText(this.#c),this.#h&&this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#g}})};return e.addEventListener("click",n,{capture:!0,signal:s}),e.addEventListener("keydown",i=>{i.target===e&&i.key==="Enter"&&(this.#i=!0,n(i))},{signal:s}),await this.#m(),e}get#g(){return this.#e&&"added"||this.#e===null&&this.guessedText&&"review"||"missing"}finish(){this.#n&&(this.#n.focus({focusVisible:this.#i}),this.#i=!1)}isEmpty(){return this.#h?this.#e===null:!this.#e&&!this.#t}hasData(){return this.#h?this.#e!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}async setGuessedText(e){this.#e===null&&(this.#l=e,this.#u=await xt._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e}),this.#m())}toggleAltTextBadge(e=!1){if(!this.#h||this.#e){this.#o?.remove(),this.#o=null;return}if(!this.#o){const t=this.#o=document.createElement("div");t.className="noAltTextBadge",this.#c.div.append(t)}this.#o.classList.toggle("hidden",!e)}serialize(e){let t=this.#e;return!e&&this.#l===t&&(t=this.#u),{altText:t,decorative:this.#t,guessedText:this.#l,textWithDisclaimer:this.#u}}get data(){return{altText:this.#e,decorative:this.#t}}set data({altText:e,decorative:t,guessedText:s,textWithDisclaimer:n,cancel:i=!1}){s&&(this.#l=s,this.#u=n),!(this.#e===e&&this.#t===t)&&(i||(this.#e=e,this.#t=t),this.#m())}toggle(e=!1){this.#n&&(!e&&this.#r&&(clearTimeout(this.#r),this.#r=null),this.#n.disabled=!e)}shown(){this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#g}})}destroy(){this.#n?.remove(),this.#n=null,this.#s=null,this.#a=null,this.#o?.remove(),this.#o=null}async#m(){const e=this.#n;if(!e)return;if(this.#h){if(e.classList.toggle("done",!!this.#e),e.setAttribute("data-l10n-id",xt.#f[this.#g]),this.#s?.setAttribute("data-l10n-id",xt.#f[`${this.#g}-label`]),!this.#e){this.#a?.remove();return}}else{if(!this.#e&&!this.#t){e.classList.remove("done"),this.#a?.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=this.#a;if(!t){this.#a=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${this.#c.id}`;const n=100,i=this.#c._uiManager._signal;i.addEventListener("abort",()=>{clearTimeout(this.#r),this.#r=null},{once:!0}),e.addEventListener("mouseenter",()=>{this.#r=setTimeout(()=>{this.#r=null,this.#a.classList.add("show"),this.#c._reportTelemetry({action:"alt_text_tooltip"})},n)},{signal:i}),e.addEventListener("mouseleave",()=>{this.#r&&(clearTimeout(this.#r),this.#r=null),this.#a?.classList.remove("show")},{signal:i})}this.#t?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=this.#e),t.parentNode||e.append(t),this.#c.getElementForAltText()?.setAttribute("aria-describedby",t.id)}}class Js{#e=null;#t=null;#n=!1;#s=null;#a=null;#r=null;#i=null;#o=null;#c=!1;#l=null;constructor(e){this.#s=e}renderForToolbar(){const e=this.#t=document.createElement("button");return e.className="comment",this.#u(e,!1)}renderForStandalone(){const e=this.#e=document.createElement("button");e.className="annotationCommentButton";const t=this.#s.commentButtonPosition;if(t){const{style:s}=e;s.insetInlineEnd=`calc(${100*(this.#s._uiManager.direction==="ltr"?1-t[0]:t[0])}% - var(--comment-button-dim))`,s.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const n=this.#s.commentButtonColor;n&&(s.backgroundColor=n)}return this.#u(e,!0)}focusButton(){setTimeout(()=>{(this.#e??this.#t)?.focus()},0)}onUpdatedColor(){if(!this.#e)return;const e=this.#s.commentButtonColor;e&&(this.#e.style.backgroundColor=e),this.#s._uiManager.updatePopupColor(this.#s)}get commentButtonWidth(){return(this.#e?.getBoundingClientRect().width??0)/this.#s.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#l)return this.#l;if(!this.#e)return null;const{x:e,y:t,height:s}=this.#e.getBoundingClientRect(),{x:n,y:i,width:r,height:a}=this.#s.parent.boundingClientRect;return[(e-n)/r,(t+s-i)/a]}set commentPopupPositionInLayer(e){this.#l=e}hasDefaultPopupPosition(){return this.#l===null}removeStandaloneCommentButton(){this.#e?.remove(),this.#e=null}removeToolbarCommentButton(){this.#t?.remove(),this.#t=null}setCommentButtonStates({selected:e,hasPopup:t}){this.#e&&(this.#e.classList.toggle("selected",e),this.#e.ariaExpanded=t)}#u(e,t){if(!this.#s._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[this.#s._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const s=this.#s._uiManager._signal;if(!(s instanceof AbortSignal)||s.aborted)return e;e.addEventListener("contextmenu",at,{signal:s}),t&&(e.addEventListener("focusin",i=>{this.#s._focusEventsAllowed=!1,De(i)},{capture:!0,signal:s}),e.addEventListener("focusout",i=>{this.#s._focusEventsAllowed=!0,De(i)},{capture:!0,signal:s})),e.addEventListener("pointerdown",i=>i.stopPropagation(),{signal:s});const n=i=>{i.preventDefault(),e===this.#t?this.edit():this.#s.toggleComment(!0)};return e.addEventListener("click",n,{capture:!0,signal:s}),e.addEventListener("keydown",i=>{i.target===e&&i.key==="Enter"&&(this.#n=!0,n(i))},{signal:s}),e.addEventListener("pointerenter",()=>{this.#s.toggleComment(!1,!0)},{signal:s}),e.addEventListener("pointerleave",()=>{this.#s.toggleComment(!1,!1)},{signal:s}),e}edit(e){const t=this.commentPopupPositionInLayer;let s,n;if(t)[s,n]=t;else{[s,n]=this.#s.commentButtonPosition;const{width:d,height:h,x:f,y:p}=this.#s;s=f+s*d,n=p+n*h}const i=this.#s.parent.boundingClientRect,{x:r,y:a,width:l,height:c}=i;this.#s._uiManager.editComment(this.#s,r+s*l,a+n*c,{...e,parentDimensions:i})}finish(){this.#t&&(this.#t.focus({focusVisible:this.#n}),this.#n=!1)}isDeleted(){return this.#c||this.#i===""}isEmpty(){return this.#i===null}hasBeenEdited(){return this.isDeleted()||this.#i!==this.#a}serialize(){return this.data}get data(){return{text:this.#i,richText:this.#r,date:this.#o,deleted:this.isDeleted()}}set data(e){if(e!==this.#i&&(this.#r=null),e===null){this.#i="",this.#c=!0;return}this.#i=e,this.#o=new Date,this.#c=!1}restoreData({text:e,richText:t,date:s}){this.#i=e,this.#r=t,this.#o=s,this.#c=!1}setInitialText(e,t=null){this.#a=e,this.data=e,this.#o=null,this.#r=t}shown(){}destroy(){this.#t?.remove(),this.#t=null,this.#e?.remove(),this.#e=null,this.#i="",this.#r=null,this.#o=null,this.#s=null,this.#n=!1,this.#c=!1}}class $s{#e;#t=!1;#n=null;#s;#a;#r;#i;#o=null;#c;#l=null;#u;#h=null;constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:s=null,onPinchStart:n=null,onPinching:i=null,onPinchEnd:r=null,signal:a}){this.#e=e,this.#n=s,this.#s=t,this.#a=n,this.#r=i,this.#i=r,this.#u=new AbortController,this.#c=AbortSignal.any([a,this.#u.signal]),e.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#c})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/ft.pixelRatio}#f(e){if(this.#s?.())return;if(e.touches.length===1){if(this.#o)return;const n=this.#o=new AbortController,i=AbortSignal.any([this.#c,n.signal]),r=this.#e,a={capture:!0,signal:i,passive:!1},l=c=>{c.pointerType==="touch"&&(this.#o?.abort(),this.#o=null)};r.addEventListener("pointerdown",c=>{c.pointerType==="touch"&&(De(c),l(c))},a),r.addEventListener("pointerup",l,a),r.addEventListener("pointercancel",l,a);return}if(!this.#h){this.#h=new AbortController;const n=AbortSignal.any([this.#c,this.#h.signal]),i=this.#e,r={signal:n,capture:!1,passive:!1};i.addEventListener("touchmove",this.#g.bind(this),r);const a=this.#m.bind(this);i.addEventListener("touchend",a,r),i.addEventListener("touchcancel",a,r),r.capture=!0,i.addEventListener("pointerdown",De,r),i.addEventListener("pointermove",De,r),i.addEventListener("pointercancel",De,r),i.addEventListener("pointerup",De,r),this.#a?.()}if(De(e),e.touches.length!==2||this.#n?.()){this.#l=null;return}let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]),this.#l={touch0X:t.screenX,touch0Y:t.screenY,touch1X:s.screenX,touch1Y:s.screenY}}#g(e){if(!this.#l||e.touches.length!==2)return;De(e);let[t,s]=e.touches;t.identifier>s.identifier&&([t,s]=[s,t]);const{screenX:n,screenY:i}=t,{screenX:r,screenY:a}=s,l=this.#l,{touch0X:c,touch0Y:d,touch1X:h,touch1Y:f}=l,p=h-c,b=f-d,m=r-n,y=a-i,g=Math.hypot(m,y)||1,x=Math.hypot(p,b)||1;if(!this.#t&&Math.abs(x-g)<=$s.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=n,l.touch0Y=i,l.touch1X=r,l.touch1Y=a,!this.#t){this.#t=!0;return}const w=[(n+r)/2,(i+a)/2];this.#r?.(w,x,g)}#m(e){e.touches.length>=2||(this.#h&&(this.#h.abort(),this.#h=null,this.#i?.()),this.#l&&(De(e),this.#l=null,this.#t=!1))}destroy(){this.#u?.abort(),this.#u=null,this.#o?.abort(),this.#o=null}}class de{#e=null;#t=null;#n=null;#s=null;#a=null;#r=!1;#i=null;#o="";#c=null;#l=null;#u=null;#h=null;#f=null;#g="";#m=!1;#d=null;#p=!1;#b=!1;#x=!1;#y=null;#E=0;#S=0;#v=null;#C=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#w=!1;#_=de._zIndex++;static _borderLineWidth=-1;static _colorManager=new tr;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const e=de.prototype._resizeWithKeyboard,t=Tt.TRANSLATE_SMALL,s=Tt.TRANSLATE_BIG;return ue(this,"_resizerKeyboardManager",new Hs([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,s]}],[["Escape","mac+Escape"],de.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null,this.canAddComment=!0;const{rotation:t,rawDims:{pageWidth:s,pageHeight:n,pageX:i,pageY:r}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,n],this.pageTranslation=[i,r];const[a,l]=this.parentDimensions;this.x=e.x/a,this.y=e.y/l,this.isAttachedToDOM=!1,this.deleted=!1}updatePageIndex(e){this.pageIndex=e}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return ue(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new wu({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(de._l10n??=e,de._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),de._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);de._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Se("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#w}set _isDraggable(e){this.#w=e,this.div?.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#_}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(this.#M(),this.#h?.remove(),this.#h=null),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#m?this.#m=!1:this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,s,n){const[i,r]=this.parentDimensions;[s,n]=this.screenToPageTranslation(s,n),this.x=(e+s)/i,this.y=(t+n)/r,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[s,n]=this.parentDimensions;this.setAt(e*s,t*n,this.width*s,this.height*n),this._onTranslated()}#P([e,t],s,n){[s,n]=this.screenToPageTranslation(s,n),this.x+=s/e,this.y+=n/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,t){this.#P(this.parentDimensions,e,t)}translateInPage(e,t){this.#d||=[this.x,this.y,this.width,this.height],this.#P(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){this.#d||=[this.x,this.y,this.width,this.height];const{div:s,parentDimensions:[n,i]}=this;if(this.x+=e/n,this.y+=t/i,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:h,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,h,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:r,y:a}=this;const[l,c]=this.getBaseTranslation();r+=l,a+=c;const{style:d}=s;d.left=`${(100*r).toFixed(2)}%`,d.top=`${(100*a).toFixed(2)}%`,this._onTranslating(r,a),s.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!this.#d&&(this.#d[0]!==this.x||this.#d[1]!==this.y)}get _hasBeenResized(){return!!this.#d&&(this.#d[2]!==this.width||this.#d[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:s}=de,n=s/e,i=s/t;switch(this.rotation){case 90:return[-n,i];case 180:return[n,i];case 270:return[n,-i];default:return[-n,-i]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[s,n]}=this;let{x:i,y:r,width:a,height:l}=this;if(a*=s,l*=n,i*=s,r*=n,this._mustFixPosition)switch(e){case 0:i=We(i,0,s-a),r=We(r,0,n-l);break;case 90:i=We(i,0,s-l),r=We(r,a,n);break;case 180:i=We(i,a,s),r=We(r,l,n);break;case 270:i=We(i,l,s),r=We(r,0,n-a);break}this.x=i/=s,this.y=r/=n;const[c,d]=this.getBaseTranslation();i+=c,r+=d,t.left=`${(100*i).toFixed(2)}%`,t.top=`${(100*r).toFixed(2)}%`,this.moveInDOM()}static#T(e,t,s){switch(s){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return de.#T(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return de.#T(e,t,360-this.parentRotation)}#N(e){switch(e){case 90:{const[t,s]=this.pageDimensions;return[0,-t/s,s/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,s]=this.pageDimensions;return[0,t/s,-s/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,s]}=this;return[t*e,s*e]}setDims(){const{div:{style:e},width:t,height:s}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*s).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#F(){if(this.#c)return;this.#c=document.createElement("div"),this.#c.classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const s of e){const n=document.createElement("div");this.#c.append(n),n.classList.add("resizer",s),n.setAttribute("data-resizer-name",s),n.addEventListener("pointerdown",this.#D.bind(this,s),{signal:t}),n.addEventListener("contextmenu",at,{signal:t}),n.tabIndex=-1}this.div.prepend(this.#c)}#D(e,t){t.preventDefault();const{isMac:s}=Oe.platform;if(t.button!==0||t.ctrlKey&&s)return;this.#n?.toggle(!1);const n=this._isDraggable;this._isDraggable=!1,this.#l=[t.screenX,t.screenY];const i=new AbortController,r=this._uiManager.combinedSignal(i);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#L.bind(this,e),{passive:!0,capture:!0,signal:r}),window.addEventListener("touchmove",De,{passive:!1,signal:r}),window.addEventListener("contextmenu",at,{signal:r}),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const a=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const c=()=>{i.abort(),this.parent.togglePointerEvents(!0),this.#n?.toggle(!0),this._isDraggable=n,this.parent.div.style.cursor=a,this.div.style.cursor=l,this.#O()};window.addEventListener("pointerup",c,{signal:r}),window.addEventListener("blur",c,{signal:r})}#j(e,t,s,n){this.width=s,this.height=n,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#O(){if(!this.#u)return;const{savedX:e,savedY:t,savedWidth:s,savedHeight:n}=this.#u;this.#u=null;const i=this.x,r=this.y,a=this.width,l=this.height;i===e&&r===t&&a===s&&l===n||this.addCommands({cmd:this.#j.bind(this,i,r,a,l),undo:this.#j.bind(this,e,t,s,n),mustExec:!0})}static _round(e){return Math.round(e*1e4)/1e4}#L(e,t){const[s,n]=this.parentDimensions,i=this.x,r=this.y,a=this.width,l=this.height,c=de.MIN_SIZE/s,d=de.MIN_SIZE/n,h=this.#N(this.rotation),f=(U,M)=>[h[0]*U+h[2]*M,h[1]*U+h[3]*M],p=this.#N(360-this.rotation),b=(U,M)=>[p[0]*U+p[2]*M,p[1]*U+p[3]*M];let m,y,g=!1,x=!1;switch(e){case"topLeft":g=!0,m=(U,M)=>[0,0],y=(U,M)=>[U,M];break;case"topMiddle":m=(U,M)=>[U/2,0],y=(U,M)=>[U/2,M];break;case"topRight":g=!0,m=(U,M)=>[U,0],y=(U,M)=>[0,M];break;case"middleRight":x=!0,m=(U,M)=>[U,M/2],y=(U,M)=>[0,M/2];break;case"bottomRight":g=!0,m=(U,M)=>[U,M],y=(U,M)=>[0,0];break;case"bottomMiddle":m=(U,M)=>[U/2,M],y=(U,M)=>[U/2,0];break;case"bottomLeft":g=!0,m=(U,M)=>[0,M],y=(U,M)=>[U,0];break;case"middleLeft":x=!0,m=(U,M)=>[0,M/2],y=(U,M)=>[U,M/2];break}const w=m(a,l),v=y(a,l);let _=f(...v);const E=de._round(i+_[0]),k=de._round(r+_[1]);let D=1,N=1,R,j;if(t.fromKeyboard)({deltaX:R,deltaY:j}=t);else{const{screenX:U,screenY:M}=t,[G,z]=this.#l;[R,j]=this.screenToPageTranslation(U-G,M-z),this.#l[0]=U,this.#l[1]=M}if([R,j]=b(R/s,j/n),g){const U=Math.hypot(a,l);D=N=Math.max(Math.min(Math.hypot(v[0]-w[0]-R,v[1]-w[1]-j)/U,1/a,1/l),c/a,d/l)}else x?D=We(Math.abs(v[0]-w[0]-R),c,1)/a:N=We(Math.abs(v[1]-w[1]-j),d,1)/l;const C=de._round(a*D),B=de._round(l*N);_=f(...y(C,B));const S=E-_[0],O=k-_[1];this.#d||=[this.x,this.y,this.width,this.height],this.width=C,this.height=B,this.x=S,this.y=O,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#n?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#b)return this._editToolbar;this._editToolbar=new gu(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,s]of e)await this._editToolbar.addButton(t,s);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#n?.destroy()}addContainer(e){const t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#n||(xt.initialize(de._l10n),this.#n=new xt(this),this.#e&&(this.#n.data=this.#e,this.#e=null)),this.#n}get altTextData(){return this.#n?.data}set altTextData(e){this.#n&&(this.#n.data=e)}get guessedAltText(){return this.#n?.guessedText}async setGuessedAltText(e){await this.#n?.setGuessedText(e)}serializeAltText(e){return this.#n?.serialize(e)}hasAltText(){return!!this.#n&&!this.#n.isEmpty()}hasAltTextData(){return this.#n?.hasData()??!1}focusCommentButton(){this.#s?.focusButton()}addCommentButton(){return this.canAddComment?this.#s||=new Js(this):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(this.#a){this._uiManager.isEditingMode()&&this.#a.classList.remove("hidden");return}this.hasComment&&(this.#a=this.#s.renderForStandalone(),this.div.append(this.#a))}}removeStandaloneCommentButton(){this.#s.removeStandaloneCommentButton(),this.#a=null}hideStandaloneCommentButton(){this.#a?.classList.add("hidden")}get comment(){if(!this.#s)return null;const{data:{richText:e,text:t,date:s,deleted:n}}=this.#s;return{text:t,richText:e,date:s,deleted:n,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){this.#s||=new Js(this),typeof e=="object"&&e!==null?this.#s.restoreData(e):this.#s.data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:t,richText:s}){if(!t||(this.#s||=new Js(this),this.#s.setInitialText(e,s),!this.annotationElementId))return;const n=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);n&&this.updateFromAnnotationLayer(n)}get hasEditedComment(){return this.#s?.hasBeenEdited()}get hasDeletedComment(){return this.#s?.isDeleted()}get hasComment(){return!!this.#s&&!this.#s.isEmpty()&&!this.#s.isDeleted()}async editComment(e){this.#s||=new Js(this),this.#s.edit(e)}toggleComment(e,t=void 0){this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){this.#s.setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const[,,,n]=e.rect,[i]=this.pageDimensions,[r]=this.pageTranslation,a=r+i+1,l=n-100,c=a+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[a,l,c,n]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:t}}){this.#s.data=t?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=this.#r?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),this.#z();const[t,s]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*s/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/s).toFixed(2)}%`);const[n,i]=this.getInitialTranslation();return this.translate(n,i),No(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#C||=new $s({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#W.bind(this),onPinching:this.#k.bind(this),onPinchEnd:this.#A.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),e}#W(){this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#n?.toggle(!1),this.parent.togglePointerEvents(!1)}#k(e,t,s){let i=.7*(s/t)+1-.7;if(i===1)return;const r=this.#N(this.rotation),a=(E,k)=>[r[0]*E+r[2]*k,r[1]*E+r[3]*k],[l,c]=this.parentDimensions,d=this.x,h=this.y,f=this.width,p=this.height,b=de.MIN_SIZE/l,m=de.MIN_SIZE/c;i=Math.max(Math.min(i,1/f,1/p),b/f,m/p);const y=de._round(f*i),g=de._round(p*i);if(y===f&&g===p)return;this.#d||=[d,h,f,p];const x=a(f/2,p/2),w=de._round(d+x[0]),v=de._round(h+x[1]),_=a(y/2,g/2);this.x=w-_[0],this.y=v-_[1],this.width=y,this.height=g,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#A(){this.#n?.toggle(!0),this.parent.togglePointerEvents(!0),this.#O()}pointerdown(e){const{isMac:t}=Oe.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(this.#m=!0,this._isDraggable){this.#B(e);return}this.#I(e)}#I(e){const{isMac:t}=Oe.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#B(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let s=!1;const n=new AbortController,i=this._uiManager.combinedSignal(n),r={capture:!0,passive:!1,signal:i},a=c=>{n.abort(),this.#i=null,this.#m=!1,this._uiManager.endDragSession()||this.#I(c),s&&this._onStopDragging()};t&&(this.#E=e.clientX,this.#S=e.clientY,this.#i=e.pointerId,this.#o=e.pointerType,window.addEventListener("pointermove",c=>{s||(s=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:d,clientY:h,pointerId:f}=c;if(f!==this.#i){De(c);return}const[p,b]=this.screenToPageTranslation(d-this.#E,h-this.#S);this.#E=d,this.#S=h,this._uiManager.dragSelectedEditors(p,b)},r),window.addEventListener("touchmove",De,r),window.addEventListener("pointerdown",c=>{c.pointerType===this.#o&&(this.#C||c.isPrimary)&&a(c),De(c)},r));const l=c=>{if(!this.#i||this.#i===c.pointerId){a(c);return}De(c)};window.addEventListener("pointerup",l,{signal:i}),window.addEventListener("blur",l,{signal:i})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#y&&clearTimeout(this.#y),this.#y=setTimeout(()=>{this.#y=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,t,s){e.changeParent(this),this.x=t,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,s=this.rotation){const n=this.parentScale,[i,r]=this.pageDimensions,[a,l]=this.pageTranslation,c=e/n,d=t/n,h=this.x*i,f=this.y*r,p=this.width*i,b=this.height*r;switch(s){case 0:return[h+c+a,r-f-d-b+l,h+c+p+a,r-f-d+l];case 90:return[h+d+a,r-f+c+l,h+d+b+a,r-f+c+p+l];case 180:return[h-c-p+a,r-f+d+l,h-c+a,r-f+d+b+l];case 270:return[h-d-b+a,r-f-c-p+l,h-d+a,r-f-c+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[s,n,i,r]=e,a=i-s,l=r-n;switch(this.rotation){case 0:return[s,t-r,a,l];case 90:return[s,t-n,l,a];case 180:return[i,t-n,a,l];case 270:return[i,t-r,l,a];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&de._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#s?.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:s,opacity:n,deleted:i,richText:r},uid:a,pageIndex:l,creationDate:c,modificationDate:d}=this;return{id:a,pageIndex:l,rect:this.getPDFRect(),richText:r,contentsObj:{str:e},creationDate:c,modificationDate:s||d,popupRef:!i,color:t,opacity:n}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#b=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#b=!1,!0):!1}isInEditMode(){return this.#b}shouldGetKeyboardEvents(){return this.#x}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:s,right:n}=this.getClientDimensions(),{innerHeight:i,innerWidth:r}=window;return t<r&&n>0&&e<i&&s>0}#z(){if(this.#f||!this.div)return;this.#f=new AbortController;const e=this._uiManager.combinedSignal(this.#f);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}rebuild(){this.#z()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,t=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(e,t,s){const n=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:s,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});n.rotation=e.rotation,n.#e=e.accessibilityData,n._isCopy=e.isCopy||!1;const[i,r]=n.pageDimensions,[a,l,c,d]=n.getRectInCurrentCoords(e.rect,r);return n.x=a/i,n.y=l/r,n.width=c/i,n.height=d/r,n}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#f?.abort(),this.#f=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),this.#y&&(clearTimeout(this.#y),this.#y=null),this.#M(),this.removeEditToolbar(),this.#v){for(const e of this.#v.values())clearTimeout(e);this.#v=null}this.parent=null,this.#C?.destroy(),this.#C=null,this.#h?.remove(),this.#h=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#F(),this.#c.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[s,n,i,r]=this.getPDFRect();return[de._round(s+(i-s)*e),de._round(n+(r-n)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#s.commentPopupPositionInLayer}set commentPopupPosition(e){this.#s.commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return this.#s.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#s.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){this.#s?.setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const t=this.#c.children;if(!this.#t){this.#t=Array.from(t);const r=this.#X.bind(this),a=this.#V.bind(this),l=this._uiManager._signal;for(const c of this.#t){const d=c.getAttribute("data-resizer-name");c.setAttribute("role","spinbutton"),c.addEventListener("keydown",r,{signal:l}),c.addEventListener("blur",a,{signal:l}),c.addEventListener("focus",this.#Y.bind(this,d),{signal:l}),c.setAttribute("data-l10n-id",de._l10nResizer[d])}}const s=this.#t[0];let n=0;for(const r of t){if(r===s)break;n++}const i=(360-this.rotation+this.parentRotation)%360/90*(this.#t.length/4);if(i!==n){if(i<n)for(let a=0;a<n-i;a++)this.#c.append(this.#c.firstElementChild);else if(i>n)for(let a=0;a<i-n;a++)this.#c.firstElementChild.before(this.#c.lastElementChild);let r=0;for(const a of t){const c=this.#t[r++].getAttribute("data-resizer-name");a.setAttribute("data-l10n-id",de._l10nResizer[c])}}this.#H(0),this.#x=!0,this.#c.firstElementChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#X(e){de._resizerKeyboardManager.exec(this,e)}#V(e){this.#x&&e.relatedTarget?.parentNode!==this.#c&&this.#M()}#Y(e){this.#g=this.#x?e:""}#H(e){if(this.#t)for(const t of this.#t)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#x&&this.#L(this.#g,{deltaX:e,deltaY:t,fromKeyboard:!0})}#M(){this.#x=!1,this.#H(-1),this.#O()}_stopResizingWithKeyboard(){this.#M(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#n?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#c?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#n?.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){e.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#p}set isEditing(e){this.#p=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){this.#v||=new Map;const{action:s}=e;let n=this.#v.get(s);n&&clearTimeout(n),n=setTimeout(()=>{this._reportTelemetry(e),this.#v.delete(s),this.#v.size===0&&(this.#v=null)},de._telemetryTimeout),this.#v.set(s,n);return}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#r=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#r=!0}updateFakeAnnotationElement(e){if(!this.#h&&!this.deleted){this.#h=e.addFakeAnnotation(this);return}if(this.deleted){this.#h.remove(),this.#h=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#h.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const s=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),s.before(t)}return t}resetAnnotationElement(e){const{firstElementChild:t}=e.container;t?.nodeName==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}}class wu extends de{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Hr=3285377520,dt=4294901760,bt=65535;class Po{constructor(e){this.h1=e?e&4294967295:Hr,this.h2=e?e&4294967295:Hr}update(e){let t,s;if(typeof e=="string"){t=new Uint8Array(e.length*2),s=0;for(let m=0,y=e.length;m<y;m++){const g=e.charCodeAt(m);g<=255?t[s++]=g:(t[s++]=g>>>8,t[s++]=g&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),s=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const n=s>>2,i=s-n*4,r=new Uint32Array(t.buffer,0,n);let a=0,l=0,c=this.h1,d=this.h2;const h=3432918353,f=461845907,p=h&bt,b=f&bt;for(let m=0;m<n;m++)m&1?(a=r[m],a=a*h&dt|a*p&bt,a=a<<15|a>>>17,a=a*f&dt|a*b&bt,c^=a,c=c<<13|c>>>19,c=c*5+3864292196):(l=r[m],l=l*h&dt|l*p&bt,l=l<<15|l>>>17,l=l*f&dt|l*b&bt,d^=l,d=d<<13|d>>>19,d=d*5+3864292196);switch(a=0,i){case 3:a^=t[n*4+2]<<16;case 2:a^=t[n*4+1]<<8;case 1:a^=t[n*4],a=a*h&dt|a*p&bt,a=a<<15|a>>>17,a=a*f&dt|a*b&bt,n&1?c^=a:d^=a}this.h1=c,this.h2=d}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&dt|e*36045&bt,t=t*4283543511&dt|((t<<16|e>>>16)*2950163797&dt)>>>16,e^=t>>>1,e=e*444984403&dt|e*60499&bt,t=t*3301882366&dt|((t<<16|e>>>16)*3120437893&dt)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const ki=Object.freeze({map:null,hash:"",transfer:void 0});class sr{#e=!1;#t=null;#n=null;#s=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const s=this.#s.get(e);return s===void 0?t:Object.assign(t,s)}getRawValue(e){return this.#s.get(e)}remove(e){const t=this.#s.get(e);if(t!==void 0&&(t instanceof de&&this.#n.delete(t.annotationElementId),this.#s.delete(e),this.#s.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const s of this.#s.values())if(s instanceof de)return;this.onAnnotationEditor(null)}}setValue(e,t){const s=this.#s.get(e);let n=!1;if(s!==void 0)for(const[i,r]of Object.entries(t))s[i]!==r&&(n=!0,s[i]=r);else n=!0,this.#s.set(e,t);n&&this.#a(),t instanceof de&&((this.#n||=new Map).set(t.annotationElementId,t),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type))}has(e){return this.#s.has(e)}get size(){return this.#s.size}#a(){this.#e||(this.#e=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#e&&(this.#e=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new Ro(this)}get serializable(){if(this.#s.size===0)return ki;const e=new Map,t=new Po,s=[],n=Object.create(null);let i=!1;for(const[r,a]of this.#s){const l=a instanceof de?a.serialize(!1,n):a;a.page&&(a.pageIndex=a.page._pageIndex,delete a.page),l&&(e.set(r,l),t.update(`${r}:${JSON.stringify(l)}`),i||=!!l.bitmap)}if(i)for(const r of e.values())r.bitmap&&s.push(r.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:s}:ki}get editorStats(){let e=null;const t=new Map;let s=0,n=0;for(const i of this.#s.values()){if(!(i instanceof de)){i.popup&&(i.popup.deleted?n+=1:s+=1);continue}i.isCommentDeleted?n+=1:i.hasEditedComment&&(s+=1);const r=i.telemetryFinalData;if(!r)continue;const{type:a}=r;t.has(a)||t.set(a,Object.getPrototypeOf(i).constructor),e||=Object.create(null);const l=e[a]||=new Map;for(const[c,d]of Object.entries(r)){if(c==="type")continue;let h=l.get(c);h||(h=new Map,l.set(c,h));const f=h.get(d)??0;h.set(d,f+1)}}if((n>0||s>0)&&(e||=Object.create(null),e.comments={deleted:n,edited:s}),!e)return null;for(const[i,r]of t)e[i]=r.computeTelemetryFinalData(e[i]);return e}resetModifiedIds(){this.#t=null}updateEditor(e,t){const s=this.#n?.get(e);return s?(s.updateFromAnnotationLayer(t),!0):!1}getEditor(e){return this.#n?.get(e)||null}get modifiedIds(){if(this.#t)return this.#t;const e=[];if(this.#n)for(const t of this.#n.values())t.serialize()&&e.push(t.annotationElementId);return this.#t={ids:new Set(e),hash:e.join(",")}}[Symbol.iterator](){return this.#s.entries()}}class Ro extends sr{#e;constructor(e){super();const{map:t,hash:s,transfer:n}=e.serializable,i=structuredClone(t,n?{transfer:n}:null);this.#e={map:i,hash:s,transfer:n}}get print(){Se("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}get modifiedIds(){return ue(this,"modifiedIds",{ids:new Set,hash:""})}}class vu{#e=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#e.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:s}){if(!(!e||this.#e.has(e.loadedName))){if(Ae(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:n,src:i,style:r}=e,a=new FontFace(n,i,r);this.addNativeFontFace(a);try{await a.load(),this.#e.add(n),s?.(e)}catch{fe(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(a)}return}Se("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const s=e.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(n){throw fe(`Failed to load font '${s.family}': '${n}'.`),e.disableFontFace=!0,n}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const n=this._queueLoadingCallback(s);this._prepareFontLoadEvent(e,n)})}}get isFontLoadingAPISupported(){const e=!!this._document?.fonts;return ue(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return ue(this,"isSyncFontLoadingSupported",Ke||Oe.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(Ae(!n.done,"completeRequest() cannot be called twice."),n.done=!0;s.length>0&&s[0].done;){const i=s.shift();setTimeout(i.callback,0)}}const{loadingRequests:s}=this,n={done:!1,complete:t,callback:e};return s.push(n),n}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return ue(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function s(v,_){return v.charCodeAt(_)<<24|v.charCodeAt(_+1)<<16|v.charCodeAt(_+2)<<8|v.charCodeAt(_+3)&255}function n(v,_,E,k){const D=v.substring(0,_),N=v.substring(_+E);return D+k+N}let i,r;const a=this._document.createElement("canvas");a.width=1,a.height=1;const l=a.getContext("2d");let c=0;function d(v,_){if(++c>30){fe("Load test font never loaded."),_();return}if(l.font="30px "+v,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){_();return}setTimeout(d.bind(null,v,_))}const h=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=n(f,976,h.length,h);const b=16,m=1482184792;let y=s(f,b);for(i=0,r=h.length-3;i<r;i+=4)y=y-m+s(h,i)|0;i<h.length&&(y=y-m+s(h+"XXX",i)|0),f=n(f,b,4,lu(y));const g=`url(data:font/opentype;base64,${btoa(f)});`,x=`@font-face {font-family:"${h}";src:${g}}`;this.insertRule(x);const w=this._document.createElement("div");w.style.visibility="hidden",w.style.width=w.style.height="10px",w.style.position="absolute",w.style.top=w.style.left="0px";for(const v of[e.loadedName,h]){const _=this._document.createElement("span");_.textContent="Hi",_.style.fontFamily=v,w.append(_)}this._document.body.append(w),d(h,()=>{w.remove(),t.complete()})}}class Au{#e;constructor(e,t=null,s,n){this.compiledGlyphs=Object.create(null),this.#e=e,this._inspectFont=t,s&&Object.assign(this,s),n&&(this.charProcOperatorList=n)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${this.data.toBase64()});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${e}}`}return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const s=this.loadedName+"_path_"+t;let n;try{n=e.get(s)}catch(r){fe(`getPathGenerator - ignoring character: "${r}".`)}const i=To(n?.path);return this.fontExtraProperties||e.delete(s),this.compiledGlyphs[t]=i}get black(){return this.#e.black}get bold(){return this.#e.bold}get disableFontFace(){return this.#e.disableFontFace??!1}set disableFontFace(e){ue(this,"disableFontFace",!!e)}get fontExtraProperties(){return this.#e.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#e.isInvalidPDFjsFont}get isType3Font(){return this.#e.isType3Font}get italic(){return this.#e.italic}get missingFile(){return this.#e.missingFile}get remeasure(){return this.#e.remeasure}get vertical(){return this.#e.vertical}get ascent(){return this.#e.ascent}get defaultWidth(){return this.#e.defaultWidth}get descent(){return this.#e.descent}get bbox(){return this.#e.bbox}set bbox(e){ue(this,"bbox",e)}get fontMatrix(){return this.#e.fontMatrix}get fallbackName(){return this.#e.fallbackName}get loadedName(){return this.#e.loadedName}get mimetype(){return this.#e.mimetype}get name(){return this.#e.name}get data(){return this.#e.data}clearData(){this.#e.clearData()}get cssFontInfo(){return this.#e.cssFontInfo}get systemFontInfo(){return this.#e.systemFontInfo}get defaultVMetrics(){return this.#e.defaultVMetrics}}class ns{#e;#t;#n;static strings=["fontFamily","fontWeight","italicAngle"];static write(e){const t=new TextEncoder,s={};let n=0;for(const c of ns.strings){const d=t.encode(e[c]);s[c]=d,n+=4+d.length}const i=new ArrayBuffer(n),r=new Uint8Array(i),a=new DataView(i);let l=0;for(const c of ns.strings){const d=s[c],h=d.length;a.setUint32(l,h),r.set(d,l+4),l+=4+h}return Ae(l===i.byteLength,"CssFontInfo.write: Buffer overflow"),i}constructor(e){this.#e=e,this.#t=new DataView(this.#e),this.#n=new TextDecoder}#s(e){Ae(e<ns.strings.length,"Invalid string index");let t=0;for(let n=0;n<e;n++)t+=this.#t.getUint32(t)+4;const s=this.#t.getUint32(t);return this.#n.decode(new Uint8Array(this.#e,t+4,s))}get fontFamily(){return this.#s(0)}get fontWeight(){return this.#s(1)}get italicAngle(){return this.#s(2)}}class is{#e;#t;#n;static strings=["css","loadedName","baseFontName","src"];static write(e){const t=new TextEncoder,s={};let n=0;for(const f of is.strings){const p=t.encode(e[f]);s[f]=p,n+=4+p.length}n+=4;let i,r,a=1+n;e.style&&(i=t.encode(e.style.style),r=t.encode(e.style.weight),a+=4+i.length+4+r.length);const l=new ArrayBuffer(a),c=new Uint8Array(l),d=new DataView(l);let h=0;d.setUint8(h++,e.guessFallback?1:0),d.setUint32(h,0),h+=4,n=0;for(const f of is.strings){const p=s[f],b=p.length;n+=4+b,d.setUint32(h,b),c.set(p,h+4),h+=4+b}return d.setUint32(h-n-4,n),e.style&&(d.setUint32(h,i.length),c.set(i,h+4),h+=4+i.length,d.setUint32(h,r.length),c.set(r,h+4),h+=4+r.length),Ae(h<=l.byteLength,"SubstitionInfo.write: Buffer overflow"),l.transferToFixedLength(h)}constructor(e){this.#e=e,this.#t=new DataView(this.#e),this.#n=new TextDecoder}get guessFallback(){return this.#t.getUint8(0)!==0}#s(e){Ae(e<is.strings.length,"Invalid string index");let t=5;for(let n=0;n<e;n++)t+=this.#t.getUint32(t)+4;const s=this.#t.getUint32(t);return this.#n.decode(new Uint8Array(this.#e,t+4,s))}get css(){return this.#s(0)}get loadedName(){return this.#s(1)}get baseFontName(){return this.#s(2)}get src(){return this.#s(3)}get style(){let e=1;e+=4+this.#t.getUint32(e);const t=this.#t.getUint32(e),s=this.#n.decode(new Uint8Array(this.#e,e+4,t));e+=4+t;const n=this.#t.getUint32(e),i=this.#n.decode(new Uint8Array(this.#e,e+4,n));return{style:s,weight:i}}}class ke{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#e=Math.ceil(this.bools.length*2/8);static#t=this.#e+this.numbers.length*8;static#n=this.#t+1+8;static#s=this.#n+1+48;static#a=this.#s+1+6;#r;#i;#o;constructor({data:e,extra:t}){this.#r=e,this.#i=new TextDecoder,this.#o=new DataView(this.#r),t&&Object.assign(this,t)}#c(e){Ae(e<ke.bools.length,"Invalid boolean index");const t=Math.floor(e/4),s=e*2%8,n=this.#o.getUint8(t)>>s&3;return n===0?void 0:n===2}get black(){return this.#c(0)}get bold(){return this.#c(1)}get disableFontFace(){return this.#c(2)}get fontExtraProperties(){return this.#c(3)}get isInvalidPDFjsFont(){return this.#c(4)}get isType3Font(){return this.#c(5)}get italic(){return this.#c(6)}get missingFile(){return this.#c(7)}get remeasure(){return this.#c(8)}get vertical(){return this.#c(9)}#l(e){return Ae(e<ke.numbers.length,"Invalid number index"),this.#o.getFloat64(ke.#e+e*8)}get ascent(){return this.#l(0)}get defaultWidth(){return this.#l(1)}get descent(){return this.#l(2)}get bbox(){let e=ke.#t;if(this.#o.getUint8(e)===0)return;e+=1;const s=[];for(let n=0;n<4;n++)s.push(this.#o.getInt16(e,!0)),e+=2;return s}get fontMatrix(){let e=ke.#n;if(this.#o.getUint8(e)===0)return;e+=1;const s=[];for(let n=0;n<6;n++)s.push(this.#o.getFloat64(e,!0)),e+=8;return s}get defaultVMetrics(){let e=ke.#s;if(this.#o.getUint8(e)===0)return;e+=1;const s=[];for(let n=0;n<3;n++)s.push(this.#o.getInt16(e,!0)),e+=2;return s}#u(e){Ae(e<ke.strings.length,"Invalid string index");let t=ke.#a+4;for(let i=0;i<e;i++)t+=this.#o.getUint32(t)+4;const s=this.#o.getUint32(t),n=new Uint8Array(s);return n.set(new Uint8Array(this.#r,t+4,s)),this.#i.decode(n)}get fallbackName(){return this.#u(0)}get loadedName(){return this.#u(1)}get mimetype(){return this.#u(2)}get name(){return this.#u(3)}get data(){let e=ke.#a;const t=this.#o.getUint32(e);e+=4+t;const s=this.#o.getUint32(e);e+=4+s;const n=this.#o.getUint32(e);e+=4+n;const i=this.#o.getUint32(e);if(i!==0)return new Uint8Array(this.#r,e+4,i)}clearData(){let e=ke.#a;const t=this.#o.getUint32(e);e+=4+t;const s=this.#o.getUint32(e);e+=4+s;const n=this.#o.getUint32(e);e+=4+n;const i=this.#o.getUint32(e);new Uint8Array(this.#r,e+4,i).fill(0),this.#o.setUint32(e,0)}get cssFontInfo(){let e=ke.#a;const t=this.#o.getUint32(e);e+=4+t;const s=this.#o.getUint32(e);e+=4+s;const n=this.#o.getUint32(e);if(n===0)return null;const i=new Uint8Array(n);return i.set(new Uint8Array(this.#r,e+4,n)),new ns(i.buffer)}get systemFontInfo(){let e=ke.#a;const t=this.#o.getUint32(e);e+=4+t;const s=this.#o.getUint32(e);if(s===0)return null;const n=new Uint8Array(s);return n.set(new Uint8Array(this.#r,e+4,s)),new is(n.buffer)}static write(e){const t=e.systemFontInfo?is.write(e.systemFontInfo):null,s=e.cssFontInfo?ns.write(e.cssFontInfo):null,n=new TextEncoder,i={};let r=0;for(const m of ke.strings)i[m]=n.encode(e[m]),r+=4+i[m].length;const a=ke.#a+4+r+4+(t?t.byteLength:0)+4+(s?s.byteLength:0)+4+(e.data?e.data.length:0),l=new ArrayBuffer(a),c=new Uint8Array(l),d=new DataView(l);let h=0;const f=ke.bools.length;let p=0,b=0;for(let m=0;m<f;m++){const y=e[ke.bools[m]];p|=(y===void 0?0:y?2:1)<<b,b+=2,(b===8||m===f-1)&&(d.setUint8(h++,p),p=0,b=0)}Ae(h===ke.#e,"FontInfo.write: Boolean properties offset mismatch");for(const m of ke.numbers)d.setFloat64(h,e[m]),h+=8;if(Ae(h===ke.#t,"FontInfo.write: Number properties offset mismatch"),e.bbox){d.setUint8(h++,4);for(const m of e.bbox)d.setInt16(h,m,!0),h+=2}else d.setUint8(h++,0),h+=8;if(Ae(h===ke.#n,"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){d.setUint8(h++,6);for(const m of e.fontMatrix)d.setFloat64(h,m,!0),h+=8}else d.setUint8(h++,0),h+=48;if(Ae(h===ke.#s,"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){d.setUint8(h++,1);for(const m of e.defaultVMetrics)d.setInt16(h,m,!0),h+=2}else d.setUint8(h++,0),h+=6;Ae(h===ke.#a,"FontInfo.write: DefaultVMetrics properties offset mismatch"),d.setUint32(ke.#a,0),h+=4;for(const m of ke.strings){const y=i[m],g=y.length;d.setUint32(h,g),c.set(y,h+4),h+=4+g}if(d.setUint32(ke.#a,h-ke.#a-4),!t)d.setUint32(h,0),h+=4;else{const m=t.byteLength;d.setUint32(h,m),Ae(h+4+m<=l.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),c.set(new Uint8Array(t),h+4),h+=4+m}if(!s)d.setUint32(h,0),h+=4;else{const m=s.byteLength;d.setUint32(h,m),Ae(h+4+m<=l.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),c.set(new Uint8Array(s),h+4),h+=4+m}return e.data===void 0?(d.setUint32(h,0),h+=4):(d.setUint32(h,e.data.length),c.set(e.data,h+4),h+=4+e.data.length),Ae(h<=l.byteLength,"FontInfo.write: Buffer overflow"),l.transferToFixedLength(h)}}class Ue{static#e=0;static#t=1;static#n=2;static#s=3;static#a=4;static#r=8;static#i=12;static#o=16;constructor(e){this.buffer=e,this.view=new DataView(e),this.data=new Uint8Array(e)}static write(e){let t,s=null,n=[],i=[],r=[],a=[],l=null,c=null;switch(e[0]){case"RadialAxial":t=e[1]==="axial"?1:2,s=e[2],r=e[3],t===1?n.push(...e[4],...e[5]):n.push(e[4][0],e[4][1],e[6],e[5][0],e[5][1],e[7]);break;case"Mesh":t=3,l=e[1],n=e[2],i=e[3],a=e[4]||[],s=e[6],c=e[7];break;default:throw new Error(`Unsupported pattern type: ${e[0]}`)}const d=Math.floor(n.length/2),h=Math.floor(i.length/3),f=r.length,p=a.length;let b=0;for(const _ of a)b+=1,b=Math.ceil(b/4)*4,b+=4+_.coords.length*4,b+=4+_.colors.length*4,_.verticesPerRow!==void 0&&(b+=4);const m=20+d*8+h*3+f*8+(s?16:0)+(c?3:0)+b,y=new ArrayBuffer(m),g=new DataView(y),x=new Uint8Array(y);g.setUint8(Ue.#e,t),g.setUint8(Ue.#t,s?1:0),g.setUint8(Ue.#n,c?1:0),g.setUint8(Ue.#s,l),g.setUint32(Ue.#a,d,!0),g.setUint32(Ue.#r,h,!0),g.setUint32(Ue.#i,f,!0),g.setUint32(Ue.#o,p,!0);let w=20;new Float32Array(y,w,d*2).set(n),w+=d*8,x.set(i,w),w+=h*3;for(const[_,E]of r)g.setFloat32(w,_,!0),w+=4,g.setUint32(w,parseInt(E.slice(1),16),!0),w+=4;if(s)for(const _ of s)g.setFloat32(w,_,!0),w+=4;c&&(x.set(c,w),w+=3);for(let _=0;_<a.length;_++){const E=a[_];g.setUint8(w,E.type),w+=1,w=Math.ceil(w/4)*4,g.setUint32(w,E.coords.length,!0),w+=4,new Int32Array(y,w,E.coords.length).set(E.coords),w+=E.coords.length*4,g.setUint32(w,E.colors.length,!0),w+=4,new Int32Array(y,w,E.colors.length).set(E.colors),w+=E.colors.length*4,E.verticesPerRow!==void 0&&(g.setUint32(w,E.verticesPerRow,!0),w+=4)}return y}getIR(){const e=this.view,t=this.data[Ue.#e],s=!!this.data[Ue.#t],n=!!this.data[Ue.#n],i=e.getUint32(Ue.#a,!0),r=e.getUint32(Ue.#r,!0),a=e.getUint32(Ue.#i,!0),l=e.getUint32(Ue.#o,!0);let c=20;const d=new Float32Array(this.buffer,c,i*2);c+=i*8;const h=new Uint8Array(this.buffer,c,r*3);c+=r*3;const f=[];for(let y=0;y<a;++y){const g=e.getFloat32(c,!0);c+=4;const x=e.getUint32(c,!0);c+=4,f.push([g,`#${x.toString(16).padStart(6,"0")}`])}let p=null;if(s){p=[];for(let y=0;y<4;++y)p.push(e.getFloat32(c,!0)),c+=4}let b=null;n&&(b=new Uint8Array(this.buffer,c,3),c+=3);const m=[];for(let y=0;y<l;++y){const g=e.getUint8(c);c+=1,c=Math.ceil(c/4)*4;const x=e.getUint32(c,!0);c+=4;const w=new Int32Array(this.buffer,c,x);c+=x*4;const v=e.getUint32(c,!0);c+=4;const _=new Int32Array(this.buffer,c,v);c+=v*4;const E={type:g,coords:w,colors:_};g===_i.LATTICE&&(E.verticesPerRow=e.getUint32(c,!0),c+=4),m.push(E)}if(t===1)return["RadialAxial","axial",p,f,Array.from(d.slice(0,2)),Array.from(d.slice(2,4)),null,null];if(t===2)return["RadialAxial","radial",p,f,[d[0],d[1]],[d[3],d[4]],d[2],d[5]];if(t===3){const y=this.data[Ue.#s];let g=null;if(d.length>0){let x=d[0],w=d[0],v=d[1],_=d[1];for(let E=0;E<d.length;E+=2){const k=d[E],D=d[E+1];x=x>k?k:x,v=v>D?D:v,w=w<k?k:w,_=_<D?D:_}g=[x,v,w,_]}return["Mesh",y,d,h,m,g,p,b]}throw new Error(`Unsupported pattern kind: ${t}`)}}class Su{static write(e){let t,s;return Oe.isFloat16ArraySupported?(s=new ArrayBuffer(e.length*2),t=new Float16Array(s)):(s=new ArrayBuffer(e.length*4),t=new Float32Array(s)),t.set(e),s}#e;constructor(e){this.#e=e}get path(){return Oe.isFloat16ArraySupported?new Float16Array(this.#e):new Float32Array(this.#e)}}function _u(o){if(o instanceof URL)return o.href;if(typeof o=="string"){if(Ke)return o;const e=URL.parse(o,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Eu(o){if(Ke&&typeof Buffer<"u"&&o instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength)return o;if(typeof o=="string")return Ln(o);if(o instanceof ArrayBuffer||ArrayBuffer.isView(o)||typeof o=="object"&&!isNaN(o?.length))return new Uint8Array(o);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Qs(o){if(typeof o!="string")return null;if(o.endsWith("/"))return o;throw new Error(`Invalid factory url: "${o}" must include trailing slash.`)}const Ci=o=>typeof o=="object"&&Number.isInteger(o?.num)&&o.num>=0&&Number.isInteger(o?.gen)&&o.gen>=0,ku=o=>typeof o=="object"&&typeof o?.name=="string",Do=uu.bind(null,Ci,ku);class Cu{#e=new Map;#t=Promise.resolve();postMessage(e,t){const s={data:structuredClone(e,t?{transfer:t}:null)};this.#t.then(()=>{for(const[n]of this.#e)n.call(this,s)})}addEventListener(e,t,s=null){let n=null;if(s?.signal instanceof AbortSignal){const{signal:i}=s;if(i.aborted){fe("LoopbackPort - cannot use an `aborted` signal.");return}const r=()=>this.removeEventListener(e,t);n=()=>i.removeEventListener("abort",r),i.addEventListener("abort",r)}this.#e.set(t,n)}removeEventListener(e,t){this.#e.get(t)?.(),this.#e.delete(t)}terminate(){for(const[,e]of this.#e)e?.();this.#e.clear()}}const en={DATA:1,ERROR:2},Me={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function $r(){}function Qe(o){if(o instanceof Ct||o instanceof xn||o instanceof Lr||o instanceof Ps||o instanceof si)return o;switch(o instanceof Error||typeof o=="object"&&o!==null||Se('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),o.name){case"AbortException":return new Ct(o.message);case"InvalidPDFException":return new xn(o.message);case"PasswordException":return new Lr(o.message,o.code);case"ResponseException":return new Ps(o.message,o.status,o.missing);case"UnknownErrorException":return new si(o.message,o.details)}return new si(o.message,o.toString())}class Es{#e=new AbortController;constructor(e,t,s){this.sourceName=e,this.targetName=t,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",this.#t.bind(this),{signal:this.#e.signal})}#t({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){this.#s(e);return}if(e.callback){const s=e.callbackId,n=this.callbackCapabilities[s];if(!n)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],e.callback===en.DATA)n.resolve(e.data);else if(e.callback===en.ERROR)n.reject(Qe(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const s=this.sourceName,n=e.sourceName,i=this.comObj;Promise.try(t,e.data).then(function(r){i.postMessage({sourceName:s,targetName:n,callback:en.DATA,callbackId:e.callbackId,data:r})},function(r){i.postMessage({sourceName:s,targetName:n,callback:en.ERROR,callbackId:e.callbackId,reason:Qe(r)})});return}if(e.streamId){this.#n(e);return}t(e.data)}on(e,t){const s=this.actionHandler;if(s[e])throw new Error(`There is already an actionName called "${e}"`);s[e]=t}send(e,t,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},s)}sendWithPromise(e,t,s){const n=this.callbackId++,i=Promise.withResolvers();this.callbackCapabilities[n]=i;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:n,data:t},s)}catch(r){i.reject(r)}return i.promise}sendWithStream(e,t,s,n){const i=this.streamId++,r=this.sourceName,a=this.targetName,l=this.comObj;return new ReadableStream({start:c=>{const d=Promise.withResolvers();return this.streamControllers[i]={controller:c,startCall:d,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:r,targetName:a,action:e,streamId:i,data:t,desiredSize:c.desiredSize},n),d.promise},pull:c=>{const d=Promise.withResolvers();return this.streamControllers[i].pullCall=d,l.postMessage({sourceName:r,targetName:a,stream:Me.PULL,streamId:i,desiredSize:c.desiredSize}),d.promise},cancel:c=>{Ae(c instanceof Error,"cancel must have a valid reason");const d=Promise.withResolvers();return this.streamControllers[i].cancelCall=d,this.streamControllers[i].isClosed=!0,l.postMessage({sourceName:r,targetName:a,stream:Me.CANCEL,streamId:i,reason:Qe(c)}),d.promise}},s)}#n(e){const t=e.streamId,s=this.sourceName,n=e.sourceName,i=this.comObj,r=this,a=this.actionHandler[e.action],l={enqueue(c,d=1,h){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=d,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),i.postMessage({sourceName:s,targetName:n,stream:Me.ENQUEUE,streamId:t,chunk:c},h)},close(){this.isCancelled||(this.isCancelled=!0,i.postMessage({sourceName:s,targetName:n,stream:Me.CLOSE,streamId:t}),delete r.streamSinks[t])},error(c){Ae(c instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,i.postMessage({sourceName:s,targetName:n,stream:Me.ERROR,streamId:t,reason:Qe(c)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[t]=l,Promise.try(a,e.data,l).then(function(){i.postMessage({sourceName:s,targetName:n,stream:Me.START_COMPLETE,streamId:t,success:!0})},function(c){i.postMessage({sourceName:s,targetName:n,stream:Me.START_COMPLETE,streamId:t,reason:Qe(c)})})}#s(e){const t=e.streamId,s=this.sourceName,n=e.sourceName,i=this.comObj,r=this.streamControllers[t],a=this.streamSinks[t];switch(e.stream){case Me.START_COMPLETE:e.success?r.startCall.resolve():r.startCall.reject(Qe(e.reason));break;case Me.PULL_COMPLETE:e.success?r.pullCall.resolve():r.pullCall.reject(Qe(e.reason));break;case Me.PULL:if(!a){i.postMessage({sourceName:s,targetName:n,stream:Me.PULL_COMPLETE,streamId:t,success:!0});break}a.desiredSize<=0&&e.desiredSize>0&&a.sinkCapability.resolve(),a.desiredSize=e.desiredSize,Promise.try(a.onPull||$r).then(function(){i.postMessage({sourceName:s,targetName:n,stream:Me.PULL_COMPLETE,streamId:t,success:!0})},function(c){i.postMessage({sourceName:s,targetName:n,stream:Me.PULL_COMPLETE,streamId:t,reason:Qe(c)})});break;case Me.ENQUEUE:if(Ae(r,"enqueue should have stream controller"),r.isClosed)break;r.controller.enqueue(e.chunk);break;case Me.CLOSE:if(Ae(r,"close should have stream controller"),r.isClosed)break;r.isClosed=!0,r.controller.close(),this.#a(r,t);break;case Me.ERROR:Ae(r,"error should have stream controller"),r.controller.error(Qe(e.reason)),this.#a(r,t);break;case Me.CANCEL_COMPLETE:e.success?r.cancelCall.resolve():r.cancelCall.reject(Qe(e.reason)),this.#a(r,t);break;case Me.CANCEL:if(!a)break;const l=Qe(e.reason);Promise.try(a.onCancel||$r,l).then(function(){i.postMessage({sourceName:s,targetName:n,stream:Me.CANCEL_COMPLETE,streamId:t,success:!0})},function(c){i.postMessage({sourceName:s,targetName:n,stream:Me.CANCEL_COMPLETE,streamId:t,reason:Qe(c)})}),a.sinkCapability.reject(l),a.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#a(e,t){await Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.#e?.abort(),this.#e=null}}class Io{#e=!1;constructor({enableHWA:e=!1}){this.#e=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(e,t);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!this.#e})}}reset(e,t,s){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||s<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=s}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Se("Abstract method `_createCanvas` called.")}}class Tu extends Io{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const s=this._document.createElement("canvas");return s.width=e,s.height=t,s}}class jo{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){Se("Abstract method `_fetch` called.")}}class Wr extends jo{async _fetch(e){const t=await fs(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):Ln(t)}}class Lo{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,s,n,i){return"none"}destroy(e=!1){}}class Nu extends Lo{#e;#t;#n;#s;#a;#r;#i=0;constructor({docId:e,ownerDocument:t=globalThis.document}){super(),this.#s=e,this.#a=t}get#o(){return this.#t||=new Map}get#c(){return this.#r||=new Map}get#l(){if(!this.#n){const e=this.#a.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;const s=this.#a.createElementNS(At,"svg");s.setAttribute("width",0),s.setAttribute("height",0),this.#n=this.#a.createElementNS(At,"defs"),e.append(s),s.append(this.#n),this.#a.body.append(e)}return this.#n}#u(e){if(e.length===1){const l=e[0],c=new Array(256);for(let h=0;h<256;h++)c[h]=l[h]/255;const d=c.join(",");return[d,d,d]}const[t,s,n]=e,i=new Array(256),r=new Array(256),a=new Array(256);for(let l=0;l<256;l++)i[l]=t[l]/255,r[l]=s[l]/255,a[l]=n[l]/255;return[i.join(","),r.join(","),a.join(",")]}#h(e){if(this.#e===void 0){this.#e="";const t=this.#a.URL;t!==this.#a.baseURI&&(zs(t)?fe('#createUrl: ignore "data:"-URL for performance reasons.'):this.#e=Ki(t,""))}return`url(${this.#e}#${e})`}addFilter(e){if(!e)return"none";let t=this.#o.get(e);if(t)return t;const[s,n,i]=this.#u(e),r=e.length===1?s:`${s}${n}${i}`;if(t=this.#o.get(r),t)return this.#o.set(e,t),t;const a=`g_${this.#s}_transfer_map_${this.#i++}`,l=this.#h(a);this.#o.set(e,l),this.#o.set(r,l);const c=this.#m(a);return this.#p(s,n,i,c),l}addHCMFilter(e,t){const s=`${e}-${t}`,n="base";let i=this.#c.get(n);if(i?.key===s||(i?(i.filter?.remove(),i.key=s,i.url="none",i.filter=null):(i={key:s,url:"none",filter:null},this.#c.set(n,i)),!e||!t))return i.url;const r=this.#x(e);e=se.makeHexColor(...r);const a=this.#x(t);if(t=se.makeHexColor(...a),this.#l.style.color="",e==="#000000"&&t==="#ffffff"||e===t)return i.url;const l=new Array(256);for(let p=0;p<=255;p++){const b=p/255;l[p]=b<=.03928?b/12.92:((b+.055)/1.055)**2.4}const c=l.join(","),d=`g_${this.#s}_hcm_filter`,h=i.filter=this.#m(d);this.#p(c,c,c,h),this.#g(h);const f=(p,b)=>{const m=r[p]/255,y=a[p]/255,g=new Array(b+1);for(let x=0;x<=b;x++)g[x]=m+x/b*(y-m);return g.join(",")};return this.#p(f(0,5),f(1,5),f(2,5),h),i.url=this.#h(d),i.url}addAlphaFilter(e){let t=this.#o.get(e);if(t)return t;const[s]=this.#u([e]),n=`alpha_${s}`;if(t=this.#o.get(n),t)return this.#o.set(e,t),t;const i=`g_${this.#s}_alpha_map_${this.#i++}`,r=this.#h(i);this.#o.set(e,r),this.#o.set(n,r);const a=this.#m(i);return this.#b(s,a),r}addLuminosityFilter(e){let t=this.#o.get(e||"luminosity");if(t)return t;let s,n;if(e?([s]=this.#u([e]),n=`luminosity_${s}`):n="luminosity",t=this.#o.get(n),t)return this.#o.set(e,t),t;const i=`g_${this.#s}_luminosity_map_${this.#i++}`,r=this.#h(i);this.#o.set(e,r),this.#o.set(n,r);const a=this.#m(i);return this.#f(a),e&&this.#b(s,a),r}addHighlightHCMFilter(e,t,s,n,i){const r=`${t}-${s}-${n}-${i}`;let a=this.#c.get(e);if(a?.key===r||(a?(a.filter?.remove(),a.key=r,a.url="none",a.filter=null):(a={key:r,url:"none",filter:null},this.#c.set(e,a)),!t||!s))return a.url;const[l,c]=[t,s].map(this.#x.bind(this));let d=Math.round(.2126*l[0]+.7152*l[1]+.0722*l[2]),h=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[f,p]=[n,i].map(this.#x.bind(this));h<d&&([d,h,f,p]=[h,d,p,f]),this.#l.style.color="";const b=(g,x,w)=>{const v=new Array(256),_=(h-d)/w,E=g/255,k=(x-g)/(255*w);let D=0;for(let N=0;N<=w;N++){const R=Math.round(d+N*_),j=E+N*k;for(let C=D;C<=R;C++)v[C]=j;D=R+1}for(let N=D;N<256;N++)v[N]=v[D-1];return v.join(",")},m=`g_${this.#s}_hcm_${e}_filter`,y=a.filter=this.#m(m);return this.#g(y),this.#p(b(f[0],p[0],5),b(f[1],p[1],5),b(f[2],p[2],5),y),a.url=this.#h(m),a.url}destroy(e=!1){e&&this.#r?.size||(this.#n?.parentNode.parentNode.remove(),this.#n=null,this.#t?.clear(),this.#t=null,this.#r?.clear(),this.#r=null,this.#i=0)}#f(e){const t=this.#a.createElementNS(At,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}#g(e){const t=this.#a.createElementNS(At,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#m(e){const t=this.#a.createElementNS(At,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#l.append(t),t}#d(e,t,s){const n=this.#a.createElementNS(At,t);n.setAttribute("type","discrete"),n.setAttribute("tableValues",s),e.append(n)}#p(e,t,s,n){const i=this.#a.createElementNS(At,"feComponentTransfer");n.append(i),this.#d(i,"feFuncR",e),this.#d(i,"feFuncG",t),this.#d(i,"feFuncB",s)}#b(e,t){const s=this.#a.createElementNS(At,"feComponentTransfer");t.append(s),this.#d(s,"feFuncA",e)}#x(e){return this.#l.style.color=e,ps(getComputedStyle(this.#l).getPropertyValue("color"))}}class Mo{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){Se("Abstract method `_fetch` called.")}}class Gr extends Mo{async _fetch(e){const t=await fs(e,"arraybuffer");return new Uint8Array(t)}}class Fo{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(s=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){Se("Abstract method `_fetch` called.")}}class Vr extends Fo{async _fetch(e){const t=await fs(e,"arraybuffer");return new Uint8Array(t)}}Ke&&fe("Please use the `legacy` build in Node.js environments.");async function nr(o){const t=await process.getBuiltinModule("fs").promises.readFile(o);return new Uint8Array(t)}class Pu extends Lo{}class Ru extends Io{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class Du extends jo{async _fetch(e){return nr(e)}}class Iu extends Mo{async _fetch(e){return nr(e)}}class ju extends Fo{async _fetch(e){return nr(e)}}const Xt="__forcedDependency",{floor:Xr,ceil:Yr}=Math;function tn(o,e,t,s,n,i){o[e*4+0]=Math.min(o[e*4+0],t),o[e*4+1]=Math.min(o[e*4+1],s),o[e*4+2]=Math.max(o[e*4+2],n),o[e*4+3]=Math.max(o[e*4+3],i)}const Ti=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class Lu{#e;#t;constructor(e,t){this.#e=e,this.#t=t}get length(){return this.#e.length}isEmpty(e){return this.#e[e]===Ti}minX(e){return this.#t[e*4+0]/256}minY(e){return this.#t[e*4+1]/256}maxX(e){return(this.#t[e*4+2]+1)/256}maxY(e){return(this.#t[e*4+3]+1)/256}}const sn=(o,e)=>{if(!o)return;let t=o.get(e);return t||(t={dependencies:new Set,isRenderingOperation:!1},o.set(e,t)),t};class Mu{#e={__proto__:null};#t={__proto__:null,transform:[],moveText:[],sameLineText:[],[Xt]:[]};#n=new Map;#s=[];#a=[];#r=[[1,0,0,1,0,0]];#i=[-1/0,-1/0,1/0,1/0];#o=new Float64Array([1/0,1/0,-1/0,-1/0]);#c=-1;#l=new Set;#u=new Map;#h=new Map;#f;#g;#m;#d;#p;constructor(e,t,s=!1){this.#f=e.width,this.#g=e.height,this.#b(t),s&&(this.#p=new Map)}growOperationsCount(e){e>=this.#d.length&&this.#b(e,this.#d)}#b(e,t){const s=new ArrayBuffer(e*4);this.#m=new Uint8ClampedArray(s),this.#d=new Uint32Array(s),t&&t.length>0?(this.#d.set(t),this.#d.fill(Ti,t.length)):this.#d.fill(Ti)}save(e){return this.#e={__proto__:this.#e},this.#t={__proto__:this.#t,transform:{__proto__:this.#t.transform},moveText:{__proto__:this.#t.moveText},sameLineText:{__proto__:this.#t.sameLineText},[Xt]:{__proto__:this.#t[Xt]}},this.#i={__proto__:this.#i},this.#s.push(e),this}restore(e){const t=Object.getPrototypeOf(this.#e);if(t===null)return this;this.#e=t,this.#t=Object.getPrototypeOf(this.#t),this.#i=Object.getPrototypeOf(this.#i);const s=this.#s.pop();return s!==void 0&&(sn(this.#p,e)?.dependencies.add(s),this.#d[e]=this.#d[s]),this}recordOpenMarker(e){return this.#s.push(e),this}getOpenMarker(){return this.#s.length===0?null:this.#s.at(-1)}recordCloseMarker(e){const t=this.#s.pop();return t!==void 0&&(sn(this.#p,e)?.dependencies.add(t),this.#d[e]=this.#d[t]),this}beginMarkedContent(e){return this.#a.push(e),this}endMarkedContent(e){const t=this.#a.pop();return t!==void 0&&(sn(this.#p,e)?.dependencies.add(t),this.#d[e]=this.#d[t]),this}pushBaseTransform(e){return this.#r.push(se.multiplyByDOMMatrix(this.#r.at(-1),e.getTransform())),this}popBaseTransform(){return this.#r.length>1&&this.#r.pop(),this}recordSimpleData(e,t){return this.#e[e]=t,this}recordIncrementalData(e,t){return this.#t[e].push(t),this}resetIncrementalData(e,t){return this.#t[e].length=0,this}recordNamedData(e,t){return this.#n.set(e,t),this}recordSimpleDataFromNamed(e,t,s){this.#e[e]=this.#n.get(t)??s}recordFutureForcedDependency(e,t){return this.recordIncrementalData(Xt,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in this.#e&&this.recordFutureForcedDependency(t,this.#e[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of this.#l)this.recordFutureForcedDependency(Xt,e);return this}resetBBox(e){return this.#c!==e&&(this.#c=e,this.#o[0]=1/0,this.#o[1]=1/0,this.#o[2]=-1/0,this.#o[3]=-1/0),this}recordClipBox(e,t,s,n,i,r){const a=se.multiplyByDOMMatrix(this.#r.at(-1),t.getTransform()),l=[1/0,1/0,-1/0,-1/0];se.axialAlignedBoundingBox([s,i,n,r],a,l);const c=se.intersect(this.#i,l);return c?(this.#i[0]=c[0],this.#i[1]=c[1],this.#i[2]=c[2],this.#i[3]=c[3]):(this.#i[0]=this.#i[1]=1/0,this.#i[2]=this.#i[3]=-1/0),this}recordBBox(e,t,s,n,i,r){const a=this.#i;if(a[0]===1/0)return this;const l=se.multiplyByDOMMatrix(this.#r.at(-1),t.getTransform());if(a[0]===-1/0)return se.axialAlignedBoundingBox([s,i,n,r],l,this.#o),this;const c=[1/0,1/0,-1/0,-1/0];return se.axialAlignedBoundingBox([s,i,n,r],l,c),this.#o[0]=Math.min(this.#o[0],Math.max(c[0],a[0])),this.#o[1]=Math.min(this.#o[1],Math.max(c[1],a[1])),this.#o[2]=Math.max(this.#o[2],Math.min(c[2],a[2])),this.#o[3]=Math.max(this.#o[3],Math.min(c[3],a[3])),this}recordCharacterBBox(e,t,s,n=1,i=0,r=0,a){const l=s.bbox;let c,d;if(l&&(c=l[2]!==l[0]&&l[3]!==l[1]&&this.#h.get(s),c!==!1&&(d=[0,0,0,0],se.axialAlignedBoundingBox(l,s.fontMatrix,d),(n!==1||i!==0||r!==0)&&se.scaleMinMax([n,0,0,-n,i,r],d),c)))return this.recordBBox(e,t,d[0],d[2],d[1],d[3]);if(!a)return this.recordFullPageBBox(e);const h=a();return l&&d&&c===void 0&&(c=d[0]<=i-h.actualBoundingBoxLeft&&d[2]>=i+h.actualBoundingBoxRight&&d[1]<=r-h.actualBoundingBoxAscent&&d[3]>=r+h.actualBoundingBoxDescent,this.#h.set(s,c),c)?this.recordBBox(e,t,d[0],d[2],d[1],d[3]):this.recordBBox(e,t,i-h.actualBoundingBoxLeft,i+h.actualBoundingBoxRight,r-h.actualBoundingBoxAscent,r+h.actualBoundingBoxDescent)}recordFullPageBBox(e){return this.#o[0]=Math.max(0,this.#i[0]),this.#o[1]=Math.max(0,this.#i[1]),this.#o[2]=Math.min(this.#f,this.#i[2]),this.#o[3]=Math.min(this.#g,this.#i[3]),this}getSimpleIndex(e){return this.#e[e]}recordDependencies(e,t){const s=this.#l,n=this.#e,i=this.#t;for(const r of t)r in this.#e?s.add(n[r]):r in i&&i[r].forEach(s.add,s);return this}recordNamedDependency(e,t){return this.#n.has(t)&&this.#l.add(this.#n.get(t)),this}recordOperation(e,t=!1){if(this.recordDependencies(e,[Xt]),this.#p){const s=sn(this.#p,e),{dependencies:n}=s;this.#l.forEach(n.add,n),this.#s.forEach(n.add,n),this.#a.forEach(n.add,n),n.delete(e),s.isRenderingOperation=!0}if(this.#c===e){const s=Xr(this.#o[0]*256/this.#f),n=Xr(this.#o[1]*256/this.#g),i=Yr(this.#o[2]*256/this.#f),r=Yr(this.#o[3]*256/this.#g);tn(this.#m,e,s,n,i,r);for(const a of this.#l)a!==e&&tn(this.#m,a,s,n,i,r);for(const a of this.#s)a!==e&&tn(this.#m,a,s,n,i,r);for(const a of this.#a)a!==e&&tn(this.#m,a,s,n,i,r);t||(this.#l.clear(),this.#c=-1)}return this}recordShowTextOperation(e,t=!1){const s=Array.from(this.#l);this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const n of s)this.recordIncrementalData("sameLineText",n);return this}bboxToClipBoxDropOperation(e,t=!1){return this.#c===e&&(this.#c=-1,this.#i[0]=Math.max(this.#i[0],this.#o[0]),this.#i[1]=Math.max(this.#i[1],this.#o[1]),this.#i[2]=Math.min(this.#i[2],this.#o[2]),this.#i[3]=Math.min(this.#i[3],this.#o[3]),t||this.#l.clear()),this}_takePendingDependencies(){const e=this.#l;return this.#l=new Set,e}_extractOperation(e){const t=this.#u.get(e);return this.#u.delete(e),t}_pushPendingDependencies(e){for(const t of e)this.#l.add(t)}take(){return this.#h.clear(),new Lu(this.#d,this.#m)}takeDebugMetadata(){return this.#p}}class An{#e;#t;#n;#s=0;#a=0;constructor(e,t,s){if(e instanceof An&&e.#n===!!s)return e;this.#e=e,this.#t=t,this.#n=!!s}growOperationsCount(){throw new Error("Unreachable")}save(e){return this.#a++,this.#e.save(this.#t),this}restore(e){return this.#a>0&&(this.#e.restore(this.#t),this.#a--),this}recordOpenMarker(e){return this.#s++,this}getOpenMarker(){return this.#s>0?this.#t:this.#e.getOpenMarker()}recordCloseMarker(e){return this.#s--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return this.#e.pushBaseTransform(e),this}popBaseTransform(){return this.#e.popBaseTransform(),this}recordSimpleData(e,t){return this.#e.recordSimpleData(e,this.#t),this}recordIncrementalData(e,t){return this.#e.recordIncrementalData(e,this.#t),this}resetIncrementalData(e,t){return this.#e.resetIncrementalData(e,this.#t),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,s){return this.#e.recordSimpleDataFromNamed(e,t,this.#t),this}recordFutureForcedDependency(e,t){return this.#e.recordFutureForcedDependency(e,this.#t),this}inheritSimpleDataAsFutureForcedDependencies(e){return this.#e.inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#e.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return this.#n||this.#e.resetBBox(this.#t),this}recordClipBox(e,t,s,n,i,r){return this.#n||this.#e.recordClipBox(this.#t,t,s,n,i,r),this}recordBBox(e,t,s,n,i,r){return this.#n||this.#e.recordBBox(this.#t,t,s,n,i,r),this}recordCharacterBBox(e,t,s,n,i,r,a){return this.#n||this.#e.recordCharacterBBox(this.#t,t,s,n,i,r,a),this}recordFullPageBBox(e){return this.#n||this.#e.recordFullPageBBox(this.#t),this}getSimpleIndex(e){return this.#e.getSimpleIndex(e)}recordDependencies(e,t){return this.#e.recordDependencies(this.#t,t),this}recordNamedDependency(e,t){return this.#e.recordNamedDependency(this.#t,t),this}recordOperation(e){return this.#e.recordOperation(this.#t,!0),this}recordShowTextOperation(e){return this.#e.recordShowTextOperation(this.#t,!0),this}bboxToClipBoxDropOperation(e){return this.#n||this.#e.bboxToClipBoxDropOperation(this.#t,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const ht={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},Xe={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Ni(o,e){if(!e)return;const t=e[2]-e[0],s=e[3]-e[1],n=new Path2D;n.rect(e[0],e[1],t,s),o.clip(n)}class ir{isModifyingCurrentTransform(){return!1}getPattern(){Se("Abstract method `getPattern` called.")}}class Fu extends ir{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}isOriginBased(){return this._p0[0]===0&&this._p0[1]===0&&(!this.isRadial()||this._p1[0]===0&&this._p1[1]===0)}isRadial(){return this._type==="radial"}_createGradient(e,t=null){let s,n=this._p0,i=this._p1;if(t&&(n=n.slice(),i=i.slice(),se.applyTransform(n,t),se.applyTransform(i,t)),this._type==="axial")s=e.createLinearGradient(n[0],n[1],i[0],i[1]);else if(this._type==="radial"){let r=this._r0,a=this._r1;if(t){const l=new Float32Array(2);se.singularValueDecompose2dScale(t,l),r*=l[0],a*=l[0]}s=e.createRadialGradient(n[0],n[1],r,i[0],i[1],a)}for(const r of this._colorStops)s.addColorStop(r[0],r[1]);return s}getPattern(e,t,s,n){let i;if(n===Xe.STROKE||n===Xe.FILL){if(this.isOriginBased()){let f=se.transform(s,t.baseTransform);this.matrix&&(f=se.transform(f,this.matrix));const p=.001,b=Math.hypot(f[0],f[1]),m=Math.hypot(f[2],f[3]),y=(f[0]*f[2]+f[1]*f[3])/(b*m);if(Math.abs(y)<p)if(this.isRadial()){if(Math.abs(b-m)<p)return this._createGradient(e,f)}else return this._createGradient(e,f)}const r=t.current.getClippedPathBoundingBox(n,Re(e))||[0,0,0,0],a=Math.ceil(r[2]-r[0])||1,l=Math.ceil(r[3]-r[1])||1,c=t.cachedCanvases.getCanvas("pattern",a,l),d=c.context;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.beginPath(),d.rect(0,0,d.canvas.width,d.canvas.height),d.translate(-r[0],-r[1]),s=se.transform(s,[1,0,0,1,r[0],r[1]]),d.transform(...t.baseTransform),this.matrix&&d.transform(...this.matrix),Ni(d,this._bbox),d.fillStyle=this._createGradient(d),d.fill(),i=e.createPattern(c.canvas,"no-repeat");const h=new DOMMatrix(s);i.setTransform(h)}else Ni(e,this._bbox),i=this._createGradient(e);return i}}function ri(o,e,t,s,n,i,r,a){const l=e.coords,c=e.colors,d=o.data,h=o.width*4;let f;l[t+1]>l[s+1]&&(f=t,t=s,s=f,f=i,i=r,r=f),l[s+1]>l[n+1]&&(f=s,s=n,n=f,f=r,r=a,a=f),l[t+1]>l[s+1]&&(f=t,t=s,s=f,f=i,i=r,r=f);const p=(l[t]+e.offsetX)*e.scaleX,b=(l[t+1]+e.offsetY)*e.scaleY,m=(l[s]+e.offsetX)*e.scaleX,y=(l[s+1]+e.offsetY)*e.scaleY,g=(l[n]+e.offsetX)*e.scaleX,x=(l[n+1]+e.offsetY)*e.scaleY;if(b>=x)return;const w=c[i],v=c[i+1],_=c[i+2],E=c[r],k=c[r+1],D=c[r+2],N=c[a],R=c[a+1],j=c[a+2],C=Math.round(b),B=Math.round(x);let S,O,U,M,G,z,$,L;for(let F=C;F<=B;F++){if(F<y){const ae=F<b?0:(b-F)/(b-y);S=p-(p-m)*ae,O=w-(w-E)*ae,U=v-(v-k)*ae,M=_-(_-D)*ae}else{let ae;F>x?ae=1:y===x?ae=0:ae=(y-F)/(y-x),S=m-(m-g)*ae,O=E-(E-N)*ae,U=k-(k-R)*ae,M=D-(D-j)*ae}let Y;F<b?Y=0:F>x?Y=1:Y=(b-F)/(b-x),G=p-(p-g)*Y,z=w-(w-N)*Y,$=v-(v-R)*Y,L=_-(_-j)*Y;const K=Math.round(Math.min(S,G)),X=Math.round(Math.max(S,G));let te=h*F+K*4;for(let ae=K;ae<=X;ae++)Y=(S-ae)/(S-G),Y<0?Y=0:Y>1&&(Y=1),d[te++]=O-(O-z)*Y|0,d[te++]=U-(U-$)*Y|0,d[te++]=M-(M-L)*Y|0,d[te++]=255}}function Ou(o,e,t){const s=e.coords,n=e.colors;let i,r;switch(e.type){case _i.LATTICE:const a=e.verticesPerRow,l=Math.floor(s.length/a)-1,c=a-1;for(i=0;i<l;i++){let d=i*a;for(let h=0;h<c;h++,d++)ri(o,t,s[d],s[d+1],s[d+a],n[d],n[d+1],n[d+a]),ri(o,t,s[d+a+1],s[d+1],s[d+a],n[d+a+1],n[d+1],n[d+a])}break;case _i.TRIANGLES:for(i=0,r=s.length;i<r;i+=3)ri(o,t,s[i],s[i+1],s[i+2],n[i],n[i+1],n[i+2]);break;default:throw new Error("illegal figure")}}class Bu extends ir{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,s){const a=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),c=Math.ceil(this._bounds[2])-a,d=Math.ceil(this._bounds[3])-l,h=Math.min(Math.ceil(Math.abs(c*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(d*e[1]*1.1)),3e3),p=c/h,b=d/f,m={coords:this._coords,colors:this._colors,offsetX:-a,offsetY:-l,scaleX:1/p,scaleY:1/b},y=h+4,g=f+4,x=s.getCanvas("mesh",y,g),w=x.context,v=w.createImageData(h,f);if(t){const E=v.data;for(let k=0,D=E.length;k<D;k+=4)E[k]=t[0],E[k+1]=t[1],E[k+2]=t[2],E[k+3]=255}for(const E of this._figures)Ou(v,E,m);return w.putImageData(v,2,2),{canvas:x.canvas,offsetX:a-2*p,offsetY:l-2*b,scaleX:p,scaleY:b}}isModifyingCurrentTransform(){return!0}getPattern(e,t,s,n){Ni(e,this._bbox);const i=new Float32Array(2);if(n===Xe.SHADING)se.singularValueDecompose2dScale(Re(e),i);else if(this.matrix){se.singularValueDecompose2dScale(this.matrix,i);const[a,l]=i;se.singularValueDecompose2dScale(t.baseTransform,i),i[0]*=a,i[1]*=l}else se.singularValueDecompose2dScale(t.baseTransform,i);const r=this._createMeshCanvas(i,n===Xe.SHADING?null:this._background,t.cachedCanvases);return n!==Xe.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(r.offsetX,r.offsetY),e.scale(r.scaleX,r.scaleY),e.createPattern(r.canvas,"no-repeat")}}class Uu extends ir{getPattern(){return"hotpink"}}function zu(o){switch(o[0]){case"RadialAxial":return new Fu(o);case"Mesh":return new Bu(o);case"Dummy":return new Uu}throw new Error(`Unknown IR type: ${o[0]}`)}const qr={COLORED:1,UNCOLORED:2};class rr{static MAX_PATTERN_SIZE=3e3;constructor(e,t,s,n){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=s,this.baseTransform=n}createPatternCanvas(e,t){const{bbox:s,operatorList:n,paintType:i,tilingType:r,color:a,canvasGraphicsFactory:l}=this;let{xstep:c,ystep:d}=this;c=Math.abs(c),d=Math.abs(d),jn("TilingType: "+r);const h=s[0],f=s[1],p=s[2],b=s[3],m=p-h,y=b-f,g=new Float32Array(2);se.singularValueDecompose2dScale(this.matrix,g);const[x,w]=g;se.singularValueDecompose2dScale(this.baseTransform,g);const v=x*g[0],_=w*g[1];let E=m,k=y,D=!1,N=!1;const R=Math.ceil(c*v),j=Math.ceil(d*_),C=Math.ceil(m*v),B=Math.ceil(y*_);R>=C?E=c:D=!0,j>=B?k=d:N=!0;const S=this.getSizeAndScale(E,this.ctx.canvas.width,v),O=this.getSizeAndScale(k,this.ctx.canvas.height,_),U=e.cachedCanvases.getCanvas("pattern",S.size,O.size),M=U.context,G=l.createCanvasGraphics(M,t);if(G.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(G,i,a),M.translate(-S.scale*h,-O.scale*f),G.transform(0,S.scale,0,0,O.scale,0,0),M.save(),G.dependencyTracker?.save(),this.clipBbox(G,h,f,p,b),G.baseTransform=Re(G.ctx),G.executeOperatorList(n),G.endDrawing(),G.dependencyTracker?.restore(),M.restore(),D||N){const z=U.canvas;D&&(E=c),N&&(k=d);const $=this.getSizeAndScale(E,this.ctx.canvas.width,v),L=this.getSizeAndScale(k,this.ctx.canvas.height,_),F=$.size,Y=L.size,K=e.cachedCanvases.getCanvas("pattern-workaround",F,Y),X=K.context,te=D?Math.floor(m/c):0,ae=N?Math.floor(y/d):0;for(let ie=0;ie<=te;ie++)for(let le=0;le<=ae;le++)X.drawImage(z,F*ie,Y*le,F,Y,0,0,F,Y);return{canvas:K.canvas,scaleX:$.scale,scaleY:L.scale,offsetX:h,offsetY:f}}return{canvas:U.canvas,scaleX:S.scale,scaleY:O.scale,offsetX:h,offsetY:f}}getSizeAndScale(e,t,s){const n=Math.max(rr.MAX_PATTERN_SIZE,t);let i=Math.ceil(e*s);return i>=n?i=n:s=i/e,{scale:s,size:i}}clipBbox(e,t,s,n,i){const r=n-t,a=i-s;e.ctx.rect(t,s,r,a),se.axialAlignedBoundingBox([t,s,n,i],Re(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,s){const n=e.ctx,i=e.current;switch(t){case qr.COLORED:const{fillStyle:r,strokeStyle:a}=this.ctx;n.fillStyle=i.fillColor=r,n.strokeStyle=i.strokeColor=a;break;case qr.UNCOLORED:n.fillStyle=n.strokeStyle=s,i.fillColor=i.strokeColor=s;break;default:throw new au(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,s,n,i){let r=s;n!==Xe.SHADING&&(r=se.transform(r,t.baseTransform),this.matrix&&(r=se.transform(r,this.matrix)));const a=this.createPatternCanvas(t,i);let l=new DOMMatrix(r);l=l.translate(a.offsetX,a.offsetY),l=l.scale(1/a.scaleX,1/a.scaleY);const c=e.createPattern(a.canvas,"repeat");return c.setTransform(l),c}}function Hu({src:o,srcPos:e=0,dest:t,width:s,height:n,nonBlackColor:i=4294967295,inverseDecode:r=!1}){const a=Oe.isLittleEndian?4278190080:255,[l,c]=r?[i,a]:[a,i],d=s>>3,h=s&7,f=o.length;t=new Uint32Array(t.buffer);let p=0;for(let b=0;b<n;b++){for(const y=e+d;e<y;e++){const g=e<f?o[e]:255;t[p++]=g&128?c:l,t[p++]=g&64?c:l,t[p++]=g&32?c:l,t[p++]=g&16?c:l,t[p++]=g&8?c:l,t[p++]=g&4?c:l,t[p++]=g&2?c:l,t[p++]=g&1?c:l}if(h===0)continue;const m=e<f?o[e++]:255;for(let y=0;y<h;y++)t[p++]=m&1<<7-y?c:l}return{srcPos:e,destPos:p}}const Kr=16,Zr=100,$u=15,Jr=10,et=16,ai=new DOMMatrix,rt=new Float32Array(2),Qt=new Float32Array([1/0,1/0,-1/0,-1/0]);function Wu(o,e){if(o._removeMirroring)throw new Error("Context is already forwarding operations.");o.__originalSave=o.save,o.__originalRestore=o.restore,o.__originalRotate=o.rotate,o.__originalScale=o.scale,o.__originalTranslate=o.translate,o.__originalTransform=o.transform,o.__originalSetTransform=o.setTransform,o.__originalResetTransform=o.resetTransform,o.__originalClip=o.clip,o.__originalMoveTo=o.moveTo,o.__originalLineTo=o.lineTo,o.__originalBezierCurveTo=o.bezierCurveTo,o.__originalRect=o.rect,o.__originalClosePath=o.closePath,o.__originalBeginPath=o.beginPath,o._removeMirroring=()=>{o.save=o.__originalSave,o.restore=o.__originalRestore,o.rotate=o.__originalRotate,o.scale=o.__originalScale,o.translate=o.__originalTranslate,o.transform=o.__originalTransform,o.setTransform=o.__originalSetTransform,o.resetTransform=o.__originalResetTransform,o.clip=o.__originalClip,o.moveTo=o.__originalMoveTo,o.lineTo=o.__originalLineTo,o.bezierCurveTo=o.__originalBezierCurveTo,o.rect=o.__originalRect,o.closePath=o.__originalClosePath,o.beginPath=o.__originalBeginPath,delete o._removeMirroring},o.save=function(){e.save(),this.__originalSave()},o.restore=function(){e.restore(),this.__originalRestore()},o.translate=function(t,s){e.translate(t,s),this.__originalTranslate(t,s)},o.scale=function(t,s){e.scale(t,s),this.__originalScale(t,s)},o.transform=function(t,s,n,i,r,a){e.transform(t,s,n,i,r,a),this.__originalTransform(t,s,n,i,r,a)},o.setTransform=function(t,s,n,i,r,a){e.setTransform(t,s,n,i,r,a),this.__originalSetTransform(t,s,n,i,r,a)},o.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},o.rotate=function(t){e.rotate(t),this.__originalRotate(t)},o.clip=function(t){e.clip(t),this.__originalClip(t)},o.moveTo=function(t,s){e.moveTo(t,s),this.__originalMoveTo(t,s)},o.lineTo=function(t,s){e.lineTo(t,s),this.__originalLineTo(t,s)},o.bezierCurveTo=function(t,s,n,i,r,a){e.bezierCurveTo(t,s,n,i,r,a),this.__originalBezierCurveTo(t,s,n,i,r,a)},o.rect=function(t,s,n,i){e.rect(t,s,n,i),this.__originalRect(t,s,n,i)},o.closePath=function(){e.closePath(),this.__originalClosePath()},o.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class Gu{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,s){let n;return this.cache[e]!==void 0?(n=this.cache[e],this.canvasFactory.reset(n,t,s)):(n=this.canvasFactory.create(t,s),this.cache[e]=n),n}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function nn(o,e,t,s,n,i,r,a,l,c){const[d,h,f,p,b,m]=Re(o);if(h===0&&f===0){const x=r*d+b,w=Math.round(x),v=a*p+m,_=Math.round(v),E=(r+l)*d+b,k=Math.abs(Math.round(E)-w)||1,D=(a+c)*p+m,N=Math.abs(Math.round(D)-_)||1;return o.setTransform(Math.sign(d),0,0,Math.sign(p),w,_),o.drawImage(e,t,s,n,i,0,0,k,N),o.setTransform(d,h,f,p,b,m),[k,N]}if(d===0&&p===0){const x=a*f+b,w=Math.round(x),v=r*h+m,_=Math.round(v),E=(a+c)*f+b,k=Math.abs(Math.round(E)-w)||1,D=(r+l)*h+m,N=Math.abs(Math.round(D)-_)||1;return o.setTransform(0,Math.sign(h),Math.sign(f),0,w,_),o.drawImage(e,t,s,n,i,0,0,N,k),o.setTransform(d,h,f,p,b,m),[N,k]}o.drawImage(e,t,s,n,i,r,a,l,c);const y=Math.hypot(d,h),g=Math.hypot(f,p);return[y*l,g*c]}class Qr{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=Si;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=Be.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(e,t,s){s?.(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=Qt.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=Xe.FILL,t=null){const s=this.minMax.slice();if(e===Xe.STROKE){t||Se("Stroke bounding box must include transform."),se.singularValueDecompose2dScale(t,rt);const n=rt[0]*this.lineWidth/2,i=rt[1]*this.lineWidth/2;s[0]-=n,s[1]-=i,s[2]+=n,s[3]+=i}return s}updateClipFromPath(){const e=se.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(Qt,0)}getClippedPathBoundingBox(e=Xe.FILL,t=null){return se.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function ea(o,e){if(e instanceof ImageData){o.putImageData(e,0,0);return}const t=e.height,s=e.width,n=t%et,i=(t-n)/et,r=n===0?i:i+1,a=o.createImageData(s,et);let l=0,c;const d=e.data,h=a.data;let f,p,b,m;if(e.kind===ks.GRAYSCALE_1BPP){const y=d.byteLength,g=new Uint32Array(h.buffer,0,h.byteLength>>2),x=g.length,w=s+7>>3,v=4294967295,_=Oe.isLittleEndian?4278190080:255;for(f=0;f<r;f++){for(b=f<i?et:n,c=0,p=0;p<b;p++){const E=y-l;let k=0;const D=E>w?s:E*8-7,N=D&-8;let R=0,j=0;for(;k<N;k+=8)j=d[l++],g[c++]=j&128?v:_,g[c++]=j&64?v:_,g[c++]=j&32?v:_,g[c++]=j&16?v:_,g[c++]=j&8?v:_,g[c++]=j&4?v:_,g[c++]=j&2?v:_,g[c++]=j&1?v:_;for(;k<D;k++)R===0&&(j=d[l++],R=128),g[c++]=j&R?v:_,R>>=1}for(;c<x;)g[c++]=0;o.putImageData(a,0,f*et)}}else if(e.kind===ks.RGBA_32BPP){for(p=0,m=s*et*4,f=0;f<i;f++)h.set(d.subarray(l,l+m)),l+=m,o.putImageData(a,0,p),p+=et;f<r&&(m=s*n*4,h.set(d.subarray(l,l+m)),o.putImageData(a,0,p))}else if(e.kind===ks.RGB_24BPP)for(b=et,m=s*b,f=0;f<r;f++){for(f>=i&&(b=n,m=s*b),c=0,p=m;p--;)h[c++]=d[l++],h[c++]=d[l++],h[c++]=d[l++],h[c++]=255;o.putImageData(a,0,f*et)}else throw new Error(`bad image kind: ${e.kind}`)}function ta(o,e){if(e.bitmap){o.drawImage(e.bitmap,0,0);return}const t=e.height,s=e.width,n=t%et,i=(t-n)/et,r=n===0?i:i+1,a=o.createImageData(s,et);let l=0;const c=e.data,d=a.data;for(let h=0;h<r;h++){const f=h<i?et:n;({srcPos:l}=Hu({src:c,srcPos:l,dest:d,width:s,height:f,nonBlackColor:0})),o.putImageData(a,0,h*et)}}function ys(o,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of t)o[s]!==void 0&&(e[s]=o[s]);o.setLineDash!==void 0&&(e.setLineDash(o.getLineDash()),e.lineDashOffset=o.lineDashOffset)}function rn(o){o.strokeStyle=o.fillStyle="#000000",o.fillRule="nonzero",o.globalAlpha=1,o.lineWidth=1,o.lineCap="butt",o.lineJoin="miter",o.miterLimit=10,o.globalCompositeOperation="source-over",o.font="10px sans-serif",o.setLineDash!==void 0&&(o.setLineDash([]),o.lineDashOffset=0);const{filter:e}=o;e!=="none"&&e!==""&&(o.filter="none")}function sa(o,e){if(e)return!0;se.singularValueDecompose2dScale(o,rt);const t=Math.fround(ft.pixelRatio*Ut.PDF_TO_CSS_UNITS);return rt[0]<=t&&rt[1]<=t}const Vu=["butt","round","square"],Xu=["miter","round","bevel"],Yu={},na={};class rs{constructor(e,t,s,n,i,{optionalContentConfig:r,markedContentStack:a=null},l,c,d){this.ctx=e,this.current=new Qr(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=s,this.canvasFactory=n,this.filterFactory=i,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=a||[],this.optionalContentConfig=r,this.cachedCanvases=new Gu(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=c,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=d??null}getObject(e,t,s=null){return typeof t=="string"?(this.dependencyTracker?.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):s}beginDrawing({transform:e,viewport:t,transparency:s=!1,background:n=null}){const i=this.ctx.canvas.width,r=this.ctx.canvas.height,a=this.ctx.fillStyle;if(this.ctx.fillStyle=n||"#ffffff",this.ctx.fillRect(0,0,i,r),this.ctx.fillStyle=a,s){const l=this.cachedCanvases.getCanvas("transparent",i,r);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...Re(this.compositeCtx))}this.ctx.save(),rn(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Re(this.ctx)}executeOperatorList(e,t,s,n,i){const r=e.argsArray,a=e.fnArray;let l=t||0;const c=r.length;if(c===l)return l;const d=c-l>Jr&&typeof s=="function",h=d?Date.now()+$u:0;let f=0;const p=this.commonObjs,b=this.objs;let m,y;for(;;){if(n!==void 0&&l===n.nextBreakPoint)return n.breakIt(l,s),l;if(!i||i(l))if(m=a[l],y=r[l]??null,m!==os.dependency)y===null?this[m](l):this[m](l,...y);else for(const g of y){this.dependencyTracker?.recordNamedData(g,l);const x=g.startsWith("g_")?p:b;if(!x.has(g))return x.get(g,s),l}if(l++,l===c)return l;if(d&&++f>Jr){if(Date.now()>h)return s(),l;f=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#t()}#t(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){const s=e.width??e.displayWidth,n=e.height??e.displayHeight;let i=Math.max(Math.hypot(t[0],t[1]),1),r=Math.max(Math.hypot(t[2],t[3]),1),a=s,l=n,c="prescale1",d,h;for(;i>2&&a>1||r>2&&l>1;){let f=a,p=l;i>2&&a>1&&(f=a>=16384?Math.floor(a/2)-1||1:Math.ceil(a/2),i/=a/f),r>2&&l>1&&(p=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,r/=l/p),d=this.cachedCanvases.getCanvas(c,f,p),h=d.context,h.clearRect(0,0,f,p),h.drawImage(e,0,0,a,l,0,0,f,p),e=d.canvas,a=f,l=p,c=c==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:a,paintHeight:l}}_createMaskCanvas(e,t){const s=this.ctx,{width:n,height:i}=t,r=this.current.fillColor,a=this.current.patternFill,l=Re(s);let c,d,h,f;if((t.bitmap||t.data)&&t.count>1){const R=t.bitmap||t.data.buffer;d=JSON.stringify(a?l:[l.slice(0,4),r]),c=this._cachedBitmapsMap.get(R),c||(c=new Map,this._cachedBitmapsMap.set(R,c));const j=c.get(d);if(j&&!a){const C=Math.round(Math.min(l[0],l[2])+l[4]),B=Math.round(Math.min(l[1],l[3])+l[5]);return this.dependencyTracker?.recordDependencies(e,ht.transformAndFill),{canvas:j,offsetX:C,offsetY:B}}h=j}h||(f=this.cachedCanvases.getCanvas("maskCanvas",n,i),ta(f.context,t));let p=se.transform(l,[1/n,0,0,-1/i,0,0]);p=se.transform(p,[1,0,0,1,0,-i]);const b=Qt.slice();se.axialAlignedBoundingBox([0,0,n,i],p,b);const[m,y,g,x]=b,w=Math.round(g-m)||1,v=Math.round(x-y)||1,_=this.cachedCanvases.getCanvas("fillCanvas",w,v),E=_.context,k=m,D=y;E.translate(-k,-D),E.transform(...p),h||(h=this._scaleImage(f.canvas,gt(E)),h=h.img,c&&a&&c.set(d,h)),E.imageSmoothingEnabled=sa(Re(E),t.interpolate),nn(E,h,0,0,h.width,h.height,0,0,n,i),E.globalCompositeOperation="source-in";const N=se.transform(gt(E),[1,0,0,1,-k,-D]);return E.fillStyle=a?r.getPattern(s,this,N,Xe.FILL,e):r,E.fillRect(0,0,n,i),c&&!a&&(this.cachedCanvases.delete("fillCanvas"),c.set(d,_.canvas)),this.dependencyTracker?.recordDependencies(e,ht.transformAndFill),{canvas:_.canvas,offsetX:Math.round(k),offsetY:Math.round(D)}}setLineWidth(e,t){this.dependencyTracker?.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){this.dependencyTracker?.recordSimpleData("lineCap",e),this.ctx.lineCap=Vu[t]}setLineJoin(e,t){this.dependencyTracker?.recordSimpleData("lineJoin",e),this.ctx.lineJoin=Xu[t]}setMiterLimit(e,t){this.dependencyTracker?.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,s){this.dependencyTracker?.recordSimpleData("dash",e);const n=this.ctx;n.setLineDash!==void 0&&(n.setLineDash(t),n.lineDashOffset=s)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){for(const[s,n]of t)switch(s){case"LW":this.setLineWidth(e,n);break;case"LC":this.setLineCap(e,n);break;case"LJ":this.setLineJoin(e,n);break;case"ML":this.setMiterLimit(e,n);break;case"D":this.setDash(e,n[0],n[1]);break;case"RI":this.setRenderingIntent(e,n);break;case"FL":this.setFlatness(e,n);break;case"Font":this.setFont(e,n[0],n[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=n;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=n;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=n;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",e),this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,s=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(n,t,s);this.suspendedCtx=this.ctx;const r=this.ctx=i.context;r.setTransform(this.suspendedCtx.getTransform()),ys(this.suspendedCtx,r),Wu(r,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),ys(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,s,n){const i=n[0],r=n[1],a=n[2]-i,l=n[3]-r;a===0||l===0||(this.genericComposeSMask(t.context,s,a,l,t.subtype,t.backdrop,t.transferMap,i,r,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(s.canvas,0,0),e.restore())}genericComposeSMask(e,t,s,n,i,r,a,l,c,d,h){let f=e.canvas,p=l-d,b=c-h;if(r)if(p<0||b<0||p+s>f.width||b+n>f.height){const y=this.cachedCanvases.getCanvas("maskExtension",s,n),g=y.context;g.drawImage(f,-p,-b),g.globalCompositeOperation="destination-atop",g.fillStyle=r,g.fillRect(0,0,s,n),g.globalCompositeOperation="source-over",f=y.canvas,p=b=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const y=new Path2D;y.rect(p,b,s,n),e.clip(y),e.globalCompositeOperation="destination-atop",e.fillStyle=r,e.fillRect(p,b,s,n),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),i==="Alpha"&&a?t.filter=this.filterFactory.addAlphaFilter(a):i==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(a));const m=new Path2D;m.rect(l,c,s,n),t.clip(m),t.globalCompositeOperation="destination-in",t.drawImage(f,p,b,s,n,l,c,s,n),t.restore()}save(e){this.inSMaskMode&&ys(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),this.dependencyTracker?.save(e)}restore(e){if(this.dependencyTracker?.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&ys(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,s,n,i,r,a){this.dependencyTracker?.recordIncrementalData("transform",e),this.ctx.transform(t,s,n,i,r,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,s,n){let[i]=s;if(!n){i||=s[0]=new Path2D,this[t](e,i);return}if(this.dependencyTracker!==null){const r=t===os.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,n[0]-r,n[2]+r,n[1]-r,n[3]+r).recordDependencies(e,["transform"])}i instanceof Path2D||(i=s[0]=To(i)),se.axialAlignedBoundingBox(n,Re(this.ctx),this.current.minMax),this[t](e,i),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,s=!0){const n=this.ctx,i=this.current.strokeColor;if(n.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof i=="object"&&i?.getPattern){const r=i.isModifyingCurrentTransform()?n.getTransform():null;if(n.save(),n.strokeStyle=i.getPattern(n,this,gt(n),Xe.STROKE,e),r){const a=new Path2D;a.addPath(t,n.getTransform().invertSelf().multiplySelf(r)),t=a}this.rescaleAndStroke(t,!1),n.restore()}else this.rescaleAndStroke(t,!0);this.dependencyTracker?.recordDependencies(e,ht.stroke),s&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(Xe.STROKE,Re(this.ctx))),n.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,s=!0){const n=this.ctx,i=this.current.fillColor,r=this.current.patternFill;let a=!1;if(r){const c=i.isModifyingCurrentTransform()?n.getTransform():null;if(this.dependencyTracker?.save(e),n.save(),n.fillStyle=i.getPattern(n,this,gt(n),Xe.FILL,e),c){const d=new Path2D;d.addPath(t,n.getTransform().invertSelf().multiplySelf(c)),t=d}a=!0}const l=this.current.getClippedPathBoundingBox();this.contentVisible&&l!==null&&(this.pendingEOFill?(n.fill(t,"evenodd"),this.pendingEOFill=!1):n.fill(t)),this.dependencyTracker?.recordDependencies(e,ht.fill),a&&(n.restore(),this.dependencyTracker?.restore(e)),s&&this.consumePath(e,t,l)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){this.ctx.fill(t),this.dependencyTracker?.recordDependencies(e,ht.rawFillPath).recordOperation(e)}clip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=Yu}eoClip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=na}beginText(e){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,s=this.ctx;if(this.dependencyTracker){const{dependencyTracker:n}=this;t!==void 0&&n.recordFutureForcedDependency("textClip",n.getOpenMarker()).recordFutureForcedDependency("textClip",e),n.recordCloseMarker(e)}if(t!==void 0){const n=new Path2D,i=s.getTransform().invertSelf();for(const{transform:r,x:a,y:l,fontSize:c,path:d}of t)d&&n.addPath(d,new DOMMatrix(r).preMultiplySelf(i).translate(a,l).scale(c,-c));s.clip(n)}delete this.pendingTextPaths}setCharSpacing(e,t){this.dependencyTracker?.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){this.dependencyTracker?.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){this.dependencyTracker?.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){this.dependencyTracker?.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,s){this.dependencyTracker?.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const n=this.commonObjs.get(t),i=this.current;if(!n)throw new Error(`Can't find font for ${t}`);if(i.fontMatrix=n.fontMatrix||Si,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&fe("Invalid font matrix for font "+t),s<0?(s=-s,i.fontDirection=-1):i.fontDirection=1,this.current.font=n,this.current.fontSize=s,n.isType3Font)return;const r=n.loadedName||"sans-serif",a=n.systemFontInfo?.css||`"${r}", ${n.fallbackName}`;let l="normal";n.black?l="900":n.bold&&(l="bold");const c=n.italic?"italic":"normal";let d=s;s<Kr?d=Kr:s>Zr&&(d=Zr),this.current.fontSizeScale=s/d,this.ctx.font=`${c} ${l} ${d}px ${a}`}setTextRenderingMode(e,t){this.dependencyTracker?.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){this.dependencyTracker?.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,s){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=s}setLeadingMoveText(e,t,s){this.setLeading(e,-s),this.moveText(e,t,s)}setTextMatrix(e,t){this.dependencyTracker?.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",e);const{current:s}=this;s.textMatrix=t,s.textMatrixScale=Math.hypot(t[0],t[1]),s.x=s.lineX=0,s.y=s.lineY=0}nextLine(e){this.moveText(e,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}#n(e,t,s){const n=new Path2D;return n.addPath(e,new DOMMatrix(s).invertSelf().multiplySelf(t)),n}paintChar(e,t,s,n,i,r){const a=this.ctx,l=this.current,c=l.font,d=l.textRenderingMode,h=l.fontSize/l.fontSizeScale,f=d&Be.FILL_STROKE_MASK,p=!!(d&Be.ADD_TO_PATH_FLAG),b=l.patternFill&&!c.missingFile,m=l.patternStroke&&!c.missingFile;let y;if((c.disableFontFace||p||b||m)&&!c.missingFile&&(y=c.getPathGenerator(this.commonObjs,t)),y&&(c.disableFontFace||b||m)){a.save(),a.translate(s,n),a.scale(h,-h),this.dependencyTracker?.recordCharacterBBox(e,a,c);let g;if(f===Be.FILL||f===Be.FILL_STROKE)if(i){g=a.getTransform(),a.setTransform(...i);const x=this.#n(y,g,i);a.fill(x)}else a.fill(y);if(f===Be.STROKE||f===Be.FILL_STROKE)if(r){g||=a.getTransform(),a.setTransform(...r);const{a:x,b:w,c:v,d:_}=g,E=se.inverseTransform(r),k=se.transform([x,w,v,_,0,0],E);se.singularValueDecompose2dScale(k,rt),a.lineWidth*=Math.max(rt[0],rt[1])/h,a.stroke(this.#n(y,g,r))}else a.lineWidth/=h,a.stroke(y);a.restore()}else(f===Be.FILL||f===Be.FILL_STROKE)&&(a.fillText(t,s,n),this.dependencyTracker?.recordCharacterBBox(e,a,c,h,s,n,()=>a.measureText(t))),(f===Be.STROKE||f===Be.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(e,a,c,h,s,n,()=>a.measureText(t)).recordDependencies(e,ht.stroke),a.strokeText(t,s,n));p&&((this.pendingTextPaths||=[]).push({transform:Re(a),x:s,y:n,fontSize:h,path:y}),this.dependencyTracker?.recordCharacterBBox(e,a,c,h,s,n))}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let s=!1;for(let n=3;n<t.length;n+=4)if(t[n]>0&&t[n]<255){s=!0;break}return ue(this,"isFontSubpixelAAEnabled",s)}showText(e,t){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,ht.showText).resetBBox(e),this.current.textRenderingMode&Be.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const s=this.current,n=s.font;if(n.isType3Font){this.showType3Text(e,t),this.dependencyTracker?.recordShowTextOperation(e);return}const i=s.fontSize;if(i===0){this.dependencyTracker?.recordOperation(e);return}const r=this.ctx,a=s.fontSizeScale,l=s.charSpacing,c=s.wordSpacing,d=s.fontDirection,h=s.textHScale*d,f=t.length,p=n.vertical,b=p?1:-1,m=n.defaultVMetrics,y=i*s.fontMatrix[0],g=s.textRenderingMode===Be.FILL&&!n.disableFontFace&&!s.patternFill;r.save(),s.textMatrix&&r.transform(...s.textMatrix),r.translate(s.x,s.y+s.textRise),d>0?r.scale(h,-1):r.scale(h,1);let x,w;const v=s.textRenderingMode&Be.FILL_STROKE_MASK,_=v===Be.FILL||v===Be.FILL_STROKE,E=v===Be.STROKE||v===Be.FILL_STROKE;if(_&&s.patternFill){r.save();const j=s.fillColor.getPattern(r,this,gt(r),Xe.FILL,e);x=Re(r),r.restore(),r.fillStyle=j}if(E&&s.patternStroke){r.save();const j=s.strokeColor.getPattern(r,this,gt(r),Xe.STROKE,e);w=Re(r),r.restore(),r.strokeStyle=j}let k=s.lineWidth;const D=s.textMatrixScale;if(D===0||k===0?E&&(k=this.getSinglePixelWidth()):k/=D,a!==1&&(r.scale(a,a),k/=a),r.lineWidth=k,n.isInvalidPDFjsFont){const j=[];let C=0;for(const S of t)j.push(S.unicode),C+=S.width;const B=j.join("");if(r.fillText(B,0,0),this.dependencyTracker!==null){const S=r.measureText(B);this.dependencyTracker.recordBBox(e,this.ctx,-S.actualBoundingBoxLeft,S.actualBoundingBoxRight,-S.actualBoundingBoxAscent,S.actualBoundingBoxDescent).recordShowTextOperation(e)}s.x+=C*y*h,r.restore(),this.compose();return}let N=0,R;for(R=0;R<f;++R){const j=t[R];if(typeof j=="number"){N+=b*j*i/1e3;continue}let C=!1;const B=(j.isSpace?c:0)+l,S=j.fontChar,O=j.accent;let U,M,G=j.width;if(p){const L=j.vmetric||m,F=-(j.vmetric?L[1]:G*.5)*y,Y=L[2]*y;G=L?-L[0]:G,U=F/a,M=(N+Y)/a}else U=N/a,M=0;let z;if(n.remeasure&&G>0){z=r.measureText(S);const L=z.width*1e3/i*a;if(G<L&&this.isFontSubpixelAAEnabled){const F=G/L;C=!0,r.save(),r.scale(F,1),U/=F}else G!==L&&(U+=(G-L)/2e3*i/a)}if(this.contentVisible&&(j.isInFont||n.missingFile)){if(g&&!O)r.fillText(S,U,M),this.dependencyTracker?.recordCharacterBBox(e,r,z?{bbox:null}:n,i/a,U,M,()=>z??r.measureText(S));else if(this.paintChar(e,S,U,M,x,w),O){const L=U+i*O.offset.x/a,F=M-i*O.offset.y/a;this.paintChar(e,O.fontChar,L,F,x,w)}}const $=p?G*y-B*d:G*y+B*d;N+=$,C&&r.restore()}p?s.y-=N:s.x+=N*h,r.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(e)}showType3Text(e,t){const s=this.ctx,n=this.current,i=n.font,r=n.fontSize,a=n.fontDirection,l=i.vertical?1:-1,c=n.charSpacing,d=n.wordSpacing,h=n.textHScale*a,f=n.fontMatrix||Si,p=t.length,b=n.textRenderingMode===Be.INVISIBLE;let m,y,g,x;if(b||r===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,s.save(),n.textMatrix&&s.transform(...n.textMatrix),s.translate(n.x,n.y+n.textRise),s.scale(h,a);const w=this.dependencyTracker;for(this.dependencyTracker=w?new An(w,e):null,m=0;m<p;++m){if(y=t[m],typeof y=="number"){x=l*y*r/1e3,this.ctx.translate(x,0),n.x+=x*h;continue}const v=(y.isSpace?d:0)+c,_=i.charProcOperatorList[y.operatorListId];_?this.contentVisible&&(this.save(),s.scale(r,r),s.transform(...f),this.executeOperatorList(_),this.restore()):fe(`Type3 character "${y.operatorListId}" is not available.`);const E=[y.width,0];se.applyTransform(E,f),g=E[0]*r+v,s.translate(g,0),n.x+=g*h}s.restore(),w&&(this.dependencyTracker=w)}setCharWidth(e,t,s){}setCharWidthAndBounds(e,t,s,n,i,r,a){const l=new Path2D;l.rect(n,i,r-n,a-i),this.ctx.clip(l),this.dependencyTracker?.recordBBox(e,this.ctx,n,r,i,a).recordClipBox(e,this.ctx,n,r,i,a),this.endPath(e)}getColorN_Pattern(e,t){let s;if(t[0]==="TilingPattern"){const n=this.baseTransform||Re(this.ctx),i={createCanvasGraphics:(r,a)=>new rs(r,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new An(this.dependencyTracker,a,!0):null)};s=new rr(t,this.ctx,i,n)}else s=this._getPattern(e,t[1],t[2]);return s}setStrokeColorN(e,...t){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){this.dependencyTracker?.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t,s=null){let n;return this.cachedPatterns.has(t)?n=this.cachedPatterns.get(t):(n=zu(this.getObject(e,t)),this.cachedPatterns.set(t,n)),s&&(n.matrix=s),n}shadingFill(e,t){if(!this.contentVisible)return;const s=this.ctx;this.save(e);const n=this._getPattern(e,t);s.fillStyle=n.getPattern(s,this,gt(s),Xe.SHADING,e);const i=gt(s);if(i){const{width:r,height:a}=s.canvas,l=Qt.slice();se.axialAlignedBoundingBox([0,0,r,a],i,l);const[c,d,h,f]=l;this.ctx.fillRect(c,d,h-c,f-d)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,ht.transform).recordDependencies(e,ht.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){Se("Should not call beginInlineImage")}beginImageData(){Se("Should not call beginImageData")}paintFormXObjectBegin(e,t,s){if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=Re(this.ctx),s)){se.axialAlignedBoundingBox(s,this.baseTransform,this.current.minMax);const[n,i,r,a]=s,l=new Path2D;l.rect(n,i,r-n,a-i),this.ctx.clip(l),this.dependencyTracker?.recordClipBox(e,this.ctx,n,r,i,a),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const s=this.ctx;t.isolated||jn("TODO: Support non-isolated groups."),t.knockout&&fe("Knockout groups not supported.");const n=Re(s);if(t.matrix&&s.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let i=Qt.slice();se.axialAlignedBoundingBox(t.bbox,Re(s),i);const r=[0,0,s.canvas.width,s.canvas.height];i=se.intersect(i,r)||[0,0,0,0];const a=Math.floor(i[0]),l=Math.floor(i[1]),c=Math.max(Math.ceil(i[2])-a,1),d=Math.max(Math.ceil(i[3])-l,1);this.current.startNewPathAndClipBox([0,0,c,d]);let h="groupAt"+this.groupLevel;t.smask&&(h+="_smask_"+this.smaskCounter++%2);const f=this.cachedCanvases.getCanvas(h,c,d),p=f.context;p.translate(-a,-l),p.transform(...n);let b=new Path2D;const[m,y,g,x]=t.bbox;if(b.rect(m,y,g-m,x-y),t.matrix){const w=new Path2D;w.addPath(b,new DOMMatrix(t.matrix)),b=w}p.clip(b),t.smask&&this.smaskStack.push({canvas:f.canvas,context:p,offsetX:a,offsetY:l,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(s.setTransform(1,0,0,1,0,0),s.translate(a,l),s.save()),ys(s,p),this.ctx=p,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(s),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(s),this.groupLevel++}endGroup(e,t){if(!this.contentVisible)return;this.groupLevel--;const s=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const i=Re(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...i);const r=Qt.slice();se.axialAlignedBoundingBox([0,0,s.canvas.width,s.canvas.height],i,r),this.ctx.drawImage(s.canvas,0,0),this.ctx.restore(),this.compose(r)}}beginAnnotation(e,t,s,n,i,r){if(this.#e(),rn(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),s){const a=s[2]-s[0],l=s[3]-s[1];if(r&&this.annotationCanvasMap){n=n.slice(),n[4]-=s[0],n[5]-=s[1],s=s.slice(),s[0]=s[1]=0,s[2]=a,s[3]=l,se.singularValueDecompose2dScale(Re(this.ctx),rt);const{viewportScale:c}=this,d=Math.ceil(a*this.outputScaleX*c),h=Math.ceil(l*this.outputScaleY*c);this.annotationCanvas=this.canvasFactory.create(d,h);const{canvas:f,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(t,f),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(rt[0],0,0,-rt[1],0,l*rt[1]),rn(this.ctx)}else{rn(this.ctx),this.endPath(e);const c=new Path2D;c.rect(s[0],s[1],a,l),this.ctx.clip(c)}}this.current=new Qr(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...n),this.transform(e,...i)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),this.#t(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){if(!this.contentVisible)return;const s=t.count;t=this.getObject(e,t.data,t),t.count=s;const n=this.ctx,i=this._createMaskCanvas(e,t),r=i.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(r,i.offsetX,i.offsetY),this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,i.offsetX,i.offsetX+r.width,i.offsetY,i.offsetY+r.height).recordOperation(e),n.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,s,n=0,i=0,r,a){if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const l=this.ctx;l.save();const c=Re(l);l.transform(s,n,i,r,0,0);const d=this._createMaskCanvas(e,t);l.setTransform(1,0,0,1,d.offsetX-c[4],d.offsetY-c[5]),this.dependencyTracker?.resetBBox(e);for(let h=0,f=a.length;h<f;h+=2){const p=se.transform(c,[s,n,i,r,a[h],a[h+1]]);l.drawImage(d.canvas,p[4],p[5]),this.dependencyTracker?.recordBBox(e,this.ctx,p[4],p[4]+d.canvas.width,p[5],p[5]+d.canvas.height)}l.restore(),this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageMaskXObjectGroup(e,t){if(!this.contentVisible)return;const s=this.ctx,n=this.current.fillColor,i=this.current.patternFill;this.dependencyTracker?.resetBBox(e).recordDependencies(e,ht.transformAndFill);for(const r of t){const{data:a,width:l,height:c,transform:d}=r,h=this.cachedCanvases.getCanvas("maskCanvas",l,c),f=h.context;f.save();const p=this.getObject(e,a,r);ta(f,p),f.globalCompositeOperation="source-in",f.fillStyle=i?n.getPattern(f,this,gt(s),Xe.FILL,e):n,f.fillRect(0,0,l,c),f.restore(),s.save(),s.transform(...d),s.scale(1,-1),nn(s,h.canvas,0,0,l,c,0,-1,1,1),this.dependencyTracker?.recordBBox(e,s,0,l,0,c),s.restore()}this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const s=this.getObject(e,t);if(!s){fe("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e,s)}paintImageXObjectRepeat(e,t,s,n,i){if(!this.contentVisible)return;const r=this.getObject(e,t);if(!r){fe("Dependent image isn't ready yet");return}const a=r.width,l=r.height,c=[];for(let d=0,h=i.length;d<h;d+=2)c.push({transform:[s,0,0,n,i[d],i[d+1]],x:0,y:0,w:a,h:l});this.paintInlineImageXObjectGroup(e,r,c)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:s,height:n}=e,i=this.cachedCanvases.getCanvas("inlineImage",s,n),r=i.context;return r.filter=this.current.transferMaps,r.drawImage(t,0,0),r.filter="none",i.canvas}paintInlineImageXObject(e,t){if(!this.contentVisible)return;const s=t.width,n=t.height,i=this.ctx;this.save(e);const{filter:r}=i;r!=="none"&&r!==""&&(i.filter="none"),i.scale(1/s,-1/n);let a;if(t.bitmap)a=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)a=t;else{const d=this.cachedCanvases.getCanvas("inlineImage",s,n).context;ea(d,t),a=this.applyTransferMapsToCanvas(d)}const l=this._scaleImage(a,gt(i));i.imageSmoothingEnabled=sa(Re(i),t.interpolate),this.dependencyTracker?.resetBBox(e).recordBBox(e,i,0,s,-n,0).recordDependencies(e,ht.imageXObject).recordOperation(e),nn(i,l.img,0,0,l.paintWidth,l.paintHeight,0,-n,s,n),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,s){if(!this.contentVisible)return;const n=this.ctx;let i;if(t.bitmap)i=t.bitmap;else{const r=t.width,a=t.height,c=this.cachedCanvases.getCanvas("inlineImage",r,a).context;ea(c,t),i=this.applyTransferMapsToCanvas(c)}this.dependencyTracker?.resetBBox(e);for(const r of s)n.save(),n.transform(...r.transform),n.scale(1,-1),nn(n,i,r.x,r.y,r.w,r.h,0,-1,1,1),this.dependencyTracker?.recordBBox(e,n,0,1,-1,0),n.restore();this.dependencyTracker?.recordOperation(e),this.compose()}paintSolidColorImageMask(e){this.contentVisible&&(this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,ht.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,s){}beginMarkedContent(e,t){this.dependencyTracker?.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,s){this.dependencyTracker?.beginMarkedContent(e),t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(s)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){this.dependencyTracker?.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,s){const n=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(s);const i=this.ctx;this.pendingClip?(n||(this.pendingClip===na?i.clip(t,"evenodd"):i.clip(t)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):this.dependencyTracker?.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Re(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),s=Math.hypot(e[0],e[2]),n=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(s,n)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:s,c:n,d:i}=this.ctx.getTransform();let r,a;if(s===0&&n===0){const l=Math.abs(t),c=Math.abs(i);if(l===c)if(e===0)r=a=1/l;else{const d=l*e;r=a=d<1?1/d:1}else if(e===0)r=1/l,a=1/c;else{const d=l*e,h=c*e;r=d<1?1/d:1,a=h<1?1/h:1}}else{const l=Math.abs(t*i-s*n),c=Math.hypot(t,s),d=Math.hypot(n,i);if(e===0)r=d/l,a=c/l;else{const h=e*l;r=d>h?d/h:1,a=c>h?c/h:1}}this._cachedScaleForStroking[0]=r,this._cachedScaleForStroking[1]=a}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:s,current:{lineWidth:n}}=this,[i,r]=this.getScaleForStroking();if(i===r){s.lineWidth=(n||1)*i,s.stroke(e);return}const a=s.getLineDash();t&&s.save(),s.scale(i,r),ai.a=1/i,ai.d=1/r;const l=new Path2D;if(l.addPath(e,ai),a.length>0){const c=Math.max(i,r);s.setLineDash(a.map(d=>d/c)),s.lineDashOffset/=c}s.lineWidth=n||1,s.stroke(l),t&&s.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(const o in os)rs.prototype[o]!==void 0&&(rs.prototype[os[o]]=rs.prototype[o]);class Bt{static#e=null;static#t="";static get workerPort(){return this.#e}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");this.#e=e}static get workerSrc(){return this.#t}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");this.#t=e}}class qu{#e;#t;constructor({parsedData:e,rawData:t}){this.#e=e,this.#t=t}getRaw(){return this.#t}get(e){return this.#e.get(e)??null}[Symbol.iterator](){return this.#e.entries()}}const Zt=Symbol("INTERNAL");class Ku{#e=!1;#t=!1;#n=!1;#s=!0;constructor(e,{name:t,intent:s,usage:n,rbGroups:i}){this.#e=!!(e&nt.DISPLAY),this.#t=!!(e&nt.PRINT),this.name=t,this.intent=s,this.usage=n,this.rbGroups=i}get visible(){if(this.#n)return this.#s;if(!this.#s)return!1;const{print:e,view:t}=this.usage;return this.#e?t?.viewState!=="OFF":this.#t?e?.printState!=="OFF":!0}_setVisible(e,t,s=!1){e!==Zt&&Se("Internal method `_setVisible` called."),this.#n=s,this.#s=t}}class Zu{#e=null;#t=new Map;#n=null;#s=null;constructor(e,t=nt.DISPLAY){if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,this.#s=e.order;for(const s of e.groups)this.#t.set(s.id,new Ku(t,s));if(e.baseState==="OFF")for(const s of this.#t.values())s._setVisible(Zt,!1);for(const s of e.on)this.#t.get(s)._setVisible(Zt,!0);for(const s of e.off)this.#t.get(s)._setVisible(Zt,!1);this.#n=this.getHash()}}#a(e){const t=e.length;if(t<2)return!0;const s=e[0];for(let n=1;n<t;n++){const i=e[n];let r;if(Array.isArray(i))r=this.#a(i);else if(this.#t.has(i))r=this.#t.get(i).visible;else return fe(`Optional content group not found: ${i}`),!0;switch(s){case"And":if(!r)return!1;break;case"Or":if(r)return!0;break;case"Not":return!r;default:return!0}}return s==="And"}isVisible(e){if(this.#t.size===0)return!0;if(!e)return jn("Optional content group not defined."),!0;if(e.type==="OCG")return this.#t.has(e.id)?this.#t.get(e.id).visible:(fe(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return this.#a(e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!this.#t.has(t))return fe(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!this.#t.has(t))return fe(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!this.#t.has(t))return fe(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!this.#t.has(t))return fe(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!1}return!0}return fe(`Unknown optional content policy ${e.policy}.`),!0}return fe(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,s=!0){const n=this.#t.get(e);if(!n){fe(`Optional content group not found: ${e}`);return}if(s&&t&&n.rbGroups.length)for(const i of n.rbGroups)for(const r of i)r!==e&&this.#t.get(r)?._setVisible(Zt,!1,!0);n._setVisible(Zt,!!t,!0),this.#e=null}setOCGState({state:e,preserveRB:t}){let s;for(const n of e){switch(n){case"ON":case"OFF":case"Toggle":s=n;continue}const i=this.#t.get(n);if(i)switch(s){case"ON":this.setVisibility(n,!0,t);break;case"OFF":this.setVisibility(n,!1,t);break;case"Toggle":this.setVisibility(n,!i.visible,t);break}}this.#e=null}get hasInitialVisibility(){return this.#n===null||this.getHash()===this.#n}getOrder(){return this.#t.size?this.#s?this.#s.slice():[...this.#t.keys()]:null}getGroup(e){return this.#t.get(e)||null}getHash(){if(this.#e!==null)return this.#e;const e=new Po;for(const[t,s]of this.#t)e.update(`${t}:${s.visible}`);return this.#e=e.hexdigest()}[Symbol.iterator](){return this.#t.entries()}}class On{#e=null;#t=null;_fullReader=null;_rangeReaders=new Set;_source=null;constructor(e,t,s){this._source=e,this.#e=t,this.#t=s}get _progressiveDataLength(){return this._fullReader?._loaded??0}getFullReader(){return Ae(!this._fullReader,"BasePDFStream.getFullReader can only be called once."),this._fullReader=new this.#e(this)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const s=new this.#t(this,e,t);return this._rangeReaders.add(s),s}cancelAllRequests(e){this._fullReader?.cancel(e);for(const t of new Set(this._rangeReaders))t.cancel(e)}}class Bn{onProgress=null;_contentLength=0;_filename=null;_headersCapability=Promise.withResolvers();_isRangeSupported=!1;_isStreamingSupported=!1;_loaded=0;_stream=null;constructor(e){this._stream=e}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){Se("Abstract method `read` called")}cancel(e){Se("Abstract method `cancel` called")}}class Un{_stream=null;constructor(e,t,s){this._stream=e}async read(){Se("Abstract method `read` called")}cancel(e){Se("Abstract method `cancel` called")}}function ia(o){return o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength?o.buffer:new Uint8Array(o).buffer}class Ju extends On{_progressiveDone=!1;_queuedChunks=[];constructor(e){super(e,Qu,ef);const{pdfDataRangeTransport:t}=e,{initialData:s,progressiveDone:n}=t;if(s?.length>0){const i=ia(s);this._queuedChunks.push(i)}this._progressiveDone=n,t.addRangeListener((i,r)=>{this.#e(i,r)}),t.addProgressListener((i,r)=>{r!==void 0&&this._fullReader?.onProgress?.({loaded:i,total:r})}),t.addProgressiveReadListener(i=>{this.#e(void 0,i)}),t.addProgressiveDoneListener(()=>{this._fullReader?.progressiveDone(),this._progressiveDone=!0}),t.transportReady()}#e(e,t){const s=ia(t);if(e===void 0)this._fullReader?this._fullReader._enqueue(s):this._queuedChunks.push(s);else{const n=this._rangeReaders.keys().find(i=>i._begin===e);Ae(n,"#onReceiveData - no `PDFDataTransportStreamRangeReader` instance found."),n._enqueue(s)}}getFullReader(){const e=super.getFullReader();return this._queuedChunks=null,e}getRangeReader(e,t){const s=super.getRangeReader(e,t);return s&&(s.onDone=()=>this._rangeReaders.delete(s),this._source.pdfDataRangeTransport.requestDataRange(e,t)),s}cancelAllRequests(e){super.cancelAllRequests(e),this._source.pdfDataRangeTransport.abort()}}class Qu extends Bn{_done=!1;_queuedChunks=null;_requests=[];constructor(e){super(e);const{pdfDataRangeTransport:t,disableRange:s,disableStream:n}=e._source,{length:i,contentDispositionFilename:r}=t;this._queuedChunks=e._queuedChunks||[];for(const a of this._queuedChunks)this._loaded+=a.byteLength;this._done=e._progressiveDone,this._contentLength=i,this._isStreamingSupported=!n,this._isRangeSupported=!s,Fn(r)&&(this._filename=r),this._headersCapability.resolve()}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||=!0}}class ef extends Un{onDone=null;_begin=-1;_done=!1;_queuedChunk=null;_requests=[];constructor(e,t,s){super(e,t,s),this._begin=t}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this.onDone?.()}}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this.onDone?.()}}function tf(o){let e=!0,t=s("filename\\*","i").exec(o);if(t){t=t[1];let d=a(t);return d=unescape(d),d=l(d),d=c(d),i(d)}if(t=r(o),t){const d=c(t);return i(d)}if(t=s("filename","i").exec(o),t){t=t[1];let d=a(t);return d=c(d),i(d)}function s(d,h){return new RegExp("(?:^|;)\\s*"+d+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',h)}function n(d,h){if(d){if(!/^[\x00-\xFF]+$/.test(h))return h;try{const f=new TextDecoder(d,{fatal:!0}),p=Ln(h);h=f.decode(p),e=!1}catch{}}return h}function i(d){return e&&/[\x80-\xff]/.test(d)&&(d=n("utf-8",d),e&&(d=n("iso-8859-1",d))),d}function r(d){const h=[];let f;const p=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=p.exec(d))!==null;){let[,m,y,g]=f;if(m=parseInt(m,10),m in h){if(m===0)break;continue}h[m]=[y,g]}const b=[];for(let m=0;m<h.length&&m in h;++m){let[y,g]=h[m];g=a(g),y&&(g=unescape(g),m===0&&(g=l(g))),b.push(g)}return b.join("")}function a(d){if(d.startsWith('"')){const h=d.slice(1).split('\\"');for(let f=0;f<h.length;++f){const p=h[f].indexOf('"');p!==-1&&(h[f]=h[f].slice(0,p),h.length=f+1),h[f]=h[f].replaceAll(/\\(.)/g,"$1")}d=h.join('"')}return d}function l(d){const h=d.indexOf("'");if(h===-1)return d;const f=d.slice(0,h),b=d.slice(h+1).replace(/^[^']*'/,"");return n(f,b)}function c(d){return!d.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(d)?d:d.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(h,f,p,b){if(p==="q"||p==="Q")return b=b.replaceAll("_"," "),b=b.replaceAll(/=([0-9a-fA-F]{2})/g,function(m,y){return String.fromCharCode(parseInt(y,16))}),n(f,b);try{b=atob(b)}catch{}return n(f,b)})}return""}function Oo(o,e){const t=new Headers;if(!o||!e||typeof e!="object")return t;for(const s in e){const n=e[s];n!==void 0&&t.append(s,n)}return t}function zn(o){return URL.parse(o)?.origin??null}function Bo({responseHeaders:o,isHttp:e,rangeChunkSize:t,disableRange:s}){const n={allowRangeRequests:!1,suggestedLength:void 0},i=parseInt(o.get("Content-Length"),10);return!Number.isInteger(i)||(n.suggestedLength=i,i<=2*t)||s||!e||o.get("Accept-Ranges")!=="bytes"||(o.get("Content-Encoding")||"identity")!=="identity"||(n.allowRangeRequests=!0),n}function Uo(o){const e=o.get("Content-Disposition");if(e){let t=tf(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(Fn(t))return t}return null}function Hn(o,e){return new Ps(`Unexpected server response (${o}) while retrieving PDF "${e}".`,o,o===404||o===0&&e.startsWith("file:"))}function zo(o,e){if(o!==e)throw new Error(`Expected range response-origin "${o}" to match "${e}".`)}function Ho(o,e,t,s){return fetch(o,{method:"GET",headers:e,signal:s.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"})}function $o(o,e){if(o!==200&&o!==206)throw Hn(o,e)}function Wo(o){return o instanceof Uint8Array?o.buffer:o instanceof ArrayBuffer?o:(fe(`getArrayBuffer - unexpected data format: ${o}`),new Uint8Array(o).buffer)}class sf extends On{_responseOrigin=null;constructor(e){super(e,nf,rf),this.isHttp=/^https?:/i.test(e.url),this.headers=Oo(this.isHttp,e.httpHeaders)}}class nf extends Bn{_abortController=new AbortController;_reader=null;constructor(e){super(e);const{disableRange:t,disableStream:s,length:n,rangeChunkSize:i,url:r,withCredentials:a}=e._source;this._contentLength=n,this._isStreamingSupported=!s,this._isRangeSupported=!t;const l=new Headers(e.headers);Ho(r,l,a,this._abortController).then(c=>{e._responseOrigin=zn(c.url),$o(c.status,r),this._reader=c.body.getReader();const d=c.headers,{allowRangeRequests:h,suggestedLength:f}=Bo({responseHeaders:d,isHttp:e.isHttp,rangeChunkSize:i,disableRange:t});this._isRangeSupported=h,this._contentLength=f||this._contentLength,this._filename=Uo(d),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Ct("Streaming is disabled.")),this._headersCapability.resolve()}).catch(this._headersCapability.reject)}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Wo(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class rf extends Un{_abortController=new AbortController;_readCapability=Promise.withResolvers();_reader=null;constructor(e,t,s){super(e,t,s);const{url:n,withCredentials:i}=e._source,r=new Headers(e.headers);r.append("Range",`bytes=${t}-${s-1}`),Ho(n,r,i,this._abortController).then(a=>{const l=zn(a.url);zo(l,e._responseOrigin),$o(a.status,n),this._reader=a.body.getReader(),this._readCapability.resolve()}).catch(this._readCapability.reject)}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:{value:Wo(e),done:!1}}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}const oi=200,ra=206;function af(o){return typeof o!="string"?o:Ln(o).buffer}class of extends On{#e=new WeakMap;_responseOrigin=null;constructor(e){super(e,lf,cf),this.url=e.url,this.isHttp=/^https?:/i.test(this.url),this.headers=Oo(this.isHttp,e.httpHeaders)}_request(e){const t=new XMLHttpRequest,s={validateStatus:null,onHeadersReceived:e.onHeadersReceived,onDone:e.onDone,onError:e.onError,onProgress:e.onProgress};this.#e.set(t,s),t.open("GET",this.url),t.withCredentials=this._source.withCredentials;for(const[n,i]of this.headers)t.setRequestHeader(n,i);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),s.validateStatus=n=>n===ra||n===oi):s.validateStatus=n=>n===oi,t.responseType="arraybuffer",Ae(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>e.onError(t.status),t.onreadystatechange=this.#n.bind(this,t),t.onprogress=this.#t.bind(this,t),t.send(null),t}#t(e,t){this.#e.get(e)?.onProgress?.(t)}#n(e,t){const s=this.#e.get(e);if(!s||(e.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),e.readyState!==4)||!this.#e.has(e))return;if(this.#e.delete(e),e.status===0&&this.isHttp){s.onError(e.status);return}const n=e.status||oi;if(!s.validateStatus(n)){s.onError(e.status);return}const i=af(e.response);if(n===ra){const r=e.getResponseHeader("Content-Range");/bytes (\d+)-(\d+)\/(\d+)/.test(r)?s.onDone(i):(fe('Missing or invalid "Content-Range" header.'),s.onError(0))}else i?s.onDone(i):s.onError(e.status)}_abortRequest(e){this.#e.has(e)&&(this.#e.delete(e),e.abort())}getRangeReader(e,t){const s=super.getRangeReader(e,t);return s&&(s.onClosed=()=>this._rangeReaders.delete(s)),s}}class lf extends Bn{_cachedChunks=[];_done=!1;_requests=[];_storedError=null;constructor(e){super(e);const{length:t}=e._source;this._contentLength=t,this._fullRequestXhr=e._request({onHeadersReceived:this.#e.bind(this),onDone:this.#t.bind(this),onError:this.#n.bind(this),onProgress:this.#s.bind(this)})}#e(){const e=this._stream,{disableRange:t,rangeChunkSize:s}=e._source,n=this._fullRequestXhr;e._responseOrigin=zn(n.responseURL);const i=n.getAllResponseHeaders(),r=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(c=>{const[d,...h]=c.split(": ");return[d,h.join(": ")]}):[]),{allowRangeRequests:a,suggestedLength:l}=Bo({responseHeaders:r,isHttp:e.isHttp,rangeChunkSize:s,disableRange:t});a&&(this._isRangeSupported=!0),this._contentLength=l||this._contentLength,this._filename=Uo(r),this._isRangeSupported&&e._abortRequest(n),this._headersCapability.resolve()}#t(e){if(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._cachedChunks.push(e),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}#n(e){this._storedError=Hn(e,this._stream.url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}#s(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._abortRequest(this._fullRequestXhr),this._fullRequestXhr=null}}class cf extends Un{onClosed=null;_done=!1;_queuedChunk=null;_requests=[];_storedError=null;constructor(e,t,s){super(e,t,s),this._requestXhr=e._request({begin:t,end:s,onHeadersReceived:this.#e.bind(this),onDone:this.#t.bind(this),onError:this.#n.bind(this),onProgress:null})}#e(){const e=zn(this._requestXhr?.responseURL);try{zo(e,this._stream._responseOrigin)}catch(t){this._storedError=t,this.#n(0)}}#t(e){this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this.onClosed?.()}#n(e){this._storedError??=Hn(e,this._stream.url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._abortRequest(this._requestXhr),this.onClosed?.()}}const df=/^[a-z][a-z0-9\-+.]+:/i;function hf(o){if(df.test(o))return new URL(o);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(o))}function Go(o){const{Readable:e}=process.getBuiltinModule("stream");return typeof e.toWeb=="function"?e.toWeb(o):process.getBuiltinModule("module").createRequire(import.meta.url)("node-readable-to-web-readable-stream").makeDefaultReadableStreamFromNodeReadable(o)}function Vo(o){return o instanceof Uint8Array?o.buffer:o instanceof ArrayBuffer?o:(fe(`getArrayBuffer - unexpected data format: ${o}`),new Uint8Array(o).buffer)}class uf extends On{constructor(e){super(e,ff,pf),this.url=hf(e.url),Ae(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs.")}}class ff extends Bn{_reader=null;constructor(e){super(e);const{disableRange:t,disableStream:s,length:n,rangeChunkSize:i}=e._source;this._contentLength=n,this._isStreamingSupported=!s,this._isRangeSupported=!t;const r=e.url,a=process.getBuiltinModule("fs");a.promises.lstat(r).then(l=>{const c=a.createReadStream(r),d=Go(c);this._reader=d.getReader();const{size:h}=l;h<=2*i&&(this._isRangeSupported=!1),this._contentLength=h,!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new Ct("Streaming is disabled.")),this._headersCapability.resolve()}).catch(l=>{l.code==="ENOENT"&&(l=Hn(0,r.href)),this._headersCapability.reject(l)})}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Vo(e),done:!1})}cancel(e){this._reader?.cancel(e)}}class pf extends Un{_readCapability=Promise.withResolvers();_reader=null;constructor(e,t,s){super(e,t,s);const n=e.url,i=process.getBuiltinModule("fs");try{const r=i.createReadStream(n,{start:t,end:s-1}),a=Go(r);this._reader=a.getReader(),this._readCapability.resolve()}catch(r){this._readCapability.reject(r)}}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:{value:Vo(e),done:!1}}cancel(e){this._reader?.cancel(e)}}const xs=Symbol("INITIAL_DATA");class Xo{#e=Object.create(null);#t(e){return this.#e[e]||={...Promise.withResolvers(),data:xs}}get(e,t=null){if(t){const n=this.#t(e);return n.promise.then(()=>t(n.data)),null}const s=this.#e[e];if(!s||s.data===xs)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return s.data}has(e){const t=this.#e[e];return!!t&&t.data!==xs}delete(e){const t=this.#e[e];return!t||t.data===xs?!1:(delete this.#e[e],!0)}resolve(e,t=null){const s=this.#t(e);s.data=t,s.resolve()}clear(){for(const e in this.#e){const{data:t}=this.#e[e];t?.bitmap?.close()}this.#e=Object.create(null)}*[Symbol.iterator](){for(const e in this.#e){const{data:t}=this.#e[e];t!==xs&&(yield[e,t])}}}const mf=1e5,aa=30;class tt{#e=Promise.withResolvers();#t=null;#n=!1;#s=!!globalThis.FontInspector?.enabled;#a=null;#r=null;#i=0;#o=0;#c=null;#l=null;#u=0;#h=0;#f=Object.create(null);#g=[];#m=null;#d=[];#p=new WeakMap;#b=null;static#x=new Map;static#y=new Map;static#E=new WeakMap;static#S=null;static#v=new Set;constructor({textContentSource:e,container:t,viewport:s}){if(e instanceof ReadableStream)this.#m=e;else if(typeof e=="object")this.#m=new ReadableStream({start(l){l.enqueue(e),l.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#t=this.#l=t,this.#h=s.scale*ft.pixelRatio,this.#u=s.rotation,this.#r={div:null,properties:null,ctx:null};const{pageWidth:n,pageHeight:i,pageX:r,pageY:a}=s.rawDims;this.#b=[1,0,0,-1,-r,a+i],this.#o=n,this.#i=i,tt.#N(),t.style.setProperty("--min-font-size",tt.#S),Lt(t,s),this.#e.promise.finally(()=>{tt.#v.delete(this),this.#r=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Oe.platform;return ue(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{this.#c.read().then(({value:t,done:s})=>{if(s){this.#e.resolve();return}this.#a??=t.lang,Object.assign(this.#f,t.styles),this.#C(t.items),e()},this.#e.reject)};return this.#c=this.#m.getReader(),tt.#v.add(this),e(),this.#e.promise}update({viewport:e,onBefore:t=null}){const s=e.scale*ft.pixelRatio,n=e.rotation;if(n!==this.#u&&(t?.(),this.#u=n,Lt(this.#l,{rotation:n})),s!==this.#h){t?.(),this.#h=s;const i={div:null,properties:null,ctx:tt.#P(this.#a)};for(const r of this.#d)i.properties=this.#p.get(r),i.div=r,this.#_(i)}}cancel(){const e=new Ct("TextLayer task cancelled.");this.#c?.cancel(e).catch(()=>{}),this.#c=null,this.#e.reject(e)}get textDivs(){return this.#d}get textContentItemsStr(){return this.#g}#C(e){if(this.#n)return;this.#r.ctx??=tt.#P(this.#a);const t=this.#d,s=this.#g;for(const n of e){if(t.length>mf){fe("Ignoring additional textDivs for performance reasons."),this.#n=!0;return}if(n.str===void 0){if(n.type==="beginMarkedContentProps"||n.type==="beginMarkedContent"){const i=this.#t;this.#t=document.createElement("span"),this.#t.classList.add("markedContent"),n.id&&this.#t.setAttribute("id",`${n.id}`),n.tag==="Artifact"&&(this.#t.ariaHidden=!0),i.append(this.#t)}else n.type==="endMarkedContent"&&(this.#t=this.#t.parentNode);continue}s.push(n.str),this.#w(n)}}#w(e){const t=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};this.#d.push(t);const n=se.transform(this.#b,e.transform);let i=Math.atan2(n[1],n[0]);const r=this.#f[e.fontName];r.vertical&&(i+=Math.PI/2);let a=this.#s&&r.fontSubstitution||r.fontFamily;a=tt.fontFamilyMap.get(a)||a;const l=Math.hypot(n[2],n[3]),c=l*tt.#F(a,r,this.#a);let d,h;i===0?(d=n[4],h=n[5]-c):(d=n[4]+c*Math.sin(i),h=n[5]-c*Math.cos(i));const f=t.style;f.left=`${(100*d/this.#o).toFixed(2)}%`,f.top=`${(100*h/this.#i).toFixed(2)}%`,f.setProperty("--font-height",`${l.toFixed(2)}px`),f.fontFamily=a,s.fontSize=l,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,this.#s&&(t.dataset.fontName=r.fontSubstitutionLoadedName||e.fontName),i!==0&&(s.angle=i*(180/Math.PI));let p=!1;if(e.str.length>1)p=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const b=Math.abs(e.transform[0]),m=Math.abs(e.transform[3]);b!==m&&Math.max(b,m)/Math.min(b,m)>1.5&&(p=!0)}if(p&&(s.canvasWidth=r.vertical?e.height:e.width),this.#p.set(t,s),this.#r.div=t,this.#r.properties=s,this.#_(this.#r),s.hasText&&this.#t.append(t),s.hasEOL){const b=document.createElement("br");b.setAttribute("role","presentation"),this.#t.append(b)}}#_(e){const{div:t,properties:s,ctx:n}=e,{style:i}=t;if(s.canvasWidth!==0&&s.hasText){const{fontFamily:r}=i,{canvasWidth:a,fontSize:l}=s;tt.#T(n,l*this.#h,r);const{width:c}=n.measureText(t.textContent);c>0&&i.setProperty("--scale-x",a*this.#h/c)}s.angle!==0&&i.setProperty("--rotate",`${s.angle}deg`)}static cleanup(){if(!(this.#v.size>0)){this.#x.clear();for(const{canvas:e}of this.#y.values())e.remove();this.#y.clear()}}static#P(e=null){let t=this.#y.get(e||="");if(!t){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=e,document.body.append(s),t=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#y.set(e,t),this.#E.set(t,{size:0,family:""})}return t}static#T(e,t,s){const n=this.#E.get(e);t===n.size&&s===n.family||(e.font=`${t}px ${s}`,n.size=t,n.family=s)}static#N(){if(this.#S!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),this.#S=e.getBoundingClientRect().height,e.remove()}static#F(e,t,s){const n=this.#x.get(e);if(n)return n;const i=this.#P(s);i.canvas.width=i.canvas.height=aa,this.#T(i,aa,e);const r=i.measureText(""),a=r.fontBoundingBoxAscent,l=Math.abs(r.fontBoundingBoxDescent);i.canvas.width=i.canvas.height=0;let c=.8;return a?c=a/(a+l):(Oe.platform.isFirefox&&fe("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?c=t.ascent:t.descent&&(c=1+t.descent)),this.#x.set(e,c),c}}const gf=100;function Yo(o={}){typeof o=="string"||o instanceof URL?o={url:o}:(o instanceof ArrayBuffer||ArrayBuffer.isView(o))&&(o={data:o});const e=new ar,{docId:t}=e,s=o.url?_u(o.url):null,n=o.data?Eu(o.data):null,i=o.httpHeaders||null,r=o.withCredentials===!0,a=o.password??null,l=o.range instanceof or?o.range:null,c=Number.isInteger(o.rangeChunkSize)&&o.rangeChunkSize>0?o.rangeChunkSize:2**16;let d=o.worker instanceof $e?o.worker:null;const h=o.verbosity,f=typeof o.docBaseUrl=="string"&&!zs(o.docBaseUrl)?o.docBaseUrl:null,p=Qs(o.cMapUrl),b=o.cMapPacked!==!1,m=o.CMapReaderFactory||(Ke?Du:Wr),y=Qs(o.iccUrl),g=Qs(o.standardFontDataUrl),x=o.StandardFontDataFactory||(Ke?Iu:Gr),w=Qs(o.wasmUrl),v=o.WasmFactory||(Ke?ju:Vr),_=o.stopAtErrors!==!0,E=Number.isInteger(o.maxImageSize)&&o.maxImageSize>-1?o.maxImageSize:-1,k=o.isEvalSupported!==!1,D=typeof o.isOffscreenCanvasSupported=="boolean"?o.isOffscreenCanvasSupported:!Ke,N=typeof o.isImageDecoderSupported=="boolean"?o.isImageDecoderSupported:!Ke&&(Oe.platform.isFirefox||!globalThis.chrome),R=Number.isInteger(o.canvasMaxAreaInBytes)?o.canvasMaxAreaInBytes:-1,j=typeof o.disableFontFace=="boolean"?o.disableFontFace:Ke,C=o.fontExtraProperties===!0,B=o.enableXfa===!0,S=o.ownerDocument||globalThis.document,O=o.disableRange===!0,U=o.disableStream===!0,M=o.disableAutoFetch===!0,G=o.pdfBug===!0,z=o.CanvasFactory||(Ke?Ru:Tu),$=o.FilterFactory||(Ke?Pu:Nu),L=o.enableHWA===!0,F=o.useWasm!==!1,Y=l?l.length:o.length??NaN,K=typeof o.useSystemFonts=="boolean"?o.useSystemFonts:!Ke&&!j,X=typeof o.useWorkerFetch=="boolean"?o.useWorkerFetch:!!(m===Wr&&x===Gr&&v===Vr&&p&&g&&w&&_s(p,document.baseURI)&&_s(g,document.baseURI)&&_s(w,document.baseURI)),te=null;nu(h);const ae={canvasFactory:new z({ownerDocument:S,enableHWA:L}),filterFactory:new $({docId:t,ownerDocument:S}),cMapReaderFactory:X?null:new m({baseUrl:p,isCompressed:b}),standardFontDataFactory:X?null:new x({baseUrl:g}),wasmFactory:X?null:new v({baseUrl:w})};d||(d=$e.create({verbosity:h,port:Bt.workerPort}),e._worker=d);const ie={docId:t,apiVersion:"5.4.624",data:n,password:a,disableAutoFetch:M,rangeChunkSize:c,length:Y,docBaseUrl:f,enableXfa:B,evaluatorOptions:{maxImageSize:E,disableFontFace:j,ignoreErrors:_,isEvalSupported:k,isOffscreenCanvasSupported:D,isImageDecoderSupported:N,canvasMaxAreaInBytes:R,fontExtraProperties:C,useSystemFonts:K,useWasm:F,useWorkerFetch:X,cMapUrl:p,iccUrl:y,standardFontDataUrl:g,wasmUrl:w}},le={ownerDocument:S,pdfBug:G,styleElement:te,enableHWA:L,loadingParams:{disableAutoFetch:M,enableXfa:B}};return d.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const ce=d.messageHandler.sendWithPromise("GetDocRequest",ie,n?[n.buffer]:null);let oe;if(l)oe=new Ju({pdfDataRangeTransport:l,disableRange:O,disableStream:U});else if(!n){if(!s)throw new Error("getDocument - no `url` parameter provided.");const be=_s(s)?sf:Ke?uf:of;oe=new be({url:s,length:Y,httpHeaders:i,withCredentials:r,rangeChunkSize:c,disableRange:O,disableStream:U})}return ce.then(be=>{if(e.destroyed)throw new Error("Loading aborted");if(d.destroyed)throw new Error("Worker was destroyed");const _e=new Es(t,be,d.port),A=new xf(_e,e,oe,le,ae);e._transport=A,_e.send("Ready",null)})}).catch(e._capability.reject),e}class ar{static#e=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${ar.#e++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}class or{#e=Promise.withResolvers();#t=[];#n=[];#s=[];#a=[];constructor(e,t,s=!1,n=null){this.length=e,this.initialData=t,this.progressiveDone=s,this.contentDispositionFilename=n}addRangeListener(e){this.#a.push(e)}addProgressListener(e){this.#s.push(e)}addProgressiveReadListener(e){this.#n.push(e)}addProgressiveDoneListener(e){this.#t.push(e)}onDataRange(e,t){for(const s of this.#a)s(e,t)}onDataProgress(e,t){this.#e.promise.then(()=>{for(const s of this.#s)s(e,t)})}onDataProgressiveRead(e){this.#e.promise.then(()=>{for(const t of this.#n)t(e)})}onDataProgressiveDone(){this.#e.promise.then(()=>{for(const e of this.#t)e()})}transportReady(){this.#e.resolve()}requestDataRange(e,t){Se("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class bf{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return ue(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}extractPages(e){return this._transport.extractPages(e)}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class yf{#e=!1;#t=xe.instance;constructor(e,t,s,n=!1){this._pageIndex=e,this._pageInfo=t,this._transport=s,this._stats=n?new Fr:null,this._pdfBug=n,this.commonObjs=s.commonObjs,this.objs=new Xo,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}set pageNumber(e){this._pageIndex=e-1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:s=0,offsetY:n=0,dontFlip:i=!1}={}){return new Us({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:s,offsetY:n,dontFlip:i})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return ue(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,canvas:t=e.canvas,viewport:s,intent:n="display",annotationMode:i=St.ENABLE,transform:r=null,background:a=null,optionalContentConfigPromise:l=null,annotationCanvasMap:c=null,pageColors:d=null,printAnnotationStorage:h=null,isEditing:f=!1,recordOperations:p=!1,operationsFilter:b=null}){this._stats?.time("Overall");const m=this._transport.getRenderingIntent(n,i,h,f),{renderingIntent:y,cacheKey:g}=m;this.#e=!1,l||=this._transport.getOptionalContentConfig(y);let x=this._intentStates.get(g);x||(x=Object.create(null),this._intentStates.set(g,x)),x.streamReaderCancelTimeout&&(clearTimeout(x.streamReaderCancelTimeout),x.streamReaderCancelTimeout=null);const w=!!(y&nt.PRINT);x.displayReadyCapability||(x.displayReadyCapability=Promise.withResolvers(),x.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(m));const v=!!(this._pdfBug&&globalThis.StepperManager?.enabled),_=!this.recordedBBoxes&&(p||v),E=N=>{if(x.renderTasks.delete(k),_){const R=k.gfx?.dependencyTracker.take();R&&(k.stepper&&k.stepper.setOperatorBBoxes(R,k.gfx.dependencyTracker.takeDebugMetadata()),p&&(this.recordedBBoxes=R))}w&&(this.#e=!0),this.#n(),N?(k.capability.reject(N),this._abortOperatorList({intentState:x,reason:N instanceof Error?N:new Error(N)})):k.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},k=new es({callback:E,params:{canvas:t,canvasContext:e,dependencyTracker:_?new Mu(t,x.operatorList.length,v):null,viewport:s,transform:r,background:a},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:c,operatorList:x.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!w,pdfBug:this._pdfBug,pageColors:d,enableHWA:this._transport.enableHWA,operationsFilter:b});(x.renderTasks||=new Set).add(k);const D=k.task;return Promise.all([x.displayReadyCapability.promise,l]).then(([N,R])=>{if(this.destroyed){E();return}if(this._stats?.time("Rendering"),!(R.renderingIntent&y))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");k.initializeGraphics({transparency:N,optionalContentConfig:R}),k.operatorListChanged()}).catch(E),D}getOperatorList({intent:e="display",annotationMode:t=St.ENABLE,printAnnotationStorage:s=null,isEditing:n=!1}={}){function i(){a.operatorList.lastChunk&&(a.opListReadCapability.resolve(a.operatorList),a.renderTasks.delete(l))}const r=this._transport.getRenderingIntent(e,t,s,n,!0);let a=this._intentStates.get(r.cacheKey);a||(a=Object.create(null),this._intentStates.set(r.cacheKey,a));let l;return a.opListReadCapability||(l=Object.create(null),l.operatorListChanged=i,a.opListReadCapability=Promise.withResolvers(),(a.renderTasks||=new Set).add(l),a.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(r)),a.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageId:this.#t.getPageId(this._pageIndex+1)-1,pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(n){return n.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>Rs.textContent(s));const t=this.streamTextContent(e);return new Promise(function(s,n){function i(){r.read().then(function({value:l,done:c}){if(c){s(a);return}a.lang??=l.lang,Object.assign(a.styles,l.styles),a.items.push(...l.items),i()},n)}const r=t.getReader(),a={items:[],styles:Object.create(null),lang:null};i()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const s of t.renderTasks)e.push(s.completed),s.cancel();return this.objs.clear(),this.#e=!1,Promise.all(e)}cleanup(e=!1){this.#e=!0;const t=this.#n();return e&&t&&(this._stats&&=new Fr),t}#n(){if(!this.#e||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}_startRenderPage(e,t){const s=this._intentStates.get(t);s&&(this._stats?.timeEnd("Page Request"),s.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let s=0,n=e.length;s<n;s++)t.operatorList.fnArray.push(e.fnArray[s]),t.operatorList.argsArray.push(e.argsArray[s]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const s of t.renderTasks)s.operatorListChanged();e.lastChunk&&this.#n()}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:s,modifiedIds:n}){const{map:i,transfer:r}=s,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageId:this.#t.getPageId(this._pageIndex+1)-1,pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:i,modifiedIds:n},r).getReader(),c=this._intentStates.get(t);c.streamReader=l;const d=()=>{l.read().then(({value:h,done:f})=>{if(f){c.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(h,c),d())},h=>{if(c.streamReader=null,!this._transport.destroyed){if(c.operatorList){c.operatorList.lastChunk=!0;for(const f of c.renderTasks)f.operatorListChanged();this.#n()}if(c.displayReadyCapability)c.displayReadyCapability.reject(h);else if(c.opListReadCapability)c.opListReadCapability.reject(h);else throw h}})};d()}_abortOperatorList({intentState:e,reason:t,force:s=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!s){if(e.renderTasks.size>0)return;if(t instanceof Mn){let n=gf;t.extraDelay>0&&t.extraDelay<1e3&&(n+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},n);return}}if(e.streamReader.cancel(new Ct(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[n,i]of this._intentStates)if(i===e){this._intentStates.delete(n);break}this.cleanup()}}}get stats(){return this._stats}}class $e{#e=Promise.withResolvers();#t=null;#n=null;#s=null;static#a=0;static#r=!1;static#i=new WeakMap;static{Ke&&(this.#r=!0,Bt.workerSrc||="./pdf.worker.mjs"),this._isSameOrigin=(e,t)=>{const s=URL.parse(e);if(!s?.origin||s.origin==="null")return!1;const n=new URL(t,s);return s.origin===n.origin},this._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},this.fromPort=e=>{if(fu("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return this.create(e)}}constructor({name:e=null,port:t=null,verbosity:s=iu()}={}){if(this.name=e,this.destroyed=!1,this.verbosity=s,t){if($e.#i.has(t))throw new Error("Cannot use more than one PDFWorker per port.");$e.#i.set(t,this),this.#c(t)}else this.#l()}get promise(){return this.#e.promise}#o(){this.#e.resolve(),this.#t.send("configure",{verbosity:this.verbosity})}get port(){return this.#n}get messageHandler(){return this.#t}#c(e){this.#n=e,this.#t=new Es("main","worker",e),this.#t.on("ready",()=>{}),this.#o()}#l(){if($e.#r||$e.#h){this.#u();return}let{workerSrc:e}=$e;try{$e._isSameOrigin(window.location,e)||(e=$e._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),s=new Es("main","worker",t),n=()=>{i.abort(),s.destroy(),t.terminate(),this.destroyed?this.#e.reject(new Error("Worker was destroyed")):this.#u()},i=new AbortController;t.addEventListener("error",()=>{this.#s||n()},{signal:i.signal}),s.on("test",a=>{if(i.abort(),this.destroyed||!a){n();return}this.#t=s,this.#n=t,this.#s=t,this.#o()}),s.on("ready",a=>{if(i.abort(),this.destroyed){n();return}try{r()}catch{this.#u()}});const r=()=>{const a=new Uint8Array;s.send("test",a,[a.buffer])};r();return}catch{jn("The worker has been disabled.")}this.#u()}#u(){$e.#r||(fe("Setting up fake worker."),$e.#r=!0),$e._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this.#e.reject(new Error("Worker was destroyed"));return}const t=new Cu;this.#n=t;const s=`fake${$e.#a++}`,n=new Es(s+"_worker",s,t);e.setup(n,t),this.#t=new Es(s,s+"_worker",t),this.#o()}).catch(e=>{this.#e.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){this.destroyed=!0,this.#s?.terminate(),this.#s=null,$e.#i.delete(this.#n),this.#n=null,this.#t?.destroy(),this.#t=null}static create(e){const t=this.#i.get(e?.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new $e(e)}static get workerSrc(){if(Bt.workerSrc)return Bt.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get#h(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}}static get _setupFakeWorkerGlobal(){return ue(this,"_setupFakeWorkerGlobal",(async()=>this.#h?this.#h:(await import(this.workerSrc)).WorkerMessageHandler)())}}class xf{downloadInfoCapability=Promise.withResolvers();#e=null;#t=new Map;#n=null;#s=new Map;#a=new Map;#r=new Map;#i=null;#o=xe.instance;constructor(e,t,s,n,i){this.messageHandler=e,this.loadingTask=t,this.#n=s,this.commonObjs=new Xo,this.fontLoader=new vu({ownerDocument:n.ownerDocument,styleElement:n.styleElement}),this.enableHWA=n.enableHWA,this.loadingParams=n.loadingParams,this._params=n,this.canvasFactory=i.canvasFactory,this.filterFactory=i.filterFactory,this.cMapReaderFactory=i.cMapReaderFactory,this.standardFontDataFactory=i.standardFontDataFactory,this.wasmFactory=i.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this.setupMessageHandler(),this.#o.addListener(this.#c.bind(this))}#c(){const e=new Map,t=new Map;for(let s=0,n=this.#o.pagesNumber;s<n;s++){const i=this.#o.getPrevPageNumber(s+1)-1,r=this.#s.get(i);r&&e.set(s,r);const a=this.#a.get(i);a&&t.set(s,a)}this.#s=e,this.#a=t}#l(e,t=null){const s=this.#t.get(e);if(s)return s;const n=this.messageHandler.sendWithPromise(e,t);return this.#t.set(e,n),n}#u({loaded:e,total:t}){this.loadingTask.onProgress?.({loaded:e,total:t,percent:We(Math.round(e/t*100),0,100)})}get annotationStorage(){return ue(this,"annotationStorage",new sr)}getRenderingIntent(e,t=St.ENABLE,s=null,n=!1,i=!1){let r=nt.DISPLAY,a=ki;switch(e){case"any":r=nt.ANY;break;case"display":break;case"print":r=nt.PRINT;break;default:fe(`getRenderingIntent - invalid intent: ${e}`)}const l=r&nt.PRINT&&s instanceof Ro?s:this.annotationStorage;switch(t){case St.DISABLE:r+=nt.ANNOTATIONS_DISABLE;break;case St.ENABLE:break;case St.ENABLE_FORMS:r+=nt.ANNOTATIONS_FORMS;break;case St.ENABLE_STORAGE:r+=nt.ANNOTATIONS_STORAGE,a=l.serializable;break;default:fe(`getRenderingIntent - invalid annotationMode: ${t}`)}n&&(r+=nt.IS_EDITING),i&&(r+=nt.OPLIST);const{ids:c,hash:d}=l.modifiedIds,h=[r,a.hash,d];return{renderingIntent:r,cacheKey:h.join("_"),annotationStorageSerializable:a,modifiedIds:c}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#i?.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const s of this.#s.values())e.push(s._destroy());this.#s.clear(),this.#a.clear(),this.#r.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(),tt.cleanup(),this.#n?.cancelAllRequests(new Ct("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(s,n)=>{Ae(this.#n,"GetReader - no `BasePDFStream` instance available."),this.#e=this.#n.getFullReader(),this.#e.onProgress=i=>this.#u(i),n.onPull=()=>{this.#e.read().then(function({value:i,done:r}){if(r){n.close();return}Ae(i instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),n.enqueue(new Uint8Array(i),1,[i])}).catch(i=>{n.error(i)})},n.onCancel=i=>{this.#e.cancel(i),n.ready.catch(r=>{if(!this.destroyed)throw r})}}),e.on("ReaderHeadersReady",async s=>{await this.#e.headersReady;const{isStreamingSupported:n,isRangeSupported:i,contentLength:r}=this.#e;return n&&i&&(this.#e.onProgress=null),{isStreamingSupported:n,isRangeSupported:i,contentLength:r}}),e.on("GetRangeReader",(s,n)=>{Ae(this.#n,"GetRangeReader - no `BasePDFStream` instance available.");const i=this.#n.getRangeReader(s.begin,s.end);if(!i){n.close();return}n.onPull=()=>{i.read().then(function({value:r,done:a}){if(a){n.close();return}Ae(r instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),n.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{n.error(r)})},n.onCancel=r=>{i.cancel(r),n.ready.catch(a=>{if(!this.destroyed)throw a})}}),e.on("GetDoc",({pdfInfo:s})=>{this.#o.pagesNumber=s.numPages,this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,t._capability.resolve(new bf(s,this))}),e.on("DocException",s=>{t._capability.reject(Qe(s))}),e.on("PasswordRequest",s=>{this.#i=Promise.withResolvers();try{if(!t.onPassword)throw Qe(s);const n=i=>{i instanceof Error?this.#i.reject(i):this.#i.resolve({password:i})};t.onPassword(n,s.code)}catch(n){this.#i.reject(n)}return this.#i.promise}),e.on("DataLoaded",s=>{this.#u({loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),e.on("StartRenderPage",s=>{if(this.destroyed)return;this.#s.get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),e.on("commonobj",([s,n,i])=>{if(this.destroyed||this.commonObjs.has(s))return null;switch(n){case"Font":if("error"in i){const h=i.error;fe(`Error during font loading: ${h}`),this.commonObjs.resolve(s,h);break}const r=new ke(i),a=this._params.pdfBug&&globalThis.FontInspector?.enabled?(h,f)=>globalThis.FontInspector.fontAdded(h,f):null,l=new Au(r,a,i.extra,i.charProcOperatorList);this.fontLoader.bind(l).catch(()=>e.sendWithPromise("FontFallback",{id:s})).finally(()=>{!l.fontExtraProperties&&l.data&&l.clearData(),this.commonObjs.resolve(s,l)});break;case"CopyLocalImage":const{imageRef:c}=i;Ae(c,"The imageRef must be defined.");for(const h of this.#s.values())for(const[,f]of h.objs)if(f?.ref===c)return f.dataLen?(this.commonObjs.resolve(s,structuredClone(f)),f.dataLen):null;break;case"FontPath":this.commonObjs.resolve(s,new Su(i));break;case"Image":this.commonObjs.resolve(s,i);break;case"Pattern":const d=new Ue(i);this.commonObjs.resolve(s,d.getIR());break;default:throw new Error(`Got unknown common object type ${n}`)}return null}),e.on("obj",([s,n,i,r])=>{if(this.destroyed)return;const a=this.#s.get(n);if(!a.objs.has(s)){if(a._intentStates.size===0){r?.bitmap?.close();return}switch(i){case"Image":case"Pattern":a.objs.resolve(s,r);break;default:throw new Error(`Got unknown object type ${i}`)}}}),e.on("DocProgress",s=>{this.destroyed||this.#u(s)}),e.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const n=this[s.type];if(!n)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return n.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&fe("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this.#e?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}extractPages(e){return this.messageHandler.sendWithPromise("ExtractPages",{pageInfos:e})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this.#o.pagesNumber)return Promise.reject(new Error("Invalid page request."));const t=e-1,s=this.#o.getPageId(e)-1,n=this.#a.get(t);if(n)return n;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:s}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&this.#r.set(r.refStr,s);const a=new yf(t,r,this,this._params.pdfBug);return this.#s.set(t,a),a});return this.#a.set(t,i),i}async getPageIndex(e){if(!Ci(e))throw new Error("Invalid pageIndex request.");const t=await this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen});return this.#o.getPageNumber(t+1)-1}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:this.#o.getPageId(e+1)-1,intent:t})}getFieldObjects(){return this.#l("GetFieldObjects")}hasJSActions(){return this.#l("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return this.#l("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:this.#o.getPageId(e+1)-1})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:this.#o.getPageId(e+1)-1})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#l("GetOptionalContentConfig").then(t=>new Zu(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=this.#t.get(e);if(t)return t;const s=this.messageHandler.sendWithPromise(e,null).then(n=>({info:n[0],metadata:n[1]?new qu(n[1]):null,contentDispositionFilename:this.#e?.filename??null,contentLength:this.#e?.contentLength??null,hasStructTree:n[2]}));return this.#t.set(e,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of this.#s.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#t.clear(),this.filterFactory.destroy(!0),tt.cleanup()}}cachedPageNumber(e){if(!Ci(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`,s=this.#r.get(t);return s>=0?this.#o.getPageNumber(s+1):null}}class wf{_internalRenderTask=null;onContinue=null;onError=null;constructor(e){this._internalRenderTask=e}get promise(){return this._internalRenderTask.capability.promise}cancel(e=0){this._internalRenderTask.cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=this._internalRenderTask.operatorList;if(!e)return!1;const{annotationCanvasMap:t}=this._internalRenderTask;return e.form||e.canvas&&t?.size>0}}class es{#e=null;static#t=new WeakSet;constructor({callback:e,params:t,objs:s,commonObjs:n,annotationCanvasMap:i,operatorList:r,pageIndex:a,canvasFactory:l,filterFactory:c,useRequestAnimationFrame:d=!1,pdfBug:h=!1,pageColors:f=null,enableHWA:p=!1,operationsFilter:b=null}){this.callback=e,this.params=t,this.objs=s,this.commonObjs=n,this.annotationCanvasMap=i,this.operatorListIdx=null,this.operatorList=r,this._pageIndex=a,this.canvasFactory=l,this.filterFactory=c,this._pdfBug=h,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=d===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new wf(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=p,this._dependencyTracker=t.dependencyTracker,this._operationsFilter=b}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(es.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");es.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:s,transform:n,background:i,dependencyTracker:r}=this.params,a=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new rs(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors,r),this.gfx.beginDrawing({transform:n,viewport:s,transparency:e,background:i}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#e&&(window.cancelAnimationFrame(this.#e),this.#e=null),es.#t.delete(this._canvas),e||=new Mn(`Rendering cancelled, page ${this._pageIndex+1}`,t),this.callback(e),this.task.onError?.(e)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#e=window.requestAnimationFrame(()=>{this.#e=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),es.#t.delete(this._canvas),this.callback())))}}const qo="5.4.624",Ko="384c6208b";class it{#e=null;#t=null;#n;#s=null;#a=!1;#r=!1;#i=null;#o;#c=null;#l=null;static#u=null;static get _keyboardManager(){return ue(this,"_keyboardManager",new Hs([[["Escape","mac+Escape"],it.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],it.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],it.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],it.prototype._moveToPrevious],[["Home","mac+Home"],it.prototype._moveToBeginning],[["End","mac+End"],it.prototype._moveToEnd]]))}constructor({editor:e=null,uiManager:t=null}){e?(this.#r=!1,this.#i=e):this.#r=!0,this.#l=e?._uiManager||t,this.#o=this.#l._eventBus,this.#n=e?.color?.toUpperCase()||this.#l?.highlightColors.values().next().value||"#FFFF98",it.#u||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const e=this.#e=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",this.#i&&(e.ariaControls=`${this.#i.id}_colorpicker_dropdown`);const t=this.#l._signal;e.addEventListener("click",this.#m.bind(this),{signal:t}),e.addEventListener("keydown",this.#g.bind(this),{signal:t});const s=this.#t=document.createElement("span");return s.className="swatch",s.ariaHidden="true",s.style.backgroundColor=this.#n,e.append(s),e}renderMainDropdown(){const e=this.#s=this.#h();return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}#h(){const e=document.createElement("div"),t=this.#l._signal;e.addEventListener("contextmenu",at,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#i&&(e.id=`${this.#i.id}_colorpicker_dropdown`);for(const[s,n]of this.#l.highlightColors){const i=document.createElement("button");i.tabIndex="0",i.role="option",i.setAttribute("data-color",n),i.title=s,i.setAttribute("data-l10n-id",it.#u[s]);const r=document.createElement("span");i.append(r),r.className="swatch",r.style.backgroundColor=n,i.ariaSelected=n===this.#n,i.addEventListener("click",this.#f.bind(this,n),{signal:t}),e.append(i)}return e.addEventListener("keydown",this.#g.bind(this),{signal:t}),e}#f(e,t){t.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:ge.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)}_colorSelectFromKeyboard(e){if(e.target===this.#e){this.#m(e);return}const t=e.target.getAttribute("data-color");t&&this.#f(t,e)}_moveToNext(e){if(!this.#p){this.#m(e);return}if(e.target===this.#e){this.#s.firstElementChild?.focus();return}e.target.nextSibling?.focus()}_moveToPrevious(e){if(e.target===this.#s?.firstElementChild||e.target===this.#e){this.#p&&this._hideDropdownFromKeyboard();return}this.#p||this.#m(e),e.target.previousSibling?.focus()}_moveToBeginning(e){if(!this.#p){this.#m(e);return}this.#s.firstElementChild?.focus()}_moveToEnd(e){if(!this.#p){this.#m(e);return}this.#s.lastElementChild?.focus()}#g(e){it._keyboardManager.exec(this,e)}#m(e){if(this.#p){this.hideDropdown();return}if(this.#a=e.detail===0,this.#c||(this.#c=new AbortController,window.addEventListener("pointerdown",this.#d.bind(this),{signal:this.#l.combinedSignal(this.#c)})),this.#e.ariaExpanded="true",this.#s){this.#s.classList.remove("hidden");return}const t=this.#s=this.#h();this.#e.append(t)}#d(e){this.#s?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#s?.classList.add("hidden"),this.#e.ariaExpanded="false",this.#c?.abort(),this.#c=null}get#p(){return this.#s&&!this.#s.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#r){if(!this.#p){this.#i?.unselect();return}this.hideDropdown(),this.#e.focus({preventScroll:!0,focusVisible:this.#a})}}updateColor(e){if(this.#t&&(this.#t.style.backgroundColor=e),!this.#s)return;const t=this.#l.highlightColors.values();for(const s of this.#s.children)s.ariaSelected=t.next().value===e.toUpperCase()}destroy(){this.#e?.remove(),this.#e=null,this.#t=null,this.#s?.remove(),this.#s=null}}class Ds{#e=null;#t=null;#n=null;static#s=null;constructor(e){this.#t=e,this.#n=e._uiManager,Ds.#s||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#e)return this.#e;const{editorType:e,colorType:t,color:s}=this.#t,n=this.#e=document.createElement("input");return n.type="color",n.value=s||"#000000",n.className="basicColorPicker",n.tabIndex=0,n.setAttribute("data-l10n-id",Ds.#s[e]),n.addEventListener("input",()=>{this.#n.updateParams(t,n.value)},{signal:this.#n._signal}),n}update(e){this.#e&&(this.#e.value=e)}destroy(){this.#e?.remove(),this.#e=null}hideDropdown(){}}function oa(o){return Math.floor(Math.max(0,Math.min(1,o))*255).toString(16).padStart(2,"0")}function ws(o){return Math.max(0,Math.min(255,255*o))}class la{static CMYK_G([e,t,s,n]){return["G",1-Math.min(1,.3*e+.59*s+.11*t+n)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=ws(e),[e,e,e]}static G_HTML([e]){const t=oa(e);return`#${t}${t}${t}`}static RGB_G([e,t,s]){return["G",.3*e+.59*t+.11*s]}static RGB_rgb(e){return e.map(ws)}static RGB_HTML(e){return`#${e.map(oa).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,s,n]){return["RGB",1-Math.min(1,e+n),1-Math.min(1,s+n),1-Math.min(1,t+n)]}static CMYK_rgb([e,t,s,n]){return[ws(1-Math.min(1,e+n)),ws(1-Math.min(1,s+n)),ws(1-Math.min(1,t+n))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,s]){const n=1-e,i=1-t,r=1-s,a=Math.min(n,i,r);return["CMYK",n,i,r,a]}}class vf{create(e,t,s=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const n=this._createSVG("svg:svg");return n.setAttribute("version","1.1"),s||(n.setAttribute("width",`${e}px`),n.setAttribute("height",`${t}px`)),n.setAttribute("preserveAspectRatio","none"),n.setAttribute("viewBox",`0 0 ${e} ${t}`),n}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Se("Abstract method `_createSVG` called.")}}class Is extends vf{_createSVG(e){return document.createElementNS(At,e)}}const Af=9,zt=new WeakSet,Sf=new Date().getTimezoneOffset()*60*1e3;class li{static create(e){switch(e.data.annotationType){case je.LINK:return new lr(e);case je.TEXT:return new Ef(e);case je.WIDGET:switch(e.data.fieldType){case"Tx":return new kf(e);case"Btn":return e.data.radioButton?new Zo(e):e.data.checkBox?new Tf(e):new Nf(e);case"Ch":return new Pf(e);case"Sig":return new Cf(e)}return new Wt(e);case je.POPUP:return new Pi(e);case je.FREETEXT:return new Jo(e);case je.LINE:return new Df(e);case je.SQUARE:return new If(e);case je.CIRCLE:return new jf(e);case je.POLYLINE:return new Qo(e);case je.CARET:return new Mf(e);case je.INK:return new cr(e);case je.POLYGON:return new Lf(e);case je.HIGHLIGHT:return new el(e);case je.UNDERLINE:return new Ff(e);case je.SQUIGGLY:return new Of(e);case je.STRIKEOUT:return new Bf(e);case je.STAMP:return new tl(e);case je.FILEATTACHMENT:return new Uf(e);default:return new Ie(e)}}}class Ie{#e=null;#t=!1;#n=null;constructor(e,{isRenderable:t=!1,ignoreBorder:s=!1,createQuadrilaterals:n=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,this.hasOwnCommentButton=!1,t&&(this.contentElement=this.container=this._createContainer(s)),n&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e?.str||t?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Ie._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:e}=this,t=this.annotationStorage?.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const e=this.annotationStorage?.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:s,rect:n}=this.data;let i=-1/0,r=-1/0;if(t?.length>=8){for(let a=0;a<t.length;a+=8)t[a+1]>r?(r=t[a+1],i=t[a+2]):t[a+1]===r&&(i=Math.max(i,t[a+2]));return[i,r]}if(s?.length>=1){for(const a of s)for(let l=0,c=a.length;l<c;l+=2)a[l+1]>r?(r=a[l+1],i=a[l]):a[l+1]===r&&(i=Math.max(i,a[l]));if(i!==1/0)return[i,r]}return n?[n[2],n[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:s,pageHeight:n,pageX:i,pageY:r}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-i)/s,e[1]=100*(e[1]-r)/n,e}get commentText(){const{data:e}=this;return this.annotationStorage.getRawValue(`${Ns}${e.id}`)?.popup?.contents||e.contentsObj?.str||""}set commentText(e){const{data:t}=this,s={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:s})||this.annotationStorage.setValue(`${Ns}${t.id}`,{id:t.id,annotationType:t.annotationType,page:this.parent.page,popup:s,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){(this.#n?.popup||this.popup)?.remove(),this.#n=this.popup=null}updateEdited(e){if(!this.container)return;e.rect&&(this.#e||={rect:this.data.rect.slice(0)});const{rect:t,popup:s}=e;t&&this.#s(t);let n=this.#n?.popup||this.popup;!n&&s?.text&&(this._createPopup(s),n=this.#n.popup),n&&(n.updateEdited(e),s?.deleted&&(n.remove(),this.#n=null,this.popup=null))}resetEdited(){this.#e&&(this.#s(this.#e.rect),this.#n?.popup.resetEdited(),this.#e=null)}#s(e){const{container:{style:t},data:{rect:s,rotation:n},parent:{viewport:{rawDims:{pageWidth:i,pageHeight:r,pageX:a,pageY:l}}}}=this;s?.splice(0,4,...e),t.left=`${100*(e[0]-a)/i}%`,t.top=`${100*(r-e[3]+l)/r}%`,n===0?(t.width=`${100*(e[2]-e[0])/i}%`,t.height=`${100*(e[3]-e[1])/r}%`):this.setRotation(n)}_createContainer(e){const{data:t,parent:{page:s,viewport:n}}=this,i=document.createElement("section");i.setAttribute("data-annotation-id",t.id),!(this instanceof Wt)&&!(this instanceof lr)&&(i.tabIndex=0);const{style:r}=i;if(r.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(i.title=t.alternativeText),t.noRotate&&i.classList.add("norotate"),!t.rect||this instanceof Pi){const{rotation:m}=t;return!t.hasOwnCanvas&&m!==0&&this.setRotation(m,i),i}const{width:a,height:l}=this;if(!e&&t.borderStyle.width>0){r.borderWidth=`${t.borderStyle.width}px`;const m=t.borderStyle.horizontalCornerRadius,y=t.borderStyle.verticalCornerRadius;if(m>0||y>0){const x=`calc(${m}px * var(--total-scale-factor)) / calc(${y}px * var(--total-scale-factor))`;r.borderRadius=x}else if(this instanceof Zo){const x=`calc(${a}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;r.borderRadius=x}switch(t.borderStyle.style){case Kt.SOLID:r.borderStyle="solid";break;case Kt.DASHED:r.borderStyle="dashed";break;case Kt.BEVELED:fe("Unimplemented border style: beveled");break;case Kt.INSET:fe("Unimplemented border style: inset");break;case Kt.UNDERLINE:r.borderBottomStyle="solid";break}const g=t.borderColor||null;g?(this.#t=!0,r.borderColor=se.makeHexColor(g[0]|0,g[1]|0,g[2]|0)):r.borderWidth=0}const c=se.normalizeRect([t.rect[0],s.view[3]-t.rect[1]+s.view[1],t.rect[2],s.view[3]-t.rect[3]+s.view[1]]),{pageWidth:d,pageHeight:h,pageX:f,pageY:p}=n.rawDims;r.left=`${100*(c[0]-f)/d}%`,r.top=`${100*(c[1]-p)/h}%`;const{rotation:b}=t;return t.hasOwnCanvas||b===0?(r.width=`${100*a/d}%`,r.height=`${100*l/h}%`):this.setRotation(b,i),i}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:n}=this.parent.viewport.rawDims;let{width:i,height:r}=this;e%180!==0&&([i,r]=[r,i]),t.style.width=`${100*i/s}%`,t.style.height=`${100*r/n}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,s,n)=>{const i=n.detail[t],r=i[0],a=i.slice(1);n.target.style[s]=la[`${r}_HTML`](a),this.annotationStorage.setValue(this.data.id,{[s]:la[`${r}_rgb`](a)})};return ue(this,"_commonActions",{display:t=>{const{display:s}=t.detail,n=s%2===1;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:n,noPrint:s===1||s===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:s}=t.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const s=t.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(e,t){const s=this._commonActions;for(const n of Object.keys(t.detail))(e[n]||s[n])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const s=this._commonActions;for(const[n,i]of Object.entries(t)){const r=s[n];if(r){const a={detail:{[n]:i},target:e};r(a),delete t[n]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,s,n,i]=this.data.rect.map(m=>Math.fround(m));if(e.length===8){const[m,y,g,x]=e.subarray(2,6);if(n===m&&i===y&&t===g&&s===x)return}const{style:r}=this.container;let a;if(this.#t){const{borderColor:m,borderWidth:y}=r;r.borderWidth=0,a=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${m}" stroke-width="${y}">`],this.container.classList.add("hasBorder")}const l=n-t,c=i-s,{svgFactory:d}=this,h=d.createElement("svg");h.classList.add("quadrilateralsContainer"),h.setAttribute("width",0),h.setAttribute("height",0),h.role="none";const f=d.createElement("defs");h.append(f);const p=d.createElement("clipPath"),b=`clippath_${this.data.id}`;p.setAttribute("id",b),p.setAttribute("clipPathUnits","objectBoundingBox"),f.append(p);for(let m=2,y=e.length;m<y;m+=8){const g=e[m],x=e[m+1],w=e[m+2],v=e[m+3],_=d.createElement("rect"),E=(w-t)/l,k=(i-x)/c,D=(g-w)/l,N=(x-v)/c;_.setAttribute("x",E),_.setAttribute("y",k),_.setAttribute("width",D),_.setAttribute("height",N),p.append(_),a?.push(`<rect vector-effect="non-scaling-stroke" x="${E}" y="${k}" width="${D}" height="${N}"/>`)}this.#t&&(a.push("</g></svg>')"),r.backgroundImage=a.join("")),this.container.append(h),this.container.style.clipPath=`url(#${b})`}_createPopup(e=null){const{data:t}=this;let s,n;e?(s={str:e.text},n=e.date):(s=t.contentsObj,n=t.modificationDate),this.#n=new Pi({data:{color:t.color,titleObj:t.titleObj,modificationDate:n,contentsObj:s,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]})}get hasPopupElement(){return!!(this.#n||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#n}render(){Se("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const s=[];if(this._fieldObjects){const n=this._fieldObjects[e];if(n)for(const{page:i,id:r,exportValues:a}of n){if(i===-1||r===t)continue;const l=typeof a=="string"?a:null,c=document.querySelector(`[data-element-id="${r}"]`);if(c&&!zt.has(c)){fe(`_getElementsByName - element not allowed: ${r}`);continue}s.push({id:r,exportValue:l,domElement:c})}return s}for(const n of document.getElementsByName(e)){const{exportValue:i}=n,r=n.getAttribute("data-element-id");r!==t&&zt.has(n)&&s.push({id:r,exportValue:i,domElement:n})}return s}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class _f extends Ie{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&this._createPopup(e.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}class lr extends Ie{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:t}=this,s=document.createElement("a");s.setAttribute("data-element-id",e.id);let n=!1;return e.url?(t.addLinkAttributes(s,e.url,e.newWindow),n=!0):e.action?(this._bindNamedAction(s,e.action,e.overlaidText),n=!0):e.attachment?(this.#t(s,e.attachment,e.overlaidText,e.attachmentDest),n=!0):e.setOCGState?(this.#n(s,e.setOCGState,e.overlaidText),n=!0):e.dest?(this._bindLink(s,e.dest,e.overlaidText),n=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,e),n=!0),e.resetForm?(this._bindResetFormAction(s,e.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(s,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&(this.contentElement=s,this.container.append(s)),this.container}#e(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t,s=""){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||t==="")&&this.#e(),s&&(e.title=s)}_bindNamedAction(e,t,s=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),s&&(e.title=s),this.#e()}#t(e,t,s="",n=null){e.href=this.linkService.getAnchorUrl(""),t.description?e.title=t.description:s&&(e.title=s),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,n),!1),this.#e()}#n(e,t,s=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),s&&(e.title=s),this.#e()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(t.actions)){const i=s.get(n);i&&(e[i]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:n}}),!1))}t.overlaidText&&(e.title=t.overlaidText),e.onclick||(e.onclick=()=>!1),this.#e()}_bindResetFormAction(e,t){const s=e.onclick;if(s||(e.href=this.linkService.getAnchorUrl("")),this.#e(),!this._fieldObjects){fe('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(e.onclick=()=>!1);return}e.onclick=()=>{s?.();const{fields:n,refs:i,include:r}=t,a=[];if(n.length!==0||i.length!==0){const d=new Set(i);for(const h of n){const f=this._fieldObjects[h]||[];for(const{id:p}of f)d.add(p)}for(const h of Object.values(this._fieldObjects))for(const f of h)d.has(f.id)===r&&a.push(f)}else for(const d of Object.values(this._fieldObjects))a.push(...d);const l=this.annotationStorage,c=[];for(const d of a){const{id:h}=d;switch(c.push(h),d.type){case"text":{const p=d.defaultValue||"";l.setValue(h,{value:p});break}case"checkbox":case"radiobutton":{const p=d.defaultValue===d.exportValues;l.setValue(h,{value:p});break}case"combobox":case"listbox":{const p=d.defaultValue||"";l.setValue(h,{value:p});break}default:continue}const f=document.querySelector(`[data-element-id="${h}"]`);if(f){if(!zt.has(f)){fe(`_bindResetFormAction - element not allowed: ${h}`);continue}}else continue;f.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:c,name:"ResetForm"}}),!1}}}class Ef extends Ie{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(e),this.container}}class Wt extends Ie{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Oe.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,s,n,i){s.includes("mouse")?e.addEventListener(s,r=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:i(r),shift:r.shiftKey,modifier:this._getKeyModifier(r)}})}):e.addEventListener(s,r=>{if(s==="blur"){if(!t.focused||!r.relatedTarget)return;t.focused=!1}else if(s==="focus"){if(t.focused)return;t.focused=!0}i&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:n,value:i(r)}})})}_setEventListeners(e,t,s,n){for(const[i,r]of s)(r==="Action"||this.data.actions?.[r])&&((r==="Focus"||r==="Blur")&&(t||={focused:!1}),this._setEventListener(e,t,i,r,n),r==="Focus"&&!this.data.actions?.Blur?this._setEventListener(e,t,"blur","Blur",null):r==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":se.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,n=this.data.defaultAppearanceData.fontSize||Af,i=e.style;let r;const a=2,l=c=>Math.round(10*c)/10;if(this.data.multiLine){const c=Math.abs(this.data.rect[3]-this.data.rect[1]-a),d=Math.round(c/(ti*n))||1,h=c/d;r=Math.min(n,l(h/ti))}else{const c=Math.abs(this.data.rect[3]-this.data.rect[1]-a);r=Math.min(n,l(c/ti))}i.fontSize=`calc(${r}px * var(--total-scale-factor))`,i.color=se.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(i.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class kf extends Wt{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,s,n){const i=this.annotationStorage;for(const r of this._getElementsByName(e.name,e.id))r.domElement&&(r.domElement[t]=s),i.setValue(r.id,{[n]:s})}render(){const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const n=e.getValue(t,{value:this.data.fieldValue});let i=n.value||"";const r=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;r&&i.length>r&&(i=i.slice(0,r));let a=n.formattedValue||this.data.textContent?.join(`
`)||null;a&&this.data.comb&&(a=a.replaceAll(/\s+/g,""));const l={userValue:i,formattedValue:a,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=a??i,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",a??i),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),zt.add(s),this.contentElement=s,s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=0;const{datetimeFormat:c,datetimeType:d,timeStep:h}=this.data,f=!!d&&this.enableScripting;c&&(s.title=c),this._setRequired(s,this.data.required),r&&(s.maxLength=r),s.addEventListener("input",b=>{e.setValue(t,{value:b.target.value}),this.setPropertyOnSiblings(s,"value",b.target.value,"value"),l.formattedValue=null}),s.addEventListener("resetform",b=>{const m=this.data.defaultFieldValue??"";s.value=l.userValue=m,l.formattedValue=null});let p=b=>{const{formattedValue:m}=l;m!=null&&(b.target.value=m),b.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",m=>{if(l.focused)return;const{target:y}=m;if(f&&(y.type=d,h&&(y.step=h)),l.userValue){const g=l.userValue;if(f)if(d==="time"){const x=new Date(g),w=[x.getHours(),x.getMinutes(),x.getSeconds()];y.value=w.map(v=>v.toString().padStart(2,"0")).join(":")}else y.value=new Date(g-Sf).toISOString().split(d==="date"?"T":".",1)[0];else y.value=g}l.lastCommittedValue=y.value,l.commitKey=1,this.data.actions?.Focus||(l.focused=!0)}),s.addEventListener("updatefromsandbox",m=>{this.showElementAndHideCanvas(m.target);const y={value(g){l.userValue=g.detail.value??"",f||e.setValue(t,{value:l.userValue.toString()}),g.target.value=l.userValue},formattedValue(g){const{formattedValue:x}=g.detail;l.formattedValue=x,x!=null&&g.target!==document.activeElement&&(g.target.value=x);const w={formattedValue:x};f&&(w.value=x),e.setValue(t,w)},selRange(g){g.target.setSelectionRange(...g.detail.selRange)},charLimit:g=>{const{charLimit:x}=g.detail,{target:w}=g;if(x===0){w.removeAttribute("maxLength");return}w.setAttribute("maxLength",x);let v=l.userValue;!v||v.length<=x||(v=v.slice(0,x),w.value=l.userValue=v,e.setValue(t,{value:v}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:v,willCommit:!0,commitKey:1,selStart:w.selectionStart,selEnd:w.selectionEnd}}))}};this._dispatchEventFromSandbox(y,m)}),s.addEventListener("keydown",m=>{l.commitKey=1;let y=-1;if(m.key==="Escape"?y=0:m.key==="Enter"&&!this.data.multiLine?y=2:m.key==="Tab"&&(l.commitKey=3),y===-1)return;const{value:g}=m.target;l.lastCommittedValue!==g&&(l.lastCommittedValue=g,l.userValue=g,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:g,willCommit:!0,commitKey:y,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}))});const b=p;p=null,s.addEventListener("blur",m=>{if(!l.focused||!m.relatedTarget)return;this.data.actions?.Blur||(l.focused=!1);const{target:y}=m;let{value:g}=y;if(f){if(g&&d==="time"){const x=g.split(":").map(w=>parseInt(w,10));g=new Date(2e3,0,1,x[0],x[1],x[2]||0).valueOf(),y.step=""}else g.includes("T")||(g=`${g}T00:00`),g=new Date(g).valueOf();y.type="text"}l.userValue=g,l.lastCommittedValue!==g&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:g,willCommit:!0,commitKey:l.commitKey,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}),b(m)}),this.data.actions?.Keystroke&&s.addEventListener("beforeinput",m=>{l.lastCommittedValue=null;const{data:y,target:g}=m,{value:x,selectionStart:w,selectionEnd:v}=g;let _=w,E=v;switch(m.inputType){case"deleteWordBackward":{const k=x.substring(0,w).match(/\w*[^\w]*$/);k&&(_-=k[0].length);break}case"deleteWordForward":{const k=x.substring(w).match(/^[^\w]*\w*/);k&&(E+=k[0].length);break}case"deleteContentBackward":w===v&&(_-=1);break;case"deleteContentForward":w===v&&(E+=1);break}m.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:x,change:y||"",willCommit:!1,selStart:_,selEnd:E}})}),this._setEventListeners(s,l,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],m=>m.target.value)}if(p&&s.addEventListener("blur",p),this.data.comb){const m=(this.data.rect[2]-this.data.rect[0])/r;s.classList.add("comb"),s.style.letterSpacing=`calc(${m}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class Cf extends Wt{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class Tf extends Wt{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,s=t.id;let n=e.getValue(s,{value:t.exportValue===t.fieldValue}).value;typeof n=="string"&&(n=n!=="Off",e.setValue(s,{value:n})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const i=document.createElement("input");return zt.add(i),i.setAttribute("data-element-id",s),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="checkbox",i.name=t.fieldName,n&&i.setAttribute("checked",!0),i.setAttribute("exportValue",t.exportValue),i.tabIndex=0,i.addEventListener("change",r=>{const{name:a,checked:l}=r.target;for(const c of this._getElementsByName(a,s)){const d=l&&c.exportValue===t.exportValue;c.domElement&&(c.domElement.checked=d),e.setValue(c.id,{value:d})}e.setValue(s,{value:l})}),i.addEventListener("resetform",r=>{const a=t.defaultFieldValue||"Off";r.target.checked=a===t.exportValue}),this.enableScripting&&this.hasJSActions&&(i.addEventListener("updatefromsandbox",r=>{const a={value(l){l.target.checked=l.detail.value!=="Off",e.setValue(s,{value:l.target.checked})}};this._dispatchEventFromSandbox(a,r)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],r=>r.target.checked)),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class Zo extends Wt{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,s=t.id;let n=e.getValue(s,{value:t.fieldValue===t.buttonValue}).value;if(typeof n=="string"&&(n=n!==t.buttonValue,e.setValue(s,{value:n})),n)for(const r of this._getElementsByName(t.fieldName,s))e.setValue(r.id,{value:!1});const i=document.createElement("input");if(zt.add(i),i.setAttribute("data-element-id",s),i.disabled=t.readOnly,this._setRequired(i,this.data.required),i.type="radio",i.name=t.fieldName,n&&i.setAttribute("checked",!0),i.tabIndex=0,i.addEventListener("change",r=>{const{name:a,checked:l}=r.target;for(const c of this._getElementsByName(a,s))e.setValue(c.id,{value:!1});e.setValue(s,{value:l})}),i.addEventListener("resetform",r=>{const a=t.defaultFieldValue;r.target.checked=a!=null&&a===t.buttonValue}),this.enableScripting&&this.hasJSActions){const r=t.buttonValue;i.addEventListener("updatefromsandbox",a=>{const l={value:c=>{const d=r===c.detail.value;for(const h of this._getElementsByName(c.target.name)){const f=d&&h.id===s;h.domElement&&(h.domElement.checked=f),e.setValue(h.id,{value:f})}}};this._dispatchEventFromSandbox(l,a)}),this._setEventListeners(i,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)}return this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class Nf extends lr{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),e}}class Pf extends Wt{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,s=e.getValue(t,{value:this.data.fieldValue}),n=document.createElement("select");zt.add(n),n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,this._setRequired(n,this.data.required),n.name=this.data.fieldName,n.tabIndex=0;let i=this.data.combo&&this.data.options.length>0;this.data.combo||(n.size=this.data.options.length,this.data.multiSelect&&(n.multiple=!0)),n.addEventListener("resetform",d=>{const h=this.data.defaultFieldValue;for(const f of n.options)f.selected=f.value===h});for(const d of this.data.options){const h=document.createElement("option");h.textContent=d.displayValue,h.value=d.exportValue,s.value.includes(d.exportValue)&&(h.setAttribute("selected",!0),i=!1),n.append(h)}let r=null;if(i){const d=document.createElement("option");d.value=" ",d.setAttribute("hidden",!0),d.setAttribute("selected",!0),n.prepend(d),r=()=>{d.remove(),n.removeEventListener("input",r),r=null},n.addEventListener("input",r)}const a=d=>{const h=d?"value":"textContent",{options:f,multiple:p}=n;return p?Array.prototype.filter.call(f,b=>b.selected).map(b=>b[h]):f.selectedIndex===-1?null:f[f.selectedIndex][h]};let l=a(!1);const c=d=>{const h=d.target.options;return Array.prototype.map.call(h,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(n.addEventListener("updatefromsandbox",d=>{const h={value(f){r?.();const p=f.detail.value,b=new Set(Array.isArray(p)?p:[p]);for(const m of n.options)m.selected=b.has(m.value);e.setValue(t,{value:a(!0)}),l=a(!1)},multipleSelection(f){n.multiple=!0},remove(f){const p=n.options,b=f.detail.remove;p[b].selected=!1,n.remove(b),p.length>0&&Array.prototype.findIndex.call(p,y=>y.selected)===-1&&(p[0].selected=!0),e.setValue(t,{value:a(!0),items:c(f)}),l=a(!1)},clear(f){for(;n.length!==0;)n.remove(0);e.setValue(t,{value:null,items:[]}),l=a(!1)},insert(f){const{index:p,displayValue:b,exportValue:m}=f.detail.insert,y=n.children[p],g=document.createElement("option");g.textContent=b,g.value=m,y?y.before(g):n.append(g),e.setValue(t,{value:a(!0),items:c(f)}),l=a(!1)},items(f){const{items:p}=f.detail;for(;n.length!==0;)n.remove(0);for(const b of p){const{displayValue:m,exportValue:y}=b,g=document.createElement("option");g.textContent=m,g.value=y,n.append(g)}n.options.length>0&&(n.options[0].selected=!0),e.setValue(t,{value:a(!0),items:c(f)}),l=a(!1)},indices(f){const p=new Set(f.detail.indices);for(const b of f.target.options)b.selected=p.has(b.index);e.setValue(t,{value:a(!0)}),l=a(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(h,d)}),n.addEventListener("input",d=>{const h=a(!0),f=a(!1);e.setValue(t,{value:h}),d.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:l,change:f,changeEx:h,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(n,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],d=>d.target.value)):n.addEventListener("input",function(d){e.setValue(t,{value:a(!0)})}),this.data.combo&&this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class Pi extends Ie{constructor(e){const{data:t,elements:s,parent:n}=e,i=!!n._commentManager;if(super(e,{isRenderable:!i&&Ie._hasPopupData(t)}),this.elements=s,i&&Ie._hasPopupData(t)){const r=this.popup=this.#e();for(const a of s)a.popup=r}else this.popup=null}#e(){return new Rf({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:e}=this;e.classList.add("popupAnnotation"),e.role="comment";const t=this.popup=this.#e(),s=[];for(const n of this.elements)n.popup=t,n.container.ariaHasPopup="dialog",s.push(n.data.id),n.addHighlightArea();return this.container.setAttribute("aria-controls",s.map(n=>`${Jt}${n}`).join(",")),this.container}}class Rf{#e=null;#t=this.#W.bind(this);#n=this.#B.bind(this);#s=this.#I.bind(this);#a=this.#A.bind(this);#r=null;#i=null;#o=null;#c=null;#l=null;#u=null;#h=null;#f=!1;#g=null;#m=null;#d=null;#p=null;#b=null;#x=null;#y=null;#E=null;#S=null;#v=null;#C=!1;#w=null;#_=null;constructor({container:e,color:t,elements:s,titleObj:n,modificationDate:i,contentsObj:r,richText:a,parent:l,rect:c,parentRect:d,open:h,commentManager:f=null}){this.#i=e,this.#S=n,this.#o=r,this.#E=a,this.#u=l,this.#r=t,this.#y=c,this.#h=d,this.#l=s,this.#e=f,this.#w=s[0],this.#c=wn.toDateObject(i),this.trigger=s.flatMap(p=>p.getElementsToTriggerPopup()),f||(this.#P(),this.#i.hidden=!0,h&&this.#A())}#P(){if(this.#m)return;this.#m=new AbortController;const{signal:e}=this.#m;for(const t of this.trigger)t.addEventListener("click",this.#a,{signal:e}),t.addEventListener("pointerenter",this.#s,{signal:e}),t.addEventListener("pointerleave",this.#n,{signal:e}),t.classList.add("popupTriggerArea");for(const t of this.#l)t.container?.addEventListener("keydown",this.#t,{signal:e})}#T(){const e=this.#l.find(t=>t.hasCommentButton);e&&(this.#b=e._normalizePoint(e.commentButtonPosition))}renderCommentButton(){if(this.#p){this.#p.parentNode||this.#w.container.after(this.#p);return}if(this.#b||this.#T(),!this.#b)return;const{signal:e}=this.#m=new AbortController,t=this.#w.hasOwnCommentButton,s=()=>{this.#e.toggleCommentPopup(this,!0,void 0,!t)},n=()=>{this.#e.toggleCommentPopup(this,!1,!0,!t)},i=()=>{this.#e.toggleCommentPopup(this,!1,!1)};if(t){this.#p=this.#w.container;for(const r of this.trigger)r.ariaHasPopup="dialog",r.ariaControls="commentPopup",r.addEventListener("keydown",this.#t,{signal:e}),r.addEventListener("click",s,{signal:e}),r.addEventListener("pointerenter",n,{signal:e}),r.addEventListener("pointerleave",i,{signal:e}),r.classList.add("popupTriggerArea")}else{const r=this.#p=document.createElement("button");r.className="annotationCommentButton";const a=this.#w.container;r.style.zIndex=a.style.zIndex+1,r.tabIndex=0,r.ariaHasPopup="dialog",r.ariaControls="commentPopup",r.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#F(),this.#N(),r.addEventListener("keydown",this.#t,{signal:e}),r.addEventListener("click",s,{signal:e}),r.addEventListener("pointerenter",n,{signal:e}),r.addEventListener("pointerleave",i,{signal:e}),a.after(r)}}#N(){if(this.#w.extraPopupElement&&!this.#w.editor)return;this.#p||this.renderCommentButton();const[e,t]=this.#b,{style:s}=this.#p;s.left=`calc(${e}%)`,s.top=`calc(${t}% - var(--comment-button-dim))`}#F(){this.#w.extraPopupElement||(this.#p||this.renderCommentButton(),this.#p.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:e,opacity:t}=this.#w.commentData;return e?this.#u._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{this.#p?.focus()},0)}getData(){const{richText:e,color:t,opacity:s,creationDate:n,modificationDate:i}=this.#w.commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:s,creationDate:n,modificationDate:i}}get elementBeforePopup(){return this.#p}get comment(){return this.#_||=this.#w.commentText,this.#_}set comment(e){e!==this.comment&&(this.#w.commentText=this.#_=e)}focus(){this.#w.container?.focus()}get parentBoundingClientRect(){return this.#w.layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:t}){this.#p&&(this.#p.classList.toggle("selected",e),this.#p.ariaExpanded=t)}setSelectedCommentButton(e){this.#p.classList.toggle("selected",e)}get commentPopupPosition(){if(this.#x)return this.#x;const{x:e,y:t,height:s}=this.#p.getBoundingClientRect(),{x:n,y:i,width:r,height:a}=this.#w.layer.getBoundingClientRect();return[(e-n)/r,(t+s-i)/a]}set commentPopupPosition(e){this.#x=e}hasDefaultPopupPosition(){return this.#x===null}get commentButtonPosition(){return this.#b}get commentButtonWidth(){return this.#p.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,s]=this.#x||this.commentButtonPosition.map(c=>c/100),n=this.parentBoundingClientRect,{x:i,y:r,width:a,height:l}=n;this.#e.showDialog(null,this,i+t*a,r+s*l,{...e,parentDimensions:n})}render(){if(this.#g)return;const e=this.#g=document.createElement("div");if(e.className="popup",this.#r){const s=e.style.outlineColor=se.makeHexColor(...this.#r);e.style.backgroundColor=`color-mix(in srgb, ${s} 30%, white)`}const t=document.createElement("span");if(t.className="header",this.#S?.str){const s=document.createElement("span");s.className="title",t.append(s),{dir:s.dir,str:s.textContent}=this.#S}if(e.append(t),this.#c){const s=document.createElement("time");s.className="popupDate",s.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),s.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#c.valueOf()})),s.dateTime=this.#c.toISOString(),t.append(s)}Qi({html:this.#D||this.#o.str,dir:this.#o?.dir,className:"popupContent"},e),this.#i.append(e)}get#D(){const e=this.#E,t=this.#o;return e?.str&&(!t?.str||t.str===e.str)&&this.#E.html||null}get#j(){return this.#D?.attributes?.style?.fontSize||0}get#O(){return this.#D?.attributes?.style?.color||null}#L(e){const t=[],s={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},n={style:{color:this.#O,fontSize:this.#j?`calc(${this.#j}px * var(--total-scale-factor))`:""}};for(const i of e.split(`
`))t.push({name:"span",value:i,attributes:n});return s}#W(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&this.#f)&&this.#A()}updateEdited({rect:e,popup:t,deleted:s}){if(this.#e){s?(this.remove(),this.#_=null):t&&(t.deleted?this.remove():(this.#F(),this.#_=t.text)),e&&(this.#b=null,this.#T(),this.#N());return}if(s||t?.deleted){this.remove();return}this.#P(),this.#v||={contentsObj:this.#o,richText:this.#E},e&&(this.#d=null),t&&t.text&&(this.#E=this.#L(t.text),this.#c=wn.toDateObject(t.date),this.#o=null),this.#g?.remove(),this.#g=null}resetEdited(){this.#v&&({contentsObj:this.#o,richText:this.#E}=this.#v,this.#v=null,this.#g?.remove(),this.#g=null,this.#d=null)}remove(){if(this.#m?.abort(),this.#m=null,this.#g?.remove(),this.#g=null,this.#C=!1,this.#f=!1,this.#p?.remove(),this.#p=null,this.trigger)for(const e of this.trigger)e.classList.remove("popupTriggerArea")}#k(){if(this.#d!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:s,pageX:n,pageY:i}}}=this.#u;let r=!!this.#h,a=r?this.#h:this.#y;for(const b of this.#l)if(!a||se.intersect(b.data.rect,a)!==null){a=b.data.rect,r=!0;break}const l=se.normalizeRect([a[0],e[3]-a[1]+e[1],a[2],e[3]-a[3]+e[1]]),d=r?a[2]-a[0]+5:0,h=l[0]+d,f=l[1];this.#d=[100*(h-n)/t,100*(f-i)/s];const{style:p}=this.#i;p.left=`${this.#d[0]}%`,p.top=`${this.#d[1]}%`}#A(){if(this.#e){this.#e.toggleCommentPopup(this,!1);return}this.#f=!this.#f,this.#f?(this.#I(),this.#i.addEventListener("click",this.#a),this.#i.addEventListener("keydown",this.#t)):(this.#B(),this.#i.removeEventListener("click",this.#a),this.#i.removeEventListener("keydown",this.#t))}#I(){this.#g||this.render(),this.isVisible?this.#f&&this.#i.classList.add("focused"):(this.#k(),this.#i.hidden=!1,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)+1e3)}#B(){this.#i.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#i.hidden=!0,this.#i.style.zIndex=parseInt(this.#i.style.zIndex)-1e3)}forceHide(){this.#C=this.isVisible,this.#C&&(this.#i.hidden=!0)}maybeShow(){this.#e||(this.#P(),this.#C&&(this.#g||this.#I(),this.#C=!1,this.#i.hidden=!1))}get isVisible(){return this.#e?!1:this.#i.hidden===!1}}class Jo extends Ie{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=pe.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=this.contentElement=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const s=document.createElement("span");s.textContent=t,e.append(s)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class Df extends Ie{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:e,width:t,height:s}=this,n=this.svgFactory.create(t,s,!0),i=this.#e=this.svgFactory.createElement("svg:line");return i.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),i.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),i.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),i.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),i.setAttribute("stroke-width",e.borderStyle.width||1),i.setAttribute("stroke","transparent"),i.setAttribute("fill","transparent"),n.append(i),this.container.append(n),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class If extends Ie{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:e,width:t,height:s}=this,n=this.svgFactory.create(t,s,!0),i=e.borderStyle.width,r=this.#e=this.svgFactory.createElement("svg:rect");return r.setAttribute("x",i/2),r.setAttribute("y",i/2),r.setAttribute("width",t-i),r.setAttribute("height",s-i),r.setAttribute("stroke-width",i||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),n.append(r),this.container.append(n),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class jf extends Ie{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:e,width:t,height:s}=this,n=this.svgFactory.create(t,s,!0),i=e.borderStyle.width,r=this.#e=this.svgFactory.createElement("svg:ellipse");return r.setAttribute("cx",t/2),r.setAttribute("cy",s/2),r.setAttribute("rx",t/2-i/2),r.setAttribute("ry",s/2-i/2),r.setAttribute("stroke-width",i||1),r.setAttribute("stroke","transparent"),r.setAttribute("fill","transparent"),n.append(r),this.container.append(n),!e.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Qo extends Ie{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:t,borderStyle:s,popupRef:n},width:i,height:r}=this;if(!t)return this.container;const a=this.svgFactory.create(i,r,!0);let l=[];for(let d=0,h=t.length;d<h;d+=2){const f=t[d]-e[0],p=e[3]-t[d+1];l.push(`${f},${p}`)}l=l.join(" ");const c=this.#e=this.svgFactory.createElement(this.svgElementName);return c.setAttribute("points",l),c.setAttribute("stroke-width",s.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),a.append(c),this.container.append(a),!n&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Lf extends Qo{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Mf extends Ie{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}class cr extends Ie{#e=null;#t=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?pe.HIGHLIGHT:pe.INK}#n(e,t){switch(e){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:t,inkLists:s,borderStyle:n,popupRef:i}}=this,{transform:r,width:a,height:l}=this.#n(t,e),c=this.svgFactory.create(a,l,!0),d=this.#e=this.svgFactory.createElement("svg:g");c.append(d),d.setAttribute("stroke-width",n.width||1),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.setAttribute("stroke-miterlimit",10),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),d.setAttribute("transform",r);for(let h=0,f=s.length;h<f;h++){const p=this.svgFactory.createElement(this.svgElementName);this.#t.push(p),p.setAttribute("points",s[h].join(",")),d.append(p)}return!i&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:t,points:s,rect:n}=e,i=this.#e;if(t>=0&&i.setAttribute("stroke-width",t||1),s)for(let r=0,a=this.#t.length;r<a;r++)this.#t[r].setAttribute("points",s[r].join(","));if(n){const{transform:r,width:a,height:l}=this.#n(this.data.rotation,n);i.parentElement.setAttribute("viewBox",`0 0 ${a} ${l}`),i.setAttribute("transform",r)}}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class el extends Ie{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=pe.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const s=document.createElement("mark");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class Ff extends Ie{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),e){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class Of extends Ie{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),e){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class Bf extends Ie{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),e){const s=document.createElement("s");s.classList.add("overlaidText"),s.textContent=e,this.container.append(s)}return this.container}}class tl extends Ie{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=pe.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}class Uf extends Ie{#e=null;constructor(e){super(e,{isRenderable:!0});const{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...t})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:t}=this;let s;t.hasAppearance||t.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(t.fillAlpha*100)}%);`)),s.addEventListener("dblclick",this.#t.bind(this)),this.#e=s;const{isMac:n}=Oe.platform;return e.addEventListener("keydown",i=>{i.key==="Enter"&&(n?i.metaKey:i.ctrlKey)&&this.#t()}),!t.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):s.classList.add("popupTriggerArea"),e.append(s),e}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}#t(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}class $n{#e=null;#t=null;#n=null;#s=new Map;#a=null;#r=null;#i=[];#o=!1;constructor({div:e,accessibilityManager:t,annotationCanvasMap:s,annotationEditorUIManager:n,page:i,viewport:r,structTreeLayer:a,commentManager:l,linkService:c,annotationStorage:d}){this.div=e,this.#e=t,this.#t=s,this.#a=a||null,this.#r=c||null,this.#n=d||new sr,this.page=i,this.viewport=r,this.zIndex=0,this._annotationEditorUIManager=n,this._commentManager=l||null}hasEditableAnnotations(){return this.#s.size>0}async render(e){const{annotations:t}=e,s=this.div;Lt(s,this.viewport);const n=new Map,i=[],r={data:null,layer:s,linkService:this.#r,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new Is,annotationStorage:this.#n,enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const a of t){if(a.noHTML)continue;const l=a.annotationType===je.POPUP;if(l){const h=n.get(a.id);if(!h)continue;if(!this._commentManager){i.push(a);continue}r.elements=h}else if(a.rect[2]===a.rect[0]||a.rect[3]===a.rect[1])continue;r.data=a;const c=li.create(r);if(!c.isRenderable)continue;if(!l&&(this.#i.push(c),a.popupRef)){const h=n.get(a.popupRef);h?h.push(c):n.set(a.popupRef,[c])}const d=c.render();a.hidden&&(d.style.visibility="hidden"),c._isEditable&&(this.#s.set(c.data.id,c),this._annotationEditorUIManager?.renderAnnotationElement(c))}await this.#c();for(const a of i){const l=r.elements=n.get(a.id);r.data=a;const c=li.create(r);if(!c.isRenderable)continue;const d=c.render();c.contentElement.id=`${Jt}${a.id}`,a.hidden&&(d.style.visibility="hidden"),l.at(-1).container.after(d)}this.#l()}async#c(){if(this.#i.length===0)return;this.div.replaceChildren();const e=[];if(!this.#o){this.#o=!0;for(const{contentElement:s,data:{id:n}}of this.#i){const i=s.id=`${Jt}${n}`;e.push(this.#a?.getAriaAttributes(i).then(r=>{if(r)for(const[a,l]of r)s.setAttribute(a,l)}))}}this.#i.sort(({data:{rect:[s,n,i,r]}},{data:{rect:[a,l,c,d]}})=>{if(s===i&&n===r)return 1;if(a===c&&l===d)return-1;const h=r,f=n,p=(n+r)/2,b=d,m=l,y=(l+d)/2;if(p>=b&&y<=f)return-1;if(y>=h&&p<=m)return 1;const g=(s+i)/2,x=(a+c)/2;return g-x});const t=document.createDocumentFragment();for(const s of this.#i)t.append(s.container),this._commentManager?(s.extraPopupElement?.popup||s.popup)?.renderCommentButton():s.extraPopupElement&&t.append(s.extraPopupElement.render());if(this.div.append(t),await Promise.all(e),this.#e)for(const s of this.#i)this.#e.addPointerInTextLayer(s.contentElement,!1)}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:this.#r,svgFactory:new Is,parent:this};for(const s of e){s.borderStyle||=$n._defaultBorderStyle,t.data=s;const n=li.create(t);n.isRenderable&&(n.render(),n.contentElement.id=`${Jt}${s.id}`,this.#i.push(n))}await this.#c()}update({viewport:e}){const t=this.div;this.viewport=e,Lt(t,{rotation:e.rotation}),this.#l(),t.hidden=!1}#l(){if(!this.#t)return;const e=this.div;for(const[t,s]of this.#t){const n=e.querySelector(`[data-annotation-id="${t}"]`);if(!n)continue;s.className="annotationContent";const{firstChild:i}=n;i?i.nodeName==="CANVAS"?i.replaceWith(s):i.classList.contains("annotationContent")?i.after(s):i.before(s):n.append(s);const r=this.#s.get(t);r&&(r._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(t,n.id,s),r._hasNoCanvas=!1):r.canvas=s)}this.#t.clear()}getEditableAnnotations(){return Array.from(this.#s.values())}getEditableAnnotation(e){return this.#s.get(e)}addFakeAnnotation(e){const{div:t}=this,{id:s,rotation:n}=e,i=new _f({data:{id:s,rect:e.getPDFRect(),rotation:n},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:this.#r,annotationStorage:this.#n});return i.render(),i.contentElement.id=`${Jt}${s}`,i.createOrUpdatePopup(),this.#i.push(i),i}removeAnnotation(e){const t=this.#i.findIndex(n=>n.data.id===e);if(t<0)return;const[s]=this.#i.splice(t,1);this.#e?.removePointerInTextLayer(s.contentElement)}updateFakeAnnotations(e){if(e.length!==0){for(const t of e)t.updateFakeAnnotationElement(this);this.#c()}}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}static get _defaultBorderStyle(){return ue(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Kt.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}}const an=/\r\n?|\n/g;class ze extends de{#e="";#t=`${this.id}-editor`;#n=null;#s;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const e=ze.prototype,t=i=>i.isEmpty(),s=Tt.TRANSLATE_SMALL,n=Tt.TRANSLATE_BIG;return ue(this,"_keyboardManager",new Hs([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-n,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[n,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-n],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,n],checker:t}]]))}static _type="freetext";static _editorType=pe.FREETEXT;constructor(e){super({...e,name:"freeTextEditor"}),this.color=e.color||ze._defaultColor||de._defaultLineColor,this.#s=e.fontSize||ze._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static initialize(e,t){de.initialize(e,t);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case ge.FREETEXT_SIZE:ze._defaultFontSize=t;break;case ge.FREETEXT_COLOR:ze._defaultColor=t;break}}updateParams(e,t){switch(e){case ge.FREETEXT_SIZE:this.#a(t);break;case ge.FREETEXT_COLOR:this.#r(t);break}}static get defaultPropertiesToUpdate(){return[[ge.FREETEXT_SIZE,ze._defaultFontSize],[ge.FREETEXT_COLOR,ze._defaultColor||de._defaultLineColor]]}get propertiesToUpdate(){return[[ge.FREETEXT_SIZE,this.#s],[ge.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new Ds(this),[["colorPicker",this._colorPicker]]}get colorType(){return ge.FREETEXT_COLOR}#a(e){const t=n=>{this.editorDiv.style.fontSize=`calc(${n}px * var(--total-scale-factor))`,this.translate(0,-(n-this.#s)*this.parentScale),this.#s=n,this.#o()},s=this.#s;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ge.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#r(e){const t=n=>{this.color=n,this.onUpdatedColor()},s=this.color;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ge.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){const e=this.parentScale;return[-ze._internalPadding*e,-(ze._internalPadding+this.#s)*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#n=new AbortController;const e=this._uiManager.combinedSignal(this.#n);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#t),this._isDraggable=!0,this.#n?.abort(),this.#n=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#i(){const e=[];this.editorDiv.normalize();let t=null;for(const s of this.editorDiv.childNodes)t?.nodeType===Node.TEXT_NODE&&s.nodeName==="BR"||(e.push(ze.#c(s)),t=s);return e.join(`
`)}#o(){const[e,t]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:n,div:i}=this,r=i.style.display,a=i.classList.contains("hidden");i.classList.remove("hidden"),i.style.display="hidden",n.div.append(this.div),s=i.getBoundingClientRect(),i.remove(),i.style.display=r,i.classList.toggle("hidden",a)}this.rotation%180===this.parentRotation%180?(this.width=s.width/e,this.height=s.height/t):(this.width=s.height/e,this.height=s.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=this.#e,t=this.#e=this.#i().trimEnd();if(e===t)return;const s=n=>{if(this.#e=n,!n){this.remove();return}this.#l(),this._uiManager.rebuild(this),this.#o()};this.addCommands({cmd:()=>{s(t)},undo:()=>{s(e)},mustExec:!1}),this.#o()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){ze._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let e,t;(this._isCopy||this.annotationElementId)&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#t),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${this.#s}px * var(--total-scale-factor))`,s.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[n,i]=this.parentDimensions;if(this.annotationElementId){const{position:r}=this._initialData;let[a,l]=this.getInitialTranslation();[a,l]=this.pageTranslationToScreen(a,l);const[c,d]=this.pageDimensions,[h,f]=this.pageTranslation;let p,b;switch(this.rotation){case 0:p=e+(r[0]-h)/c,b=t+this.height-(r[1]-f)/d;break;case 90:p=e+(r[0]-h)/c,b=t-(r[1]-f)/d,[a,l]=[l,-a];break;case 180:p=e-this.width+(r[0]-h)/c,b=t-(r[1]-f)/d,[a,l]=[-a,-l];break;case 270:p=e+(r[0]-h-this.height*d)/c,b=t+(r[1]-f-this.width*c)/d,[a,l]=[-l,a];break}this.setAt(p*n,b*i,a,l)}else this._moveAfterPaste(e,t);this.#l(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(an,"")}editorDivPaste(e){const t=e.clipboardData||window.clipboardData,{types:s}=t;if(s.length===1&&s[0]==="text/plain")return;e.preventDefault();const n=ze.#h(t.getData("text")||"").replaceAll(an,`
`);if(!n)return;const i=window.getSelection();if(!i.rangeCount)return;this.editorDiv.normalize(),i.deleteFromDocument();const r=i.getRangeAt(0);if(!n.includes(`
`)){r.insertNode(document.createTextNode(n)),this.editorDiv.normalize(),i.collapseToStart();return}const{startContainer:a,startOffset:l}=r,c=[],d=[];if(a.nodeType===Node.TEXT_NODE){const p=a.parentElement;if(d.push(a.nodeValue.slice(l).replaceAll(an,"")),p!==this.editorDiv){let b=c;for(const m of this.editorDiv.childNodes){if(m===p){b=d;continue}b.push(ze.#c(m))}}c.push(a.nodeValue.slice(0,l).replaceAll(an,""))}else if(a===this.editorDiv){let p=c,b=0;for(const m of this.editorDiv.childNodes)b++===l&&(p=d),p.push(ze.#c(m))}this.#e=`${c.join(`
`)}${n}${d.join(`
`)}`,this.#l();const h=new Range;let f=Math.sumPrecise(c.map(p=>p.length));for(const{firstChild:p}of this.editorDiv.childNodes)if(p.nodeType===Node.TEXT_NODE){const b=p.nodeValue.length;if(f<=b){h.setStart(p,f),h.setEnd(p,f);break}f-=b}i.removeAllRanges(),i.addRange(h)}#l(){if(this.editorDiv.replaceChildren(),!!this.#e)for(const e of this.#e.split(`
`)){const t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#u(){return this.#e.replaceAll("Â "," ")}static#h(e){return e.replaceAll(" ","Â ")}get contentDiv(){return this.editorDiv}getPDFRect(){const e=ze._internalPadding*this.parentScale;return this.getRect(e,e)}static async deserialize(e,t,s){let n=null;if(e instanceof Jo){const{data:{defaultAppearanceData:{fontSize:r,fontColor:a},rect:l,rotation:c,id:d,popupRef:h,richText:f,contentsObj:p,creationDate:b,modificationDate:m},textContent:y,textPosition:g,parent:{page:{pageNumber:x}}}=e;if(!y||y.length===0)return null;n=e={annotationType:pe.FREETEXT,color:Array.from(a),fontSize:r,value:y.join(`
`),position:g,pageIndex:x-1,rect:l.slice(0),rotation:c,annotationElementId:d,id:d,deleted:!1,popupRef:h,comment:p?.str||null,richText:f,creationDate:b,modificationDate:m}}const i=await super.deserialize(e,t,s);return i.#s=e.fontSize,i.color=se.makeHexColor(...e.color),i.#e=ze.#h(e.value),i._initialData=n,e.comment&&i.setCommentData(e),i}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const t=de._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),s=Object.assign(super.serialize(e),{color:t,fontSize:this.#s,value:this.#u()});return this.addComment(s),e?(s.isCopy=!0,s):this.annotationElementId&&!this.#f(s)?null:(s.id=this.annotationElementId,s)}#f(e){const{value:t,fontSize:s,color:n,pageIndex:i}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||e.value!==t||e.fontSize!==s||e.color.some((r,a)=>r!==n[a])||e.pageIndex!==i}renderAnnotationElement(e){const t=super.renderAnnotationElement(e);if(!t)return null;const{style:s}=t;s.fontSize=`calc(${this.#s}px * var(--total-scale-factor))`,s.color=this.color,t.replaceChildren();for(const n of this.#e.split(`
`)){const i=document.createElement("div");i.append(n?document.createTextNode(n):document.createElement("br")),t.append(i)}return e.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#e}}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}}class re{static PRECISION=1e-4;toSVGPath(){Se("Abstract method `toSVGPath` must be implemented.")}get box(){Se("Abstract getter `box` must be implemented.")}serialize(e,t){Se("Abstract method `serialize` must be implemented.")}static _rescale(e,t,s,n,i,r){r||=new Float32Array(e.length);for(let a=0,l=e.length;a<l;a+=2)r[a]=t+e[a]*n,r[a+1]=s+e[a+1]*i;return r}static _rescaleAndSwap(e,t,s,n,i,r){r||=new Float32Array(e.length);for(let a=0,l=e.length;a<l;a+=2)r[a]=t+e[a+1]*n,r[a+1]=s+e[a]*i;return r}static _translate(e,t,s,n){n||=new Float32Array(e.length);for(let i=0,r=e.length;i<r;i+=2)n[i]=t+e[i],n[i+1]=s+e[i+1];return n}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,s,n,i){switch(i){case 90:return[1-t/s,e/n];case 180:return[1-e/s,1-t/n];case 270:return[t/s,1-e/n];default:return[e/s,t/n]}}static _normalizePagePoint(e,t,s){switch(s){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,s,n,i,r){return[(e+5*s)/6,(t+5*n)/6,(5*s+i)/6,(5*n+r)/6,(s+i)/2,(n+r)/2]}}class Ot{#e;#t=[];#n;#s;#a=[];#r=new Float32Array(18);#i;#o;#c;#l;#u;#h;#f=[];static#g=8;static#m=2;static#d=Ot.#g+Ot.#m;constructor({x:e,y:t},s,n,i,r,a=0){this.#e=s,this.#h=i*n,this.#s=r,this.#r.set([NaN,NaN,NaN,NaN,e,t],6),this.#n=a,this.#l=Ot.#g*n,this.#c=Ot.#d*n,this.#u=n,this.#f.push(e,t)}isEmpty(){return isNaN(this.#r[8])}#p(){const e=this.#r.subarray(4,6),t=this.#r.subarray(16,18),[s,n,i,r]=this.#e;return[(this.#i+(e[0]-t[0])/2-s)/i,(this.#o+(e[1]-t[1])/2-n)/r,(this.#i+(t[0]-e[0])/2-s)/i,(this.#o+(t[1]-e[1])/2-n)/r]}add({x:e,y:t}){this.#i=e,this.#o=t;const[s,n,i,r]=this.#e;let[a,l,c,d]=this.#r.subarray(8,12);const h=e-c,f=t-d,p=Math.hypot(h,f);if(p<this.#c)return!1;const b=p-this.#l,m=b/p,y=m*h,g=m*f;let x=a,w=l;a=c,l=d,c+=y,d+=g,this.#f?.push(e,t);const v=-g/b,_=y/b,E=v*this.#h,k=_*this.#h;return this.#r.set(this.#r.subarray(2,8),0),this.#r.set([c+E,d+k],4),this.#r.set(this.#r.subarray(14,18),12),this.#r.set([c-E,d-k],16),isNaN(this.#r[6])?(this.#a.length===0&&(this.#r.set([a+E,l+k],2),this.#a.push(NaN,NaN,NaN,NaN,(a+E-s)/i,(l+k-n)/r),this.#r.set([a-E,l-k],14),this.#t.push(NaN,NaN,NaN,NaN,(a-E-s)/i,(l-k-n)/r)),this.#r.set([x,w,a,l,c,d],6),!this.isEmpty()):(this.#r.set([x,w,a,l,c,d],6),Math.abs(Math.atan2(w-l,x-a)-Math.atan2(g,y))<Math.PI/2?([a,l,c,d]=this.#r.subarray(2,6),this.#a.push(NaN,NaN,NaN,NaN,((a+c)/2-s)/i,((l+d)/2-n)/r),[a,l,x,w]=this.#r.subarray(14,18),this.#t.push(NaN,NaN,NaN,NaN,((x+a)/2-s)/i,((w+l)/2-n)/r),!0):([x,w,a,l,c,d]=this.#r.subarray(0,6),this.#a.push(((x+5*a)/6-s)/i,((w+5*l)/6-n)/r,((5*a+c)/6-s)/i,((5*l+d)/6-n)/r,((a+c)/2-s)/i,((l+d)/2-n)/r),[c,d,a,l,x,w]=this.#r.subarray(12,18),this.#t.push(((x+5*a)/6-s)/i,((w+5*l)/6-n)/r,((5*a+c)/6-s)/i,((5*l+d)/6-n)/r,((a+c)/2-s)/i,((l+d)/2-n)/r),!0))}toSVGPath(){if(this.isEmpty())return"";const e=this.#a,t=this.#t;if(isNaN(this.#r[6])&&!this.isEmpty())return this.#b();const s=[];s.push(`M${e[4]} ${e[5]}`);for(let n=6;n<e.length;n+=6)isNaN(e[n])?s.push(`L${e[n+4]} ${e[n+5]}`):s.push(`C${e[n]} ${e[n+1]} ${e[n+2]} ${e[n+3]} ${e[n+4]} ${e[n+5]}`);this.#y(s);for(let n=t.length-6;n>=6;n-=6)isNaN(t[n])?s.push(`L${t[n+4]} ${t[n+5]}`):s.push(`C${t[n]} ${t[n+1]} ${t[n+2]} ${t[n+3]} ${t[n+4]} ${t[n+5]}`);return this.#x(s),s.join(" ")}#b(){const[e,t,s,n]=this.#e,[i,r,a,l]=this.#p();return`M${(this.#r[2]-e)/s} ${(this.#r[3]-t)/n} L${(this.#r[4]-e)/s} ${(this.#r[5]-t)/n} L${i} ${r} L${a} ${l} L${(this.#r[16]-e)/s} ${(this.#r[17]-t)/n} L${(this.#r[14]-e)/s} ${(this.#r[15]-t)/n} Z`}#x(e){const t=this.#t;e.push(`L${t[4]} ${t[5]} Z`)}#y(e){const[t,s,n,i]=this.#e,r=this.#r.subarray(4,6),a=this.#r.subarray(16,18),[l,c,d,h]=this.#p();e.push(`L${(r[0]-t)/n} ${(r[1]-s)/i} L${l} ${c} L${d} ${h} L${(a[0]-t)/n} ${(a[1]-s)/i}`)}newFreeDrawOutline(e,t,s,n,i,r){return new sl(e,t,s,n,i,r)}getOutlines(){const e=this.#a,t=this.#t,s=this.#r,[n,i,r,a]=this.#e,l=new Float32Array((this.#f?.length??0)+2);for(let h=0,f=l.length-2;h<f;h+=2)l[h]=(this.#f[h]-n)/r,l[h+1]=(this.#f[h+1]-i)/a;if(l[l.length-2]=(this.#i-n)/r,l[l.length-1]=(this.#o-i)/a,isNaN(s[6])&&!this.isEmpty())return this.#E(l);const c=new Float32Array(this.#a.length+24+this.#t.length);let d=e.length;for(let h=0;h<d;h+=2){if(isNaN(e[h])){c[h]=c[h+1]=NaN;continue}c[h]=e[h],c[h+1]=e[h+1]}d=this.#v(c,d);for(let h=t.length-6;h>=6;h-=6)for(let f=0;f<6;f+=2){if(isNaN(t[h+f])){c[d]=c[d+1]=NaN,d+=2;continue}c[d]=t[h+f],c[d+1]=t[h+f+1],d+=2}return this.#S(c,d),this.newFreeDrawOutline(c,l,this.#e,this.#u,this.#n,this.#s)}#E(e){const t=this.#r,[s,n,i,r]=this.#e,[a,l,c,d]=this.#p(),h=new Float32Array(36);return h.set([NaN,NaN,NaN,NaN,(t[2]-s)/i,(t[3]-n)/r,NaN,NaN,NaN,NaN,(t[4]-s)/i,(t[5]-n)/r,NaN,NaN,NaN,NaN,a,l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,(t[16]-s)/i,(t[17]-n)/r,NaN,NaN,NaN,NaN,(t[14]-s)/i,(t[15]-n)/r],0),this.newFreeDrawOutline(h,e,this.#e,this.#u,this.#n,this.#s)}#S(e,t){const s=this.#t;return e.set([NaN,NaN,NaN,NaN,s[4],s[5]],t),t+=6}#v(e,t){const s=this.#r.subarray(4,6),n=this.#r.subarray(16,18),[i,r,a,l]=this.#e,[c,d,h,f]=this.#p();return e.set([NaN,NaN,NaN,NaN,(s[0]-i)/a,(s[1]-r)/l,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,h,f,NaN,NaN,NaN,NaN,(n[0]-i)/a,(n[1]-r)/l],t),t+=24}}class sl extends re{#e;#t=new Float32Array(4);#n;#s;#a;#r;#i;constructor(e,t,s,n,i,r){super(),this.#i=e,this.#a=t,this.#e=s,this.#r=n,this.#n=i,this.#s=r,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#o(r);const[a,l,c,d]=this.#t;for(let h=0,f=e.length;h<f;h+=2)e[h]=(e[h]-a)/c,e[h+1]=(e[h+1]-l)/d;for(let h=0,f=t.length;h<f;h+=2)t[h]=(t[h]-a)/c,t[h+1]=(t[h+1]-l)/d}toSVGPath(){const e=[`M${this.#i[4]} ${this.#i[5]}`];for(let t=6,s=this.#i.length;t<s;t+=6){if(isNaN(this.#i[t])){e.push(`L${this.#i[t+4]} ${this.#i[t+5]}`);continue}e.push(`C${this.#i[t]} ${this.#i[t+1]} ${this.#i[t+2]} ${this.#i[t+3]} ${this.#i[t+4]} ${this.#i[t+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,t,s,n],i){const r=s-e,a=n-t;let l,c;switch(i){case 0:l=re._rescale(this.#i,e,n,r,-a),c=re._rescale(this.#a,e,n,r,-a);break;case 90:l=re._rescaleAndSwap(this.#i,e,t,r,a),c=re._rescaleAndSwap(this.#a,e,t,r,a);break;case 180:l=re._rescale(this.#i,s,t,-r,a),c=re._rescale(this.#a,s,t,-r,a);break;case 270:l=re._rescaleAndSwap(this.#i,s,n,-r,-a),c=re._rescaleAndSwap(this.#a,s,n,-r,-a);break}return{outline:Array.from(l),points:[Array.from(c)]}}#o(e){const t=this.#i;let s=t[4],n=t[5];const i=[s,n,s,n];let r=s,a=n,l=s,c=n;const d=e?Math.max:Math.min,h=new Float32Array(4);for(let p=6,b=t.length;p<b;p+=6){const m=t[p+4],y=t[p+5];isNaN(t[p])?(se.pointBoundingBox(m,y,i),a>y?(r=m,a=y):a===y&&(r=d(r,m)),c<y?(l=m,c=y):c===y&&(l=d(l,m))):(h[0]=h[1]=1/0,h[2]=h[3]=-1/0,se.bezierBoundingBox(s,n,...t.slice(p,p+6),h),se.rectBoundingBox(h[0],h[1],h[2],h[3],i),a>h[1]?(r=h[0],a=h[1]):a===h[1]&&(r=d(r,h[0])),c<h[3]?(l=h[2],c=h[3]):c===h[3]&&(l=d(l,h[2]))),s=m,n=y}const f=this.#t;f[0]=i[0]-this.#n,f[1]=i[1]-this.#n,f[2]=i[2]-i[0]+2*this.#n,f[3]=i[3]-i[1]+2*this.#n,this.firstPoint=[r,a],this.lastPoint=[l,c]}get box(){return this.#t}newOutliner(e,t,s,n,i,r=0){return new Ot(e,t,s,n,i,r)}getNewOutline(e,t){const[s,n,i,r]=this.#t,[a,l,c,d]=this.#e,h=i*c,f=r*d,p=s*c+a,b=n*d+l,m=this.newOutliner({x:this.#a[0]*h+p,y:this.#a[1]*f+b},this.#e,this.#r,e,this.#s,t??this.#n);for(let y=2;y<this.#a.length;y+=2)m.add({x:this.#a[y]*h+p,y:this.#a[y+1]*f+b});return m.getOutlines()}}class Ri{#e;#t;#n;#s=[];#a=[];constructor(e,t=0,s=0,n=!0){const i=[1/0,1/0,-1/0,-1/0],r=10**-4;for(const{x:m,y,width:g,height:x}of e){const w=Math.floor((m-t)/r)*r,v=Math.ceil((m+g+t)/r)*r,_=Math.floor((y-t)/r)*r,E=Math.ceil((y+x+t)/r)*r,k=[w,_,E,!0],D=[v,_,E,!1];this.#s.push(k,D),se.rectBoundingBox(w,_,v,E,i)}const a=i[2]-i[0]+2*s,l=i[3]-i[1]+2*s,c=i[0]-s,d=i[1]-s;let h=n?-1/0:1/0,f=1/0;const p=this.#s.at(n?-1:-2),b=[p[0],p[2]];for(const m of this.#s){const[y,g,x,w]=m;!w&&n?g<f?(f=g,h=y):g===f&&(h=Math.max(h,y)):w&&!n&&(g<f?(f=g,h=y):g===f&&(h=Math.min(h,y))),m[0]=(y-c)/a,m[1]=(g-d)/l,m[2]=(x-d)/l}this.#e=new Float32Array([c,d,a,l]),this.#t=[h,f],this.#n=b}getOutlines(){this.#s.sort((t,s)=>t[0]-s[0]||t[1]-s[1]||t[2]-s[2]);const e=[];for(const t of this.#s)t[3]?(e.push(...this.#l(t)),this.#o(t)):(this.#c(t),e.push(...this.#l(t)));return this.#r(e)}#r(e){const t=[],s=new Set;for(const r of e){const[a,l,c]=r;t.push([a,l,r],[a,c,r])}t.sort((r,a)=>r[1]-a[1]||r[0]-a[0]);for(let r=0,a=t.length;r<a;r+=2){const l=t[r][2],c=t[r+1][2];l.push(c),c.push(l),s.add(l),s.add(c)}const n=[];let i;for(;s.size>0;){const r=s.values().next().value;let[a,l,c,d,h]=r;s.delete(r);let f=a,p=l;for(i=[a,c],n.push(i);;){let b;if(s.has(d))b=d;else if(s.has(h))b=h;else break;s.delete(b),[a,l,c,d,h]=b,f!==a&&(i.push(f,p,a,p===l?l:c),f=a),p=p===l?c:l}i.push(f,p)}return new zf(n,this.#e,this.#t,this.#n)}#i(e){const t=this.#a;let s=0,n=t.length-1;for(;s<=n;){const i=s+n>>1,r=t[i][0];if(r===e)return i;r<e?s=i+1:n=i-1}return n+1}#o([,e,t]){const s=this.#i(e);this.#a.splice(s,0,[e,t])}#c([,e,t]){const s=this.#i(e);for(let n=s;n<this.#a.length;n++){const[i,r]=this.#a[n];if(i!==e)break;if(i===e&&r===t){this.#a.splice(n,1);return}}for(let n=s-1;n>=0;n--){const[i,r]=this.#a[n];if(i!==e)break;if(i===e&&r===t){this.#a.splice(n,1);return}}}#l(e){const[t,s,n]=e,i=[[t,s,n]],r=this.#i(n);for(let a=0;a<r;a++){const[l,c]=this.#a[a];for(let d=0,h=i.length;d<h;d++){const[,f,p]=i[d];if(!(c<=f||p<=l)){if(f>=l){if(p>c)i[d][1]=c;else{if(h===1)return[];i.splice(d,1),d--,h--}continue}i[d][2]=l,p>c&&i.push([t,c,p])}}}return i}}class zf extends re{#e;#t;constructor(e,t,s,n){super(),this.#t=e,this.#e=t,this.firstPoint=s,this.lastPoint=n}toSVGPath(){const e=[];for(const t of this.#t){let[s,n]=t;e.push(`M${s} ${n}`);for(let i=2;i<t.length;i+=2){const r=t[i],a=t[i+1];r===s?(e.push(`V${a}`),n=a):a===n&&(e.push(`H${r}`),s=r)}e.push("Z")}return e.join(" ")}serialize([e,t,s,n],i){const r=[],a=s-e,l=n-t;for(const c of this.#t){const d=new Array(c.length);for(let h=0;h<c.length;h+=2)d[h]=e+c[h]*a,d[h+1]=n-c[h+1]*l;r.push(d)}return r}get box(){return this.#e}get classNamesForOutlining(){return["highlightOutline"]}}class Di extends Ot{newFreeDrawOutline(e,t,s,n,i,r){return new Hf(e,t,s,n,i,r)}}class Hf extends sl{newOutliner(e,t,s,n,i,r=0){return new Di(e,t,s,n,i,r)}}class Le extends de{#e=null;#t=0;#n;#s=null;#a=null;#r=null;#i=null;#o=0;#c=null;#l=null;#u=null;#h=!1;#f=null;#g=null;#m=null;#d="";#p;#b="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=pe.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const e=Le.prototype;return ue(this,"_keyboardManager",new Hs([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super({...e,name:"highlightEditor"}),this.color=e.color||Le._defaultColor,this.#p=e.thickness||Le._defaultThickness,this.opacity=e.opacity||Le._defaultOpacity,this.#n=e.boxes||null,this.#b=e.methodOfCreation||"",this.#d=e.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(this.#h=!0,this.#y(e),this.#w()):this.#n&&(this.#e=e.anchorNode,this.#t=e.anchorOffset,this.#i=e.focusNode,this.#o=e.focusOffset,this.#x(),this.#w(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#h?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#p,methodOfCreation:this.#b}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#x(){const e=new Ri(this.#n,.001);this.#l=e.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;const t=new Ri(this.#n,.0025,.001,this._uiManager.direction==="ltr");this.#r=t.getOutlines();const{firstPoint:s}=this.#l;this.#f=[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height];const{lastPoint:n}=this.#r;this.#g=[(n[0]-this.x)/this.width,(n[1]-this.y)/this.height]}#y({highlightOutlines:e,highlightId:t,clipPathId:s}){this.#l=e;const n=1.5;if(this.#r=e.getNewOutline(this.#p/2+n,.0025),t>=0)this.#u=t,this.#s=s,this.parent.drawLayer.finalizeDraw(t,{bbox:e.box,path:{d:e.toSVGPath()}}),this.#m=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#r.box,path:{d:this.#r.toSVGPath()}},!0);else if(this.parent){const h=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#u,{bbox:Le.#_(this.#l.box,(h-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#m,{bbox:Le.#_(this.#r.box,h),path:{d:this.#r.toSVGPath()}})}const[i,r,a,l]=e.box;switch(this.rotation){case 0:this.x=i,this.y=r,this.width=a,this.height=l;break;case 90:{const[h,f]=this.parentDimensions;this.x=r,this.y=1-i,this.width=a*f/h,this.height=l*h/f;break}case 180:this.x=1-i,this.y=1-r,this.width=a,this.height=l;break;case 270:{const[h,f]=this.parentDimensions;this.x=1-r,this.y=i,this.width=a*f/h,this.height=l*h/f;break}}const{firstPoint:c}=e;this.#f=[(c[0]-i)/a,(c[1]-r)/l];const{lastPoint:d}=this.#r;this.#g=[(d[0]-i)/a,(d[1]-r)/l]}static initialize(e,t){de.initialize(e,t),Le._defaultColor||=t.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,t){switch(e){case ge.HIGHLIGHT_COLOR:Le._defaultColor=t;break;case ge.HIGHLIGHT_THICKNESS:Le._defaultThickness=t;break}}translateInPage(e,t){}get toolbarPosition(){return this.#g}get commentButtonPosition(){return this.#f}updateParams(e,t){switch(e){case ge.HIGHLIGHT_COLOR:this.#E(t);break;case ge.HIGHLIGHT_THICKNESS:this.#S(t);break}}static get defaultPropertiesToUpdate(){return[[ge.HIGHLIGHT_COLOR,Le._defaultColor],[ge.HIGHLIGHT_THICKNESS,Le._defaultThickness]]}get propertiesToUpdate(){return[[ge.HIGHLIGHT_COLOR,this.color||Le._defaultColor],[ge.HIGHLIGHT_THICKNESS,this.#p||Le._defaultThickness],[ge.HIGHLIGHT_FREE,this.#h]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#u,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#a?.updateColor(this.color),super.onUpdatedColor()}#E(e){const t=(i,r)=>{this.color=i,this.opacity=r,this.onUpdatedColor()},s=this.color,n=this.opacity;this.addCommands({cmd:t.bind(this,e,Le._defaultOpacity),undo:t.bind(this,s,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ge.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(e)},!0)}#S(e){const t=this.#p,s=n=>{this.#p=n,this.#v(n)};this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ge.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#a=new it({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#N())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#N())}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){this.#C(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#w(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#C():e&&(this.#w(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),t&&this.select()}#v(e){this.#h&&(this.#y({highlightOutlines:this.#l.getNewOutline(e/2)}),this.fixAndSetPosition(),this.setDims())}#C(){this.#u===null||!this.parent||(this.parent.drawLayer.remove(this.#u),this.#u=null,this.parent.drawLayer.remove(this.#m),this.#m=null)}#w(e=this.parent){this.#u===null&&({id:this.#u,clipPathId:this.#s}=e.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#h},path:{d:this.#l.toSVGPath()}},!1,!0),this.#m=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#h},bbox:this.#r.box,path:{d:this.#r.toSVGPath()}},this.#h),this.#c&&(this.#c.style.clipPath=this.#s))}static#_([e,t,s,n],i){switch(i){case 90:return[1-t-n,e,n,s];case 180:return[1-e-s,1-t-n,s,n];case 270:return[t,1-e-s,n,s]}return[e,t,s,n]}rotate(e){const{drawLayer:t}=this.parent;let s;this.#h?(e=(e-this.rotation+360)%360,s=Le.#_(this.#l.box,e)):s=Le.#_([this.x,this.y,this.width,this.height],e),t.updateProperties(this.#u,{bbox:s,root:{"data-main-rotation":e}}),t.updateProperties(this.#m,{bbox:Le.#_(this.#r.box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();this.#d&&(e.setAttribute("aria-label",this.#d),e.setAttribute("role","mark")),this.#h?e.classList.add("free"):this.div.addEventListener("keydown",this.#P.bind(this),{signal:this._uiManager._signal});const t=this.#c=document.createElement("div");return e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=this.#s,this.setDims(),No(this,this.#c,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{hovered:!1}})}#P(e){Le._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#T(!0);break;case 1:case 3:this.#T(!1);break}}#T(e){if(!this.#e)return;const t=window.getSelection();e?t.setPosition(this.#e,this.#t):t.setPosition(this.#i,this.#o)}select(){super.select(),this.#m&&this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#m&&(this.parent?.drawLayer.updateProperties(this.#m,{rootClass:{selected:!1}}),this.#h||this.#T(!1))}get _mustFixPosition(){return!this.#h}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#u,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#m,{rootClass:{hidden:!e}}))}#N(){return this.#h?this.rotation:0}#F(){if(this.#h)return null;const[e,t]=this.pageDimensions,[s,n]=this.pageTranslation,i=this.#n,r=new Float32Array(i.length*8);let a=0;for(const{x:l,y:c,width:d,height:h}of i){const f=l*e+s,p=(1-c)*t+n;r[a]=r[a+4]=f,r[a+1]=r[a+3]=p,r[a+2]=r[a+6]=f+d*e,r[a+5]=r[a+7]=p-h*t,a+=8}return r}#D(e){return this.#l.serialize(e,this.#N())}static startHighlighting(e,t,{target:s,x:n,y:i}){const{x:r,y:a,width:l,height:c}=s.getBoundingClientRect(),d=new AbortController,h=e.combinedSignal(d),f=p=>{d.abort(),this.#O(e,p)};window.addEventListener("blur",f,{signal:h}),window.addEventListener("pointerup",f,{signal:h}),window.addEventListener("pointerdown",De,{capture:!0,passive:!1,signal:h}),window.addEventListener("contextmenu",at,{signal:h}),s.addEventListener("pointermove",this.#j.bind(this,e),{signal:h}),this._freeHighlight=new Di({x:n,y:i},[r,a,l,c],e.scale,this._defaultThickness/2,t,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#j(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#O(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(e,t,s){let n=null;if(e instanceof el){const{data:{quadPoints:b,rect:m,rotation:y,id:g,color:x,opacity:w,popupRef:v,richText:_,contentsObj:E,creationDate:k,modificationDate:D},parent:{page:{pageNumber:N}}}=e;n=e={annotationType:pe.HIGHLIGHT,color:Array.from(x),opacity:w,quadPoints:b,boxes:null,pageIndex:N-1,rect:m.slice(0),rotation:y,annotationElementId:g,id:g,deleted:!1,popupRef:v,richText:_,comment:E?.str||null,creationDate:k,modificationDate:D}}else if(e instanceof cr){const{data:{inkLists:b,rect:m,rotation:y,id:g,color:x,borderStyle:{rawWidth:w},popupRef:v,richText:_,contentsObj:E,creationDate:k,modificationDate:D},parent:{page:{pageNumber:N}}}=e;n=e={annotationType:pe.HIGHLIGHT,color:Array.from(x),thickness:w,inkLists:b,boxes:null,pageIndex:N-1,rect:m.slice(0),rotation:y,annotationElementId:g,id:g,deleted:!1,popupRef:v,richText:_,comment:E?.str||null,creationDate:k,modificationDate:D}}const{color:i,quadPoints:r,inkLists:a,opacity:l}=e,c=await super.deserialize(e,t,s);c.color=se.makeHexColor(...i),c.opacity=l||1,a&&(c.#p=e.thickness),c._initialData=n,e.comment&&c.setCommentData(e);const[d,h]=c.pageDimensions,[f,p]=c.pageTranslation;if(r){const b=c.#n=[];for(let m=0;m<r.length;m+=8)b.push({x:(r[m]-f)/d,y:1-(r[m+1]-p)/h,width:(r[m+2]-r[m])/d,height:(r[m+1]-r[m+5])/h});c.#x(),c.#w(),c.rotate(c.rotation)}else if(a){c.#h=!0;const b=a[0],m={x:b[0]-f,y:h-(b[1]-p)},y=new Di(m,[0,0,d,h],1,c.#p/2,!0,.001);for(let w=0,v=b.length;w<v;w+=2)m.x=b[w]-f,m.y=h-(b[w+1]-p),y.add(m);const{id:g,clipPathId:x}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:y.toSVGPath()}},!0,!0);c.#y({highlightOutlines:y.getOutlines(),highlightId:g,clipPathId:x}),c.#w(),c.rotate(c.parentRotation)}return c}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const t=de._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),s=super.serialize(e);return Object.assign(s,{color:t,opacity:this.opacity,thickness:this.#p,quadPoints:this.#F(),outlines:this.#D(s.rect)}),this.addComment(s),this.annotationElementId&&!this.#L(s)?null:(s.id=this.annotationElementId,s)}#L(e){const{color:t}=this._initialData;return this.hasEditedComment||e.color.some((s,n)=>s!==t[n])}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class nl{#e=Object.create(null);updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,s]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,s)}updateSVGProperty(e,t){this.#e[e]=t}toSVGProperties(){const e=this.#e;return this.#e=Object.create(null),{root:e}}reset(){this.#e=Object.create(null)}updateAll(e=this){this.updateProperties(e)}clone(){Se("Not implemented")}}class we extends de{#e=null;#t;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#n=null;static#s=null;static#a=null;static _INNER_MARGIN=3;constructor(e){super(e),this.#t=e.mustBeCommitted||!1,this._addOutlines(e)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(e){e.drawOutlines&&(this.#r(e),this.#c())}#r({drawOutlines:e,drawId:t,drawingOptions:s}){this.#e=e,this._drawingOptions||=s,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),t>=0?(this._drawId=t,this.parent.drawLayer.finalizeDraw(t,e.defaultProperties)):this._drawId=this.#i(e,this.parent),this.#h(e.box)}#i(e,t){const{id:s}=t.drawLayer.draw(we._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return s}static _mergeSVGProperties(e,t){const s=new Set(Object.keys(e));for(const[n,i]of Object.entries(t))s.has(n)?Object.assign(e[n],i):e[n]=i;return e}static getDefaultDrawingOptions(e){Se("Not implemented")}static get typesMap(){Se("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,t){const s=this.typesMap.get(e);s&&this._defaultDrawingOptions.updateProperty(s,t),this._currentParent&&(we.#n.updateProperty(s,t),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,t){const s=this.constructor.typesMap.get(e);s&&this._updateProperty(e,s,t)}static get defaultPropertiesToUpdate(){const e=[],t=this._defaultDrawingOptions;for(const[s,n]of this.typesMap)e.push([s,t[n]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:t}=this;for(const[s,n]of this.constructor.typesMap)e.push([s,t[n]]);return e}_updateProperty(e,t,s){const n=this._drawingOptions,i=n[t],r=a=>{n.updateProperty(t,a);const l=this.#e.updateProperty(t,a);l&&this.#h(l),this.parent?.drawLayer.updateProperties(this._drawId,n.toSVGProperties()),e===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:r.bind(this,s),undo:r.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,we._mergeSVGProperties(this.#e.getPathResizingSVGProperties(this.#u()),{bbox:this.#f()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,we._mergeSVGProperties(this.#e.getPathResizedSVGProperties(this.#u()),{bbox:this.#f()}))}_onTranslating(e,t){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#f()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,we._mergeSVGProperties(this.#e.getPathTranslatedSVGProperties(this.#u(),this.parentDimensions),{bbox:this.#f()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#t&&(this.#t=!1,this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){this.#o(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#c(),this.#h(this.#e.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),this.#o()):e&&(this._uiManager.addShouldRescale(this),this.#c(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),t&&this.select()}#o(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#c(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#i(this.#e,e)}}#l([e,t,s,n]){const{parentDimensions:[i,r],rotation:a}=this;switch(a){case 90:return[t,1-e,s*(r/i),n*(i/r)];case 180:return[1-e,1-t,s,n];case 270:return[1-t,e,s*(r/i),n*(i/r)];default:return[e,t,s,n]}}#u(){const{x:e,y:t,width:s,height:n,parentDimensions:[i,r],rotation:a}=this;switch(a){case 90:return[1-t,e,s*(i/r),n*(r/i)];case 180:return[1-e,1-t,s,n];case 270:return[t,1-e,s*(i/r),n*(r/i)];default:return[e,t,s,n]}}#h(e){[this.x,this.y,this.width,this.height]=this.#l(e),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#f(){const{x:e,y:t,width:s,height:n,rotation:i,parentRotation:r,parentDimensions:[a,l]}=this;switch((i*4+r)/90){case 1:return[1-t-n,e,n,s];case 2:return[1-e-s,1-t-n,s,n];case 3:return[t,1-e-s,n,s];case 4:return[e,t-s*(a/l),n*(l/a),s*(a/l)];case 5:return[1-t,e,s*(a/l),n*(l/a)];case 6:return[1-e-n*(l/a),1-t,n*(l/a),s*(a/l)];case 7:return[t-s*(a/l),1-e-n*(l/a),s*(a/l),n*(l/a)];case 8:return[e-s,t-n,s,n];case 9:return[1-t,e-s,n,s];case 10:return[1-e,1-t,s,n];case 11:return[t-n,1-e,n,s];case 12:return[e-n*(l/a),t,n*(l/a),s*(a/l)];case 13:return[1-t-s*(a/l),e-n*(l/a),s*(a/l),n*(l/a)];case 14:return[1-e,1-t-s*(a/l),n*(l/a),s*(a/l)];case 15:return[t,1-e,s*(a/l),n*(l/a)];default:return[e,t,s,n]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,we._mergeSVGProperties({bbox:this.#f()},this.#e.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#h(this.#e.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e,t;this._isCopy&&(e=this.x,t=this.y);const s=super.render();s.classList.add("draw");const n=document.createElement("div");return s.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,t),s}static createDrawerInstance(e,t,s,n,i){Se("Not implemented")}static startDrawing(e,t,s,n){const{target:i,offsetX:r,offsetY:a,pointerId:l,pointerType:c}=n;if(ve.isInitializedAndDifferentPointerType(c))return;const{viewport:{rotation:d}}=e,{width:h,height:f}=i.getBoundingClientRect(),p=we.#s=new AbortController,b=e.combinedSignal(p);if(ve.setPointer(c,l),window.addEventListener("pointerup",m=>{ve.isSamePointerIdOrRemove(m.pointerId)&&this._endDraw(m)},{signal:b}),window.addEventListener("pointercancel",m=>{ve.isSamePointerIdOrRemove(m.pointerId)&&this._currentParent.endDrawingSession()},{signal:b}),window.addEventListener("pointerdown",m=>{ve.isSamePointerType(m.pointerType)&&(ve.initializeAndAddPointerId(m.pointerId),we.#n.isCancellable()&&(we.#n.removeLastElement(),we.#n.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:b}),window.addEventListener("contextmenu",at,{signal:b}),i.addEventListener("pointermove",this._drawMove.bind(this),{signal:b}),i.addEventListener("touchmove",m=>{ve.isSameTimeStamp(m.timeStamp)&&De(m)},{signal:b}),e.toggleDrawing(),t._editorUndoBar?.hide(),we.#n){e.drawLayer.updateProperties(this._currentDrawId,we.#n.startNew(r,a,h,f,d));return}t.updateUIForDefaultProperties(this),we.#n=this.createDrawerInstance(r,a,h,f,d),we.#a=this.getDefaultDrawingOptions(),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(we.#a.toSVGProperties(),we.#n.defaultSVGProperties),!0,!1)}static _drawMove(e){if(ve.isSameTimeStamp(e.timeStamp),!we.#n)return;const{offsetX:t,offsetY:s,pointerId:n}=e;if(ve.isSamePointerId(n)){if(ve.isUsingMultiplePointers()){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,we.#n.add(t,s)),ve.setTimeStamp(e.timeStamp),De(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,we.#n=null,we.#a=null,ve.clearTimeStamp()),we.#s&&(we.#s.abort(),we.#s=null,ve.clearPointerIds())}static _endDraw(e){const t=this._currentParent;if(t){if(t.toggleDrawing(!0),this._cleanup(!1),e?.target===t.div&&t.drawLayer.updateProperties(this._currentDrawId,we.#n.end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const s=we.#n,n=this._currentDrawId,i=s.getLastElement();t.addCommands({cmd:()=>{t.drawLayer.updateProperties(n,s.setLastElement(i))},undo:()=>{t.drawLayer.updateProperties(n,s.removeLastElement())},mustExec:!1,type:ge.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){const t=this._currentParent;if(!t)return null;if(t.toggleDrawing(!0),t.cleanUndoStack(ge.DRAW_STEP),!we.#n.isEmpty()){const{pageDimensions:[s,n],scale:i}=t,r=t.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:we.#n.getOutlines(s*i,n*i,i,this._INNER_MARGIN),drawingOptions:we.#a,mustBeCommitted:!e});return this._cleanup(!0),r}return t.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,t,s,n,i,r){Se("Not implemented")}static async deserialize(e,t,s){const{rawDims:{pageWidth:n,pageHeight:i,pageX:r,pageY:a}}=t.viewport,l=this.deserializeDraw(r,a,n,i,this._INNER_MARGIN,e),c=await super.deserialize(e,t,s);return c.createDrawingOptions(e),c.#r({drawOutlines:l}),c.#c(),c.onScaleChanging(),c.rotate(),c}serializeDraw(e){const[t,s]=this.pageTranslation,[n,i]=this.pageDimensions;return this.#e.serialize([t,s,n,i],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class $f{#e=new Float64Array(6);#t;#n;#s;#a;#r;#i="";#o=0;#c=new Ws;#l;#u;constructor(e,t,s,n,i,r){this.#l=s,this.#u=n,this.#s=i,this.#a=r,[e,t]=this.#h(e,t);const a=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#r=[e,t],this.#n=[{line:a,points:this.#r}],this.#e.set(a,0)}updateProperty(e,t){e==="stroke-width"&&(this.#a=t)}#h(e,t){return re._normalizePoint(e,t,this.#l,this.#u,this.#s)}isEmpty(){return!this.#n||this.#n.length===0}isCancellable(){return this.#r.length<=10}add(e,t){[e,t]=this.#h(e,t);const[s,n,i,r]=this.#e.subarray(2,6),a=e-i,l=t-r;return Math.hypot(this.#l*a,this.#u*l)<=2?null:(this.#r.push(e,t),isNaN(s)?(this.#e.set([i,r,e,t],2),this.#t.push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(this.#e[0])&&this.#t.splice(6,6),this.#e.set([s,n,i,r,e,t],0),this.#t.push(...re.createBezierPoints(s,n,i,r,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const s=this.add(e,t);return s||(this.#r.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,s,n,i){this.#l=s,this.#u=n,this.#s=i,[e,t]=this.#h(e,t);const r=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#r=[e,t];const a=this.#n.at(-1);return a&&(a.line=new Float32Array(a.line),a.points=new Float32Array(a.points)),this.#n.push({line:r,points:this.#r}),this.#e.set(r,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#n.at(-1)}setLastElement(e){return this.#n?(this.#n.push(e),this.#t=e.line,this.#r=e.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#c.setLastElement(e)}removeLastElement(){if(!this.#n)return this.#c.removeLastElement();this.#n.pop(),this.#i="";for(let e=0,t=this.#n.length;e<t;e++){const{line:s,points:n}=this.#n[e];this.#t=s,this.#r=n,this.#o=0,this.toSVGPath()}return{path:{d:this.#i}}}toSVGPath(){const e=re.svgRound(this.#t[4]),t=re.svgRound(this.#t[5]);if(this.#r.length===2)return this.#i=`${this.#i} M ${e} ${t} Z`,this.#i;if(this.#r.length<=6){const n=this.#i.lastIndexOf("M");this.#i=`${this.#i.slice(0,n)} M ${e} ${t}`,this.#o=6}if(this.#r.length===4){const n=re.svgRound(this.#t[10]),i=re.svgRound(this.#t[11]);return this.#i=`${this.#i} L ${n} ${i}`,this.#o=12,this.#i}const s=[];this.#o===0&&(s.push(`M ${e} ${t}`),this.#o=6);for(let n=this.#o,i=this.#t.length;n<i;n+=6){const[r,a,l,c,d,h]=this.#t.slice(n,n+6).map(re.svgRound);s.push(`C${r} ${a} ${l} ${c} ${d} ${h}`)}return this.#i+=s.join(" "),this.#o=this.#t.length,this.#i}getOutlines(e,t,s,n){const i=this.#n.at(-1);return i.line=new Float32Array(i.line),i.points=new Float32Array(i.points),this.#c.build(this.#n,e,t,s,this.#s,this.#a,n),this.#e=null,this.#t=null,this.#n=null,this.#i=null,this.#c}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class Ws extends re{#e;#t=0;#n;#s;#a;#r;#i;#o;#c;build(e,t,s,n,i,r,a){this.#a=t,this.#r=s,this.#i=n,this.#o=i,this.#c=r,this.#n=a??0,this.#s=e,this.#h()}get thickness(){return this.#c}setLastElement(e){return this.#s.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#s.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:t}of this.#s){if(e.push(`M${re.svgRound(t[4])} ${re.svgRound(t[5])}`),t.length===6){e.push("Z");continue}if(t.length===12&&isNaN(t[6])){e.push(`L${re.svgRound(t[10])} ${re.svgRound(t[11])}`);continue}for(let s=6,n=t.length;s<n;s+=6){const[i,r,a,l,c,d]=t.subarray(s,s+6).map(re.svgRound);e.push(`C${i} ${r} ${a} ${l} ${c} ${d}`)}}return e.join("")}serialize([e,t,s,n],i){const r=[],a=[],[l,c,d,h]=this.#u();let f,p,b,m,y,g,x,w,v;switch(this.#o){case 0:v=re._rescale,f=e,p=t+n,b=s,m=-n,y=e+l*s,g=t+(1-c-h)*n,x=e+(l+d)*s,w=t+(1-c)*n;break;case 90:v=re._rescaleAndSwap,f=e,p=t,b=s,m=n,y=e+c*s,g=t+l*n,x=e+(c+h)*s,w=t+(l+d)*n;break;case 180:v=re._rescale,f=e+s,p=t,b=-s,m=n,y=e+(1-l-d)*s,g=t+c*n,x=e+(1-l)*s,w=t+(c+h)*n;break;case 270:v=re._rescaleAndSwap,f=e+s,p=t+n,b=-s,m=-n,y=e+(1-c-h)*s,g=t+(1-l-d)*n,x=e+(1-c)*s,w=t+(1-l)*n;break}for(const{line:_,points:E}of this.#s)r.push(v(_,f,p,b,m,i?new Array(_.length):null)),a.push(v(E,f,p,b,m,i?new Array(E.length):null));return{lines:r,points:a,rect:[y,g,x,w]}}static deserialize(e,t,s,n,i,{paths:{lines:r,points:a},rotation:l,thickness:c}){const d=[];let h,f,p,b,m;switch(l){case 0:m=re._rescale,h=-e/s,f=t/n+1,p=1/s,b=-1/n;break;case 90:m=re._rescaleAndSwap,h=-t/n,f=-e/s,p=1/n,b=1/s;break;case 180:m=re._rescale,h=e/s+1,f=-t/n,p=-1/s,b=1/n;break;case 270:m=re._rescaleAndSwap,h=t/n+1,f=e/s+1,p=-1/n,b=-1/s;break}if(!r){r=[];for(const g of a){const x=g.length;if(x===2){r.push(new Float32Array([NaN,NaN,NaN,NaN,g[0],g[1]]));continue}if(x===4){r.push(new Float32Array([NaN,NaN,NaN,NaN,g[0],g[1],NaN,NaN,NaN,NaN,g[2],g[3]]));continue}const w=new Float32Array(3*(x-2));r.push(w);let[v,_,E,k]=g.subarray(0,4);w.set([NaN,NaN,NaN,NaN,v,_],0);for(let D=4;D<x;D+=2){const N=g[D],R=g[D+1];w.set(re.createBezierPoints(v,_,E,k,N,R),(D-2)*3),[v,_,E,k]=[E,k,N,R]}}}for(let g=0,x=r.length;g<x;g++)d.push({line:m(r[g].map(w=>w??NaN),h,f,p,b),points:m(a[g].map(w=>w??NaN),h,f,p,b)});const y=new this.prototype.constructor;return y.build(d,s,n,1,l,c,i),y}#l(e=this.#c){const t=this.#n+e/2*this.#i;return this.#o%180===0?[t/this.#a,t/this.#r]:[t/this.#r,t/this.#a]}#u(){const[e,t,s,n]=this.#e,[i,r]=this.#l(0);return[e+i,t+r,s-2*i,n-2*r]}#h(){const e=this.#e=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:n}of this.#s){if(n.length<=12){for(let a=4,l=n.length;a<l;a+=6)se.pointBoundingBox(n[a],n[a+1],e);continue}let i=n[4],r=n[5];for(let a=6,l=n.length;a<l;a+=6){const[c,d,h,f,p,b]=n.subarray(a,a+6);se.bezierBoundingBox(i,r,c,d,h,f,p,b,e),i=p,r=b}}const[t,s]=this.#l();e[0]=We(e[0]-t,0,1),e[1]=We(e[1]-s,0,1),e[2]=We(e[2]+t,0,1),e[3]=We(e[3]+s,0,1),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#e}updateProperty(e,t){return e==="stroke-width"?this.#f(t):null}#f(e){const[t,s]=this.#l();this.#c=e;const[n,i]=this.#l(),[r,a]=[n-t,i-s],l=this.#e;return l[0]-=r,l[1]-=a,l[2]+=2*r,l[3]+=2*a,l}updateParentDimensions([e,t],s){const[n,i]=this.#l();this.#a=e,this.#r=t,this.#i=s;const[r,a]=this.#l(),l=r-n,c=a-i,d=this.#e;return d[0]-=l,d[1]-=c,d[2]+=2*l,d[3]+=2*c,d}updateRotation(e){return this.#t=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#e.map(re.svgRound).join(" ")}get defaultProperties(){const[e,t]=this.#e;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${re.svgRound(e)} ${re.svgRound(t)}`}}}get rotationTransform(){const[,,e,t]=this.#e;let s=0,n=0,i=0,r=0,a=0,l=0;switch(this.#t){case 90:n=t/e,i=-e/t,a=e;break;case 180:s=-1,r=-1,a=e,l=t;break;case 270:n=-t/e,i=e/t,l=t;break;default:return""}return`matrix(${s} ${n} ${i} ${r} ${re.svgRound(a)} ${re.svgRound(l)})`}getPathResizingSVGProperties([e,t,s,n]){const[i,r]=this.#l(),[a,l,c,d]=this.#e;if(Math.abs(c-i)<=re.PRECISION||Math.abs(d-r)<=re.PRECISION){const m=e+s/2-(a+c/2),y=t+n/2-(l+d/2);return{path:{"transform-origin":`${re.svgRound(e)} ${re.svgRound(t)}`,transform:`${this.rotationTransform} translate(${m} ${y})`}}}const h=(s-2*i)/(c-2*i),f=(n-2*r)/(d-2*r),p=c/s,b=d/n;return{path:{"transform-origin":`${re.svgRound(a)} ${re.svgRound(l)}`,transform:`${this.rotationTransform} scale(${p} ${b}) translate(${re.svgRound(i)} ${re.svgRound(r)}) scale(${h} ${f}) translate(${re.svgRound(-i)} ${re.svgRound(-r)})`}}}getPathResizedSVGProperties([e,t,s,n]){const[i,r]=this.#l(),a=this.#e,[l,c,d,h]=a;if(a[0]=e,a[1]=t,a[2]=s,a[3]=n,Math.abs(d-i)<=re.PRECISION||Math.abs(h-r)<=re.PRECISION){const y=e+s/2-(l+d/2),g=t+n/2-(c+h/2);for(const{line:x,points:w}of this.#s)re._translate(x,y,g,x),re._translate(w,y,g,w);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${re.svgRound(e)} ${re.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const f=(s-2*i)/(d-2*i),p=(n-2*r)/(h-2*r),b=-f*(l+i)+e+i,m=-p*(c+r)+t+r;if(f!==1||p!==1||b!==0||m!==0)for(const{line:y,points:g}of this.#s)re._rescale(y,b,m,f,p,y),re._rescale(g,b,m,f,p,g);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${re.svgRound(e)} ${re.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,t],s){const[n,i]=s,r=this.#e,a=e-r[0],l=t-r[1];if(this.#a===n&&this.#r===i)for(const{line:c,points:d}of this.#s)re._translate(c,a,l,c),re._translate(d,a,l,d);else{const c=this.#a/n,d=this.#r/i;this.#a=n,this.#r=i;for(const{line:h,points:f}of this.#s)re._rescale(h,a,l,c,d,h),re._rescale(f,a,l,c,d,f);r[2]*=c,r[3]*=d}return r[0]=e,r[1]=t,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${re.svgRound(e)} ${re.svgRound(t)}`}}}get defaultSVGProperties(){const e=this.#e;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${re.svgRound(e[0])} ${re.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}class Wn extends nl{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:de._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??=this["stroke-width"],t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new Wn(this._viewParameters);return e.updateAll(this),e}}class dr extends we{static _type="ink";static _editorType=pe.INK;static _defaultDrawingOptions=null;constructor(e){super({...e,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(e,t){de.initialize(e,t),this._defaultDrawingOptions=new Wn(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!0}static get typesMap(){return ue(this,"typesMap",new Map([[ge.INK_THICKNESS,"stroke-width"],[ge.INK_COLOR,"stroke"],[ge.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,t,s,n,i){return new $f(e,t,s,n,i,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,t,s,n,i,r){return Ws.deserialize(e,t,s,n,i,r)}static async deserialize(e,t,s){let n=null;if(e instanceof cr){const{data:{inkLists:r,rect:a,rotation:l,id:c,color:d,opacity:h,borderStyle:{rawWidth:f},popupRef:p,richText:b,contentsObj:m,creationDate:y,modificationDate:g},parent:{page:{pageNumber:x}}}=e;n=e={annotationType:pe.INK,color:Array.from(d),thickness:f,opacity:h,paths:{points:r},boxes:null,pageIndex:x-1,rect:a.slice(0),rotation:l,annotationElementId:c,id:c,deleted:!1,popupRef:p,richText:b,comment:m?.str||null,creationDate:y,modificationDate:g}}const i=await super.deserialize(e,t,s);return i._initialData=n,e.comment&&i.setCommentData(e),i}get toolbarButtons(){return this._colorPicker||=new Ds(this),[["colorPicker",this._colorPicker]]}get colorType(){return ge.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:t,parent:s}=this;t.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(e,t.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:t,opacity:s}){this._drawingOptions=dr.getDefaultDrawingOptions({stroke:se.makeHexColor(...e),"stroke-width":t,"stroke-opacity":s})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:t,points:s}=this.serializeDraw(e),{_drawingOptions:{stroke:n,"stroke-opacity":i,"stroke-width":r}}=this,a=Object.assign(super.serialize(e),{color:de._colorManager.convert(n),opacity:i,thickness:r,paths:{lines:t,points:s}});return this.addComment(a),e?(a.isCopy=!0,a):this.annotationElementId&&!this.#e(a)?null:(a.id=this.annotationElementId,a)}#e(e){const{color:t,thickness:s,opacity:n,pageIndex:i}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||e.color.some((r,a)=>r!==t[a])||e.thickness!==s||e.opacity!==n||e.pageIndex!==i}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;const{points:t,rect:s}=this.serializeDraw(!1);return e.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:t,popup:this.comment}),null}}class Ii extends Ws{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const on=8,vs=3;class Ft{static#e={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#t(e,t,s,n){return s-=e,n-=t,s===0?n>0?0:4:s===1?n+6:2-n}static#n=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#s(e,t,s,n,i,r,a){const l=this.#t(s,n,i,r);for(let c=0;c<8;c++){const d=(-c+l-a+16)%8,h=this.#n[2*d],f=this.#n[2*d+1];if(e[(s+h)*t+(n+f)]!==0)return d}return-1}static#a(e,t,s,n,i,r,a){const l=this.#t(s,n,i,r);for(let c=0;c<8;c++){const d=(c+l+a+16)%8,h=this.#n[2*d],f=this.#n[2*d+1];if(e[(s+h)*t+(n+f)]!==0)return d}return-1}static#r(e,t,s,n){const i=e.length,r=new Int32Array(i);for(let d=0;d<i;d++)r[d]=e[d]<=n?1:0;for(let d=1;d<s-1;d++)r[d*t]=r[d*t+t-1]=0;for(let d=0;d<t;d++)r[d]=r[t*s-1-d]=0;let a=1,l;const c=[];for(let d=1;d<s-1;d++){l=1;for(let h=1;h<t-1;h++){const f=d*t+h,p=r[f];if(p===0)continue;let b=d,m=h;if(p===1&&r[f-1]===0)a+=1,m-=1;else if(p>=1&&r[f+1]===0)a+=1,m+=1,p>1&&(l=p);else{p!==1&&(l=Math.abs(p));continue}const y=[h,d],g=m===h+1,x={isHole:g,points:y,id:a,parent:0};c.push(x);let w;for(const j of c)if(j.id===l){w=j;break}w?w.isHole?x.parent=g?w.parent:l:x.parent=g?l:w.parent:x.parent=g?l:0;const v=this.#s(r,t,d,h,b,m,0);if(v===-1){r[f]=-a,r[f]!==1&&(l=Math.abs(r[f]));continue}let _=this.#n[2*v],E=this.#n[2*v+1];const k=d+_,D=h+E;b=k,m=D;let N=d,R=h;for(;;){const j=this.#a(r,t,N,R,b,m,1);_=this.#n[2*j],E=this.#n[2*j+1];const C=N+_,B=R+E;y.push(B,C);const S=N*t+R;if(r[S+1]===0?r[S]=-a:r[S]===1&&(r[S]=a),C===d&&B===h&&N===k&&R===D){r[f]!==1&&(l=Math.abs(r[f]));break}else b=N,m=R,N=C,R=B}}}return c}static#i(e,t,s,n){if(s-t<=4){for(let k=t;k<s-2;k+=2)n.push(e[k],e[k+1]);return}const i=e[t],r=e[t+1],a=e[s-4]-i,l=e[s-3]-r,c=Math.hypot(a,l),d=a/c,h=l/c,f=d*r-h*i,p=l/a,b=1/c,m=Math.atan(p),y=Math.cos(m),g=Math.sin(m),x=b*(Math.abs(y)+Math.abs(g)),w=b*(1-x+x**2),v=Math.max(Math.atan(Math.abs(g+y)*w),Math.atan(Math.abs(g-y)*w));let _=0,E=t;for(let k=t+2;k<s-2;k+=2){const D=Math.abs(f-d*e[k+1]+h*e[k]);D>_&&(E=k,_=D)}_>(c*v)**2?(this.#i(e,t,E+2,n),this.#i(e,E,s,n)):n.push(i,r)}static#o(e){const t=[],s=e.length;return this.#i(e,0,s,t),t.push(e[s-2],e[s-1]),t.length<=4?null:t}static#c(e,t,s,n,i,r){const a=new Float32Array(r**2),l=-2*n**2,c=r>>1;for(let m=0;m<r;m++){const y=(m-c)**2;for(let g=0;g<r;g++)a[m*r+g]=Math.exp((y+(g-c)**2)/l)}const d=new Float32Array(256),h=-2*i**2;for(let m=0;m<256;m++)d[m]=Math.exp(m**2/h);const f=e.length,p=new Uint8Array(f),b=new Uint32Array(256);for(let m=0;m<s;m++)for(let y=0;y<t;y++){const g=m*t+y,x=e[g];let w=0,v=0;for(let E=0;E<r;E++){const k=m+E-c;if(!(k<0||k>=s))for(let D=0;D<r;D++){const N=y+D-c;if(N<0||N>=t)continue;const R=e[k*t+N],j=a[E*r+D]*d[Math.abs(R-x)];w+=R*j,v+=j}}const _=p[g]=Math.round(w/v);b[_]++}return[p,b]}static#l(e){const t=new Uint32Array(256);for(const s of e)t[s]++;return t}static#u(e){const t=e.length,s=new Uint8ClampedArray(t>>2);let n=-1/0,i=1/0;for(let a=0,l=s.length;a<l;a++){const c=s[a]=e[a<<2];n=Math.max(n,c),i=Math.min(i,c)}const r=255/(n-i);for(let a=0,l=s.length;a<l;a++)s[a]=(s[a]-i)*r;return s}static#h(e){let t,s=-1/0,n=-1/0;const i=e.findIndex(l=>l!==0);let r=i,a=i;for(t=i;t<256;t++){const l=e[t];l>s&&(t-r>n&&(n=t-r,a=t-1),s=l,r=t)}for(t=a-1;t>=0&&!(e[t]>e[t+1]);t--);return t}static#f(e){const t=e,{width:s,height:n}=e,{maxDim:i}=this.#e;let r=s,a=n;if(s>i||n>i){let f=s,p=n,b=Math.log2(Math.max(s,n)/i);const m=Math.floor(b);b=b===m?m-1:m;for(let g=0;g<b;g++){r=Math.ceil(f/2),a=Math.ceil(p/2);const x=new OffscreenCanvas(r,a);x.getContext("2d").drawImage(e,0,0,f,p,0,0,r,a),f=r,p=a,e!==t&&e.close(),e=x.transferToImageBitmap()}const y=Math.min(i/r,i/a);r=Math.round(r*y),a=Math.round(a*y)}const c=new OffscreenCanvas(r,a).getContext("2d",{willReadFrequently:!0});c.fillStyle="white",c.fillRect(0,0,r,a),c.filter="grayscale(1)",c.drawImage(e,0,0,e.width,e.height,0,0,r,a);const d=c.getImageData(0,0,r,a).data;return[this.#u(d),r,a]}static extractContoursFromText(e,{fontFamily:t,fontStyle:s,fontWeight:n},i,r,a,l){let c=new OffscreenCanvas(1,1),d=c.getContext("2d",{alpha:!1});const h=200,f=d.font=`${s} ${n} ${h}px ${t}`,{actualBoundingBoxLeft:p,actualBoundingBoxRight:b,actualBoundingBoxAscent:m,actualBoundingBoxDescent:y,fontBoundingBoxAscent:g,fontBoundingBoxDescent:x,width:w}=d.measureText(e),v=1.5,_=Math.ceil(Math.max(Math.abs(p)+Math.abs(b)||0,w)*v),E=Math.ceil(Math.max(Math.abs(m)+Math.abs(y)||h,Math.abs(g)+Math.abs(x)||h)*v);c=new OffscreenCanvas(_,E),d=c.getContext("2d",{alpha:!0,willReadFrequently:!0}),d.font=f,d.filter="grayscale(1)",d.fillStyle="white",d.fillRect(0,0,_,E),d.fillStyle="black",d.fillText(e,_*(v-1)/2,E*(3-v)/2);const k=this.#u(d.getImageData(0,0,_,E).data),D=this.#l(k),N=this.#h(D),R=this.#r(k,_,E,N);return this.processDrawnLines({lines:{curves:R,width:_,height:E},pageWidth:i,pageHeight:r,rotation:a,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(e,t,s,n,i){const[r,a,l]=this.#f(e),[c,d]=this.#c(r,a,l,Math.hypot(a,l)*this.#e.sigmaSFactor,this.#e.sigmaR,this.#e.kernelSize),h=this.#h(d),f=this.#r(c,a,l,h);return this.processDrawnLines({lines:{curves:f,width:a,height:l},pageWidth:t,pageHeight:s,rotation:n,innerMargin:i,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:s,rotation:n,innerMargin:i,mustSmooth:r,areContours:a}){n%180!==0&&([t,s]=[s,t]);const{curves:l,width:c,height:d}=e,h=e.thickness??0,f=[],p=Math.min(t/c,s/d),b=p/t,m=p/s,y=[];for(const{points:x}of l){const w=r?this.#o(x):x;if(!w)continue;y.push(w);const v=w.length,_=new Float32Array(v),E=new Float32Array(3*(v===2?2:v-2));if(f.push({line:E,points:_}),v===2){_[0]=w[0]*b,_[1]=w[1]*m,E.set([NaN,NaN,NaN,NaN,_[0],_[1]],0);continue}let[k,D,N,R]=w;k*=b,D*=m,N*=b,R*=m,_.set([k,D,N,R],0),E.set([NaN,NaN,NaN,NaN,k,D],0);for(let j=4;j<v;j+=2){const C=_[j]=w[j]*b,B=_[j+1]=w[j+1]*m;E.set(re.createBezierPoints(k,D,N,R,C,B),(j-2)*3),[k,D,N,R]=[N,R,C,B]}}if(f.length===0)return null;const g=a?new Ii:new Ws;return g.build(f,t,s,1,n,a?0:h,i),{outline:g,newCurves:y,areContours:a,thickness:h,width:c,height:d}}static async compressSignature({outlines:e,areContours:t,thickness:s,width:n,height:i}){let r=1/0,a=-1/0,l=0;for(const w of e){l+=w.length;for(let v=2,_=w.length;v<_;v++){const E=w[v]-w[v-2];r=Math.min(r,E),a=Math.max(a,E)}}let c;r>=-128&&a<=127?c=Int8Array:r>=-32768&&a<=32767?c=Int16Array:c=Int32Array;const d=e.length,h=on+vs*d,f=new Uint32Array(h);let p=0;f[p++]=h*Uint32Array.BYTES_PER_ELEMENT+(l-2*d)*c.BYTES_PER_ELEMENT,f[p++]=0,f[p++]=n,f[p++]=i,f[p++]=t?0:1,f[p++]=Math.max(0,Math.floor(s??0)),f[p++]=d,f[p++]=c.BYTES_PER_ELEMENT;for(const w of e)f[p++]=w.length-2,f[p++]=w[0],f[p++]=w[1];const b=new CompressionStream("deflate-raw"),m=b.writable.getWriter();await m.ready,m.write(f);const y=c.prototype.constructor;for(const w of e){const v=new y(w.length-2);for(let _=2,E=w.length;_<E;_++)v[_-2]=w[_]-w[_-2];m.write(v)}m.close();const g=await new Response(b.readable).arrayBuffer();return new Uint8Array(g).toBase64()}static async decompressSignature(e){try{const t=Uint8Array.fromBase64(e),{readable:s,writable:n}=new DecompressionStream("deflate-raw"),i=n.getWriter();await i.ready,i.write(t).then(async()=>{await i.ready,await i.close()}).catch(()=>{});let r=null,a=0;for await(const w of s)r||=new Uint8Array(new Uint32Array(w.buffer,0,4)[0]),r.set(w,a),a+=w.length;const l=new Uint32Array(r.buffer,0,r.length>>2),c=l[1];if(c!==0)throw new Error(`Invalid version: ${c}`);const d=l[2],h=l[3],f=l[4]===0,p=l[5],b=l[6],m=l[7],y=[],g=(on+vs*b)*Uint32Array.BYTES_PER_ELEMENT;let x;switch(m){case Int8Array.BYTES_PER_ELEMENT:x=new Int8Array(r.buffer,g);break;case Int16Array.BYTES_PER_ELEMENT:x=new Int16Array(r.buffer,g);break;case Int32Array.BYTES_PER_ELEMENT:x=new Int32Array(r.buffer,g);break}a=0;for(let w=0;w<b;w++){const v=l[vs*w+on],_=new Float32Array(v+2);y.push(_);for(let E=0;E<vs-1;E++)_[E]=l[vs*w+on+E+1];for(let E=0;E<v;E++)_[E+2]=_[E]+x[a++]}return{areContours:f,thickness:p,outlines:y,width:d,height:h}}catch(t){return fe(`decompressSignature: ${t}`),null}}}class hr extends nl{constructor(){super(),super.updateProperties({fill:de._defaultLineColor,"stroke-width":0})}clone(){const e=new hr;return e.updateAll(this),e}}class ur extends Wn{constructor(e){super(e),super.updateProperties({stroke:de._defaultLineColor,"stroke-width":1})}clone(){const e=new ur(this._viewParameters);return e.updateAll(this),e}}class yt extends we{#e=!1;#t=null;#n=null;#s=null;static _type="signature";static _editorType=pe.SIGNATURE;static _defaultDrawingOptions=null;constructor(e){super({...e,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#n=e.signatureData||null,this.#t=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(e,t){de.initialize(e,t),this._defaultDrawingOptions=new hr,this._defaultDrawnSignatureOptions=new ur(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!1}static get typesMap(){return ue(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#t}}static computeTelemetryFinalData(e){const t=e.get("hasDescription");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let e,t;const{_isCopy:s}=this;if(s&&(this._isCopy=!1,e=this.x,t=this.y),super.render(),this._drawId===null)if(this.#n){const{lines:n,mustSmooth:i,areContours:r,description:a,uuid:l,heightInPage:c}=this.#n,{rawDims:{pageWidth:d,pageHeight:h},rotation:f}=this.parent.viewport,p=Ft.processDrawnLines({lines:n,pageWidth:d,pageHeight:h,rotation:f,innerMargin:yt._INNER_MARGIN,mustSmooth:i,areContours:r});this.addSignature(p,c,a,l)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#t||""}));return s&&(this._isCopy=!0,this._moveAfterPaste(e,t)),this.div}setUuid(e){this.#s=e,this.addEditToolbar()}getUuid(){return this.#s}get description(){return this.#t}set description(e){this.#t=e,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:e})),super.addEditToolbar().then(t=>{t?.updateEditSignatureButton(e)}))}getSignaturePreview(){const{newCurves:e,areContours:t,thickness:s,width:n,height:i}=this.#n,r=Math.max(n,i),a=Ft.processDrawnLines({lines:{curves:e.map(l=>({points:l})),thickness:s,width:n,height:i},pageWidth:r,pageHeight:r,rotation:0,innerMargin:0,mustSmooth:!1,areContours:t});return{areContours:t,outline:a.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(e,t,s,n){const{x:i,y:r}=this,{outline:a}=this.#n=e;this.#e=a instanceof Ii,this.description=s;let l;this.#e?l=yt.getDefaultDrawingOptions():(l=yt._defaultDrawnSignatureOptions.clone(),l.updateProperties({"stroke-width":a.thickness})),this._addOutlines({drawOutlines:a,drawingOptions:l});const[,c]=this.pageDimensions;let d=t/c;d=d>=1?.5:d,this.width*=d/this.height,this.width>=1&&(d*=.9/this.width,this.width=.9),this.height=d,this.setDims(),this.x=i,this.y=r,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(n),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!n,hasDescription:!!s}}),this.div.hidden=!1}getFromImage(e){const{rawDims:{pageWidth:t,pageHeight:s},rotation:n}=this.parent.viewport;return Ft.process(e,t,s,n,yt._INNER_MARGIN)}getFromText(e,t){const{rawDims:{pageWidth:s,pageHeight:n},rotation:i}=this.parent.viewport;return Ft.extractContoursFromText(e,t,s,n,i,yt._INNER_MARGIN)}getDrawnSignature(e){const{rawDims:{pageWidth:t,pageHeight:s},rotation:n}=this.parent.viewport;return Ft.processDrawnLines({lines:e,pageWidth:t,pageHeight:s,rotation:n,innerMargin:yt._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:e,thickness:t}){e?this._drawingOptions=yt.getDefaultDrawingOptions():(this._drawingOptions=yt._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":t}))}serialize(e=!1){if(this.isEmpty())return null;const{lines:t,points:s}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":n}}=this,i=Object.assign(super.serialize(e),{isSignature:!0,areContours:this.#e,color:[0,0,0],thickness:this.#e?0:n});return this.addComment(i),e?(i.paths={lines:t,points:s},i.uuid=this.#s,i.isCopy=!0):i.lines=t,this.#t&&(i.accessibilityData={type:"Figure",alt:this.#t}),i}static deserializeDraw(e,t,s,n,i,r){return r.areContours?Ii.deserialize(e,t,s,n,i,r):Ws.deserialize(e,t,s,n,i,r)}static async deserialize(e,t,s){const n=await super.deserialize(e,t,s);return n.#e=e.areContours,n.description=e.accessibilityData?.alt||"",n.#s=e.uuid,n}}class Wf extends de{#e=null;#t=null;#n=null;#s=null;#a=null;#r="";#i=null;#o=!1;#c=null;#l=!1;#u=!1;static _type="stamp";static _editorType=pe.STAMP;constructor(e){super({...e,name:"stampEditor"}),this.#s=e.bitmapUrl,this.#a=e.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(e,t){de.initialize(e,t)}static isHandlingMimeForPasting(e){return vn.includes(e)}static paste(e,t){t.pasteEditor({mode:pe.STAMP},{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){const t=e.get("hasAltText");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}#h(e,t=!1){if(!e){this.remove();return}this.#e=e.bitmap,t||(this.#t=e.id,this.#l=e.isSvg),e.file&&(this.#r=e.file.name),this.#m()}#f(){if(this.#n=null,this._uiManager.enableWaiting(!1),!!this.#i){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(e=null,t=!0){if(this.hasAltTextData())return null;const{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:n,width:i,height:r}=e||this.copyCanvas(null,null,!0).imageData,a=await s.guess({name:"altText",request:{data:n,width:i,height:r,channels:n.length/(i*r)}});if(!a)throw new Error("No response from the AI service.");if(a.error)throw new Error("Error from the AI service.");if(a.cancel)return null;if(!a.output)throw new Error("No valid response from the AI service.");const l=a.output;return await this.setGuessedAltText(l),t&&!this.hasAltTextData()&&(this.altTextData={alt:l,decorative:!1}),l}#g(){if(this.#t){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#t).then(s=>this.#h(s,!0)).finally(()=>this.#f());return}if(this.#s){const s=this.#s;this.#s=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromUrl(s).then(n=>this.#h(n)).finally(()=>this.#f());return}if(this.#a){const s=this.#a;this.#a=null,this._uiManager.enableWaiting(!0),this.#n=this._uiManager.imageManager.getFromFile(s).then(n=>this.#h(n)).finally(()=>this.#f());return}const e=document.createElement("input");e.type="file",e.accept=vn.join(",");const t=this._uiManager._signal;this.#n=new Promise(s=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const n=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#h(n)}s()},{signal:t}),e.addEventListener("cancel",()=>{this.remove(),s()},{signal:t})}).finally(()=>this.#f()),e.click()}remove(){this.#t&&(this.#e=null,this._uiManager.imageManager.deleteId(this.#t),this.#i?.remove(),this.#i=null,this.#c&&(clearTimeout(this.#c),this.#c=null)),super.remove()}rebuild(){if(!this.parent){this.#t&&this.#g();return}super.rebuild(),this.div!==null&&(this.#t&&this.#i===null&&this.#g(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(this.#n||this.#e||this.#s||this.#a||this.#t||this.#o)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;return this._isCopy&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#o||(this.#e?this.#m():this.#g()),this._isCopy&&this._moveAfterPaste(e,t),this._uiManager.addShouldRescale(this),this.div}setCanvas(e,t){const{id:s,bitmap:n}=this._uiManager.imageManager.getFromCanvas(e,t);t.remove(),s&&this._uiManager.imageManager.isValidId(s)&&(this.#t=s,n&&(this.#e=n),this.#o=!1,this.#m())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#c!==null&&clearTimeout(this.#c);const e=200;this.#c=setTimeout(()=>{this.#c=null,this.#p()},e)}#m(){const{div:e}=this;let{width:t,height:s}=this.#e;const[n,i]=this.pageDimensions,r=.75;if(this.width)t=this.width*n,s=this.height*i;else if(t>r*n||s>r*i){const l=Math.min(r*n/t,r*i/s);t*=l,s*=l}this._uiManager.enableWaiting(!1);const a=this.#i=document.createElement("canvas");a.setAttribute("role","img"),this.addContainer(a),this.width=t/n,this.height=s/i,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),this.#p(),this.#u||(this.parent.addUndoableEditor(this),this.#u=!0),this._reportTelemetry({action:"inserted_image"}),this.#r&&this.div.setAttribute("aria-description",this.#r),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(e,t,s=!1){e||(e=224);const{width:n,height:i}=this.#e,r=new ft;let a=this.#e,l=n,c=i,d=null;if(t){if(n>t||i>t){const E=Math.min(t/n,t/i);l=Math.floor(n*E),c=Math.floor(i*E)}d=document.createElement("canvas");const f=d.width=Math.ceil(l*r.sx),p=d.height=Math.ceil(c*r.sy);this.#l||(a=this.#d(f,p));const b=d.getContext("2d");b.filter=this._uiManager.hcmFilter;let m="white",y="#cfcfd8";this._uiManager.hcmFilter!=="none"?y="black":mu.isDarkMode&&(m="#8f8f9d",y="#42414d");const g=15,x=g*r.sx,w=g*r.sy,v=new OffscreenCanvas(x*2,w*2),_=v.getContext("2d");_.fillStyle=m,_.fillRect(0,0,x*2,w*2),_.fillStyle=y,_.fillRect(0,0,x,w),_.fillRect(x,w,x,w),b.fillStyle=b.createPattern(v,"repeat"),b.fillRect(0,0,f,p),b.drawImage(a,0,0,a.width,a.height,0,0,f,p)}let h=null;if(s){let f,p;if(r.symmetric&&a.width<e&&a.height<e)f=a.width,p=a.height;else if(a=this.#e,n>e||i>e){const y=Math.min(e/n,e/i);f=Math.floor(n*y),p=Math.floor(i*y),this.#l||(a=this.#d(f,p))}const m=new OffscreenCanvas(f,p).getContext("2d",{willReadFrequently:!0});m.drawImage(a,0,0,a.width,a.height,0,0,f,p),h={width:f,height:p,data:m.getImageData(0,0,f,p).data}}return{canvas:d,width:l,height:c,imageData:h}}#d(e,t){const{width:s,height:n}=this.#e;let i=s,r=n,a=this.#e;for(;i>2*e||r>2*t;){const l=i,c=r;i>2*e&&(i=i>=16384?Math.floor(i/2)-1:Math.ceil(i/2)),r>2*t&&(r=r>=16384?Math.floor(r/2)-1:Math.ceil(r/2));const d=new OffscreenCanvas(i,r);d.getContext("2d").drawImage(a,0,0,l,c,0,0,i,r),a=d.transferToImageBitmap()}return a}#p(){const[e,t]=this.parentDimensions,{width:s,height:n}=this,i=new ft,r=Math.ceil(s*e*i.sx),a=Math.ceil(n*t*i.sy),l=this.#i;if(!l||l.width===r&&l.height===a)return;l.width=r,l.height=a;const c=this.#l?this.#e:this.#d(r,a),d=l.getContext("2d");d.filter=this._uiManager.hcmFilter,d.drawImage(c,0,0,c.width,c.height,0,0,r,a)}#b(e){if(e){if(this.#l){const n=this._uiManager.imageManager.getSvgUrl(this.#t);if(n)return n}const t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#e,t.getContext("2d").drawImage(this.#e,0,0),t.toDataURL()}if(this.#l){const[t,s]=this.pageDimensions,n=Math.round(this.width*t*Ut.PDF_TO_CSS_UNITS),i=Math.round(this.height*s*Ut.PDF_TO_CSS_UNITS),r=new OffscreenCanvas(n,i);return r.getContext("2d").drawImage(this.#e,0,0,this.#e.width,this.#e.height,0,0,n,i),r.transferToImageBitmap()}return structuredClone(this.#e)}static async deserialize(e,t,s){let n=null,i=!1;if(e instanceof tl){const{data:{rect:m,rotation:y,id:g,structParent:x,popupRef:w,richText:v,contentsObj:_,creationDate:E,modificationDate:k},container:D,parent:{page:{pageNumber:N}},canvas:R}=e;let j,C;R?(delete e.canvas,{id:j,bitmap:C}=s.imageManager.getFromCanvas(D.id,R),R.remove()):(i=!0,e._hasNoCanvas=!0);const B=(await t._structTree.getAriaAttributes(`${Jt}${g}`))?.get("aria-label")||"";n=e={annotationType:pe.STAMP,bitmapId:j,bitmap:C,pageIndex:N-1,rect:m.slice(0),rotation:y,annotationElementId:g,id:g,deleted:!1,accessibilityData:{decorative:!1,altText:B},isSvg:!1,structParent:x,popupRef:w,richText:v,comment:_?.str||null,creationDate:E,modificationDate:k}}const r=await super.deserialize(e,t,s),{rect:a,bitmap:l,bitmapUrl:c,bitmapId:d,isSvg:h,accessibilityData:f}=e;i?(s.addMissingCanvas(e.id,r),r.#o=!0):d&&s.imageManager.isValidId(d)?(r.#t=d,l&&(r.#e=l)):r.#s=c,r.#l=h;const[p,b]=r.pageDimensions;return r.width=(a[2]-a[0])/p,r.height=(a[3]-a[1])/b,f&&(r.altTextData=f),r._initialData=n,e.comment&&r.setCommentData(e),r.#u=!!n,r}serialize(e=!1,t=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=Object.assign(super.serialize(e),{bitmapId:this.#t,isSvg:this.#l});if(this.addComment(s),e)return s.bitmapUrl=this.#b(!0),s.accessibilityData=this.serializeAltText(!0),s.isCopy=!0,s;const{decorative:n,altText:i}=this.serializeAltText(!1);if(!n&&i&&(s.accessibilityData={type:"Figure",alt:i}),this.annotationElementId){const a=this.#x(s);return a.isSame?null:(a.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1,s.id=this.annotationElementId,delete s.bitmapId,s)}if(t===null)return s;t.stamps||=new Map;const r=this.#l?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!t.stamps.has(this.#t))t.stamps.set(this.#t,{area:r,serialized:s}),s.bitmap=this.#b(!1);else if(this.#l){const a=t.stamps.get(this.#t);r>a.area&&(a.area=r,a.serialized.bitmap.close(),a.serialized.bitmap=this.#b(!1))}return s}#x(e){const{pageIndex:t,accessibilityData:{altText:s}}=this._initialData,n=e.pageIndex===t,i=(e.accessibilityData?.alt||"")===s;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&n&&i,isSameAltText:i}}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class wt{#e;#t=!1;#n=null;#s=null;#a=null;#r=new Map;#i=!1;#o=!1;#c=!1;#l=null;#u=null;#h=null;#f=null;#g=null;#m=-1;#d;static _initialized=!1;static#p=new Map([ze,dr,Wf,Le,yt].map(e=>[e._editorType,e]));constructor({uiManager:e,pageIndex:t,div:s,structTreeLayer:n,accessibilityManager:i,annotationLayer:r,drawLayer:a,textLayer:l,viewport:c,l10n:d}){const h=[...wt.#p.values()];if(!wt._initialized){wt._initialized=!0;for(const f of h)f.initialize(d,e)}e.registerEditorTypes(h),this.#d=e,this.pageIndex=t,this.div=s,this.#e=i,this.#n=r,this.viewport=c,this.#h=l,this.drawLayer=a,this._structTree=n,this.#d.addLayer(this)}updatePageIndex(e){this.pageIndex=e}get isEmpty(){return this.#r.size===0}get isInvisible(){return this.isEmpty&&this.#d.getMode()===pe.NONE}updateToolbar(e){this.#d.updateToolbar(e)}updateMode(e=this.#d.getMode()){switch(this.#v(),e){case pe.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case pe.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case pe.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===pe.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const s of wt.#p.values())t.toggle(`${s._type}Editing`,e===s._editorType)}this.div.hidden=!1}hasTextLayer(e){return e===this.#h?.div}setEditingState(e){this.#d.setEditingState(e)}addCommands(e){this.#d.addCommands(e)}cleanUndoStack(e){this.#d.cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){this.#n?.togglePointerEvents(e)}get#b(){return this.#r.size!==0?this.#r.values():this.#d.getEditors(this.pageIndex)}async enable(){this.#c=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#g?.abort(),this.#g=null;const e=new Set;for(const s of this.#b)s.enableEditing(),s.show(!0),s.annotationElementId&&(this.#d.removeChangedExistingAnnotation(s),e.add(s.annotationElementId));const t=this.#n;if(t)for(const s of t.getEditableAnnotations()){if(s.hide(),this.#d.isDeletedAnnotationElement(s.data.id)||e.has(s.data.id))continue;const n=await this.deserialize(s);n&&(this.addOrRebuild(n),n.enableEditing())}this.#c=!1,this.#d._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#h&&!this.#g){this.#g=new AbortController;const n=this.#d.combinedSignal(this.#g);this.#h.div.addEventListener("pointerdown",i=>{const{clientX:a,clientY:l,timeStamp:c}=i,d=this.#m;if(c-d>500){this.#m=c;return}this.#m=-1;const{classList:h}=this.div;h.toggle("getElements",!0);const f=document.elementsFromPoint(a,l);if(h.toggle("getElements",!1),!this.div.contains(f[0]))return;let p;const b=new RegExp(`^${Ns}[0-9]+$`);for(const y of f)if(b.test(y.id)){p=y.id;break}if(!p)return;const m=this.#r.get(p);m?.annotationElementId===null&&(i.stopPropagation(),i.preventDefault(),m.dblclick(i))},{signal:n,capture:!0})}const e=this.#n,t=[];if(e){const n=new Map,i=new Map;for(const a of this.#b){if(a.disableEditing(),!a.annotationElementId){t.push(a);continue}if(a.serialize()!==null){n.set(a.annotationElementId,a);continue}else i.set(a.annotationElementId,a);this.getEditableAnnotation(a.annotationElementId)?.show(),a.remove()}const r=e.getEditableAnnotations();for(const a of r){const{id:l}=a.data;if(this.#d.isDeletedAnnotationElement(l)){a.updateEdited({deleted:!0});continue}let c=i.get(l);if(c){c.resetAnnotationElement(a),c.show(!1),a.show();continue}c=n.get(l),c&&(this.#d.addChangedExistingAnnotation(c),c.renderAnnotationElement(a)&&c.show(!1)),a.show()}}this.#v(),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const n of wt.#p.values())s.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),e?.updateFakeAnnotations(t),this.#o=!1}getEditableAnnotation(e){return this.#n?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#d.getActive()!==e&&this.#d.setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,this.#h?.div&&!this.#f){this.#f=new AbortController;const e=this.#d.combinedSignal(this.#f);this.#h.div.addEventListener("pointerdown",this.#x.bind(this),{signal:e}),this.#h.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#h?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#h.div.classList.remove("highlighting"))}#x(e){this.#d.unselectAll();const{target:t}=e;if(t===this.#h.div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&this.#h.div.contains(t)){const{isMac:s}=Oe.platform;if(e.button!==0||e.ctrlKey&&s)return;this.#d.showAllEditors("highlight",!0,!0),this.#h.div.classList.add("free"),this.toggleDrawing(),Le.startHighlighting(this,this.#d.direction==="ltr",{target:this.#h.div,x:e.x,y:e.y}),this.#h.div.addEventListener("pointerup",()=>{this.#h.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#d._signal}),e.preventDefault()}}enableClick(){if(this.#s)return;this.#s=new AbortController;const e=this.#d.combinedSignal(this.#s);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){this.#s?.abort(),this.#s=null}attach(e){this.#r.set(e.id,e);const{annotationElementId:t}=e;t&&this.#d.isDeletedAnnotationElement(t)&&this.#d.removeDeletedAnnotationElement(e)}detach(e){this.#r.delete(e.id),this.#e?.removePointerInTextLayer(e.contentDiv),!this.#o&&e.annotationElementId&&this.#d.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#d.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(this.#d.addDeletedAnnotationElement(e),de.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),this.#d.addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!this.#c),this.#d.addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!this.#a&&(e._focusEventsAllowed=!1,this.#a=setTimeout(()=>{this.#a=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this.#d._signal}),t.focus())},0)),e._structTreeParentId=this.#e?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),s=()=>{e.remove()};this.addCommands({cmd:t,undo:s,mustExec:!1})}getEditorByUID(e){for(const t of this.#r.values())if(t.uid===e)return t;return null}getNextId(){return this.#d.getId()}get#y(){return wt.#p.get(this.#d.getMode())}combinedSignal(e){return this.#d.combinedSignal(e)}#E(e){const t=this.#y;return t?new t.prototype.constructor(e):null}canCreateNewEmptyEditor(){return this.#y?.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await this.#d.updateMode(e.mode);const{offsetX:s,offsetY:n}=this.#S(),i=this.getNextId(),r=this.#E({parent:this,id:i,x:s,y:n,uiManager:this.#d,isCentered:!0,...t});r&&this.add(r)}async deserialize(e){return await wt.#p.get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,this.#d)||null}createAndAddNewEditor(e,t,s={}){const n=this.getNextId(),i=this.#E({parent:this,id:n,x:e.offsetX,y:e.offsetY,uiManager:this.#d,isCentered:t,...s});return i&&this.add(i),i}get boundingClientRect(){return this.div.getBoundingClientRect()}#S(){const{x:e,y:t,width:s,height:n}=this.boundingClientRect,i=Math.max(0,e),r=Math.max(0,t),a=Math.min(window.innerWidth,e+s),l=Math.min(window.innerHeight,t+n),c=(i+a)/2-e,d=(r+l)/2-t,[h,f]=this.viewport.rotation%180===0?[c,d]:[d,c];return{offsetX:h,offsetY:f}}addNewEditor(e={}){this.createAndAddNewEditor(this.#S(),!0,e)}setSelected(e){this.#d.setSelected(e)}toggleSelected(e){this.#d.toggleSelected(e)}unselect(e){this.#d.unselect(e)}pointerup(e){const{isMac:t}=Oe.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!this.#i||(this.#i=!1,this.#y?.isDrawer&&this.#y.supportMultipleDrawings))return;if(!this.#t){this.#t=!0;return}const s=this.#d.getMode();if(s===pe.STAMP||s===pe.SIGNATURE){this.#d.unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){if(this.#d.getMode()===pe.HIGHLIGHT&&this.enableTextSelection(),this.#i){this.#i=!1;return}const{isMac:t}=Oe.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(this.#i=!0,this.#y?.isDrawer){this.startDrawingSession(e);return}const s=this.#d.getActive();this.#t=!s||s.isEmpty()}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),this.#l){this.#y.startDrawing(this,this.#d,!1,e);return}this.#d.setCurrentDrawingSession(this),this.#l=new AbortController;const t=this.#d.combinedSignal(this.#l);this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(this.#u=null,this.commitOrRemove())},{signal:t}),this.#y.startDrawing(this,this.#d,!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&(this.#u=t);return}this.#u&&setTimeout(()=>{this.#u?.focus(),this.#u=null},0)}endDrawingSession(e=!1){return this.#l?(this.#d.setCurrentDrawingSession(null),this.#l.abort(),this.#l=null,this.#u=null,this.#y.endDrawing(e)):null}findNewParent(e,t,s){const n=this.#d.findParent(t,s);return n===null||n===this?!1:(n.changeParent(e),!0)}commitOrRemove(){return this.#l?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#l&&this.#y.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#d.getActive()?.parent===this&&(this.#d.commitOrRemove(),this.#d.setActiveEditor(null)),this.#a&&(clearTimeout(this.#a),this.#a=null);for(const e of this.#r.values())this.#e?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#r.clear(),this.#d.removeLayer(this)}#v(){for(const e of this.#r.values())e.isEmpty()&&e.remove()}render({viewport:e}){this.viewport=e,Lt(this.div,e);for(const t of this.#d.getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){this.#d.commitOrRemove(),this.#v();const t=this.viewport.rotation,s=e.rotation;if(this.viewport=e,Lt(this.div,{rotation:s}),t!==s)for(const n of this.#r.values())n.rotate(s)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return this.#d.viewParameters.realScale}}class He{#e=null;#t=new Map;#n=new Map;static#s=0;setParent(e){if(!this.#e){this.#e=e;return}if(this.#e!==e){if(this.#t.size>0)for(const t of this.#t.values())t.remove(),e.append(t);this.#e=e}}static get _svgFactory(){return ue(this,"_svgFactory",new Is)}static#a(e,[t,s,n,i]){const{style:r}=e;r.top=`${100*s}%`,r.left=`${100*t}%`,r.width=`${100*n}%`,r.height=`${100*i}%`}#r(){const e=He._svgFactory.create(1,1,!0);return this.#e.append(e),e.setAttribute("aria-hidden",!0),e}#i(e,t){const s=He._svgFactory.createElement("clipPath");e.append(s);const n=`clip_${t}`;s.setAttribute("id",n),s.setAttribute("clipPathUnits","objectBoundingBox");const i=He._svgFactory.createElement("use");return s.append(i),i.setAttribute("href",`#${t}`),i.classList.add("clip"),n}#o(e,t){for(const[s,n]of Object.entries(t))n===null?e.removeAttribute(s):e.setAttribute(s,n)}draw(e,t=!1,s=!1){const n=He.#s++,i=this.#r(),r=He._svgFactory.createElement("defs");i.append(r);const a=He._svgFactory.createElement("path");r.append(a);const l=`path_${n}`;a.setAttribute("id",l),a.setAttribute("vector-effect","non-scaling-stroke"),t&&this.#n.set(n,a);const c=s?this.#i(r,l):null,d=He._svgFactory.createElement("use");return i.append(d),d.setAttribute("href",`#${l}`),this.updateProperties(i,e),this.#t.set(n,i),{id:n,clipPathId:`url(#${c})`}}drawOutline(e,t){const s=He.#s++,n=this.#r(),i=He._svgFactory.createElement("defs");n.append(i);const r=He._svgFactory.createElement("path");i.append(r);const a=`path_${s}`;r.setAttribute("id",a),r.setAttribute("vector-effect","non-scaling-stroke");let l;if(t){const h=He._svgFactory.createElement("mask");i.append(h),l=`mask_${s}`,h.setAttribute("id",l),h.setAttribute("maskUnits","objectBoundingBox");const f=He._svgFactory.createElement("rect");h.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const p=He._svgFactory.createElement("use");h.append(p),p.setAttribute("href",`#${a}`),p.setAttribute("stroke","none"),p.setAttribute("fill","black"),p.setAttribute("fill-rule","nonzero"),p.classList.add("mask")}const c=He._svgFactory.createElement("use");n.append(c),c.setAttribute("href",`#${a}`),l&&c.setAttribute("mask",`url(#${l})`);const d=c.cloneNode();return n.append(d),c.classList.add("mainOutline"),d.classList.add("secondaryOutline"),this.updateProperties(n,e),this.#t.set(s,n),s}finalizeDraw(e,t){this.#n.delete(e),this.updateProperties(e,t)}updateProperties(e,t){if(!t)return;const{root:s,bbox:n,rootClass:i,path:r}=t,a=typeof e=="number"?this.#t.get(e):e;if(a){if(s&&this.#o(a,s),n&&He.#a(a,n),i){const{classList:l}=a;for(const[c,d]of Object.entries(i))l.toggle(c,d)}if(r){const c=a.firstElementChild.firstElementChild;this.#o(c,r)}}}updateParent(e,t){if(t===this)return;const s=this.#t.get(e);s&&(t.#e.append(s),this.#t.delete(e),t.#t.set(e,s))}remove(e){this.#n.delete(e),this.#e!==null&&(this.#t.get(e).remove(),this.#t.delete(e))}destroy(){this.#e=null;for(const e of this.#t.values())e.remove();this.#t.clear(),this.#n.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:Ri};globalThis.pdfjsLib={AbortException:Ct,AnnotationEditorLayer:wt,AnnotationEditorParamsType:ge,AnnotationEditorType:pe,AnnotationEditorUIManager:Tt,AnnotationLayer:$n,AnnotationMode:St,AnnotationType:je,applyOpacity:ko,build:Ko,ColorPicker:it,createValidAbsoluteUrl:qi,CSSConstants:Eo,DOMSVGFactory:Is,DrawLayer:He,FeatureTest:Oe,fetchData:fs,findContrastColor:Co,getDocument:Yo,getFilenameFromUrl:Ao,getPdfFilenameFromUrl:So,getRGB:ps,getUuid:Zi,getXfaPageViewport:_o,GlobalWorkerOptions:Bt,ImageKind:ks,InvalidPDFException:xn,isDataScheme:zs,isPdfFile:Fn,isValidExplicitDest:Do,MathClamp:We,noContextMenu:at,normalizeUnicode:vo,OPS:os,OutputScale:ft,PagesMapper:xe,PasswordResponses:wo,PDFDataRangeTransport:or,PDFDateString:wn,PDFWorker:$e,PermissionFlag:xo,PixelsPerInch:Ut,RenderingCancelledException:Mn,renderRichText:Qi,ResponseException:Ps,setLayerDimensions:Lt,shadow:ue,SignatureExtractor:Ft,stopEvent:De,SupportedImageMimeTypes:vn,TextLayer:tt,TouchManager:$s,updateUrlHash:Ki,Util:se,VerbosityLevel:Bs,version:qo,XfaLayer:Ji};const Gf=Object.freeze(Object.defineProperty({__proto__:null,AbortException:Ct,AnnotationEditorLayer:wt,AnnotationEditorParamsType:ge,AnnotationEditorType:pe,AnnotationEditorUIManager:Tt,AnnotationLayer:$n,AnnotationMode:St,AnnotationType:je,CSSConstants:Eo,ColorPicker:it,DOMSVGFactory:Is,DrawLayer:He,FeatureTest:Oe,GlobalWorkerOptions:Bt,ImageKind:ks,InvalidPDFException:xn,MathClamp:We,OPS:os,OutputScale:ft,PDFDataRangeTransport:or,PDFDateString:wn,PDFWorker:$e,PagesMapper:xe,PasswordResponses:wo,PermissionFlag:xo,PixelsPerInch:Ut,RenderingCancelledException:Mn,ResponseException:Ps,SignatureExtractor:Ft,SupportedImageMimeTypes:vn,TextLayer:tt,TouchManager:$s,Util:se,VerbosityLevel:Bs,XfaLayer:Ji,applyOpacity:ko,build:Ko,createValidAbsoluteUrl:qi,fetchData:fs,findContrastColor:Co,getDocument:Yo,getFilenameFromUrl:Ao,getPdfFilenameFromUrl:So,getRGB:ps,getUuid:Zi,getXfaPageViewport:_o,isDataScheme:zs,isPdfFile:Fn,isValidExplicitDest:Do,noContextMenu:at,normalizeUnicode:vo,renderRichText:Qi,setLayerDimensions:Lt,shadow:ue,stopEvent:De,updateUrlHash:Ki,version:qo},Symbol.toStringTag,{value:"Module"}));let ca=!1;const da=()=>{import.meta?.env?.VITEST||ca||typeof Worker>"u"||(Bt.workerPort=new Worker(new URL("/_astro/pdf.worker.min-CwpCpSQE.js",import.meta.url),{type:"module"}),ca=!0)},ha=()=>import.meta?.env?.VITEST?void 0:new URL("pdfjs-dist/standard_fonts/",import.meta.url).toString(),ua=async o=>{try{let e="";for(let t=1;t<=o.numPages;t++){const i=(await(await o.getPage(t)).getTextContent()).items.map(r=>r.str).join(" ");e+=i+"\f"}return e}catch(e){throw console.error("Error extracting text from PDF:",e?.message||e),e}},Sn=async o=>{let e;if(typeof o=="string")e=new TextEncoder().encode(o);else if(o instanceof ArrayBuffer)e=new Uint8Array(o);else if(o instanceof Uint8Array)e=o;else throw new Error("computeSHA256: unsupported input type");const t=await crypto.subtle.digest("SHA-256",e);return Array.from(new Uint8Array(t)).map(n=>n.toString(16).padStart(2,"0")).join("")};function js({pageCount:o,extractedText:e,pdfSizeBytes:t}){const s=String(e||""),i=s.split("\f").filter(r=>r!==void 0).slice(0,o).map(r=>String(r||"").trim().length);return{pageCount:o,charsPerPage:i,totalChars:s.replace(/\f/g,"").length,pdfSizeBytes:t||0}}const fr=()=>{const[o,e]=T.useState(!1),[t,s]=T.useState(null),[n,i]=T.useState(null),[r,a]=T.useState(1),[l,c]=T.useState(1.5),[d,h]=T.useState(""),[f,p]=T.useState(null),[b,m]=T.useState(null),[y,g]=T.useState(!1),[x,w]=T.useState(""),[v,_]=T.useState(null);T.useEffect(()=>{(async()=>{if(window.pdfjsLib){da(),e(!0);return}try{const j=await Nn(()=>Promise.resolve().then(()=>Gf),[]);window.pdfjsLib=j,da(),e(!0)}catch(j){console.error("Failed to load PDF.js:",j),_(j)}})()},[]);const E=T.useCallback(async R=>{if(!(!window.pdfjsLib||!R))try{g(!0),_(null);const j=R.name||"document";w(`Loading ${j}...`);const C=await R.arrayBuffer(),B=await Sn(C);m(B);const O=await window.pdfjsLib.getDocument({data:C,onProgress:G=>{if(G.total>0){const z=Math.round(G.loaded/G.total*100);w(`Loading ${j}: ${z}%`)}},standardFontDataUrl:ha()}).promise;s(O),i(O.numPages),w(`Extracting text from ${j}...`);const U=await ua(O);h(U);const M=js({pageCount:O.numPages,extractedText:U,pdfSizeBytes:C.byteLength});return p(M),a(1),w(""),{docHash:B,stats:M,text:U}}catch(j){throw console.error("Error loading PDF from blob:",j),_(j),w(""),j}finally{g(!1)}},[]),k=T.useCallback(async R=>{if(window.pdfjsLib)try{g(!0),_(null),w(`Loading ${R}...`);const j=`/test-docs/${R}`,C=await fetch(j);if(!C.ok)throw new Error(`Failed to fetch PDF: ${C.statusText}`);const B=await C.arrayBuffer(),S=await Sn(B);m(S);const U=await window.pdfjsLib.getDocument({data:B,onProgress:z=>{if(z.total>0){const $=Math.round(z.loaded/z.total*100);w(`Loading ${R}: ${$}%`)}},standardFontDataUrl:ha()}).promise;s(U),i(U.numPages),w(`Extracting text from ${R}...`);const M=await ua(U);h(M);const G=js({pageCount:U.numPages,extractedText:M,pdfSizeBytes:B.byteLength});return p(G),a(1),w(""),{docHash:S,stats:G,text:M,fileInfo:{name:R,size:B.byteLength,type:"application/pdf"}}}catch(j){throw console.error("Error loading test PDF:",j),_(j),w(""),j}finally{g(!1)}},[]),D=T.useMemo(()=>({goToPreviousPage:()=>a(R=>Math.max(R-1,1)),goToNextPage:()=>a(R=>Math.min(R+1,n||1)),zoomIn:()=>c(R=>Math.min(R+.2,3)),zoomOut:()=>c(R=>Math.max(R-.2,.5)),setPageNumber:a,setPageScale:c}),[n]),N=T.useCallback(()=>{try{t?.destroy?.()}catch{}s(null),i(null),a(1),c(1.5),h(""),p(null),m(null),g(!1),w(""),_(null)},[t]);return{pdfLibLoaded:o,pdfDoc:t,numPages:n,pageNumber:r,pageScale:l,pdfTextContent:d,docStats:f,docHash:b,isLoading:y,loadingMessage:x,loadError:v,loadPdfFromBlob:E,loadTestPdf:k,navigation:D,resetPdf:N}};async function Vf({functions:o,docHash:e,text:t}){if(!o)throw new Error("Firebase functions not available");const s=st(o,"analyzeByType");if(typeof s!="function")throw new Error("analyzeByType callable not available");return(await s({docHash:e,text:t}))?.data}async function Xf({functions:o,docHash:e,stats:t}){if(!o)throw new Error("Firebase functions not available");const s=st(o,"preflightCheck");if(typeof s!="function")throw new Error("preflightCheck callable not available");return(await s({docHash:e,stats:t}))?.data}async function Yf({functions:o,payload:e}){if(!o)throw new Error("Firebase functions not available");const t=st(o,"analyzeText");if(typeof t!="function")throw new Error("analyzeText callable not available");return await t(e)}const qf=async({functions:o,docHash:e,selection:t,documentContext:s})=>(await st(o,"explainSelection")({docHash:e,selection:t,documentContext:s})).data,Kf=async({functions:o,docHash:e,documentText:t,documentType:s})=>(await st(o,"highlightRisks")({docHash:e,documentText:t,documentType:s})).data,Zf=async({functions:o,docHash:e,legalText:t})=>(await st(o,"translateToPlainEnglish")({docHash:e,legalText:t})).data,Jf=({functions:o,authState:e,isMockMode:t})=>{const[s,n]=T.useState({}),[i,r]=T.useState(null),[a,l]=T.useState(null),[c,d]=T.useState(!1),h=()=>t&&e.status==="authenticated"?!0:o&&e.status==="authenticated",f=async({pdfTextContent:v,numPages:_,selectedDocument:E,docHash:k})=>{if(!v||!_)return{ok:!0,classification:"OK"};if(t)return{ok:!0,classification:"OK"};try{const D=js({pageCount:_,extractedText:v,pdfSizeBytes:E?.size||0});return await Xf({functions:o,docHash:k,stats:D})}catch(D){return console.error("Preflight check error:",D),{ok:!0,classification:"OK"}}},p=async({selectedDocument:v,pdfTextContent:_,docHash:E})=>{if(!(!v||!_||!E)){if(!h()){console.warn("Type-specific analysis unavailable: Firebase services not accessible.");return}n(k=>({...k,[v.id]:{...k[v.id],_meta:{status:"loading",message:"Running type-specific analysisâ€¦"}}})),d(!0);try{if(t){l({title:"Type-specific analysis (beta)",message:"Not available in mock mode yet.",primaryLabel:"OK",primaryTo:null,secondaryLabel:null,secondaryTo:null}),n(N=>({...N,[v.id]:{...N[v.id],_meta:{status:"error",message:"Not available in mock mode yet."}}}));return}const k=await Vf({functions:o,docHash:E,text:_})||{},D={ok:!!k.ok,effectiveTypeId:k.effectiveTypeId||null,validationSlug:k.validationSlug||null,validationTitle:k.validationSpec?.title||null,message:k.message||null,result:k.result||null,usage:k.usage||null,requiredTier:k.requiredTier||null,code:k.code||null};n(N=>({...N,[v.id]:{...N[v.id],_meta:{status:"success"},typeSpecific:D}}))}catch(k){console.error("analyzeByType error:",k),n(D=>({...D,[v.id]:{...D[v.id],_meta:{status:"error",message:k?.message||"Request failed."}}})),l({title:"Type-specific analysis failed",message:k?.message||"Request failed.",primaryLabel:"OK",primaryTo:null,secondaryLabel:null,secondaryTo:null})}finally{d(!1)}}},b=async({selectedDocument:v,pdfTextContent:_,docHash:E,numPages:k,updateAnnotations:D})=>{if(!(!v||!E)&&!(!_&&!t)){if(!h()){console.warn("Document analysis unavailable: Firebase services not accessible.");return}n(N=>({...N,[v.id]:{...N[v.id],_meta:{status:"loading",message:"Running analysisâ€¦"}}})),d(!0);try{const N=await f({pdfTextContent:_,numPages:k,selectedDocument:v,docHash:E});if(!N.ok)throw console.error("Preflight check failed:",N),new Error(N.message||"Preflight check failed");if(N.classification==="PRO_REQUIRED"){const U=N.reasons?.map(M=>M.message).join(" ")||"This document requires Pro features (OCR / deeper processing).";n(M=>({...M,[v.id]:{...M[v.id],_meta:{status:"error",message:U}}})),r({title:"Pro required",message:U,primaryLabel:"Upgrade to Pro",primaryTo:"/pricing",secondaryLabel:"Cancel",secondaryTo:null});return}const R=js({pageCount:k,extractedText:_,pdfSizeBytes:v?.size||0}),j=typeof _=="string"?_:"",C=j.split("\f"),{charsPerPage:B,totalChars:S}=R;let O;if(t?O={data:await(await fetch("/analyzeText",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({docHash:E,stats:{pageCount:k,charsPerPage:B,totalChars:S,languageHint:"en"},text:{format:"paged",value:j},options:{tasks:["explain","caveats","inconsistencies"],targetLanguage:null}})})).json()}:O=await Yf({functions:o,payload:{docHash:E,stats:{pageCount:k,charsPerPage:B,totalChars:S,languageHint:"en"},text:{format:"paged",value:j,pageTextIndex:C.map((U,M)=>({page:M+1,start:0,end:U.length}))},options:{tasks:["explain","caveats","inconsistencies"],targetLanguage:null}}}),O.data.ok){r(null),l(null);const U={_meta:{status:"success"},summary:O.data.result.plainExplanation,keyPoints:[],risks:O.data.result.risks.map(M=>{const G=Array.isArray(M.whatToCheck)?M.whatToCheck:[];return{id:M.id,clause:M.title,riskLevel:M.severity,description:M.whyItMatters,explanation:G.join("; ")}}),recommendations:O.data.result.risks.flatMap(M=>Array.isArray(M.whatToCheck)?M.whatToCheck:[])};n(M=>({...M,[v.id]:U})),D&&D(U)}else{const U=O.data.code;if(U==="SCAN_DETECTED_PRO_REQUIRED"){const M=O.data.message||"This PDF appears to be scanned. OCR is available on Pro.";n(G=>({...G,[v.id]:{...G[v.id],_meta:{status:"error",message:M}}})),r({title:"Scanned PDF (OCR requires Pro)",message:M,primaryLabel:"Upgrade to Pro",primaryTo:"/pricing",secondaryLabel:"Cancel",secondaryTo:null,secondaryTo:null});return}if(U==="ANON_TOKEN_LIMIT"){const M=O.data.message||"Anonymous token limit reached. Create a free account to continue.";n(G=>({...G,[v.id]:{...G[v.id],_meta:{status:"error",message:M}}})),l({title:"Limit reached",message:M,primaryLabel:"Create free account",primaryTo:"/sign-in",secondaryLabel:"Cancel",secondaryTo:null});return}if(U==="FREE_TOKEN_LIMIT"){const M=O.data.message||"Daily token limit reached. Upgrade to Pro to continue.";n(G=>({...G,[v.id]:{...G[v.id],_meta:{status:"error",message:M}}})),r({title:"Daily limit reached",message:M,primaryLabel:"Upgrade to Pro",primaryTo:"/pricing",secondaryLabel:"Cancel",secondaryTo:null});return}throw console.error("Analysis failed:",O.data),new Error(O.data.message||"Analysis failed")}}catch(N){console.error("Error analyzing document:",N),n(R=>({...R,[v.id]:{...R[v.id],_meta:{status:"error",message:N?.message||"Analysis failed."}}})),l({title:"Analysis failed",message:N?.message||"Request failed.",primaryLabel:"OK",primaryTo:null,secondaryLabel:null,secondaryTo:null});return}finally{d(!1)}}};return{analysisResults:s,gate:i,dialog:a,setGate:r,setDialog:l,isLoading:c,handleAnalyzeDocument:b,handleAnalyzeByType:p,handleExplainSelection:async v=>{const{selectedDocument:_,docHash:E,pdfTextContent:k}=v;if(!_||!E)return;if(!h()){console.warn("Explain selection unavailable: Firebase services not accessible.");return}const D=v.selection?.text;if(!D){l({title:"No selection",message:"Please select some text in the document first.",primaryLabel:"OK"});return}try{let N;if(t?N=await(await fetch("/explainSelection",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({docHash:E,selection:D,documentContext:k})})).json():N=await qf({functions:o,docHash:E,selection:D,documentContext:k}),N.ok)l({title:"Explanation",message:N.explanation?.plainExplanation||"No explanation available.",primaryLabel:"OK",primaryTo:null});else throw console.error("Explanation failed:",N),new Error(N.error||"Explanation failed")}catch(N){throw console.error("Error explaining selection:",N),N}},handleHighlightRisks:async({selectedDocument:v,docHash:_,pdfTextContent:E,setRiskBadges:k})=>{if(!(!v||!_)){if(!h()){console.warn("Risk highlighting unavailable: Firebase services not accessible.");return}d(!0);try{let D;if(t?D=await(await fetch("/highlightRisks",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({docHash:_,documentText:E,documentType:"contract"})})).json():D=await Kf({functions:o,docHash:_,documentText:E,documentType:"contract"}),D.ok){l({title:"Risk scan complete",message:`Found ${D.risks?.summary?.totalRisks||0} risks in the document.`,primaryLabel:"OK",primaryTo:null});const N=D.risks.items?.map((R,j)=>({id:j,pageNum:1,x:150+j*40,y:150+j*35,level:R.severity,description:R.description,explanation:R.explanation}))||[];k(N)}else throw console.error("Risk highlighting failed:",D),new Error(D.error||"Risk highlighting failed")}catch(D){throw console.error("Error highlighting risks:",D),D}finally{d(!1)}}},handleTranslateToPlainEnglish:async({selectedDocument:v,docHash:_,pdfTextContent:E})=>{if(!(!v||!_)){if(!h()){console.warn("Translation unavailable: Firebase services not accessible.");return}try{const k=E.substring(0,500);let D;if(t?D=await(await fetch("/translateToPlainEnglish",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({docHash:_,legalText:k})})).json():D=await Zf({functions:o,docHash:_,legalText:k}),D.ok)l({title:"Plain English translation",message:`Original: ${D.translation?.originalText||""}

Plain English: ${D.translation?.plainEnglishTranslation||""}`,primaryLabel:"OK",primaryTo:null});else throw console.error("Translation failed:",D),new Error(D.error||"Translation failed")}catch(k){throw console.error("Error translating to plain English:",k),k}}},handleSummarizeKeyPoints:async({selectedDocument:v,docHash:_,pdfTextContent:E})=>{if(!(!v||!_))return b({selectedDocument:v,pdfTextContent:E,docHash:_,numPages:1})},handleSuggestImprovements:async({selectedDocument:v,docHash:_,pdfTextContent:E})=>{if(!(!v||!_))return b({selectedDocument:v,pdfTextContent:E,docHash:_,numPages:1})}}};async function Qf({functions:o,docHash:e,typeId:t}){if(!o)throw new Error("Firebase functions not available");const s=st(o,"saveDocTypeOverride");return typeof s!="function"?null:(await s({docHash:e,typeId:t}))?.data}async function ep({functions:o,docHash:e}){if(!o)throw new Error("Firebase functions not available");const t=st(o,"getDocumentTypeState");return typeof t!="function"?null:(await t({docHash:e}))?.data}async function tp({functions:o,docHash:e,stats:t,text:s}){if(!o)throw new Error("Firebase functions not available");const n=st(o,"detectDocumentType");return typeof n!="function"?null:(await n({docHash:e,stats:t,text:s}))?.data}const sp=({functions:o,isMockMode:e})=>{const[t,s]=T.useState("legal_contract_generic"),[n,i]=T.useState(null),[r,a]=T.useState(null),[l,c]=T.useState(null);return{detectedDocTypeId:t,detectedMeta:n,overrideDocTypeId:r,pendingOverride:l,setOverrideDocTypeId:a,setPendingOverride:c,loadServerTypeState:async b=>{if(!(!o||e))try{const m=await ep({functions:o,docHash:b})||{};m?.overrideTypeId&&a(m.overrideTypeId),m?.detected?.typeId&&s(m.detected.typeId),m?.detected&&i({intakeCategory:m.detected.intakeCategory||null,confidence:typeof m.detected.confidence=="number"?m.detected.confidence:null,model:m.detected.model||null,updatedAt:m.detected.updatedAt||null})}catch(m){console.warn("Failed to load server document type state",m)}},runServerDetection:async({docHashValue:b,stats:m,text:y})=>{if(!(!o||e))try{const g=await tp({functions:o,docHash:b,stats:m,text:y})||{};g?.typeId&&s(g.typeId),i({intakeCategory:g.intakeCategory||null,confidence:typeof g.confidence=="number"?g.confidence:null,model:g.model||"heuristic-v1",updatedAt:null})}catch(g){console.warn("Failed to detect document type",g)}},persistOverride:async(b,m)=>{try{localStorage.setItem(`decodocs:doctype:${b}`,String(m))}catch{}if(!(!o||e))try{await Qf({functions:o,docHash:b,typeId:m})}catch(y){console.warn("Failed to persist doc type override",y)}},loadLocalOverride:b=>{try{const m=localStorage.getItem(`decodocs:doctype:${b}`);m&&a(m)}catch{}},setDetectedDocTypeId:s}},np=()=>{const[o,e]=T.useState(null),t=T.useCallback(()=>{const s=window.getSelection();if(!s||s.rangeCount===0||s.isCollapsed){e(null);return}const n=s.toString().trim();if(!n){e(null);return}const i=s.getRangeAt(0),r=i.getClientRects(),a=i.getBoundingClientRect();e({text:n,boundingBox:a,rects:r})},[]);return T.useEffect(()=>(document.addEventListener("selectionchange",t),()=>{document.removeEventListener("selectionchange",t)}),[t]),o},ip=(o,e=50)=>Array.isArray(o)?o.length<=e?o:o.slice(o.length-e):[],fa=({signatures:o,annotations:e,selectedItemId:t})=>({signatures:Array.isArray(o)?o.map(s=>({...s})):[],annotations:Array.isArray(e)?e.map(s=>({...s})):[],selectedItemId:t||null}),rp=({initialSignatures:o=[],initialAnnotations:e=[]}={})=>{const[t,s]=T.useState("select"),[n,i]=T.useState(()=>Array.isArray(o)?o:[]),[r,a]=T.useState(()=>Array.isArray(e)?e:[]),[l,c]=T.useState(!1),[d,h]=T.useState(null),[f,p]=T.useState(null),b=T.useRef(null),m=T.useRef(n),y=T.useRef(r),g=T.useRef(f);T.useEffect(()=>{m.current=n},[n]),T.useEffect(()=>{y.current=r},[r]),T.useEffect(()=>{g.current=f},[f]);const x=T.useRef(null),[w,v]=T.useState(0);if(!x.current){const $=fa({signatures:Array.isArray(o)?o:[],annotations:Array.isArray(e)?e:[],selectedItemId:null});x.current={stack:[$],index:0}}const _=w>0,E=T.useMemo(()=>{const $=x.current?.stack?.length||0;return w<$-1},[w]),k=T.useCallback($=>{const L=x.current;if(!L)return;const F=fa($),Y=L.stack.slice(0,L.index+1),K=ip([...Y,F],60);L.stack=K,L.index=K.length-1,v(L.index)},[]),D=T.useCallback(()=>{const $=x.current;if(!$||$.index<=0)return;const L=$.index-1,F=$.stack[L];F&&($.index=L,v(L),i(F.signatures),a(F.annotations),p(F.selectedItemId))},[]),N=T.useCallback(()=>{const $=x.current;if(!$||$.index>=$.stack.length-1)return;const L=$.index+1,F=$.stack[L];F&&($.index=L,v(L),i(F.signatures),a(F.annotations),p(F.selectedItemId))},[]),R=($,L)=>{if(!$||!L)return null;const F=$.querySelector?.(`#pdf-page-${L}`)||null;return F||(typeof document<"u"?document.getElementById(`pdf-page-${L}`):null)||null},j=T.useCallback(($,L,F)=>{a(Y=>Y.map(K=>K.id===$?{...K,x:L,y:F}:K))},[]),C=T.useCallback(($,L,F)=>{i(Y=>Y.map(K=>K.id===$?{...K,x:L,y:F}:K))},[]),B=T.useCallback(($,L,F)=>{if(b.current)return;$.stopPropagation();const Y=$.currentTarget||$.target,K=Number.isFinite(Number($.pointerId))?Number($.pointerId):null,X=L?.pageNum||null,te=(X&&typeof document<"u"?document.getElementById(`pdf-page-${X}`):null)||$.target.closest?.("#pdf-page-1")||$.target.closest?.('[id^="pdf-page-"]')||$.target.closest?.("[data-page-num]")||null;if(!te||!X)return;const ae=te.getBoundingClientRect(),ie=$.clientX-ae.left-L.x,le=$.clientY-ae.top-L.y;p(L.id),b.current={id:L.id,kind:F,offsetX:ie,offsetY:le,pageEl:te,hasMoved:!1};const ce=be=>{if(!b.current)return;b.current.hasMoved=!0;const _e=b.current.pageEl.getBoundingClientRect(),A=be.clientX-_e.left-b.current.offsetX,q=be.clientY-_e.top-b.current.offsetY;b.current.kind==="annotation"?j(b.current.id,A,q):C(b.current.id,A,q)},oe=()=>{const be=!!b.current?.hasMoved;b.current=null,document.removeEventListener("mousemove",ce,!0),document.removeEventListener("mouseup",oe,!0),document.removeEventListener("pointermove",ce,!0),document.removeEventListener("pointerup",oe,!0),Y?.removeEventListener&&(Y.removeEventListener("pointermove",ce,!0),Y.removeEventListener("pointerup",oe,!0),Y.removeEventListener("pointercancel",oe,!0)),be&&k({signatures:m.current,annotations:y.current,selectedItemId:g.current})};if(K!==null&&Y?.setPointerCapture)try{Y.setPointerCapture(K)}catch{}document.addEventListener("mousemove",ce,!0),document.addEventListener("mouseup",oe,!0),document.addEventListener("pointermove",ce,!0),document.addEventListener("pointerup",oe,!0),Y?.addEventListener&&(Y.addEventListener("pointermove",ce,!0),Y.addEventListener("pointerup",oe,!0),Y.addEventListener("pointercancel",oe,!0))},[k,j,C]),S=T.useRef(!1),O=T.useCallback(async()=>typeof document>"u"?null:await new Promise($=>{const L=document.createElement("input");L.type="file",L.accept="image/*",L.multiple=!1;const F=()=>{L.onchange=null;try{L.remove()}catch{}};L.onchange=async()=>{try{const Y=L.files?.[0]||null;if(!Y){F(),$(null);return}const K=await new Promise((te,ae)=>{const ie=new FileReader;ie.onload=()=>te(String(ie.result||"")),ie.onerror=()=>ae(new Error("Failed to read image file")),ie.readAsDataURL(Y)}),X=new Image;X.onload=()=>{const te={dataUrl:K,width:X.naturalWidth||X.width||0,height:X.naturalHeight||X.height||0,mimeType:Y.type||"",name:Y.name||""};F(),$(te)},X.onerror=()=>{F(),$({dataUrl:K,width:0,height:0,mimeType:Y.type||"",name:Y.name||""})},X.src=K}catch{F(),$(null)}},L.style.position="fixed",L.style.left="-9999px",document.body.appendChild(L),L.click()}),[]),U=$=>{if($?.target?.closest?.('[data-testid^="overlay-"]'))return;if(t==="select"){p(null);return}const L=$.target,F=L?.closest?.("[data-page-num]")||null,Y=L?.closest?.('[id^="pdf-page-"]')||null;let K=(F?parseInt(F.getAttribute("data-page-num"),10):NaN)||(Y?.id?parseInt(String(Y.id).replace("pdf-page-",""),10):NaN),X=R(F||Y,K)||Y||F;if((!X||!K||Number.isNaN(K))&&typeof document<"u"){const oe=Array.from(document.querySelectorAll('[id^="pdf-page-"]')).find(be=>{const _e=be.getBoundingClientRect();return $.clientX>=_e.left&&$.clientX<=_e.right&&$.clientY>=_e.top&&$.clientY<=_e.bottom})||null;if(oe?.id){const be=parseInt(String(oe.id).replace("pdf-page-",""),10);!Number.isNaN(be)&&be>0&&(K=be,X=oe)}}if(!X||!K||Number.isNaN(K))return;const te=X.getBoundingClientRect(),ae=$.clientX-te.left,ie=$.clientY-te.top,le={signatures:m.current,annotations:y.current,selectedItemId:null};if(t==="signature"&&d){const ce={id:Date.now(),pageNum:K,x:ae,y:ie,width:d.width||200,height:d.height||60,...d},oe=[...le.signatures,ce];i(oe),p(ce.id),k({...le,signatures:oe,selectedItemId:ce.id}),s("select");return}if(t==="text"){const ce={id:Date.now(),pageNum:K,x:ae,y:ie,text:"Text",type:"text"},oe=[...le.annotations,ce];a(oe),p(ce.id),k({...le,annotations:oe,selectedItemId:ce.id}),s("select");return}if(t==="date"){const ce={id:Date.now(),pageNum:K,x:ae,y:ie,text:new Date().toLocaleDateString(),type:"date"},oe=[...le.annotations,ce];a(oe),p(ce.id),k({...le,annotations:oe,selectedItemId:ce.id}),s("select");return}if(t==="image"){if(S.current)return;S.current=!0,(async()=>{try{const ce=await O();if(!ce?.dataUrl)return;const oe=240,be=240,_e=Number(ce.width)||0,A=Number(ce.height)||0,q=_e>0&&A>0?Math.min(1,oe/_e,be/A):1,V=Math.max(48,Math.round((_e||220)*q)),I=Math.max(48,Math.round((A||120)*q)),P=Math.max(0,Math.min(ae-V/2,te.width-V)),H=Math.max(0,Math.min(ie-I/2,te.height-I)),Z={id:Date.now(),pageNum:K,x:P,y:H,type:"image",text:ce.name||"Image",dataUrl:ce.dataUrl,width:V,height:I},J=[...y.current,Z];a(J),p(Z.id),k({...le,annotations:J,selectedItemId:Z.id}),s("select")}finally{S.current=!1}})();return}if(t==="checkmark"){const ce={id:Date.now(),pageNum:K,x:ae,y:ie,text:"âœ“",type:"checkmark"},oe=[...le.annotations,ce];a(oe),p(ce.id),k({...le,annotations:oe,selectedItemId:ce.id}),s("select")}},M=()=>{if(d){s("signature");return}c(!0)},G=$=>{h($),s("signature")},z=T.useCallback(()=>{if(!f)return;const $=y.current.filter(F=>F.id!==f),L=m.current.filter(F=>F.id!==f);a($),i(L),p(null),k({signatures:L,annotations:$,selectedItemId:null})},[f]);return{activeTool:t,setActiveTool:s,signatures:n,annotations:r,signatureModalOpen:l,setSignatureModalOpen:c,pendingSignature:d,selectedItemId:f,setSelectedItemId:p,handleCanvasClick:U,handleSignClick:M,handleSignatureAdopt:G,startDrag:B,deleteSelectedItem:z,canUndo:_,canRedo:E,undo:D,redo:N}},il=o=>{if(typeof window>"u")return null;const e=window.MOCK_STORAGE_CALLABLES;return!e||typeof e[o]!="function"?null:e[o]},ap=async(o,e)=>{const t=il("storageCreateUploadUrl");if(t)return t(e);if(!o)throw new Error("storageCreateUploadUrl callable not available");const n=await st(o,"storageCreateUploadUrl")(e);return n?.data||n},op=async(o,e)=>{const t=il("storageCreateDownloadUrl");if(t)return t(e);if(!o)throw new Error("storageCreateDownloadUrl callable not available");const n=await st(o,"storageCreateDownloadUrl")(e);return n?.data||n},lp=async({url:o,file:e,contentType:t})=>{const s=await fetch(o,{method:"PUT",headers:{"content-type":t},body:e});if(!s.ok)throw new Error(`Upload failed with status ${s.status}`)},cp=async o=>{const e=await fetch(o);if(!e.ok)throw new Error(`Download failed with status ${e.status}`);return e.blob()};function ln(o){throw new Error('Could not dynamically require "'+o+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ci={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var pa;function dp(){return pa||(pa=1,(function(o,e){(function(t){o.exports=t()})(function(){return(function t(s,n,i){function r(c,d){if(!n[c]){if(!s[c]){var h=typeof ln=="function"&&ln;if(!d&&h)return h(c,!0);if(a)return a(c,!0);var f=new Error("Cannot find module '"+c+"'");throw f.code="MODULE_NOT_FOUND",f}var p=n[c]={exports:{}};s[c][0].call(p.exports,function(b){var m=s[c][1][b];return r(m||b)},p,p.exports,t,s,n,i)}return n[c].exports}for(var a=typeof ln=="function"&&ln,l=0;l<i.length;l++)r(i[l]);return r})({1:[function(t,s,n){var i=t("./utils"),r=t("./support"),a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(l){for(var c,d,h,f,p,b,m,y=[],g=0,x=l.length,w=x,v=i.getTypeOf(l)!=="string";g<l.length;)w=x-g,h=v?(c=l[g++],d=g<x?l[g++]:0,g<x?l[g++]:0):(c=l.charCodeAt(g++),d=g<x?l.charCodeAt(g++):0,g<x?l.charCodeAt(g++):0),f=c>>2,p=(3&c)<<4|d>>4,b=1<w?(15&d)<<2|h>>6:64,m=2<w?63&h:64,y.push(a.charAt(f)+a.charAt(p)+a.charAt(b)+a.charAt(m));return y.join("")},n.decode=function(l){var c,d,h,f,p,b,m=0,y=0,g="data:";if(l.substr(0,g.length)===g)throw new Error("Invalid base64 input, it looks like a data url.");var x,w=3*(l=l.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(l.charAt(l.length-1)===a.charAt(64)&&w--,l.charAt(l.length-2)===a.charAt(64)&&w--,w%1!=0)throw new Error("Invalid base64 input, bad content length.");for(x=r.uint8array?new Uint8Array(0|w):new Array(0|w);m<l.length;)c=a.indexOf(l.charAt(m++))<<2|(f=a.indexOf(l.charAt(m++)))>>4,d=(15&f)<<4|(p=a.indexOf(l.charAt(m++)))>>2,h=(3&p)<<6|(b=a.indexOf(l.charAt(m++))),x[y++]=c,p!==64&&(x[y++]=d),b!==64&&(x[y++]=h);return x}},{"./support":30,"./utils":32}],2:[function(t,s,n){var i=t("./external"),r=t("./stream/DataWorker"),a=t("./stream/Crc32Probe"),l=t("./stream/DataLengthProbe");function c(d,h,f,p,b){this.compressedSize=d,this.uncompressedSize=h,this.crc32=f,this.compression=p,this.compressedContent=b}c.prototype={getContentWorker:function(){var d=new r(i.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new l("data_length")),h=this;return d.on("end",function(){if(this.streamInfo.data_length!==h.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),d},getCompressedWorker:function(){return new r(i.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},c.createWorkerFrom=function(d,h,f){return d.pipe(new a).pipe(new l("uncompressedSize")).pipe(h.compressWorker(f)).pipe(new l("compressedSize")).withStreamInfo("compression",h)},s.exports=c},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(t,s,n){var i=t("./stream/GenericWorker");n.STORE={magic:"\0\0",compressWorker:function(){return new i("STORE compression")},uncompressWorker:function(){return new i("STORE decompression")}},n.DEFLATE=t("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(t,s,n){var i=t("./utils"),r=(function(){for(var a,l=[],c=0;c<256;c++){a=c;for(var d=0;d<8;d++)a=1&a?3988292384^a>>>1:a>>>1;l[c]=a}return l})();s.exports=function(a,l){return a!==void 0&&a.length?i.getTypeOf(a)!=="string"?(function(c,d,h,f){var p=r,b=f+h;c^=-1;for(var m=f;m<b;m++)c=c>>>8^p[255&(c^d[m])];return-1^c})(0|l,a,a.length,0):(function(c,d,h,f){var p=r,b=f+h;c^=-1;for(var m=f;m<b;m++)c=c>>>8^p[255&(c^d.charCodeAt(m))];return-1^c})(0|l,a,a.length,0):0}},{"./utils":32}],5:[function(t,s,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!0,n.date=null,n.compression=null,n.compressionOptions=null,n.comment=null,n.unixPermissions=null,n.dosPermissions=null},{}],6:[function(t,s,n){var i=null;i=typeof Promise<"u"?Promise:t("lie"),s.exports={Promise:i}},{lie:37}],7:[function(t,s,n){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",r=t("pako"),a=t("./utils"),l=t("./stream/GenericWorker"),c=i?"uint8array":"array";function d(h,f){l.call(this,"FlateWorker/"+h),this._pako=null,this._pakoAction=h,this._pakoOptions=f,this.meta={}}n.magic="\b\0",a.inherits(d,l),d.prototype.processChunk=function(h){this.meta=h.meta,this._pako===null&&this._createPako(),this._pako.push(a.transformTo(c,h.data),!1)},d.prototype.flush=function(){l.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},d.prototype.cleanUp=function(){l.prototype.cleanUp.call(this),this._pako=null},d.prototype._createPako=function(){this._pako=new r[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var h=this;this._pako.onData=function(f){h.push({data:f,meta:h.meta})}},n.compressWorker=function(h){return new d("Deflate",h)},n.uncompressWorker=function(){return new d("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(t,s,n){function i(p,b){var m,y="";for(m=0;m<b;m++)y+=String.fromCharCode(255&p),p>>>=8;return y}function r(p,b,m,y,g,x){var w,v,_=p.file,E=p.compression,k=x!==c.utf8encode,D=a.transformTo("string",x(_.name)),N=a.transformTo("string",c.utf8encode(_.name)),R=_.comment,j=a.transformTo("string",x(R)),C=a.transformTo("string",c.utf8encode(R)),B=N.length!==_.name.length,S=C.length!==R.length,O="",U="",M="",G=_.dir,z=_.date,$={crc32:0,compressedSize:0,uncompressedSize:0};b&&!m||($.crc32=p.crc32,$.compressedSize=p.compressedSize,$.uncompressedSize=p.uncompressedSize);var L=0;b&&(L|=8),k||!B&&!S||(L|=2048);var F=0,Y=0;G&&(F|=16),g==="UNIX"?(Y=798,F|=(function(X,te){var ae=X;return X||(ae=te?16893:33204),(65535&ae)<<16})(_.unixPermissions,G)):(Y=20,F|=(function(X){return 63&(X||0)})(_.dosPermissions)),w=z.getUTCHours(),w<<=6,w|=z.getUTCMinutes(),w<<=5,w|=z.getUTCSeconds()/2,v=z.getUTCFullYear()-1980,v<<=4,v|=z.getUTCMonth()+1,v<<=5,v|=z.getUTCDate(),B&&(U=i(1,1)+i(d(D),4)+N,O+="up"+i(U.length,2)+U),S&&(M=i(1,1)+i(d(j),4)+C,O+="uc"+i(M.length,2)+M);var K="";return K+=`
\0`,K+=i(L,2),K+=E.magic,K+=i(w,2),K+=i(v,2),K+=i($.crc32,4),K+=i($.compressedSize,4),K+=i($.uncompressedSize,4),K+=i(D.length,2),K+=i(O.length,2),{fileRecord:h.LOCAL_FILE_HEADER+K+D+O,dirRecord:h.CENTRAL_FILE_HEADER+i(Y,2)+K+i(j.length,2)+"\0\0\0\0"+i(F,4)+i(y,4)+D+O+j}}var a=t("../utils"),l=t("../stream/GenericWorker"),c=t("../utf8"),d=t("../crc32"),h=t("../signature");function f(p,b,m,y){l.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=b,this.zipPlatform=m,this.encodeFileName=y,this.streamFiles=p,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}a.inherits(f,l),f.prototype.push=function(p){var b=p.meta.percent||0,m=this.entriesCount,y=this._sources.length;this.accumulate?this.contentBuffer.push(p):(this.bytesWritten+=p.data.length,l.prototype.push.call(this,{data:p.data,meta:{currentFile:this.currentFile,percent:m?(b+100*(m-y-1))/m:100}}))},f.prototype.openedSource=function(p){this.currentSourceOffset=this.bytesWritten,this.currentFile=p.file.name;var b=this.streamFiles&&!p.file.dir;if(b){var m=r(p,b,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:m.fileRecord,meta:{percent:0}})}else this.accumulate=!0},f.prototype.closedSource=function(p){this.accumulate=!1;var b=this.streamFiles&&!p.file.dir,m=r(p,b,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(m.dirRecord),b)this.push({data:(function(y){return h.DATA_DESCRIPTOR+i(y.crc32,4)+i(y.compressedSize,4)+i(y.uncompressedSize,4)})(p),meta:{percent:100}});else for(this.push({data:m.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},f.prototype.flush=function(){for(var p=this.bytesWritten,b=0;b<this.dirRecords.length;b++)this.push({data:this.dirRecords[b],meta:{percent:100}});var m=this.bytesWritten-p,y=(function(g,x,w,v,_){var E=a.transformTo("string",_(v));return h.CENTRAL_DIRECTORY_END+"\0\0\0\0"+i(g,2)+i(g,2)+i(x,4)+i(w,4)+i(E.length,2)+E})(this.dirRecords.length,m,p,this.zipComment,this.encodeFileName);this.push({data:y,meta:{percent:100}})},f.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},f.prototype.registerPrevious=function(p){this._sources.push(p);var b=this;return p.on("data",function(m){b.processChunk(m)}),p.on("end",function(){b.closedSource(b.previous.streamInfo),b._sources.length?b.prepareNextSource():b.end()}),p.on("error",function(m){b.error(m)}),this},f.prototype.resume=function(){return!!l.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},f.prototype.error=function(p){var b=this._sources;if(!l.prototype.error.call(this,p))return!1;for(var m=0;m<b.length;m++)try{b[m].error(p)}catch{}return!0},f.prototype.lock=function(){l.prototype.lock.call(this);for(var p=this._sources,b=0;b<p.length;b++)p[b].lock()},s.exports=f},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(t,s,n){var i=t("../compressions"),r=t("./ZipFileWorker");n.generateWorker=function(a,l,c){var d=new r(l.streamFiles,c,l.platform,l.encodeFileName),h=0;try{a.forEach(function(f,p){h++;var b=(function(x,w){var v=x||w,_=i[v];if(!_)throw new Error(v+" is not a valid compression method !");return _})(p.options.compression,l.compression),m=p.options.compressionOptions||l.compressionOptions||{},y=p.dir,g=p.date;p._compressWorker(b,m).withStreamInfo("file",{name:f,dir:y,date:g,comment:p.comment||"",unixPermissions:p.unixPermissions,dosPermissions:p.dosPermissions}).pipe(d)}),d.entriesCount=h}catch(f){d.error(f)}return d}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(t,s,n){function i(){if(!(this instanceof i))return new i;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var r=new i;for(var a in this)typeof this[a]!="function"&&(r[a]=this[a]);return r}}(i.prototype=t("./object")).loadAsync=t("./load"),i.support=t("./support"),i.defaults=t("./defaults"),i.version="3.10.1",i.loadAsync=function(r,a){return new i().loadAsync(r,a)},i.external=t("./external"),s.exports=i},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(t,s,n){var i=t("./utils"),r=t("./external"),a=t("./utf8"),l=t("./zipEntries"),c=t("./stream/Crc32Probe"),d=t("./nodejsUtils");function h(f){return new r.Promise(function(p,b){var m=f.decompressed.getContentWorker().pipe(new c);m.on("error",function(y){b(y)}).on("end",function(){m.streamInfo.crc32!==f.decompressed.crc32?b(new Error("Corrupted zip : CRC32 mismatch")):p()}).resume()})}s.exports=function(f,p){var b=this;return p=i.extend(p||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:a.utf8decode}),d.isNode&&d.isStream(f)?r.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):i.prepareContent("the loaded zip file",f,!0,p.optimizedBinaryString,p.base64).then(function(m){var y=new l(p);return y.load(m),y}).then(function(m){var y=[r.Promise.resolve(m)],g=m.files;if(p.checkCRC32)for(var x=0;x<g.length;x++)y.push(h(g[x]));return r.Promise.all(y)}).then(function(m){for(var y=m.shift(),g=y.files,x=0;x<g.length;x++){var w=g[x],v=w.fileNameStr,_=i.resolve(w.fileNameStr);b.file(_,w.decompressed,{binary:!0,optimizedBinaryString:!0,date:w.date,dir:w.dir,comment:w.fileCommentStr.length?w.fileCommentStr:null,unixPermissions:w.unixPermissions,dosPermissions:w.dosPermissions,createFolders:p.createFolders}),w.dir||(b.file(_).unsafeOriginalName=v)}return y.zipComment.length&&(b.comment=y.zipComment),b})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(t,s,n){var i=t("../utils"),r=t("../stream/GenericWorker");function a(l,c){r.call(this,"Nodejs stream input adapter for "+l),this._upstreamEnded=!1,this._bindStream(c)}i.inherits(a,r),a.prototype._bindStream=function(l){var c=this;(this._stream=l).pause(),l.on("data",function(d){c.push({data:d,meta:{percent:0}})}).on("error",function(d){c.isPaused?this.generatedError=d:c.error(d)}).on("end",function(){c.isPaused?c._upstreamEnded=!0:c.end()})},a.prototype.pause=function(){return!!r.prototype.pause.call(this)&&(this._stream.pause(),!0)},a.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},s.exports=a},{"../stream/GenericWorker":28,"../utils":32}],13:[function(t,s,n){var i=t("readable-stream").Readable;function r(a,l,c){i.call(this,l),this._helper=a;var d=this;a.on("data",function(h,f){d.push(h)||d._helper.pause(),c&&c(f)}).on("error",function(h){d.emit("error",h)}).on("end",function(){d.push(null)})}t("../utils").inherits(r,i),r.prototype._read=function(){this._helper.resume()},s.exports=r},{"../utils":32,"readable-stream":16}],14:[function(t,s,n){s.exports={isNode:typeof Buffer<"u",newBufferFrom:function(i,r){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(i,r);if(typeof i=="number")throw new Error('The "data" argument must not be a number');return new Buffer(i,r)},allocBuffer:function(i){if(Buffer.alloc)return Buffer.alloc(i);var r=new Buffer(i);return r.fill(0),r},isBuffer:function(i){return Buffer.isBuffer(i)},isStream:function(i){return i&&typeof i.on=="function"&&typeof i.pause=="function"&&typeof i.resume=="function"}}},{}],15:[function(t,s,n){function i(_,E,k){var D,N=a.getTypeOf(E),R=a.extend(k||{},d);R.date=R.date||new Date,R.compression!==null&&(R.compression=R.compression.toUpperCase()),typeof R.unixPermissions=="string"&&(R.unixPermissions=parseInt(R.unixPermissions,8)),R.unixPermissions&&16384&R.unixPermissions&&(R.dir=!0),R.dosPermissions&&16&R.dosPermissions&&(R.dir=!0),R.dir&&(_=g(_)),R.createFolders&&(D=y(_))&&x.call(this,D,!0);var j=N==="string"&&R.binary===!1&&R.base64===!1;k&&k.binary!==void 0||(R.binary=!j),(E instanceof h&&E.uncompressedSize===0||R.dir||!E||E.length===0)&&(R.base64=!1,R.binary=!0,E="",R.compression="STORE",N="string");var C=null;C=E instanceof h||E instanceof l?E:b.isNode&&b.isStream(E)?new m(_,E):a.prepareContent(_,E,R.binary,R.optimizedBinaryString,R.base64);var B=new f(_,C,R);this.files[_]=B}var r=t("./utf8"),a=t("./utils"),l=t("./stream/GenericWorker"),c=t("./stream/StreamHelper"),d=t("./defaults"),h=t("./compressedObject"),f=t("./zipObject"),p=t("./generate"),b=t("./nodejsUtils"),m=t("./nodejs/NodejsStreamInputAdapter"),y=function(_){_.slice(-1)==="/"&&(_=_.substring(0,_.length-1));var E=_.lastIndexOf("/");return 0<E?_.substring(0,E):""},g=function(_){return _.slice(-1)!=="/"&&(_+="/"),_},x=function(_,E){return E=E!==void 0?E:d.createFolders,_=g(_),this.files[_]||i.call(this,_,null,{dir:!0,createFolders:E}),this.files[_]};function w(_){return Object.prototype.toString.call(_)==="[object RegExp]"}var v={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(_){var E,k,D;for(E in this.files)D=this.files[E],(k=E.slice(this.root.length,E.length))&&E.slice(0,this.root.length)===this.root&&_(k,D)},filter:function(_){var E=[];return this.forEach(function(k,D){_(k,D)&&E.push(D)}),E},file:function(_,E,k){if(arguments.length!==1)return _=this.root+_,i.call(this,_,E,k),this;if(w(_)){var D=_;return this.filter(function(R,j){return!j.dir&&D.test(R)})}var N=this.files[this.root+_];return N&&!N.dir?N:null},folder:function(_){if(!_)return this;if(w(_))return this.filter(function(N,R){return R.dir&&_.test(N)});var E=this.root+_,k=x.call(this,E),D=this.clone();return D.root=k.name,D},remove:function(_){_=this.root+_;var E=this.files[_];if(E||(_.slice(-1)!=="/"&&(_+="/"),E=this.files[_]),E&&!E.dir)delete this.files[_];else for(var k=this.filter(function(N,R){return R.name.slice(0,_.length)===_}),D=0;D<k.length;D++)delete this.files[k[D].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(_){var E,k={};try{if((k=a.extend(_||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:r.utf8encode})).type=k.type.toLowerCase(),k.compression=k.compression.toUpperCase(),k.type==="binarystring"&&(k.type="string"),!k.type)throw new Error("No output type specified.");a.checkSupport(k.type),k.platform!=="darwin"&&k.platform!=="freebsd"&&k.platform!=="linux"&&k.platform!=="sunos"||(k.platform="UNIX"),k.platform==="win32"&&(k.platform="DOS");var D=k.comment||this.comment||"";E=p.generateWorker(this,k,D)}catch(N){(E=new l("error")).error(N)}return new c(E,k.type||"string",k.mimeType)},generateAsync:function(_,E){return this.generateInternalStream(_).accumulate(E)},generateNodeStream:function(_,E){return(_=_||{}).type||(_.type="nodebuffer"),this.generateInternalStream(_).toNodejsStream(E)}};s.exports=v},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(t,s,n){s.exports=t("stream")},{stream:void 0}],17:[function(t,s,n){var i=t("./DataReader");function r(a){i.call(this,a);for(var l=0;l<this.data.length;l++)a[l]=255&a[l]}t("../utils").inherits(r,i),r.prototype.byteAt=function(a){return this.data[this.zero+a]},r.prototype.lastIndexOfSignature=function(a){for(var l=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),h=a.charCodeAt(3),f=this.length-4;0<=f;--f)if(this.data[f]===l&&this.data[f+1]===c&&this.data[f+2]===d&&this.data[f+3]===h)return f-this.zero;return-1},r.prototype.readAndCheckSignature=function(a){var l=a.charCodeAt(0),c=a.charCodeAt(1),d=a.charCodeAt(2),h=a.charCodeAt(3),f=this.readData(4);return l===f[0]&&c===f[1]&&d===f[2]&&h===f[3]},r.prototype.readData=function(a){if(this.checkOffset(a),a===0)return[];var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=r},{"../utils":32,"./DataReader":18}],18:[function(t,s,n){var i=t("../utils");function r(a){this.data=a,this.length=a.length,this.index=0,this.zero=0}r.prototype={checkOffset:function(a){this.checkIndex(this.index+a)},checkIndex:function(a){if(this.length<this.zero+a||a<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+a+"). Corrupted zip ?")},setIndex:function(a){this.checkIndex(a),this.index=a},skip:function(a){this.setIndex(this.index+a)},byteAt:function(){},readInt:function(a){var l,c=0;for(this.checkOffset(a),l=this.index+a-1;l>=this.index;l--)c=(c<<8)+this.byteAt(l);return this.index+=a,c},readString:function(a){return i.transformTo("string",this.readData(a))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var a=this.readInt(4);return new Date(Date.UTC(1980+(a>>25&127),(a>>21&15)-1,a>>16&31,a>>11&31,a>>5&63,(31&a)<<1))}},s.exports=r},{"../utils":32}],19:[function(t,s,n){var i=t("./Uint8ArrayReader");function r(a){i.call(this,a)}t("../utils").inherits(r,i),r.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=r},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(t,s,n){var i=t("./DataReader");function r(a){i.call(this,a)}t("../utils").inherits(r,i),r.prototype.byteAt=function(a){return this.data.charCodeAt(this.zero+a)},r.prototype.lastIndexOfSignature=function(a){return this.data.lastIndexOf(a)-this.zero},r.prototype.readAndCheckSignature=function(a){return a===this.readData(4)},r.prototype.readData=function(a){this.checkOffset(a);var l=this.data.slice(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=r},{"../utils":32,"./DataReader":18}],21:[function(t,s,n){var i=t("./ArrayReader");function r(a){i.call(this,a)}t("../utils").inherits(r,i),r.prototype.readData=function(a){if(this.checkOffset(a),a===0)return new Uint8Array(0);var l=this.data.subarray(this.zero+this.index,this.zero+this.index+a);return this.index+=a,l},s.exports=r},{"../utils":32,"./ArrayReader":17}],22:[function(t,s,n){var i=t("../utils"),r=t("../support"),a=t("./ArrayReader"),l=t("./StringReader"),c=t("./NodeBufferReader"),d=t("./Uint8ArrayReader");s.exports=function(h){var f=i.getTypeOf(h);return i.checkSupport(f),f!=="string"||r.uint8array?f==="nodebuffer"?new c(h):r.uint8array?new d(i.transformTo("uint8array",h)):new a(i.transformTo("array",h)):new l(h)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(t,s,n){n.LOCAL_FILE_HEADER="PK",n.CENTRAL_FILE_HEADER="PK",n.CENTRAL_DIRECTORY_END="PK",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK",n.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(t,s,n){var i=t("./GenericWorker"),r=t("../utils");function a(l){i.call(this,"ConvertWorker to "+l),this.destType=l}r.inherits(a,i),a.prototype.processChunk=function(l){this.push({data:r.transformTo(this.destType,l.data),meta:l.meta})},s.exports=a},{"../utils":32,"./GenericWorker":28}],25:[function(t,s,n){var i=t("./GenericWorker"),r=t("../crc32");function a(){i.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}t("../utils").inherits(a,i),a.prototype.processChunk=function(l){this.streamInfo.crc32=r(l.data,this.streamInfo.crc32||0),this.push(l)},s.exports=a},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(t,s,n){var i=t("../utils"),r=t("./GenericWorker");function a(l){r.call(this,"DataLengthProbe for "+l),this.propName=l,this.withStreamInfo(l,0)}i.inherits(a,r),a.prototype.processChunk=function(l){if(l){var c=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=c+l.data.length}r.prototype.processChunk.call(this,l)},s.exports=a},{"../utils":32,"./GenericWorker":28}],27:[function(t,s,n){var i=t("../utils"),r=t("./GenericWorker");function a(l){r.call(this,"DataWorker");var c=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,l.then(function(d){c.dataIsReady=!0,c.data=d,c.max=d&&d.length||0,c.type=i.getTypeOf(d),c.isPaused||c._tickAndRepeat()},function(d){c.error(d)})}i.inherits(a,r),a.prototype.cleanUp=function(){r.prototype.cleanUp.call(this),this.data=null},a.prototype.resume=function(){return!!r.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,i.delay(this._tickAndRepeat,[],this)),!0)},a.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(i.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},a.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var l=null,c=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":l=this.data.substring(this.index,c);break;case"uint8array":l=this.data.subarray(this.index,c);break;case"array":case"nodebuffer":l=this.data.slice(this.index,c)}return this.index=c,this.push({data:l,meta:{percent:this.max?this.index/this.max*100:0}})},s.exports=a},{"../utils":32,"./GenericWorker":28}],28:[function(t,s,n){function i(r){this.name=r||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}i.prototype={push:function(r){this.emit("data",r)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(r){this.emit("error",r)}return!0},error:function(r){return!this.isFinished&&(this.isPaused?this.generatedError=r:(this.isFinished=!0,this.emit("error",r),this.previous&&this.previous.error(r),this.cleanUp()),!0)},on:function(r,a){return this._listeners[r].push(a),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(r,a){if(this._listeners[r])for(var l=0;l<this._listeners[r].length;l++)this._listeners[r][l].call(this,a)},pipe:function(r){return r.registerPrevious(this)},registerPrevious:function(r){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=r.streamInfo,this.mergeStreamInfo(),this.previous=r;var a=this;return r.on("data",function(l){a.processChunk(l)}),r.on("end",function(){a.end()}),r.on("error",function(l){a.error(l)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var r=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),r=!0),this.previous&&this.previous.resume(),!r},flush:function(){},processChunk:function(r){this.push(r)},withStreamInfo:function(r,a){return this.extraStreamInfo[r]=a,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var r in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,r)&&(this.streamInfo[r]=this.extraStreamInfo[r])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var r="Worker "+this.name;return this.previous?this.previous+" -> "+r:r}},s.exports=i},{}],29:[function(t,s,n){var i=t("../utils"),r=t("./ConvertWorker"),a=t("./GenericWorker"),l=t("../base64"),c=t("../support"),d=t("../external"),h=null;if(c.nodestream)try{h=t("../nodejs/NodejsStreamOutputAdapter")}catch{}function f(b,m){return new d.Promise(function(y,g){var x=[],w=b._internalType,v=b._outputType,_=b._mimeType;b.on("data",function(E,k){x.push(E),m&&m(k)}).on("error",function(E){x=[],g(E)}).on("end",function(){try{var E=(function(k,D,N){switch(k){case"blob":return i.newBlob(i.transformTo("arraybuffer",D),N);case"base64":return l.encode(D);default:return i.transformTo(k,D)}})(v,(function(k,D){var N,R=0,j=null,C=0;for(N=0;N<D.length;N++)C+=D[N].length;switch(k){case"string":return D.join("");case"array":return Array.prototype.concat.apply([],D);case"uint8array":for(j=new Uint8Array(C),N=0;N<D.length;N++)j.set(D[N],R),R+=D[N].length;return j;case"nodebuffer":return Buffer.concat(D);default:throw new Error("concat : unsupported type '"+k+"'")}})(w,x),_);y(E)}catch(k){g(k)}x=[]}).resume()})}function p(b,m,y){var g=m;switch(m){case"blob":case"arraybuffer":g="uint8array";break;case"base64":g="string"}try{this._internalType=g,this._outputType=m,this._mimeType=y,i.checkSupport(g),this._worker=b.pipe(new r(g)),b.lock()}catch(x){this._worker=new a("error"),this._worker.error(x)}}p.prototype={accumulate:function(b){return f(this,b)},on:function(b,m){var y=this;return b==="data"?this._worker.on(b,function(g){m.call(y,g.data,g.meta)}):this._worker.on(b,function(){i.delay(m,arguments,y)}),this},resume:function(){return i.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(b){if(i.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new h(this,{objectMode:this._outputType!=="nodebuffer"},b)}},s.exports=p},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(t,s,n){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",n.nodebuffer=typeof Buffer<"u",n.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")n.blob=!1;else{var i=new ArrayBuffer(0);try{n.blob=new Blob([i],{type:"application/zip"}).size===0}catch{try{var r=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);r.append(i),n.blob=r.getBlob("application/zip").size===0}catch{n.blob=!1}}}try{n.nodestream=!!t("readable-stream").Readable}catch{n.nodestream=!1}},{"readable-stream":16}],31:[function(t,s,n){for(var i=t("./utils"),r=t("./support"),a=t("./nodejsUtils"),l=t("./stream/GenericWorker"),c=new Array(256),d=0;d<256;d++)c[d]=252<=d?6:248<=d?5:240<=d?4:224<=d?3:192<=d?2:1;c[254]=c[254]=1;function h(){l.call(this,"utf-8 decode"),this.leftOver=null}function f(){l.call(this,"utf-8 encode")}n.utf8encode=function(p){return r.nodebuffer?a.newBufferFrom(p,"utf-8"):(function(b){var m,y,g,x,w,v=b.length,_=0;for(x=0;x<v;x++)(64512&(y=b.charCodeAt(x)))==55296&&x+1<v&&(64512&(g=b.charCodeAt(x+1)))==56320&&(y=65536+(y-55296<<10)+(g-56320),x++),_+=y<128?1:y<2048?2:y<65536?3:4;for(m=r.uint8array?new Uint8Array(_):new Array(_),x=w=0;w<_;x++)(64512&(y=b.charCodeAt(x)))==55296&&x+1<v&&(64512&(g=b.charCodeAt(x+1)))==56320&&(y=65536+(y-55296<<10)+(g-56320),x++),y<128?m[w++]=y:(y<2048?m[w++]=192|y>>>6:(y<65536?m[w++]=224|y>>>12:(m[w++]=240|y>>>18,m[w++]=128|y>>>12&63),m[w++]=128|y>>>6&63),m[w++]=128|63&y);return m})(p)},n.utf8decode=function(p){return r.nodebuffer?i.transformTo("nodebuffer",p).toString("utf-8"):(function(b){var m,y,g,x,w=b.length,v=new Array(2*w);for(m=y=0;m<w;)if((g=b[m++])<128)v[y++]=g;else if(4<(x=c[g]))v[y++]=65533,m+=x-1;else{for(g&=x===2?31:x===3?15:7;1<x&&m<w;)g=g<<6|63&b[m++],x--;1<x?v[y++]=65533:g<65536?v[y++]=g:(g-=65536,v[y++]=55296|g>>10&1023,v[y++]=56320|1023&g)}return v.length!==y&&(v.subarray?v=v.subarray(0,y):v.length=y),i.applyFromCharCode(v)})(p=i.transformTo(r.uint8array?"uint8array":"array",p))},i.inherits(h,l),h.prototype.processChunk=function(p){var b=i.transformTo(r.uint8array?"uint8array":"array",p.data);if(this.leftOver&&this.leftOver.length){if(r.uint8array){var m=b;(b=new Uint8Array(m.length+this.leftOver.length)).set(this.leftOver,0),b.set(m,this.leftOver.length)}else b=this.leftOver.concat(b);this.leftOver=null}var y=(function(x,w){var v;for((w=w||x.length)>x.length&&(w=x.length),v=w-1;0<=v&&(192&x[v])==128;)v--;return v<0||v===0?w:v+c[x[v]]>w?v:w})(b),g=b;y!==b.length&&(r.uint8array?(g=b.subarray(0,y),this.leftOver=b.subarray(y,b.length)):(g=b.slice(0,y),this.leftOver=b.slice(y,b.length))),this.push({data:n.utf8decode(g),meta:p.meta})},h.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:n.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},n.Utf8DecodeWorker=h,i.inherits(f,l),f.prototype.processChunk=function(p){this.push({data:n.utf8encode(p.data),meta:p.meta})},n.Utf8EncodeWorker=f},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(t,s,n){var i=t("./support"),r=t("./base64"),a=t("./nodejsUtils"),l=t("./external");function c(m){return m}function d(m,y){for(var g=0;g<m.length;++g)y[g]=255&m.charCodeAt(g);return y}t("setimmediate"),n.newBlob=function(m,y){n.checkSupport("blob");try{return new Blob([m],{type:y})}catch{try{var g=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return g.append(m),g.getBlob(y)}catch{throw new Error("Bug : can't construct the Blob.")}}};var h={stringifyByChunk:function(m,y,g){var x=[],w=0,v=m.length;if(v<=g)return String.fromCharCode.apply(null,m);for(;w<v;)y==="array"||y==="nodebuffer"?x.push(String.fromCharCode.apply(null,m.slice(w,Math.min(w+g,v)))):x.push(String.fromCharCode.apply(null,m.subarray(w,Math.min(w+g,v)))),w+=g;return x.join("")},stringifyByChar:function(m){for(var y="",g=0;g<m.length;g++)y+=String.fromCharCode(m[g]);return y},applyCanBeUsed:{uint8array:(function(){try{return i.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return i.nodebuffer&&String.fromCharCode.apply(null,a.allocBuffer(1)).length===1}catch{return!1}})()}};function f(m){var y=65536,g=n.getTypeOf(m),x=!0;if(g==="uint8array"?x=h.applyCanBeUsed.uint8array:g==="nodebuffer"&&(x=h.applyCanBeUsed.nodebuffer),x)for(;1<y;)try{return h.stringifyByChunk(m,g,y)}catch{y=Math.floor(y/2)}return h.stringifyByChar(m)}function p(m,y){for(var g=0;g<m.length;g++)y[g]=m[g];return y}n.applyFromCharCode=f;var b={};b.string={string:c,array:function(m){return d(m,new Array(m.length))},arraybuffer:function(m){return b.string.uint8array(m).buffer},uint8array:function(m){return d(m,new Uint8Array(m.length))},nodebuffer:function(m){return d(m,a.allocBuffer(m.length))}},b.array={string:f,array:c,arraybuffer:function(m){return new Uint8Array(m).buffer},uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(m)}},b.arraybuffer={string:function(m){return f(new Uint8Array(m))},array:function(m){return p(new Uint8Array(m),new Array(m.byteLength))},arraybuffer:c,uint8array:function(m){return new Uint8Array(m)},nodebuffer:function(m){return a.newBufferFrom(new Uint8Array(m))}},b.uint8array={string:f,array:function(m){return p(m,new Array(m.length))},arraybuffer:function(m){return m.buffer},uint8array:c,nodebuffer:function(m){return a.newBufferFrom(m)}},b.nodebuffer={string:f,array:function(m){return p(m,new Array(m.length))},arraybuffer:function(m){return b.nodebuffer.uint8array(m).buffer},uint8array:function(m){return p(m,new Uint8Array(m.length))},nodebuffer:c},n.transformTo=function(m,y){if(y=y||"",!m)return y;n.checkSupport(m);var g=n.getTypeOf(y);return b[g][m](y)},n.resolve=function(m){for(var y=m.split("/"),g=[],x=0;x<y.length;x++){var w=y[x];w==="."||w===""&&x!==0&&x!==y.length-1||(w===".."?g.pop():g.push(w))}return g.join("/")},n.getTypeOf=function(m){return typeof m=="string"?"string":Object.prototype.toString.call(m)==="[object Array]"?"array":i.nodebuffer&&a.isBuffer(m)?"nodebuffer":i.uint8array&&m instanceof Uint8Array?"uint8array":i.arraybuffer&&m instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(m){if(!i[m.toLowerCase()])throw new Error(m+" is not supported by this platform")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(m){var y,g,x="";for(g=0;g<(m||"").length;g++)x+="\\x"+((y=m.charCodeAt(g))<16?"0":"")+y.toString(16).toUpperCase();return x},n.delay=function(m,y,g){setImmediate(function(){m.apply(g||null,y||[])})},n.inherits=function(m,y){function g(){}g.prototype=y.prototype,m.prototype=new g},n.extend=function(){var m,y,g={};for(m=0;m<arguments.length;m++)for(y in arguments[m])Object.prototype.hasOwnProperty.call(arguments[m],y)&&g[y]===void 0&&(g[y]=arguments[m][y]);return g},n.prepareContent=function(m,y,g,x,w){return l.Promise.resolve(y).then(function(v){return i.blob&&(v instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(v))!==-1)&&typeof FileReader<"u"?new l.Promise(function(_,E){var k=new FileReader;k.onload=function(D){_(D.target.result)},k.onerror=function(D){E(D.target.error)},k.readAsArrayBuffer(v)}):v}).then(function(v){var _=n.getTypeOf(v);return _?(_==="arraybuffer"?v=n.transformTo("uint8array",v):_==="string"&&(w?v=r.decode(v):g&&x!==!0&&(v=(function(E){return d(E,i.uint8array?new Uint8Array(E.length):new Array(E.length))})(v))),v):l.Promise.reject(new Error("Can't read the data of '"+m+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(t,s,n){var i=t("./reader/readerFor"),r=t("./utils"),a=t("./signature"),l=t("./zipEntry"),c=t("./support");function d(h){this.files=[],this.loadOptions=h}d.prototype={checkSignature:function(h){if(!this.reader.readAndCheckSignature(h)){this.reader.index-=4;var f=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+r.pretty(f)+", expected "+r.pretty(h)+")")}},isSignature:function(h,f){var p=this.reader.index;this.reader.setIndex(h);var b=this.reader.readString(4)===f;return this.reader.setIndex(p),b},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var h=this.reader.readData(this.zipCommentLength),f=c.uint8array?"uint8array":"array",p=r.transformTo(f,h);this.zipComment=this.loadOptions.decodeFileName(p)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var h,f,p,b=this.zip64EndOfCentralSize-44;0<b;)h=this.reader.readInt(2),f=this.reader.readInt(4),p=this.reader.readData(f),this.zip64ExtensibleData[h]={id:h,length:f,value:p}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var h,f;for(h=0;h<this.files.length;h++)f=this.files[h],this.reader.setIndex(f.localHeaderOffset),this.checkSignature(a.LOCAL_FILE_HEADER),f.readLocalPart(this.reader),f.handleUTF8(),f.processAttributes()},readCentralDir:function(){var h;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(a.CENTRAL_FILE_HEADER);)(h=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(h);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var h=this.reader.lastIndexOfSignature(a.CENTRAL_DIRECTORY_END);if(h<0)throw this.isSignature(0,a.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(h);var f=h;if(this.checkSignature(a.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===r.MAX_VALUE_16BITS||this.diskWithCentralDirStart===r.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===r.MAX_VALUE_16BITS||this.centralDirRecords===r.MAX_VALUE_16BITS||this.centralDirSize===r.MAX_VALUE_32BITS||this.centralDirOffset===r.MAX_VALUE_32BITS){if(this.zip64=!0,(h=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(h),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,a.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(a.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var p=this.centralDirOffset+this.centralDirSize;this.zip64&&(p+=20,p+=12+this.zip64EndOfCentralSize);var b=f-p;if(0<b)this.isSignature(f,a.CENTRAL_FILE_HEADER)||(this.reader.zero=b);else if(b<0)throw new Error("Corrupted zip: missing "+Math.abs(b)+" bytes.")},prepareReader:function(h){this.reader=i(h)},load:function(h){this.prepareReader(h),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},s.exports=d},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(t,s,n){var i=t("./reader/readerFor"),r=t("./utils"),a=t("./compressedObject"),l=t("./crc32"),c=t("./utf8"),d=t("./compressions"),h=t("./support");function f(p,b){this.options=p,this.loadOptions=b}f.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(p){var b,m;if(p.skip(22),this.fileNameLength=p.readInt(2),m=p.readInt(2),this.fileName=p.readData(this.fileNameLength),p.skip(m),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((b=(function(y){for(var g in d)if(Object.prototype.hasOwnProperty.call(d,g)&&d[g].magic===y)return d[g];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+r.transformTo("string",this.fileName)+")");this.decompressed=new a(this.compressedSize,this.uncompressedSize,this.crc32,b,p.readData(this.compressedSize))},readCentralPart:function(p){this.versionMadeBy=p.readInt(2),p.skip(2),this.bitFlag=p.readInt(2),this.compressionMethod=p.readString(2),this.date=p.readDate(),this.crc32=p.readInt(4),this.compressedSize=p.readInt(4),this.uncompressedSize=p.readInt(4);var b=p.readInt(2);if(this.extraFieldsLength=p.readInt(2),this.fileCommentLength=p.readInt(2),this.diskNumberStart=p.readInt(2),this.internalFileAttributes=p.readInt(2),this.externalFileAttributes=p.readInt(4),this.localHeaderOffset=p.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");p.skip(b),this.readExtraFields(p),this.parseZIP64ExtraField(p),this.fileComment=p.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var p=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),p==0&&(this.dosPermissions=63&this.externalFileAttributes),p==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var p=i(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=p.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=p.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=p.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=p.readInt(4))}},readExtraFields:function(p){var b,m,y,g=p.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});p.index+4<g;)b=p.readInt(2),m=p.readInt(2),y=p.readData(m),this.extraFields[b]={id:b,length:m,value:y};p.setIndex(g)},handleUTF8:function(){var p=h.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=c.utf8decode(this.fileName),this.fileCommentStr=c.utf8decode(this.fileComment);else{var b=this.findExtraFieldUnicodePath();if(b!==null)this.fileNameStr=b;else{var m=r.transformTo(p,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(m)}var y=this.findExtraFieldUnicodeComment();if(y!==null)this.fileCommentStr=y;else{var g=r.transformTo(p,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(g)}}},findExtraFieldUnicodePath:function(){var p=this.extraFields[28789];if(p){var b=i(p.value);return b.readInt(1)!==1||l(this.fileName)!==b.readInt(4)?null:c.utf8decode(b.readData(p.length-5))}return null},findExtraFieldUnicodeComment:function(){var p=this.extraFields[25461];if(p){var b=i(p.value);return b.readInt(1)!==1||l(this.fileComment)!==b.readInt(4)?null:c.utf8decode(b.readData(p.length-5))}return null}},s.exports=f},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(t,s,n){function i(b,m,y){this.name=b,this.dir=y.dir,this.date=y.date,this.comment=y.comment,this.unixPermissions=y.unixPermissions,this.dosPermissions=y.dosPermissions,this._data=m,this._dataBinary=y.binary,this.options={compression:y.compression,compressionOptions:y.compressionOptions}}var r=t("./stream/StreamHelper"),a=t("./stream/DataWorker"),l=t("./utf8"),c=t("./compressedObject"),d=t("./stream/GenericWorker");i.prototype={internalStream:function(b){var m=null,y="string";try{if(!b)throw new Error("No output type specified.");var g=(y=b.toLowerCase())==="string"||y==="text";y!=="binarystring"&&y!=="text"||(y="string"),m=this._decompressWorker();var x=!this._dataBinary;x&&!g&&(m=m.pipe(new l.Utf8EncodeWorker)),!x&&g&&(m=m.pipe(new l.Utf8DecodeWorker))}catch(w){(m=new d("error")).error(w)}return new r(m,y,"")},async:function(b,m){return this.internalStream(b).accumulate(m)},nodeStream:function(b,m){return this.internalStream(b||"nodebuffer").toNodejsStream(m)},_compressWorker:function(b,m){if(this._data instanceof c&&this._data.compression.magic===b.magic)return this._data.getCompressedWorker();var y=this._decompressWorker();return this._dataBinary||(y=y.pipe(new l.Utf8EncodeWorker)),c.createWorkerFrom(y,b,m)},_decompressWorker:function(){return this._data instanceof c?this._data.getContentWorker():this._data instanceof d?this._data:new a(this._data)}};for(var h=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],f=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},p=0;p<h.length;p++)i.prototype[h[p]]=f;s.exports=i},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(t,s,n){(function(i){var r,a,l=i.MutationObserver||i.WebKitMutationObserver;if(l){var c=0,d=new l(b),h=i.document.createTextNode("");d.observe(h,{characterData:!0}),r=function(){h.data=c=++c%2}}else if(i.setImmediate||i.MessageChannel===void 0)r="document"in i&&"onreadystatechange"in i.document.createElement("script")?function(){var m=i.document.createElement("script");m.onreadystatechange=function(){b(),m.onreadystatechange=null,m.parentNode.removeChild(m),m=null},i.document.documentElement.appendChild(m)}:function(){setTimeout(b,0)};else{var f=new i.MessageChannel;f.port1.onmessage=b,r=function(){f.port2.postMessage(0)}}var p=[];function b(){var m,y;a=!0;for(var g=p.length;g;){for(y=p,p=[],m=-1;++m<g;)y[m]();g=p.length}a=!1}s.exports=function(m){p.push(m)!==1||a||r()}}).call(this,typeof Ys<"u"?Ys:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(t,s,n){var i=t("immediate");function r(){}var a={},l=["REJECTED"],c=["FULFILLED"],d=["PENDING"];function h(g){if(typeof g!="function")throw new TypeError("resolver must be a function");this.state=d,this.queue=[],this.outcome=void 0,g!==r&&m(this,g)}function f(g,x,w){this.promise=g,typeof x=="function"&&(this.onFulfilled=x,this.callFulfilled=this.otherCallFulfilled),typeof w=="function"&&(this.onRejected=w,this.callRejected=this.otherCallRejected)}function p(g,x,w){i(function(){var v;try{v=x(w)}catch(_){return a.reject(g,_)}v===g?a.reject(g,new TypeError("Cannot resolve promise with itself")):a.resolve(g,v)})}function b(g){var x=g&&g.then;if(g&&(typeof g=="object"||typeof g=="function")&&typeof x=="function")return function(){x.apply(g,arguments)}}function m(g,x){var w=!1;function v(k){w||(w=!0,a.reject(g,k))}function _(k){w||(w=!0,a.resolve(g,k))}var E=y(function(){x(_,v)});E.status==="error"&&v(E.value)}function y(g,x){var w={};try{w.value=g(x),w.status="success"}catch(v){w.status="error",w.value=v}return w}(s.exports=h).prototype.finally=function(g){if(typeof g!="function")return this;var x=this.constructor;return this.then(function(w){return x.resolve(g()).then(function(){return w})},function(w){return x.resolve(g()).then(function(){throw w})})},h.prototype.catch=function(g){return this.then(null,g)},h.prototype.then=function(g,x){if(typeof g!="function"&&this.state===c||typeof x!="function"&&this.state===l)return this;var w=new this.constructor(r);return this.state!==d?p(w,this.state===c?g:x,this.outcome):this.queue.push(new f(w,g,x)),w},f.prototype.callFulfilled=function(g){a.resolve(this.promise,g)},f.prototype.otherCallFulfilled=function(g){p(this.promise,this.onFulfilled,g)},f.prototype.callRejected=function(g){a.reject(this.promise,g)},f.prototype.otherCallRejected=function(g){p(this.promise,this.onRejected,g)},a.resolve=function(g,x){var w=y(b,x);if(w.status==="error")return a.reject(g,w.value);var v=w.value;if(v)m(g,v);else{g.state=c,g.outcome=x;for(var _=-1,E=g.queue.length;++_<E;)g.queue[_].callFulfilled(x)}return g},a.reject=function(g,x){g.state=l,g.outcome=x;for(var w=-1,v=g.queue.length;++w<v;)g.queue[w].callRejected(x);return g},h.resolve=function(g){return g instanceof this?g:a.resolve(new this(r),g)},h.reject=function(g){var x=new this(r);return a.reject(x,g)},h.all=function(g){var x=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=g.length,v=!1;if(!w)return this.resolve([]);for(var _=new Array(w),E=0,k=-1,D=new this(r);++k<w;)N(g[k],k);return D;function N(R,j){x.resolve(R).then(function(C){_[j]=C,++E!==w||v||(v=!0,a.resolve(D,_))},function(C){v||(v=!0,a.reject(D,C))})}},h.race=function(g){var x=this;if(Object.prototype.toString.call(g)!=="[object Array]")return this.reject(new TypeError("must be an array"));var w=g.length,v=!1;if(!w)return this.resolve([]);for(var _=-1,E=new this(r);++_<w;)k=g[_],x.resolve(k).then(function(D){v||(v=!0,a.resolve(E,D))},function(D){v||(v=!0,a.reject(E,D))});var k;return E}},{immediate:36}],38:[function(t,s,n){var i={};(0,t("./lib/utils/common").assign)(i,t("./lib/deflate"),t("./lib/inflate"),t("./lib/zlib/constants")),s.exports=i},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(t,s,n){var i=t("./zlib/deflate"),r=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/messages"),c=t("./zlib/zstream"),d=Object.prototype.toString,h=0,f=-1,p=0,b=8;function m(g){if(!(this instanceof m))return new m(g);this.options=r.assign({level:f,method:b,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},g||{});var x=this.options;x.raw&&0<x.windowBits?x.windowBits=-x.windowBits:x.gzip&&0<x.windowBits&&x.windowBits<16&&(x.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new c,this.strm.avail_out=0;var w=i.deflateInit2(this.strm,x.level,x.method,x.windowBits,x.memLevel,x.strategy);if(w!==h)throw new Error(l[w]);if(x.header&&i.deflateSetHeader(this.strm,x.header),x.dictionary){var v;if(v=typeof x.dictionary=="string"?a.string2buf(x.dictionary):d.call(x.dictionary)==="[object ArrayBuffer]"?new Uint8Array(x.dictionary):x.dictionary,(w=i.deflateSetDictionary(this.strm,v))!==h)throw new Error(l[w]);this._dict_set=!0}}function y(g,x){var w=new m(x);if(w.push(g,!0),w.err)throw w.msg||l[w.err];return w.result}m.prototype.push=function(g,x){var w,v,_=this.strm,E=this.options.chunkSize;if(this.ended)return!1;v=x===~~x?x:x===!0?4:0,typeof g=="string"?_.input=a.string2buf(g):d.call(g)==="[object ArrayBuffer]"?_.input=new Uint8Array(g):_.input=g,_.next_in=0,_.avail_in=_.input.length;do{if(_.avail_out===0&&(_.output=new r.Buf8(E),_.next_out=0,_.avail_out=E),(w=i.deflate(_,v))!==1&&w!==h)return this.onEnd(w),!(this.ended=!0);_.avail_out!==0&&(_.avail_in!==0||v!==4&&v!==2)||(this.options.to==="string"?this.onData(a.buf2binstring(r.shrinkBuf(_.output,_.next_out))):this.onData(r.shrinkBuf(_.output,_.next_out)))}while((0<_.avail_in||_.avail_out===0)&&w!==1);return v===4?(w=i.deflateEnd(this.strm),this.onEnd(w),this.ended=!0,w===h):v!==2||(this.onEnd(h),!(_.avail_out=0))},m.prototype.onData=function(g){this.chunks.push(g)},m.prototype.onEnd=function(g){g===h&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=g,this.msg=this.strm.msg},n.Deflate=m,n.deflate=y,n.deflateRaw=function(g,x){return(x=x||{}).raw=!0,y(g,x)},n.gzip=function(g,x){return(x=x||{}).gzip=!0,y(g,x)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(t,s,n){var i=t("./zlib/inflate"),r=t("./utils/common"),a=t("./utils/strings"),l=t("./zlib/constants"),c=t("./zlib/messages"),d=t("./zlib/zstream"),h=t("./zlib/gzheader"),f=Object.prototype.toString;function p(m){if(!(this instanceof p))return new p(m);this.options=r.assign({chunkSize:16384,windowBits:0,to:""},m||{});var y=this.options;y.raw&&0<=y.windowBits&&y.windowBits<16&&(y.windowBits=-y.windowBits,y.windowBits===0&&(y.windowBits=-15)),!(0<=y.windowBits&&y.windowBits<16)||m&&m.windowBits||(y.windowBits+=32),15<y.windowBits&&y.windowBits<48&&(15&y.windowBits)==0&&(y.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var g=i.inflateInit2(this.strm,y.windowBits);if(g!==l.Z_OK)throw new Error(c[g]);this.header=new h,i.inflateGetHeader(this.strm,this.header)}function b(m,y){var g=new p(y);if(g.push(m,!0),g.err)throw g.msg||c[g.err];return g.result}p.prototype.push=function(m,y){var g,x,w,v,_,E,k=this.strm,D=this.options.chunkSize,N=this.options.dictionary,R=!1;if(this.ended)return!1;x=y===~~y?y:y===!0?l.Z_FINISH:l.Z_NO_FLUSH,typeof m=="string"?k.input=a.binstring2buf(m):f.call(m)==="[object ArrayBuffer]"?k.input=new Uint8Array(m):k.input=m,k.next_in=0,k.avail_in=k.input.length;do{if(k.avail_out===0&&(k.output=new r.Buf8(D),k.next_out=0,k.avail_out=D),(g=i.inflate(k,l.Z_NO_FLUSH))===l.Z_NEED_DICT&&N&&(E=typeof N=="string"?a.string2buf(N):f.call(N)==="[object ArrayBuffer]"?new Uint8Array(N):N,g=i.inflateSetDictionary(this.strm,E)),g===l.Z_BUF_ERROR&&R===!0&&(g=l.Z_OK,R=!1),g!==l.Z_STREAM_END&&g!==l.Z_OK)return this.onEnd(g),!(this.ended=!0);k.next_out&&(k.avail_out!==0&&g!==l.Z_STREAM_END&&(k.avail_in!==0||x!==l.Z_FINISH&&x!==l.Z_SYNC_FLUSH)||(this.options.to==="string"?(w=a.utf8border(k.output,k.next_out),v=k.next_out-w,_=a.buf2string(k.output,w),k.next_out=v,k.avail_out=D-v,v&&r.arraySet(k.output,k.output,w,v,0),this.onData(_)):this.onData(r.shrinkBuf(k.output,k.next_out)))),k.avail_in===0&&k.avail_out===0&&(R=!0)}while((0<k.avail_in||k.avail_out===0)&&g!==l.Z_STREAM_END);return g===l.Z_STREAM_END&&(x=l.Z_FINISH),x===l.Z_FINISH?(g=i.inflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===l.Z_OK):x!==l.Z_SYNC_FLUSH||(this.onEnd(l.Z_OK),!(k.avail_out=0))},p.prototype.onData=function(m){this.chunks.push(m)},p.prototype.onEnd=function(m){m===l.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=m,this.msg=this.strm.msg},n.Inflate=p,n.inflate=b,n.inflateRaw=function(m,y){return(y=y||{}).raw=!0,b(m,y)},n.ungzip=b},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(t,s,n){var i=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";n.assign=function(l){for(var c=Array.prototype.slice.call(arguments,1);c.length;){var d=c.shift();if(d){if(typeof d!="object")throw new TypeError(d+"must be non-object");for(var h in d)d.hasOwnProperty(h)&&(l[h]=d[h])}}return l},n.shrinkBuf=function(l,c){return l.length===c?l:l.subarray?l.subarray(0,c):(l.length=c,l)};var r={arraySet:function(l,c,d,h,f){if(c.subarray&&l.subarray)l.set(c.subarray(d,d+h),f);else for(var p=0;p<h;p++)l[f+p]=c[d+p]},flattenChunks:function(l){var c,d,h,f,p,b;for(c=h=0,d=l.length;c<d;c++)h+=l[c].length;for(b=new Uint8Array(h),c=f=0,d=l.length;c<d;c++)p=l[c],b.set(p,f),f+=p.length;return b}},a={arraySet:function(l,c,d,h,f){for(var p=0;p<h;p++)l[f+p]=c[d+p]},flattenChunks:function(l){return[].concat.apply([],l)}};n.setTyped=function(l){l?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,a))},n.setTyped(i)},{}],42:[function(t,s,n){var i=t("./common"),r=!0,a=!0;try{String.fromCharCode.apply(null,[0])}catch{r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{a=!1}for(var l=new i.Buf8(256),c=0;c<256;c++)l[c]=252<=c?6:248<=c?5:240<=c?4:224<=c?3:192<=c?2:1;function d(h,f){if(f<65537&&(h.subarray&&a||!h.subarray&&r))return String.fromCharCode.apply(null,i.shrinkBuf(h,f));for(var p="",b=0;b<f;b++)p+=String.fromCharCode(h[b]);return p}l[254]=l[254]=1,n.string2buf=function(h){var f,p,b,m,y,g=h.length,x=0;for(m=0;m<g;m++)(64512&(p=h.charCodeAt(m)))==55296&&m+1<g&&(64512&(b=h.charCodeAt(m+1)))==56320&&(p=65536+(p-55296<<10)+(b-56320),m++),x+=p<128?1:p<2048?2:p<65536?3:4;for(f=new i.Buf8(x),m=y=0;y<x;m++)(64512&(p=h.charCodeAt(m)))==55296&&m+1<g&&(64512&(b=h.charCodeAt(m+1)))==56320&&(p=65536+(p-55296<<10)+(b-56320),m++),p<128?f[y++]=p:(p<2048?f[y++]=192|p>>>6:(p<65536?f[y++]=224|p>>>12:(f[y++]=240|p>>>18,f[y++]=128|p>>>12&63),f[y++]=128|p>>>6&63),f[y++]=128|63&p);return f},n.buf2binstring=function(h){return d(h,h.length)},n.binstring2buf=function(h){for(var f=new i.Buf8(h.length),p=0,b=f.length;p<b;p++)f[p]=h.charCodeAt(p);return f},n.buf2string=function(h,f){var p,b,m,y,g=f||h.length,x=new Array(2*g);for(p=b=0;p<g;)if((m=h[p++])<128)x[b++]=m;else if(4<(y=l[m]))x[b++]=65533,p+=y-1;else{for(m&=y===2?31:y===3?15:7;1<y&&p<g;)m=m<<6|63&h[p++],y--;1<y?x[b++]=65533:m<65536?x[b++]=m:(m-=65536,x[b++]=55296|m>>10&1023,x[b++]=56320|1023&m)}return d(x,b)},n.utf8border=function(h,f){var p;for((f=f||h.length)>h.length&&(f=h.length),p=f-1;0<=p&&(192&h[p])==128;)p--;return p<0||p===0?f:p+l[h[p]]>f?p:f}},{"./common":41}],43:[function(t,s,n){s.exports=function(i,r,a,l){for(var c=65535&i|0,d=i>>>16&65535|0,h=0;a!==0;){for(a-=h=2e3<a?2e3:a;d=d+(c=c+r[l++]|0)|0,--h;);c%=65521,d%=65521}return c|d<<16|0}},{}],44:[function(t,s,n){s.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(t,s,n){var i=(function(){for(var r,a=[],l=0;l<256;l++){r=l;for(var c=0;c<8;c++)r=1&r?3988292384^r>>>1:r>>>1;a[l]=r}return a})();s.exports=function(r,a,l,c){var d=i,h=c+l;r^=-1;for(var f=c;f<h;f++)r=r>>>8^d[255&(r^a[f])];return-1^r}},{}],46:[function(t,s,n){var i,r=t("../utils/common"),a=t("./trees"),l=t("./adler32"),c=t("./crc32"),d=t("./messages"),h=0,f=4,p=0,b=-2,m=-1,y=4,g=2,x=8,w=9,v=286,_=30,E=19,k=2*v+1,D=15,N=3,R=258,j=R+N+1,C=42,B=113,S=1,O=2,U=3,M=4;function G(A,q){return A.msg=d[q],q}function z(A){return(A<<1)-(4<A?9:0)}function $(A){for(var q=A.length;0<=--q;)A[q]=0}function L(A){var q=A.state,V=q.pending;V>A.avail_out&&(V=A.avail_out),V!==0&&(r.arraySet(A.output,q.pending_buf,q.pending_out,V,A.next_out),A.next_out+=V,q.pending_out+=V,A.total_out+=V,A.avail_out-=V,q.pending-=V,q.pending===0&&(q.pending_out=0))}function F(A,q){a._tr_flush_block(A,0<=A.block_start?A.block_start:-1,A.strstart-A.block_start,q),A.block_start=A.strstart,L(A.strm)}function Y(A,q){A.pending_buf[A.pending++]=q}function K(A,q){A.pending_buf[A.pending++]=q>>>8&255,A.pending_buf[A.pending++]=255&q}function X(A,q){var V,I,P=A.max_chain_length,H=A.strstart,Z=A.prev_length,J=A.nice_match,W=A.strstart>A.w_size-j?A.strstart-(A.w_size-j):0,Q=A.window,ne=A.w_mask,ee=A.prev,he=A.strstart+R,Ee=Q[H+Z-1],me=Q[H+Z];A.prev_length>=A.good_match&&(P>>=2),J>A.lookahead&&(J=A.lookahead);do if(Q[(V=q)+Z]===me&&Q[V+Z-1]===Ee&&Q[V]===Q[H]&&Q[++V]===Q[H+1]){H+=2,V++;do;while(Q[++H]===Q[++V]&&Q[++H]===Q[++V]&&Q[++H]===Q[++V]&&Q[++H]===Q[++V]&&Q[++H]===Q[++V]&&Q[++H]===Q[++V]&&Q[++H]===Q[++V]&&Q[++H]===Q[++V]&&H<he);if(I=R-(he-H),H=he-R,Z<I){if(A.match_start=q,J<=(Z=I))break;Ee=Q[H+Z-1],me=Q[H+Z]}}while((q=ee[q&ne])>W&&--P!=0);return Z<=A.lookahead?Z:A.lookahead}function te(A){var q,V,I,P,H,Z,J,W,Q,ne,ee=A.w_size;do{if(P=A.window_size-A.lookahead-A.strstart,A.strstart>=ee+(ee-j)){for(r.arraySet(A.window,A.window,ee,ee,0),A.match_start-=ee,A.strstart-=ee,A.block_start-=ee,q=V=A.hash_size;I=A.head[--q],A.head[q]=ee<=I?I-ee:0,--V;);for(q=V=ee;I=A.prev[--q],A.prev[q]=ee<=I?I-ee:0,--V;);P+=ee}if(A.strm.avail_in===0)break;if(Z=A.strm,J=A.window,W=A.strstart+A.lookahead,Q=P,ne=void 0,ne=Z.avail_in,Q<ne&&(ne=Q),V=ne===0?0:(Z.avail_in-=ne,r.arraySet(J,Z.input,Z.next_in,ne,W),Z.state.wrap===1?Z.adler=l(Z.adler,J,ne,W):Z.state.wrap===2&&(Z.adler=c(Z.adler,J,ne,W)),Z.next_in+=ne,Z.total_in+=ne,ne),A.lookahead+=V,A.lookahead+A.insert>=N)for(H=A.strstart-A.insert,A.ins_h=A.window[H],A.ins_h=(A.ins_h<<A.hash_shift^A.window[H+1])&A.hash_mask;A.insert&&(A.ins_h=(A.ins_h<<A.hash_shift^A.window[H+N-1])&A.hash_mask,A.prev[H&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=H,H++,A.insert--,!(A.lookahead+A.insert<N)););}while(A.lookahead<j&&A.strm.avail_in!==0)}function ae(A,q){for(var V,I;;){if(A.lookahead<j){if(te(A),A.lookahead<j&&q===h)return S;if(A.lookahead===0)break}if(V=0,A.lookahead>=N&&(A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+N-1])&A.hash_mask,V=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart),V!==0&&A.strstart-V<=A.w_size-j&&(A.match_length=X(A,V)),A.match_length>=N)if(I=a._tr_tally(A,A.strstart-A.match_start,A.match_length-N),A.lookahead-=A.match_length,A.match_length<=A.max_lazy_match&&A.lookahead>=N){for(A.match_length--;A.strstart++,A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+N-1])&A.hash_mask,V=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart,--A.match_length!=0;);A.strstart++}else A.strstart+=A.match_length,A.match_length=0,A.ins_h=A.window[A.strstart],A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+1])&A.hash_mask;else I=a._tr_tally(A,0,A.window[A.strstart]),A.lookahead--,A.strstart++;if(I&&(F(A,!1),A.strm.avail_out===0))return S}return A.insert=A.strstart<N-1?A.strstart:N-1,q===f?(F(A,!0),A.strm.avail_out===0?U:M):A.last_lit&&(F(A,!1),A.strm.avail_out===0)?S:O}function ie(A,q){for(var V,I,P;;){if(A.lookahead<j){if(te(A),A.lookahead<j&&q===h)return S;if(A.lookahead===0)break}if(V=0,A.lookahead>=N&&(A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+N-1])&A.hash_mask,V=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart),A.prev_length=A.match_length,A.prev_match=A.match_start,A.match_length=N-1,V!==0&&A.prev_length<A.max_lazy_match&&A.strstart-V<=A.w_size-j&&(A.match_length=X(A,V),A.match_length<=5&&(A.strategy===1||A.match_length===N&&4096<A.strstart-A.match_start)&&(A.match_length=N-1)),A.prev_length>=N&&A.match_length<=A.prev_length){for(P=A.strstart+A.lookahead-N,I=a._tr_tally(A,A.strstart-1-A.prev_match,A.prev_length-N),A.lookahead-=A.prev_length-1,A.prev_length-=2;++A.strstart<=P&&(A.ins_h=(A.ins_h<<A.hash_shift^A.window[A.strstart+N-1])&A.hash_mask,V=A.prev[A.strstart&A.w_mask]=A.head[A.ins_h],A.head[A.ins_h]=A.strstart),--A.prev_length!=0;);if(A.match_available=0,A.match_length=N-1,A.strstart++,I&&(F(A,!1),A.strm.avail_out===0))return S}else if(A.match_available){if((I=a._tr_tally(A,0,A.window[A.strstart-1]))&&F(A,!1),A.strstart++,A.lookahead--,A.strm.avail_out===0)return S}else A.match_available=1,A.strstart++,A.lookahead--}return A.match_available&&(I=a._tr_tally(A,0,A.window[A.strstart-1]),A.match_available=0),A.insert=A.strstart<N-1?A.strstart:N-1,q===f?(F(A,!0),A.strm.avail_out===0?U:M):A.last_lit&&(F(A,!1),A.strm.avail_out===0)?S:O}function le(A,q,V,I,P){this.good_length=A,this.max_lazy=q,this.nice_length=V,this.max_chain=I,this.func=P}function ce(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=x,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new r.Buf16(2*k),this.dyn_dtree=new r.Buf16(2*(2*_+1)),this.bl_tree=new r.Buf16(2*(2*E+1)),$(this.dyn_ltree),$(this.dyn_dtree),$(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new r.Buf16(D+1),this.heap=new r.Buf16(2*v+1),$(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new r.Buf16(2*v+1),$(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function oe(A){var q;return A&&A.state?(A.total_in=A.total_out=0,A.data_type=g,(q=A.state).pending=0,q.pending_out=0,q.wrap<0&&(q.wrap=-q.wrap),q.status=q.wrap?C:B,A.adler=q.wrap===2?0:1,q.last_flush=h,a._tr_init(q),p):G(A,b)}function be(A){var q=oe(A);return q===p&&(function(V){V.window_size=2*V.w_size,$(V.head),V.max_lazy_match=i[V.level].max_lazy,V.good_match=i[V.level].good_length,V.nice_match=i[V.level].nice_length,V.max_chain_length=i[V.level].max_chain,V.strstart=0,V.block_start=0,V.lookahead=0,V.insert=0,V.match_length=V.prev_length=N-1,V.match_available=0,V.ins_h=0})(A.state),q}function _e(A,q,V,I,P,H){if(!A)return b;var Z=1;if(q===m&&(q=6),I<0?(Z=0,I=-I):15<I&&(Z=2,I-=16),P<1||w<P||V!==x||I<8||15<I||q<0||9<q||H<0||y<H)return G(A,b);I===8&&(I=9);var J=new ce;return(A.state=J).strm=A,J.wrap=Z,J.gzhead=null,J.w_bits=I,J.w_size=1<<J.w_bits,J.w_mask=J.w_size-1,J.hash_bits=P+7,J.hash_size=1<<J.hash_bits,J.hash_mask=J.hash_size-1,J.hash_shift=~~((J.hash_bits+N-1)/N),J.window=new r.Buf8(2*J.w_size),J.head=new r.Buf16(J.hash_size),J.prev=new r.Buf16(J.w_size),J.lit_bufsize=1<<P+6,J.pending_buf_size=4*J.lit_bufsize,J.pending_buf=new r.Buf8(J.pending_buf_size),J.d_buf=1*J.lit_bufsize,J.l_buf=3*J.lit_bufsize,J.level=q,J.strategy=H,J.method=V,be(A)}i=[new le(0,0,0,0,function(A,q){var V=65535;for(V>A.pending_buf_size-5&&(V=A.pending_buf_size-5);;){if(A.lookahead<=1){if(te(A),A.lookahead===0&&q===h)return S;if(A.lookahead===0)break}A.strstart+=A.lookahead,A.lookahead=0;var I=A.block_start+V;if((A.strstart===0||A.strstart>=I)&&(A.lookahead=A.strstart-I,A.strstart=I,F(A,!1),A.strm.avail_out===0)||A.strstart-A.block_start>=A.w_size-j&&(F(A,!1),A.strm.avail_out===0))return S}return A.insert=0,q===f?(F(A,!0),A.strm.avail_out===0?U:M):(A.strstart>A.block_start&&(F(A,!1),A.strm.avail_out),S)}),new le(4,4,8,4,ae),new le(4,5,16,8,ae),new le(4,6,32,32,ae),new le(4,4,16,16,ie),new le(8,16,32,32,ie),new le(8,16,128,128,ie),new le(8,32,128,256,ie),new le(32,128,258,1024,ie),new le(32,258,258,4096,ie)],n.deflateInit=function(A,q){return _e(A,q,x,15,8,0)},n.deflateInit2=_e,n.deflateReset=be,n.deflateResetKeep=oe,n.deflateSetHeader=function(A,q){return A&&A.state?A.state.wrap!==2?b:(A.state.gzhead=q,p):b},n.deflate=function(A,q){var V,I,P,H;if(!A||!A.state||5<q||q<0)return A?G(A,b):b;if(I=A.state,!A.output||!A.input&&A.avail_in!==0||I.status===666&&q!==f)return G(A,A.avail_out===0?-5:b);if(I.strm=A,V=I.last_flush,I.last_flush=q,I.status===C)if(I.wrap===2)A.adler=0,Y(I,31),Y(I,139),Y(I,8),I.gzhead?(Y(I,(I.gzhead.text?1:0)+(I.gzhead.hcrc?2:0)+(I.gzhead.extra?4:0)+(I.gzhead.name?8:0)+(I.gzhead.comment?16:0)),Y(I,255&I.gzhead.time),Y(I,I.gzhead.time>>8&255),Y(I,I.gzhead.time>>16&255),Y(I,I.gzhead.time>>24&255),Y(I,I.level===9?2:2<=I.strategy||I.level<2?4:0),Y(I,255&I.gzhead.os),I.gzhead.extra&&I.gzhead.extra.length&&(Y(I,255&I.gzhead.extra.length),Y(I,I.gzhead.extra.length>>8&255)),I.gzhead.hcrc&&(A.adler=c(A.adler,I.pending_buf,I.pending,0)),I.gzindex=0,I.status=69):(Y(I,0),Y(I,0),Y(I,0),Y(I,0),Y(I,0),Y(I,I.level===9?2:2<=I.strategy||I.level<2?4:0),Y(I,3),I.status=B);else{var Z=x+(I.w_bits-8<<4)<<8;Z|=(2<=I.strategy||I.level<2?0:I.level<6?1:I.level===6?2:3)<<6,I.strstart!==0&&(Z|=32),Z+=31-Z%31,I.status=B,K(I,Z),I.strstart!==0&&(K(I,A.adler>>>16),K(I,65535&A.adler)),A.adler=1}if(I.status===69)if(I.gzhead.extra){for(P=I.pending;I.gzindex<(65535&I.gzhead.extra.length)&&(I.pending!==I.pending_buf_size||(I.gzhead.hcrc&&I.pending>P&&(A.adler=c(A.adler,I.pending_buf,I.pending-P,P)),L(A),P=I.pending,I.pending!==I.pending_buf_size));)Y(I,255&I.gzhead.extra[I.gzindex]),I.gzindex++;I.gzhead.hcrc&&I.pending>P&&(A.adler=c(A.adler,I.pending_buf,I.pending-P,P)),I.gzindex===I.gzhead.extra.length&&(I.gzindex=0,I.status=73)}else I.status=73;if(I.status===73)if(I.gzhead.name){P=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>P&&(A.adler=c(A.adler,I.pending_buf,I.pending-P,P)),L(A),P=I.pending,I.pending===I.pending_buf_size)){H=1;break}H=I.gzindex<I.gzhead.name.length?255&I.gzhead.name.charCodeAt(I.gzindex++):0,Y(I,H)}while(H!==0);I.gzhead.hcrc&&I.pending>P&&(A.adler=c(A.adler,I.pending_buf,I.pending-P,P)),H===0&&(I.gzindex=0,I.status=91)}else I.status=91;if(I.status===91)if(I.gzhead.comment){P=I.pending;do{if(I.pending===I.pending_buf_size&&(I.gzhead.hcrc&&I.pending>P&&(A.adler=c(A.adler,I.pending_buf,I.pending-P,P)),L(A),P=I.pending,I.pending===I.pending_buf_size)){H=1;break}H=I.gzindex<I.gzhead.comment.length?255&I.gzhead.comment.charCodeAt(I.gzindex++):0,Y(I,H)}while(H!==0);I.gzhead.hcrc&&I.pending>P&&(A.adler=c(A.adler,I.pending_buf,I.pending-P,P)),H===0&&(I.status=103)}else I.status=103;if(I.status===103&&(I.gzhead.hcrc?(I.pending+2>I.pending_buf_size&&L(A),I.pending+2<=I.pending_buf_size&&(Y(I,255&A.adler),Y(I,A.adler>>8&255),A.adler=0,I.status=B)):I.status=B),I.pending!==0){if(L(A),A.avail_out===0)return I.last_flush=-1,p}else if(A.avail_in===0&&z(q)<=z(V)&&q!==f)return G(A,-5);if(I.status===666&&A.avail_in!==0)return G(A,-5);if(A.avail_in!==0||I.lookahead!==0||q!==h&&I.status!==666){var J=I.strategy===2?(function(W,Q){for(var ne;;){if(W.lookahead===0&&(te(W),W.lookahead===0)){if(Q===h)return S;break}if(W.match_length=0,ne=a._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++,ne&&(F(W,!1),W.strm.avail_out===0))return S}return W.insert=0,Q===f?(F(W,!0),W.strm.avail_out===0?U:M):W.last_lit&&(F(W,!1),W.strm.avail_out===0)?S:O})(I,q):I.strategy===3?(function(W,Q){for(var ne,ee,he,Ee,me=W.window;;){if(W.lookahead<=R){if(te(W),W.lookahead<=R&&Q===h)return S;if(W.lookahead===0)break}if(W.match_length=0,W.lookahead>=N&&0<W.strstart&&(ee=me[he=W.strstart-1])===me[++he]&&ee===me[++he]&&ee===me[++he]){Ee=W.strstart+R;do;while(ee===me[++he]&&ee===me[++he]&&ee===me[++he]&&ee===me[++he]&&ee===me[++he]&&ee===me[++he]&&ee===me[++he]&&ee===me[++he]&&he<Ee);W.match_length=R-(Ee-he),W.match_length>W.lookahead&&(W.match_length=W.lookahead)}if(W.match_length>=N?(ne=a._tr_tally(W,1,W.match_length-N),W.lookahead-=W.match_length,W.strstart+=W.match_length,W.match_length=0):(ne=a._tr_tally(W,0,W.window[W.strstart]),W.lookahead--,W.strstart++),ne&&(F(W,!1),W.strm.avail_out===0))return S}return W.insert=0,Q===f?(F(W,!0),W.strm.avail_out===0?U:M):W.last_lit&&(F(W,!1),W.strm.avail_out===0)?S:O})(I,q):i[I.level].func(I,q);if(J!==U&&J!==M||(I.status=666),J===S||J===U)return A.avail_out===0&&(I.last_flush=-1),p;if(J===O&&(q===1?a._tr_align(I):q!==5&&(a._tr_stored_block(I,0,0,!1),q===3&&($(I.head),I.lookahead===0&&(I.strstart=0,I.block_start=0,I.insert=0))),L(A),A.avail_out===0))return I.last_flush=-1,p}return q!==f?p:I.wrap<=0?1:(I.wrap===2?(Y(I,255&A.adler),Y(I,A.adler>>8&255),Y(I,A.adler>>16&255),Y(I,A.adler>>24&255),Y(I,255&A.total_in),Y(I,A.total_in>>8&255),Y(I,A.total_in>>16&255),Y(I,A.total_in>>24&255)):(K(I,A.adler>>>16),K(I,65535&A.adler)),L(A),0<I.wrap&&(I.wrap=-I.wrap),I.pending!==0?p:1)},n.deflateEnd=function(A){var q;return A&&A.state?(q=A.state.status)!==C&&q!==69&&q!==73&&q!==91&&q!==103&&q!==B&&q!==666?G(A,b):(A.state=null,q===B?G(A,-3):p):b},n.deflateSetDictionary=function(A,q){var V,I,P,H,Z,J,W,Q,ne=q.length;if(!A||!A.state||(H=(V=A.state).wrap)===2||H===1&&V.status!==C||V.lookahead)return b;for(H===1&&(A.adler=l(A.adler,q,ne,0)),V.wrap=0,ne>=V.w_size&&(H===0&&($(V.head),V.strstart=0,V.block_start=0,V.insert=0),Q=new r.Buf8(V.w_size),r.arraySet(Q,q,ne-V.w_size,V.w_size,0),q=Q,ne=V.w_size),Z=A.avail_in,J=A.next_in,W=A.input,A.avail_in=ne,A.next_in=0,A.input=q,te(V);V.lookahead>=N;){for(I=V.strstart,P=V.lookahead-(N-1);V.ins_h=(V.ins_h<<V.hash_shift^V.window[I+N-1])&V.hash_mask,V.prev[I&V.w_mask]=V.head[V.ins_h],V.head[V.ins_h]=I,I++,--P;);V.strstart=I,V.lookahead=N-1,te(V)}return V.strstart+=V.lookahead,V.block_start=V.strstart,V.insert=V.lookahead,V.lookahead=0,V.match_length=V.prev_length=N-1,V.match_available=0,A.next_in=J,A.input=W,A.avail_in=Z,V.wrap=H,p},n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(t,s,n){s.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(t,s,n){s.exports=function(i,r){var a,l,c,d,h,f,p,b,m,y,g,x,w,v,_,E,k,D,N,R,j,C,B,S,O;a=i.state,l=i.next_in,S=i.input,c=l+(i.avail_in-5),d=i.next_out,O=i.output,h=d-(r-i.avail_out),f=d+(i.avail_out-257),p=a.dmax,b=a.wsize,m=a.whave,y=a.wnext,g=a.window,x=a.hold,w=a.bits,v=a.lencode,_=a.distcode,E=(1<<a.lenbits)-1,k=(1<<a.distbits)-1;e:do{w<15&&(x+=S[l++]<<w,w+=8,x+=S[l++]<<w,w+=8),D=v[x&E];t:for(;;){if(x>>>=N=D>>>24,w-=N,(N=D>>>16&255)===0)O[d++]=65535&D;else{if(!(16&N)){if((64&N)==0){D=v[(65535&D)+(x&(1<<N)-1)];continue t}if(32&N){a.mode=12;break e}i.msg="invalid literal/length code",a.mode=30;break e}R=65535&D,(N&=15)&&(w<N&&(x+=S[l++]<<w,w+=8),R+=x&(1<<N)-1,x>>>=N,w-=N),w<15&&(x+=S[l++]<<w,w+=8,x+=S[l++]<<w,w+=8),D=_[x&k];s:for(;;){if(x>>>=N=D>>>24,w-=N,!(16&(N=D>>>16&255))){if((64&N)==0){D=_[(65535&D)+(x&(1<<N)-1)];continue s}i.msg="invalid distance code",a.mode=30;break e}if(j=65535&D,w<(N&=15)&&(x+=S[l++]<<w,(w+=8)<N&&(x+=S[l++]<<w,w+=8)),p<(j+=x&(1<<N)-1)){i.msg="invalid distance too far back",a.mode=30;break e}if(x>>>=N,w-=N,(N=d-h)<j){if(m<(N=j-N)&&a.sane){i.msg="invalid distance too far back",a.mode=30;break e}if(B=g,(C=0)===y){if(C+=b-N,N<R){for(R-=N;O[d++]=g[C++],--N;);C=d-j,B=O}}else if(y<N){if(C+=b+y-N,(N-=y)<R){for(R-=N;O[d++]=g[C++],--N;);if(C=0,y<R){for(R-=N=y;O[d++]=g[C++],--N;);C=d-j,B=O}}}else if(C+=y-N,N<R){for(R-=N;O[d++]=g[C++],--N;);C=d-j,B=O}for(;2<R;)O[d++]=B[C++],O[d++]=B[C++],O[d++]=B[C++],R-=3;R&&(O[d++]=B[C++],1<R&&(O[d++]=B[C++]))}else{for(C=d-j;O[d++]=O[C++],O[d++]=O[C++],O[d++]=O[C++],2<(R-=3););R&&(O[d++]=O[C++],1<R&&(O[d++]=O[C++]))}break}}break}}while(l<c&&d<f);l-=R=w>>3,x&=(1<<(w-=R<<3))-1,i.next_in=l,i.next_out=d,i.avail_in=l<c?c-l+5:5-(l-c),i.avail_out=d<f?f-d+257:257-(d-f),a.hold=x,a.bits=w}},{}],49:[function(t,s,n){var i=t("../utils/common"),r=t("./adler32"),a=t("./crc32"),l=t("./inffast"),c=t("./inftrees"),d=1,h=2,f=0,p=-2,b=1,m=852,y=592;function g(C){return(C>>>24&255)+(C>>>8&65280)+((65280&C)<<8)+((255&C)<<24)}function x(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function w(C){var B;return C&&C.state?(B=C.state,C.total_in=C.total_out=B.total=0,C.msg="",B.wrap&&(C.adler=1&B.wrap),B.mode=b,B.last=0,B.havedict=0,B.dmax=32768,B.head=null,B.hold=0,B.bits=0,B.lencode=B.lendyn=new i.Buf32(m),B.distcode=B.distdyn=new i.Buf32(y),B.sane=1,B.back=-1,f):p}function v(C){var B;return C&&C.state?((B=C.state).wsize=0,B.whave=0,B.wnext=0,w(C)):p}function _(C,B){var S,O;return C&&C.state?(O=C.state,B<0?(S=0,B=-B):(S=1+(B>>4),B<48&&(B&=15)),B&&(B<8||15<B)?p:(O.window!==null&&O.wbits!==B&&(O.window=null),O.wrap=S,O.wbits=B,v(C))):p}function E(C,B){var S,O;return C?(O=new x,(C.state=O).window=null,(S=_(C,B))!==f&&(C.state=null),S):p}var k,D,N=!0;function R(C){if(N){var B;for(k=new i.Buf32(512),D=new i.Buf32(32),B=0;B<144;)C.lens[B++]=8;for(;B<256;)C.lens[B++]=9;for(;B<280;)C.lens[B++]=7;for(;B<288;)C.lens[B++]=8;for(c(d,C.lens,0,288,k,0,C.work,{bits:9}),B=0;B<32;)C.lens[B++]=5;c(h,C.lens,0,32,D,0,C.work,{bits:5}),N=!1}C.lencode=k,C.lenbits=9,C.distcode=D,C.distbits=5}function j(C,B,S,O){var U,M=C.state;return M.window===null&&(M.wsize=1<<M.wbits,M.wnext=0,M.whave=0,M.window=new i.Buf8(M.wsize)),O>=M.wsize?(i.arraySet(M.window,B,S-M.wsize,M.wsize,0),M.wnext=0,M.whave=M.wsize):(O<(U=M.wsize-M.wnext)&&(U=O),i.arraySet(M.window,B,S-O,U,M.wnext),(O-=U)?(i.arraySet(M.window,B,S-O,O,0),M.wnext=O,M.whave=M.wsize):(M.wnext+=U,M.wnext===M.wsize&&(M.wnext=0),M.whave<M.wsize&&(M.whave+=U))),0}n.inflateReset=v,n.inflateReset2=_,n.inflateResetKeep=w,n.inflateInit=function(C){return E(C,15)},n.inflateInit2=E,n.inflate=function(C,B){var S,O,U,M,G,z,$,L,F,Y,K,X,te,ae,ie,le,ce,oe,be,_e,A,q,V,I,P=0,H=new i.Buf8(4),Z=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!C||!C.state||!C.output||!C.input&&C.avail_in!==0)return p;(S=C.state).mode===12&&(S.mode=13),G=C.next_out,U=C.output,$=C.avail_out,M=C.next_in,O=C.input,z=C.avail_in,L=S.hold,F=S.bits,Y=z,K=$,q=f;e:for(;;)switch(S.mode){case b:if(S.wrap===0){S.mode=13;break}for(;F<16;){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}if(2&S.wrap&&L===35615){H[S.check=0]=255&L,H[1]=L>>>8&255,S.check=a(S.check,H,2,0),F=L=0,S.mode=2;break}if(S.flags=0,S.head&&(S.head.done=!1),!(1&S.wrap)||(((255&L)<<8)+(L>>8))%31){C.msg="incorrect header check",S.mode=30;break}if((15&L)!=8){C.msg="unknown compression method",S.mode=30;break}if(F-=4,A=8+(15&(L>>>=4)),S.wbits===0)S.wbits=A;else if(A>S.wbits){C.msg="invalid window size",S.mode=30;break}S.dmax=1<<A,C.adler=S.check=1,S.mode=512&L?10:12,F=L=0;break;case 2:for(;F<16;){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}if(S.flags=L,(255&S.flags)!=8){C.msg="unknown compression method",S.mode=30;break}if(57344&S.flags){C.msg="unknown header flags set",S.mode=30;break}S.head&&(S.head.text=L>>8&1),512&S.flags&&(H[0]=255&L,H[1]=L>>>8&255,S.check=a(S.check,H,2,0)),F=L=0,S.mode=3;case 3:for(;F<32;){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}S.head&&(S.head.time=L),512&S.flags&&(H[0]=255&L,H[1]=L>>>8&255,H[2]=L>>>16&255,H[3]=L>>>24&255,S.check=a(S.check,H,4,0)),F=L=0,S.mode=4;case 4:for(;F<16;){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}S.head&&(S.head.xflags=255&L,S.head.os=L>>8),512&S.flags&&(H[0]=255&L,H[1]=L>>>8&255,S.check=a(S.check,H,2,0)),F=L=0,S.mode=5;case 5:if(1024&S.flags){for(;F<16;){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}S.length=L,S.head&&(S.head.extra_len=L),512&S.flags&&(H[0]=255&L,H[1]=L>>>8&255,S.check=a(S.check,H,2,0)),F=L=0}else S.head&&(S.head.extra=null);S.mode=6;case 6:if(1024&S.flags&&(z<(X=S.length)&&(X=z),X&&(S.head&&(A=S.head.extra_len-S.length,S.head.extra||(S.head.extra=new Array(S.head.extra_len)),i.arraySet(S.head.extra,O,M,X,A)),512&S.flags&&(S.check=a(S.check,O,X,M)),z-=X,M+=X,S.length-=X),S.length))break e;S.length=0,S.mode=7;case 7:if(2048&S.flags){if(z===0)break e;for(X=0;A=O[M+X++],S.head&&A&&S.length<65536&&(S.head.name+=String.fromCharCode(A)),A&&X<z;);if(512&S.flags&&(S.check=a(S.check,O,X,M)),z-=X,M+=X,A)break e}else S.head&&(S.head.name=null);S.length=0,S.mode=8;case 8:if(4096&S.flags){if(z===0)break e;for(X=0;A=O[M+X++],S.head&&A&&S.length<65536&&(S.head.comment+=String.fromCharCode(A)),A&&X<z;);if(512&S.flags&&(S.check=a(S.check,O,X,M)),z-=X,M+=X,A)break e}else S.head&&(S.head.comment=null);S.mode=9;case 9:if(512&S.flags){for(;F<16;){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}if(L!==(65535&S.check)){C.msg="header crc mismatch",S.mode=30;break}F=L=0}S.head&&(S.head.hcrc=S.flags>>9&1,S.head.done=!0),C.adler=S.check=0,S.mode=12;break;case 10:for(;F<32;){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}C.adler=S.check=g(L),F=L=0,S.mode=11;case 11:if(S.havedict===0)return C.next_out=G,C.avail_out=$,C.next_in=M,C.avail_in=z,S.hold=L,S.bits=F,2;C.adler=S.check=1,S.mode=12;case 12:if(B===5||B===6)break e;case 13:if(S.last){L>>>=7&F,F-=7&F,S.mode=27;break}for(;F<3;){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}switch(S.last=1&L,F-=1,3&(L>>>=1)){case 0:S.mode=14;break;case 1:if(R(S),S.mode=20,B!==6)break;L>>>=2,F-=2;break e;case 2:S.mode=17;break;case 3:C.msg="invalid block type",S.mode=30}L>>>=2,F-=2;break;case 14:for(L>>>=7&F,F-=7&F;F<32;){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}if((65535&L)!=(L>>>16^65535)){C.msg="invalid stored block lengths",S.mode=30;break}if(S.length=65535&L,F=L=0,S.mode=15,B===6)break e;case 15:S.mode=16;case 16:if(X=S.length){if(z<X&&(X=z),$<X&&(X=$),X===0)break e;i.arraySet(U,O,M,X,G),z-=X,M+=X,$-=X,G+=X,S.length-=X;break}S.mode=12;break;case 17:for(;F<14;){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}if(S.nlen=257+(31&L),L>>>=5,F-=5,S.ndist=1+(31&L),L>>>=5,F-=5,S.ncode=4+(15&L),L>>>=4,F-=4,286<S.nlen||30<S.ndist){C.msg="too many length or distance symbols",S.mode=30;break}S.have=0,S.mode=18;case 18:for(;S.have<S.ncode;){for(;F<3;){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}S.lens[Z[S.have++]]=7&L,L>>>=3,F-=3}for(;S.have<19;)S.lens[Z[S.have++]]=0;if(S.lencode=S.lendyn,S.lenbits=7,V={bits:S.lenbits},q=c(0,S.lens,0,19,S.lencode,0,S.work,V),S.lenbits=V.bits,q){C.msg="invalid code lengths set",S.mode=30;break}S.have=0,S.mode=19;case 19:for(;S.have<S.nlen+S.ndist;){for(;le=(P=S.lencode[L&(1<<S.lenbits)-1])>>>16&255,ce=65535&P,!((ie=P>>>24)<=F);){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}if(ce<16)L>>>=ie,F-=ie,S.lens[S.have++]=ce;else{if(ce===16){for(I=ie+2;F<I;){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}if(L>>>=ie,F-=ie,S.have===0){C.msg="invalid bit length repeat",S.mode=30;break}A=S.lens[S.have-1],X=3+(3&L),L>>>=2,F-=2}else if(ce===17){for(I=ie+3;F<I;){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}F-=ie,A=0,X=3+(7&(L>>>=ie)),L>>>=3,F-=3}else{for(I=ie+7;F<I;){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}F-=ie,A=0,X=11+(127&(L>>>=ie)),L>>>=7,F-=7}if(S.have+X>S.nlen+S.ndist){C.msg="invalid bit length repeat",S.mode=30;break}for(;X--;)S.lens[S.have++]=A}}if(S.mode===30)break;if(S.lens[256]===0){C.msg="invalid code -- missing end-of-block",S.mode=30;break}if(S.lenbits=9,V={bits:S.lenbits},q=c(d,S.lens,0,S.nlen,S.lencode,0,S.work,V),S.lenbits=V.bits,q){C.msg="invalid literal/lengths set",S.mode=30;break}if(S.distbits=6,S.distcode=S.distdyn,V={bits:S.distbits},q=c(h,S.lens,S.nlen,S.ndist,S.distcode,0,S.work,V),S.distbits=V.bits,q){C.msg="invalid distances set",S.mode=30;break}if(S.mode=20,B===6)break e;case 20:S.mode=21;case 21:if(6<=z&&258<=$){C.next_out=G,C.avail_out=$,C.next_in=M,C.avail_in=z,S.hold=L,S.bits=F,l(C,K),G=C.next_out,U=C.output,$=C.avail_out,M=C.next_in,O=C.input,z=C.avail_in,L=S.hold,F=S.bits,S.mode===12&&(S.back=-1);break}for(S.back=0;le=(P=S.lencode[L&(1<<S.lenbits)-1])>>>16&255,ce=65535&P,!((ie=P>>>24)<=F);){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}if(le&&(240&le)==0){for(oe=ie,be=le,_e=ce;le=(P=S.lencode[_e+((L&(1<<oe+be)-1)>>oe)])>>>16&255,ce=65535&P,!(oe+(ie=P>>>24)<=F);){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}L>>>=oe,F-=oe,S.back+=oe}if(L>>>=ie,F-=ie,S.back+=ie,S.length=ce,le===0){S.mode=26;break}if(32&le){S.back=-1,S.mode=12;break}if(64&le){C.msg="invalid literal/length code",S.mode=30;break}S.extra=15&le,S.mode=22;case 22:if(S.extra){for(I=S.extra;F<I;){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}S.length+=L&(1<<S.extra)-1,L>>>=S.extra,F-=S.extra,S.back+=S.extra}S.was=S.length,S.mode=23;case 23:for(;le=(P=S.distcode[L&(1<<S.distbits)-1])>>>16&255,ce=65535&P,!((ie=P>>>24)<=F);){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}if((240&le)==0){for(oe=ie,be=le,_e=ce;le=(P=S.distcode[_e+((L&(1<<oe+be)-1)>>oe)])>>>16&255,ce=65535&P,!(oe+(ie=P>>>24)<=F);){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}L>>>=oe,F-=oe,S.back+=oe}if(L>>>=ie,F-=ie,S.back+=ie,64&le){C.msg="invalid distance code",S.mode=30;break}S.offset=ce,S.extra=15&le,S.mode=24;case 24:if(S.extra){for(I=S.extra;F<I;){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}S.offset+=L&(1<<S.extra)-1,L>>>=S.extra,F-=S.extra,S.back+=S.extra}if(S.offset>S.dmax){C.msg="invalid distance too far back",S.mode=30;break}S.mode=25;case 25:if($===0)break e;if(X=K-$,S.offset>X){if((X=S.offset-X)>S.whave&&S.sane){C.msg="invalid distance too far back",S.mode=30;break}te=X>S.wnext?(X-=S.wnext,S.wsize-X):S.wnext-X,X>S.length&&(X=S.length),ae=S.window}else ae=U,te=G-S.offset,X=S.length;for($<X&&(X=$),$-=X,S.length-=X;U[G++]=ae[te++],--X;);S.length===0&&(S.mode=21);break;case 26:if($===0)break e;U[G++]=S.length,$--,S.mode=21;break;case 27:if(S.wrap){for(;F<32;){if(z===0)break e;z--,L|=O[M++]<<F,F+=8}if(K-=$,C.total_out+=K,S.total+=K,K&&(C.adler=S.check=S.flags?a(S.check,U,K,G-K):r(S.check,U,K,G-K)),K=$,(S.flags?L:g(L))!==S.check){C.msg="incorrect data check",S.mode=30;break}F=L=0}S.mode=28;case 28:if(S.wrap&&S.flags){for(;F<32;){if(z===0)break e;z--,L+=O[M++]<<F,F+=8}if(L!==(4294967295&S.total)){C.msg="incorrect length check",S.mode=30;break}F=L=0}S.mode=29;case 29:q=1;break e;case 30:q=-3;break e;case 31:return-4;case 32:default:return p}return C.next_out=G,C.avail_out=$,C.next_in=M,C.avail_in=z,S.hold=L,S.bits=F,(S.wsize||K!==C.avail_out&&S.mode<30&&(S.mode<27||B!==4))&&j(C,C.output,C.next_out,K-C.avail_out)?(S.mode=31,-4):(Y-=C.avail_in,K-=C.avail_out,C.total_in+=Y,C.total_out+=K,S.total+=K,S.wrap&&K&&(C.adler=S.check=S.flags?a(S.check,U,K,C.next_out-K):r(S.check,U,K,C.next_out-K)),C.data_type=S.bits+(S.last?64:0)+(S.mode===12?128:0)+(S.mode===20||S.mode===15?256:0),(Y==0&&K===0||B===4)&&q===f&&(q=-5),q)},n.inflateEnd=function(C){if(!C||!C.state)return p;var B=C.state;return B.window&&(B.window=null),C.state=null,f},n.inflateGetHeader=function(C,B){var S;return C&&C.state?(2&(S=C.state).wrap)==0?p:((S.head=B).done=!1,f):p},n.inflateSetDictionary=function(C,B){var S,O=B.length;return C&&C.state?(S=C.state).wrap!==0&&S.mode!==11?p:S.mode===11&&r(1,B,O,0)!==S.check?-3:j(C,B,O,O)?(S.mode=31,-4):(S.havedict=1,f):p},n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(t,s,n){var i=t("../utils/common"),r=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],a=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],l=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],c=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];s.exports=function(d,h,f,p,b,m,y,g){var x,w,v,_,E,k,D,N,R,j=g.bits,C=0,B=0,S=0,O=0,U=0,M=0,G=0,z=0,$=0,L=0,F=null,Y=0,K=new i.Buf16(16),X=new i.Buf16(16),te=null,ae=0;for(C=0;C<=15;C++)K[C]=0;for(B=0;B<p;B++)K[h[f+B]]++;for(U=j,O=15;1<=O&&K[O]===0;O--);if(O<U&&(U=O),O===0)return b[m++]=20971520,b[m++]=20971520,g.bits=1,0;for(S=1;S<O&&K[S]===0;S++);for(U<S&&(U=S),C=z=1;C<=15;C++)if(z<<=1,(z-=K[C])<0)return-1;if(0<z&&(d===0||O!==1))return-1;for(X[1]=0,C=1;C<15;C++)X[C+1]=X[C]+K[C];for(B=0;B<p;B++)h[f+B]!==0&&(y[X[h[f+B]]++]=B);if(k=d===0?(F=te=y,19):d===1?(F=r,Y-=257,te=a,ae-=257,256):(F=l,te=c,-1),C=S,E=m,G=B=L=0,v=-1,_=($=1<<(M=U))-1,d===1&&852<$||d===2&&592<$)return 1;for(;;){for(D=C-G,R=y[B]<k?(N=0,y[B]):y[B]>k?(N=te[ae+y[B]],F[Y+y[B]]):(N=96,0),x=1<<C-G,S=w=1<<M;b[E+(L>>G)+(w-=x)]=D<<24|N<<16|R|0,w!==0;);for(x=1<<C-1;L&x;)x>>=1;if(x!==0?(L&=x-1,L+=x):L=0,B++,--K[C]==0){if(C===O)break;C=h[f+y[B]]}if(U<C&&(L&_)!==v){for(G===0&&(G=U),E+=S,z=1<<(M=C-G);M+G<O&&!((z-=K[M+G])<=0);)M++,z<<=1;if($+=1<<M,d===1&&852<$||d===2&&592<$)return 1;b[v=L&_]=U<<24|M<<16|E-m|0}}return L!==0&&(b[E+L]=C-G<<24|64<<16|0),g.bits=U,0}},{"../utils/common":41}],51:[function(t,s,n){s.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(t,s,n){var i=t("../utils/common"),r=0,a=1;function l(P){for(var H=P.length;0<=--H;)P[H]=0}var c=0,d=29,h=256,f=h+1+d,p=30,b=19,m=2*f+1,y=15,g=16,x=7,w=256,v=16,_=17,E=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],D=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],N=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],j=new Array(2*(f+2));l(j);var C=new Array(2*p);l(C);var B=new Array(512);l(B);var S=new Array(256);l(S);var O=new Array(d);l(O);var U,M,G,z=new Array(p);function $(P,H,Z,J,W){this.static_tree=P,this.extra_bits=H,this.extra_base=Z,this.elems=J,this.max_length=W,this.has_stree=P&&P.length}function L(P,H){this.dyn_tree=P,this.max_code=0,this.stat_desc=H}function F(P){return P<256?B[P]:B[256+(P>>>7)]}function Y(P,H){P.pending_buf[P.pending++]=255&H,P.pending_buf[P.pending++]=H>>>8&255}function K(P,H,Z){P.bi_valid>g-Z?(P.bi_buf|=H<<P.bi_valid&65535,Y(P,P.bi_buf),P.bi_buf=H>>g-P.bi_valid,P.bi_valid+=Z-g):(P.bi_buf|=H<<P.bi_valid&65535,P.bi_valid+=Z)}function X(P,H,Z){K(P,Z[2*H],Z[2*H+1])}function te(P,H){for(var Z=0;Z|=1&P,P>>>=1,Z<<=1,0<--H;);return Z>>>1}function ae(P,H,Z){var J,W,Q=new Array(y+1),ne=0;for(J=1;J<=y;J++)Q[J]=ne=ne+Z[J-1]<<1;for(W=0;W<=H;W++){var ee=P[2*W+1];ee!==0&&(P[2*W]=te(Q[ee]++,ee))}}function ie(P){var H;for(H=0;H<f;H++)P.dyn_ltree[2*H]=0;for(H=0;H<p;H++)P.dyn_dtree[2*H]=0;for(H=0;H<b;H++)P.bl_tree[2*H]=0;P.dyn_ltree[2*w]=1,P.opt_len=P.static_len=0,P.last_lit=P.matches=0}function le(P){8<P.bi_valid?Y(P,P.bi_buf):0<P.bi_valid&&(P.pending_buf[P.pending++]=P.bi_buf),P.bi_buf=0,P.bi_valid=0}function ce(P,H,Z,J){var W=2*H,Q=2*Z;return P[W]<P[Q]||P[W]===P[Q]&&J[H]<=J[Z]}function oe(P,H,Z){for(var J=P.heap[Z],W=Z<<1;W<=P.heap_len&&(W<P.heap_len&&ce(H,P.heap[W+1],P.heap[W],P.depth)&&W++,!ce(H,J,P.heap[W],P.depth));)P.heap[Z]=P.heap[W],Z=W,W<<=1;P.heap[Z]=J}function be(P,H,Z){var J,W,Q,ne,ee=0;if(P.last_lit!==0)for(;J=P.pending_buf[P.d_buf+2*ee]<<8|P.pending_buf[P.d_buf+2*ee+1],W=P.pending_buf[P.l_buf+ee],ee++,J===0?X(P,W,H):(X(P,(Q=S[W])+h+1,H),(ne=k[Q])!==0&&K(P,W-=O[Q],ne),X(P,Q=F(--J),Z),(ne=D[Q])!==0&&K(P,J-=z[Q],ne)),ee<P.last_lit;);X(P,w,H)}function _e(P,H){var Z,J,W,Q=H.dyn_tree,ne=H.stat_desc.static_tree,ee=H.stat_desc.has_stree,he=H.stat_desc.elems,Ee=-1;for(P.heap_len=0,P.heap_max=m,Z=0;Z<he;Z++)Q[2*Z]!==0?(P.heap[++P.heap_len]=Ee=Z,P.depth[Z]=0):Q[2*Z+1]=0;for(;P.heap_len<2;)Q[2*(W=P.heap[++P.heap_len]=Ee<2?++Ee:0)]=1,P.depth[W]=0,P.opt_len--,ee&&(P.static_len-=ne[2*W+1]);for(H.max_code=Ee,Z=P.heap_len>>1;1<=Z;Z--)oe(P,Q,Z);for(W=he;Z=P.heap[1],P.heap[1]=P.heap[P.heap_len--],oe(P,Q,1),J=P.heap[1],P.heap[--P.heap_max]=Z,P.heap[--P.heap_max]=J,Q[2*W]=Q[2*Z]+Q[2*J],P.depth[W]=(P.depth[Z]>=P.depth[J]?P.depth[Z]:P.depth[J])+1,Q[2*Z+1]=Q[2*J+1]=W,P.heap[1]=W++,oe(P,Q,1),2<=P.heap_len;);P.heap[--P.heap_max]=P.heap[1],(function(me,qe){var Mt,Je,Dt,Ne,Ve,ms,ct=qe.dyn_tree,Gs=qe.max_code,Vn=qe.stat_desc.static_tree,Xn=qe.stat_desc.has_stree,Yn=qe.stat_desc.extra_bits,Vs=qe.stat_desc.extra_base,It=qe.stat_desc.max_length,Gt=0;for(Ne=0;Ne<=y;Ne++)me.bl_count[Ne]=0;for(ct[2*me.heap[me.heap_max]+1]=0,Mt=me.heap_max+1;Mt<m;Mt++)It<(Ne=ct[2*ct[2*(Je=me.heap[Mt])+1]+1]+1)&&(Ne=It,Gt++),ct[2*Je+1]=Ne,Gs<Je||(me.bl_count[Ne]++,Ve=0,Vs<=Je&&(Ve=Yn[Je-Vs]),ms=ct[2*Je],me.opt_len+=ms*(Ne+Ve),Xn&&(me.static_len+=ms*(Vn[2*Je+1]+Ve)));if(Gt!==0){do{for(Ne=It-1;me.bl_count[Ne]===0;)Ne--;me.bl_count[Ne]--,me.bl_count[Ne+1]+=2,me.bl_count[It]--,Gt-=2}while(0<Gt);for(Ne=It;Ne!==0;Ne--)for(Je=me.bl_count[Ne];Je!==0;)Gs<(Dt=me.heap[--Mt])||(ct[2*Dt+1]!==Ne&&(me.opt_len+=(Ne-ct[2*Dt+1])*ct[2*Dt],ct[2*Dt+1]=Ne),Je--)}})(P,H),ae(Q,Ee,P.bl_count)}function A(P,H,Z){var J,W,Q=-1,ne=H[1],ee=0,he=7,Ee=4;for(ne===0&&(he=138,Ee=3),H[2*(Z+1)+1]=65535,J=0;J<=Z;J++)W=ne,ne=H[2*(J+1)+1],++ee<he&&W===ne||(ee<Ee?P.bl_tree[2*W]+=ee:W!==0?(W!==Q&&P.bl_tree[2*W]++,P.bl_tree[2*v]++):ee<=10?P.bl_tree[2*_]++:P.bl_tree[2*E]++,Q=W,Ee=(ee=0)===ne?(he=138,3):W===ne?(he=6,3):(he=7,4))}function q(P,H,Z){var J,W,Q=-1,ne=H[1],ee=0,he=7,Ee=4;for(ne===0&&(he=138,Ee=3),J=0;J<=Z;J++)if(W=ne,ne=H[2*(J+1)+1],!(++ee<he&&W===ne)){if(ee<Ee)for(;X(P,W,P.bl_tree),--ee!=0;);else W!==0?(W!==Q&&(X(P,W,P.bl_tree),ee--),X(P,v,P.bl_tree),K(P,ee-3,2)):ee<=10?(X(P,_,P.bl_tree),K(P,ee-3,3)):(X(P,E,P.bl_tree),K(P,ee-11,7));Q=W,Ee=(ee=0)===ne?(he=138,3):W===ne?(he=6,3):(he=7,4)}}l(z);var V=!1;function I(P,H,Z,J){K(P,(c<<1)+(J?1:0),3),(function(W,Q,ne,ee){le(W),Y(W,ne),Y(W,~ne),i.arraySet(W.pending_buf,W.window,Q,ne,W.pending),W.pending+=ne})(P,H,Z)}n._tr_init=function(P){V||((function(){var H,Z,J,W,Q,ne=new Array(y+1);for(W=J=0;W<d-1;W++)for(O[W]=J,H=0;H<1<<k[W];H++)S[J++]=W;for(S[J-1]=W,W=Q=0;W<16;W++)for(z[W]=Q,H=0;H<1<<D[W];H++)B[Q++]=W;for(Q>>=7;W<p;W++)for(z[W]=Q<<7,H=0;H<1<<D[W]-7;H++)B[256+Q++]=W;for(Z=0;Z<=y;Z++)ne[Z]=0;for(H=0;H<=143;)j[2*H+1]=8,H++,ne[8]++;for(;H<=255;)j[2*H+1]=9,H++,ne[9]++;for(;H<=279;)j[2*H+1]=7,H++,ne[7]++;for(;H<=287;)j[2*H+1]=8,H++,ne[8]++;for(ae(j,f+1,ne),H=0;H<p;H++)C[2*H+1]=5,C[2*H]=te(H,5);U=new $(j,k,h+1,f,y),M=new $(C,D,0,p,y),G=new $(new Array(0),N,0,b,x)})(),V=!0),P.l_desc=new L(P.dyn_ltree,U),P.d_desc=new L(P.dyn_dtree,M),P.bl_desc=new L(P.bl_tree,G),P.bi_buf=0,P.bi_valid=0,ie(P)},n._tr_stored_block=I,n._tr_flush_block=function(P,H,Z,J){var W,Q,ne=0;0<P.level?(P.strm.data_type===2&&(P.strm.data_type=(function(ee){var he,Ee=4093624447;for(he=0;he<=31;he++,Ee>>>=1)if(1&Ee&&ee.dyn_ltree[2*he]!==0)return r;if(ee.dyn_ltree[18]!==0||ee.dyn_ltree[20]!==0||ee.dyn_ltree[26]!==0)return a;for(he=32;he<h;he++)if(ee.dyn_ltree[2*he]!==0)return a;return r})(P)),_e(P,P.l_desc),_e(P,P.d_desc),ne=(function(ee){var he;for(A(ee,ee.dyn_ltree,ee.l_desc.max_code),A(ee,ee.dyn_dtree,ee.d_desc.max_code),_e(ee,ee.bl_desc),he=b-1;3<=he&&ee.bl_tree[2*R[he]+1]===0;he--);return ee.opt_len+=3*(he+1)+5+5+4,he})(P),W=P.opt_len+3+7>>>3,(Q=P.static_len+3+7>>>3)<=W&&(W=Q)):W=Q=Z+5,Z+4<=W&&H!==-1?I(P,H,Z,J):P.strategy===4||Q===W?(K(P,2+(J?1:0),3),be(P,j,C)):(K(P,4+(J?1:0),3),(function(ee,he,Ee,me){var qe;for(K(ee,he-257,5),K(ee,Ee-1,5),K(ee,me-4,4),qe=0;qe<me;qe++)K(ee,ee.bl_tree[2*R[qe]+1],3);q(ee,ee.dyn_ltree,he-1),q(ee,ee.dyn_dtree,Ee-1)})(P,P.l_desc.max_code+1,P.d_desc.max_code+1,ne+1),be(P,P.dyn_ltree,P.dyn_dtree)),ie(P),J&&le(P)},n._tr_tally=function(P,H,Z){return P.pending_buf[P.d_buf+2*P.last_lit]=H>>>8&255,P.pending_buf[P.d_buf+2*P.last_lit+1]=255&H,P.pending_buf[P.l_buf+P.last_lit]=255&Z,P.last_lit++,H===0?P.dyn_ltree[2*Z]++:(P.matches++,H--,P.dyn_ltree[2*(S[Z]+h+1)]++,P.dyn_dtree[2*F(H)]++),P.last_lit===P.lit_bufsize-1},n._tr_align=function(P){K(P,2,3),X(P,w,j),(function(H){H.bi_valid===16?(Y(H,H.bi_buf),H.bi_buf=0,H.bi_valid=0):8<=H.bi_valid&&(H.pending_buf[H.pending++]=255&H.bi_buf,H.bi_buf>>=8,H.bi_valid-=8)})(P)}},{"../utils/common":41}],53:[function(t,s,n){s.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(t,s,n){(function(i){(function(r,a){if(!r.setImmediate){var l,c,d,h,f=1,p={},b=!1,m=r.document,y=Object.getPrototypeOf&&Object.getPrototypeOf(r);y=y&&y.setTimeout?y:r,l={}.toString.call(r.process)==="[object process]"?function(v){process.nextTick(function(){x(v)})}:(function(){if(r.postMessage&&!r.importScripts){var v=!0,_=r.onmessage;return r.onmessage=function(){v=!1},r.postMessage("","*"),r.onmessage=_,v}})()?(h="setImmediate$"+Math.random()+"$",r.addEventListener?r.addEventListener("message",w,!1):r.attachEvent("onmessage",w),function(v){r.postMessage(h+v,"*")}):r.MessageChannel?((d=new MessageChannel).port1.onmessage=function(v){x(v.data)},function(v){d.port2.postMessage(v)}):m&&"onreadystatechange"in m.createElement("script")?(c=m.documentElement,function(v){var _=m.createElement("script");_.onreadystatechange=function(){x(v),_.onreadystatechange=null,c.removeChild(_),_=null},c.appendChild(_)}):function(v){setTimeout(x,0,v)},y.setImmediate=function(v){typeof v!="function"&&(v=new Function(""+v));for(var _=new Array(arguments.length-1),E=0;E<_.length;E++)_[E]=arguments[E+1];var k={callback:v,args:_};return p[f]=k,l(f),f++},y.clearImmediate=g}function g(v){delete p[v]}function x(v){if(b)setTimeout(x,0,v);else{var _=p[v];if(_){b=!0;try{(function(E){var k=E.callback,D=E.args;switch(D.length){case 0:k();break;case 1:k(D[0]);break;case 2:k(D[0],D[1]);break;case 3:k(D[0],D[1],D[2]);break;default:k.apply(a,D)}})(_)}finally{g(v),b=!1}}}}function w(v){v.source===r&&typeof v.data=="string"&&v.data.indexOf(h)===0&&x(+v.data.slice(h.length))}})(typeof self>"u"?i===void 0?this:i:self)}).call(this,typeof Ys<"u"?Ys:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(ci)),ci.exports}var hp=dp();const pr=Tl(hp),rl="1.0",mr="manifest.json",Ls="document.pdf",al="analysis.json",ol="audit.json",Yt={maxPages:15,maxTokens:2e4,maxScanRatio:.2,maxFileSizeBytes:20*1024*1024},Gn=o=>{if(o instanceof Uint8Array)return o;if(o instanceof ArrayBuffer)return new Uint8Array(o);if(ArrayBuffer.isView(o))return new Uint8Array(o.buffer,o.byteOffset,o.byteLength);throw new Error("Expected ArrayBuffer or Uint8Array")},ll=async o=>{if(o&&typeof o.arrayBuffer=="function")return new Uint8Array(await o.arrayBuffer());if(typeof Response<"u")return new Uint8Array(await new Response(o).arrayBuffer());throw new Error("Expected a Blob/File with binary content")},up=o=>o.buffer.slice(o.byteOffset,o.byteOffset+o.byteLength),cl=({bytes:o,name:e,type:t})=>{const s=Gn(o);class n extends Blob{constructor(){super([s],{type:t}),this.name=e,this.lastModified=Date.now()}async arrayBuffer(){return up(s)}}return new n},dl=o=>{const e=Object.values(o.files).filter(s=>!s.dir),t=e.find(s=>s.name===Ls);return t||e.find(s=>s.name.toLowerCase().endsWith(".pdf"))||null},fp=async(o,e,t={})=>{const s=await Sn(o);return{version:rl,createdAt:new Date().toISOString(),document:{path:Ls,name:e||Ls,mimeType:"application/pdf",sizeBytes:o.byteLength,sha256:s},metadata:t}};async function pp({pdfBytes:o,pdfName:e,metadata:t={},analysis:s=null,audit:n=[]}){const i=Gn(o),r=new pr,a=await fp(i,e,t);return r.file(Ls,i),r.file(mr,JSON.stringify(a,null,2)),s&&typeof s=="object"&&r.file(al,JSON.stringify(s,null,2)),Array.isArray(n)&&n.length>0&&r.file(ol,JSON.stringify(n,null,2)),r.generateAsync({type:"uint8array",compression:"DEFLATE"})}async function mp(o){const e=Gn(o),t=[],s=[];let n=null;try{const i=await pr.loadAsync(e),r=i.file(mr),a=dl(i);if(r||t.push("Missing manifest.json"),a||t.push("Missing PDF document"),r){const l=await r.async("text"),c=JSON.parse(l);if(n=c,c?.document?.sha256||s.push("Manifest missing document.sha256"),c?.version!==rl&&s.push(`Unexpected envelope version: ${c?.version||"unknown"}`),a&&c?.document?.sha256){const d=await a.async("uint8array");await Sn(d)!==c.document.sha256&&t.push("Document hash mismatch")}}}catch(i){t.push(`Invalid archive: ${i.message}`)}return{valid:t.length===0,errors:t,warnings:s,info:n}}async function gp(o){const e=Gn(o),t=await mp(e);if(!t.valid)throw new Error(`Invalid envelope: ${t.errors.join("; ")}`);const s=await pr.loadAsync(e),n=s.file(mr),i=dl(s);if(!n)throw new Error("Envelope is missing manifest.json");if(!i)throw new Error("Envelope is missing a PDF document");const r=JSON.parse(await n.async("text")),a=await i.async("uint8array"),l=await s.file(al)?.async("text"),c=await s.file(ol)?.async("text");return{manifest:r,analysis:l?JSON.parse(l):null,audit:c?JSON.parse(c):[],pdfBytes:a,pdfName:r?.document?.name||i.name||Ls}}async function gr(o){if(!o)throw new Error("No file provided");const e=String(o.name||"").toLowerCase();if(o.type==="application/pdf"||e.endsWith(".pdf"))return{source:"pdf",pdfFile:o,envelope:null};if(!e.endsWith(".snapsign"))throw new Error("Unsupported file type. Please upload a .pdf or .snapsign file.");const n=await ll(o),i=await gp(n),r=i.pdfName.replace(/\.snapsign$/i,".pdf");return{source:"snapsign",pdfFile:cl({bytes:i.pdfBytes,name:r,type:"application/pdf"}),envelope:i}}async function bp({pdfFile:o,metadata:e={},analysis:t=null,audit:s=[]}){if(!o)throw new Error("Missing pdfFile");const n=await ll(o),i=await pp({pdfBytes:n,pdfName:o.name,metadata:e,analysis:t,audit:s}),r=o.name.replace(/\.pdf$/i,"")+".snapsign";return cl({bytes:i,name:r,type:"application/zip"})}function yp({pageCount:o,extractedText:e,pdfSizeBytes:t}){const s=js({pageCount:o,extractedText:e,pdfSizeBytes:t}),n=s.charsPerPage.filter(c=>c<50).length,i=s.pageCount>0?n/s.pageCount:0,r=Math.ceil(s.totalChars/4),a=[];let l="FREE_OK";return t>Yt.maxFileSizeBytes&&(l="BLOCKED",a.push({code:"FILE_TOO_LARGE",message:`File exceeds ${Math.round(Yt.maxFileSizeBytes/1024/1024)}MB limit`})),l!=="BLOCKED"&&o>Yt.maxPages&&(l="PRO_REQUIRED",a.push({code:"TOO_MANY_PAGES",message:`Document has ${o} pages (max ${Yt.maxPages} for free)`})),l!=="BLOCKED"&&r>Yt.maxTokens&&(l="PRO_REQUIRED",a.push({code:"TOO_MANY_TOKENS",message:`Document content (~${r} tokens) exceeds free limit`})),l!=="BLOCKED"&&i>Yt.maxScanRatio&&(l="PRO_REQUIRED",a.push({code:"SCANNED_PDF",message:`Document is ${Math.round(i*100)}% scanned (OCR needed for free)`})),{classification:l,valid:l==="FREE_OK"||l==="PRO_REQUIRED",estimatedTokens:r,scanRatio:i,stats:s,reasons:a}}async function xp({inputFile:o,extractedText:e,pageCount:t,analyzeFn:s,metadata:n={}}){const i=await gr(o),r=yp({pageCount:t,extractedText:e,pdfSizeBytes:i.pdfFile.size});if(r.classification!=="FREE_OK")return{status:r.classification==="BLOCKED"?"blocked":"upgrade_required",preflight:r,envelopeFile:null};const a=typeof s=="function"?await s():null,l=await bp({pdfFile:i.pdfFile,metadata:n,analysis:a,audit:[{action:"client_analysis",createdAt:new Date().toISOString()}]});return{status:"success",preflight:r,analysis:a,envelopeFile:l}}const ma=o=>{const e=String(o||"").match(/^data:([^;]+);base64,(.+)$/);if(!e)return null;const t=e[1]||"",s=e[2]||"",n=typeof atob=="function"?atob(s):Buffer.from(s,"base64").toString("binary"),i=new Uint8Array(n.length);for(let r=0;r<n.length;r+=1)i[r]=n.charCodeAt(r);return{mimeType:t,bytes:i}},ga=o=>String(o||"").replaceAll("âœ“","X").replaceAll("âœ”","X").replaceAll("ðŸ–¼","[Image]"),hl=async({pdfBytes:o,pageScale:e=1,signatures:t=[],annotations:s=[]}={})=>{if(!o)throw new Error("Missing base PDF bytes");const{PDFDocument:n,StandardFonts:i,rgb:r}=await Nn(async()=>{const{PDFDocument:p,StandardFonts:b,rgb:m}=await import("./index.C3hS-p31.js");return{PDFDocument:p,StandardFonts:b,rgb:m}},__vite__mapDeps([0,1])),a=await n.load(o),l=await a.embedFont(i.Helvetica),c=await a.embedFont(i.TimesRomanItalic),d=await a.embedFont(i.Courier),h=a.getPageCount(),f=Number(e)>0?Number(e):1;for(let p=0;p<h;p+=1){const b=p+1,m=a.getPage(p),{height:y}=m.getSize(),g=(t||[]).filter(w=>w?.pageNum===b);for(const w of g){const v=(w?.x||0)/f,_=(w?.y||0)/f,E=(w?.width||180)/f,k=(w?.height||60)/f,D=y-_-k;if(w?.dataUrl){const R=ma(w.dataUrl);if(R?.bytes){const C=R.mimeType.includes("png")?await a.embedPng(R.bytes):await a.embedJpg(R.bytes);m.drawImage(C,{x:v,y:D,width:E,height:k,opacity:1});continue}}const N=ga(w?.text||"Signature");m.drawText(N,{x:v+2,y:D+Math.max(2,k*.35),size:Math.max(10,Math.min(24,k*.6)),font:c,color:r(.12,.16,.23)})}const x=(s||[]).filter(w=>w?.pageNum===b);for(const w of x){const v=(w?.x||0)/f,_=(w?.y||0)/f;if(w?.type==="image"&&w?.dataUrl){const N=(w?.width||180)/f,R=(w?.height||120)/f,j=y-_-R,C=ma(w.dataUrl);if(C?.bytes){const S=C.mimeType.includes("png")?await a.embedPng(C.bytes):await a.embedJpg(C.bytes);m.drawImage(S,{x:v,y:j,width:N,height:R,opacity:1})}continue}if(w?.type==="checkmark"){const N=y-_-18;m.drawText("X",{x:v,y:N,size:18,font:l,color:r(.08,.5,.23)});continue}const E=ga(w?.text||""),k=w?.type==="date"?11:12,D=y-_-k;m.drawText(E,{x:v,y:D,size:k,font:w?.type==="text"?d:l,color:r(.06,.09,.16)})}}return await a.save()},wp=o=>String(o||"document.pdf").replace(/[^a-zA-Z0-9._-]/g,"_"),vp=({fileName:o,pdfLibLoaded:e,location:t,navigate:s,loadTestPdf:n,loadPdfFromBlob:i,loadError:r,setDialog:a,loadLocalOverride:l,loadServerTypeState:c,runServerDetection:d,functions:h,pdfDoc:f,resetPdf:p})=>{const[b,m]=T.useState(null),[y,g]=T.useState(null),[x,w]=T.useState(!1),v=T.useRef(null);return T.useEffect(()=>{if(!o||!e||v.current===`test:${o}`)return;v.current=`test:${o}`,(async()=>{try{const j=await n(o);if(!j)return;m({id:o,name:o,type:"application/pdf",size:j.fileInfo?.size,file:null}),l(j.docHash),await c(j.docHash),d({docHashValue:j.docHash,stats:j.stats,text:j.text})}catch(j){a({title:"Could not load PDF",message:j?.message||"Failed to load test PDF.",primaryLabel:"OK",primaryTo:null,secondaryLabel:null,secondaryTo:null})}})()},[o,e,l,c,n,d,a]),T.useEffect(()=>{if(!t.state?.document||o||!e)return;const R=t.state.document,j=R.id||R.name;if(v.current===j)return;m(R),g(R?.cloudKey||null),v.current=j,(async()=>{try{const B=await i(R.file);if(!B)return;l(B.docHash),await c(B.docHash),d({docHashValue:B.docHash,stats:B.stats,text:B.text})}catch{}})()},[o,t,e,l,i,c,d]),T.useEffect(()=>{r&&(a({title:"Could not load PDF",message:r?.message||"Failed to load PDF.",primaryLabel:"OK",primaryTo:null}),m(null),s("/view"))},[r,s,a]),{selectedDocument:b,isCloudBusy:x,handleFileUpload:async R=>{const j=Array.from(R.target.files);if(j.length!==0)try{const C=j[0],B=await gr(C),S={id:Date.now()+Math.random(),name:B.pdfFile.name,size:B.pdfFile.size,type:B.pdfFile.type,file:B.pdfFile,sourceType:B.source,envelope:B.envelope||null};m(S),g(null),s("/view",{state:{document:S}})}catch(C){a({title:"Unsupported or invalid file",message:C?.message||"Please upload a valid .pdf or .snapsign file.",primaryLabel:"OK"})}},handleSaveToCloud:async()=>{const R=typeof window<"u"&&typeof window.MOCK_STORAGE_CALLABLES?.storageCreateUploadUrl=="function";if(!(!h&&!R)){if(!b?.file){a({title:"No local file to upload",message:"Open a local PDF first, then save it to DecoDocs cloud storage.",primaryLabel:"OK"});return}w(!0);try{const j=`documents/${Date.now()}-${wp(b.name)}`,C=await ap(h,{key:j,contentType:b.type||"application/pdf",expiresIn:600});await lp({url:C.url,file:b.file,contentType:b.type||"application/pdf"}),g(C.key),m(B=>({...B||{},cloudKey:C.key})),a({title:"Saved to DecoDocs",message:`Document uploaded successfully.
Object key: ${C.key}`,primaryLabel:"OK"})}catch(j){const C=j?.code||"",B=String(C).includes("permission-denied");a({title:B?"Pro required":"Cloud upload failed",message:B?"Cloud storage is available for Pro plans. Upgrade to continue.":j?.message||"Unable to upload file to cloud storage.",primaryLabel:B?"View plans":"OK",primaryTo:B?"/pricing":null})}finally{w(!1)}}},handleDownload:async({signatures:R=[],annotations:j=[],pageScale:C=1}={})=>{if(!f)return;if(Array.isArray(R)&&R.length>0||Array.isArray(j)&&j.length>0)try{w(!0);const S=await f.getData(),O=await hl({pdfBytes:S,pageScale:C,signatures:R,annotations:j}),U=new Blob([O],{type:"application/pdf"}),M=(b?.name||"document.pdf").replace(/\\.pdf$/i,""),G=document.createElement("a");G.href=URL.createObjectURL(U),G.download=`${M}-edited.pdf`,G.click();return}catch(S){a({title:"Download failed",message:S?.message||"Unable to download edited PDF.",primaryLabel:"OK"});return}finally{w(!1)}if(b?.file){const S=document.createElement("a");S.href=URL.createObjectURL(b.file),S.download=b?.name||"document.pdf",S.click();return}if(h&&y){w(!0);try{const S=await op(h,{key:y,expiresIn:600}),O=await cp(S.url),U=document.createElement("a");U.href=URL.createObjectURL(O),U.download=b?.name||"document.pdf",U.click()}catch(S){a({title:"Download failed",message:S?.message||"Unable to download cloud document.",primaryLabel:"OK"})}finally{w(!1)}}},handleEditDocument:({overlays:R}={})=>{b&&s(`/edit/${b.id}`,{state:{document:b,overlays:R||null}})},handleFinishDocument:()=>{m(null);try{typeof p=="function"&&p()}catch{}s("/view")}}},Ap=o=>{if(!o)return!1;const e=o;if(e.isContentEditable)return!0;const t=String(e.tagName||"").toUpperCase();return t==="INPUT"||t==="TEXTAREA"||t==="SELECT"},ul=({enabled:o=!0,canUndo:e=!1,canRedo:t=!1,hasSelection:s=!1,onUndo:n,onRedo:i,onDelete:r}={})=>{T.useEffect(()=>{if(!o)return;const a=l=>{if(!l||Ap(l.target))return;const c=String(l.key||""),h=typeof navigator<"u"&&/Mac|iPhone|iPad|iPod/.test(navigator.platform)?l.metaKey:l.ctrlKey;if((c==="Delete"||c==="Backspace")&&s){typeof r=="function"&&(l.preventDefault(),r());return}if(h&&c.toLowerCase()==="z"){if(l.shiftKey){t&&typeof i=="function"&&(l.preventDefault(),i());return}e&&typeof n=="function"&&(l.preventDefault(),n());return}h&&c.toLowerCase()==="y"&&t&&typeof i=="function"&&(l.preventDefault(),i())};return window.addEventListener("keydown",a,!0),()=>window.removeEventListener("keydown",a,!0)},[o,e,t,s,n,i,r])},di=()=>{const{authState:o,app:e}=lt(),t=typeof window<"u"&&window.MOCK_AUTH,{fileName:s}=zi(),n=Ge(),i=Rt(),r=T.useRef(null),a=e?Dn(e):null,{pdfLibLoaded:l,pdfDoc:c,numPages:d,pageNumber:h,pageScale:f,pdfTextContent:p,docHash:b,isLoading:m,loadingMessage:y,loadPdfFromBlob:g,loadTestPdf:x,navigation:w,loadError:v,resetPdf:_}=fr(),{analysisResults:E,gate:k,dialog:D,setGate:N,setDialog:R,isLoading:j,handleAnalyzeDocument:C,handleAnalyzeByType:B,handleExplainSelection:S,handleHighlightRisks:O,handleTranslateToPlainEnglish:U,handleSummarizeKeyPoints:M,handleSuggestImprovements:G}=Jf({functions:a,authState:o,isMockMode:t}),z=np(),{detectedDocTypeId:$,overrideDocTypeId:L,pendingOverride:F,setOverrideDocTypeId:Y,setPendingOverride:K,loadServerTypeState:X,runServerDetection:te,persistOverride:ae,loadLocalOverride:ie}=sp({functions:a,isMockMode:t}),{activeTool:le,setActiveTool:ce,signatures:oe,annotations:be,signatureModalOpen:_e,setSignatureModalOpen:A,selectedItemId:q,setSelectedItemId:V,handleCanvasClick:I,handleSignClick:P,handleSignatureAdopt:H,startDrag:Z,deleteSelectedItem:J,canUndo:W,canRedo:Q,undo:ne,redo:ee}=rp({initialSignatures:n.state?.overlays?.signatures,initialAnnotations:n.state?.overlays?.annotations}),[he]=T.useState([]),[Ee]=T.useState([]),[me,qe]=T.useState([]),[Mt,Je]=T.useState(!1),[Dt,Ne]=T.useState(!0);ul({enabled:!0,canUndo:W,canRedo:Q,hasSelection:!!q,onUndo:ne,onRedo:ee,onDelete:J}),T.useEffect(()=>{const Ce=vt=>{const mt=vt?.detail||{};R({title:mt.title||"Notice",message:mt.message||"",primaryLabel:mt.primaryLabel||"OK",primaryTo:mt.primaryTo||null,secondaryLabel:mt.secondaryLabel||null,secondaryTo:mt.secondaryTo||null})};return window.addEventListener("decodocs:show-gate",Ce),()=>window.removeEventListener("decodocs:show-gate",Ce)},[R]);const{selectedDocument:Ve,isCloudBusy:ms,handleFileUpload:ct,handleSaveToCloud:Gs,handleDownload:Vn,handleEditDocument:Xn,handleFinishDocument:Yn}=vp({fileName:s,pdfLibLoaded:l,location:n,navigate:i,loadTestPdf:x,loadPdfFromBlob:g,loadError:v,setDialog:R,loadLocalOverride:ie,loadServerTypeState:X,runServerDetection:te,functions:a,pdfDoc:c,resetPdf:_}),Vs=()=>Vn({signatures:oe,annotations:be,pageScale:f}),It=()=>Xn({overlays:{signatures:oe,annotations:be}}),Gt=m,xl=j,{types:wl}=bo(),br=Ce=>wl.find(vt=>vt.id===Ce)||null,yr=br(L||$),vl=br($),Al=yr?.validationSlug||null;su(Al);const Sl=Ce=>{w.setPageNumber(Ce)},qn=Ce=>{w.setPageNumber(Ce);const vt=document.getElementById(`pdf-page-${Ce}`);vt&&vt.scrollIntoView({behavior:"smooth"})},_l=()=>{const Ce=Math.max((h||1)-1,1);qn(Ce)},El=()=>{const Ce=Math.min((h||1)+1,d||1);qn(Ce)},kl=Ce=>{const vt=[];Ce.risks&&Ce.risks.length>0&&Ce.risks.forEach((mt,Kn)=>{vt.push({id:Kn,pageNum:1,x:100+Kn*50,y:100+Kn*40,level:mt.riskLevel,description:mt.description,explanation:mt.explanation})}),qe(vt)},Cl=Ce=>u.jsx(tu,{pageNum:Ce,signatures:oe,annotations:be,selectedItemId:q,onStartDrag:Z,onSelect:V}),Xs=k||D;return u.jsxs("div",{className:"contents",children:[u.jsx(Xh,{open:_e,onClose:()=>A(!1),onAdopt:H}),u.jsx(Yi,{dialog:Xs,onCancel:()=>{N(null),R(null)},onConfirm:async()=>{if(Xs?._kind==="confirm-override"&&F&&b){const Ce=F.id;Y(Ce),await ae(b,Ce),K(null),R(null);return}N(null),R(null),Xs?.primaryTo&&i(Xs.primaryTo)}}),u.jsx(Kh,{open:Mt,detectedType:vl,onClose:()=>Je(!1),onPick:Ce=>{Je(!1),K(Ce),R({title:"Confirm document type",message:`Set document type to â€œ${Ce.label}â€? This will change the actions/checks we show for this document.`,primaryLabel:"Confirm",primaryTo:null,secondaryLabel:"Cancel",secondaryTo:null,_kind:"confirm-override"})}}),u.jsxs("div",{id:"viewer-root",className:"flex flex-col flex-1 h-full overflow-hidden bg-slate-100",children:[c&&u.jsx(Qh,{fileName:Ve?.name,onShare:()=>{Ve&&i("/sign",{state:{document:Ve}})},onSaveCloud:Gs,onDownload:Vs,onEdit:It,onFinish:Yn,isCloudBusy:ms,effectiveDocType:yr,onOpenDocTypeSelector:()=>Je(!0),activeTool:le,setActiveTool:ce,onSignClick:P,canUndo:W,canRedo:Q,hasSelection:!!q,onUndo:ne,onRedo:ee,onDelete:J}),u.jsxs("div",{id:"viewer-content",className:"flex flex-1 overflow-hidden relative",children:[u.jsxs("div",{id:"viewer-canvas-area",className:"flex-1 flex flex-col items-center justify-start overflow-hidden relative",children:[c?u.jsxs("div",{className:"w-full flex-1 relative flex overflow-hidden",children:[u.jsx(go,{pdfDoc:c,numPages:d,currentPage:h,onPageClick:qn}),u.jsx("div",{id:"viewer-scroll-area",className:`flex-1 overflow-auto bg-slate-100/50 relative ${le!=="select"?"cursor-crosshair":""}`,onClickCapture:I,children:u.jsx(po,{pdfDoc:c,numPages:d,pageScale:f,isLoading:Gt,loadingMessage:y,onPageVisible:Sl,highlights:he,clauseMarkers:Ee,riskBadges:me,renderPageOverlay:Cl})})]}):u.jsx("div",{className:"flex-1 flex items-center justify-center w-full",children:u.jsx(mo,{onFileSelect:ct})}),c&&u.jsx(fo,{onFileSelect:ct,onEdit:It,pageNumber:h,numPages:d,pageScale:f,onPreviousPage:_l,onNextPage:El,onZoomIn:w.zoomIn,onZoomOut:w.zoomOut,fileInputRef:r})]}),u.jsx(Oh,{isOpen:Dt,onToggle:()=>Ne(!Dt),onAnalyzeDocument:()=>C({selectedDocument:Ve,pdfTextContent:p,docHash:b,numPages:d,updateAnnotations:kl}),onAnalyzeByType:()=>B({selectedDocument:Ve,pdfTextContent:p,docHash:b}),onExplainSelection:()=>S({selectedDocument:Ve,docHash:b,pdfTextContent:p,selection:z}),onHighlightRisks:()=>O({selectedDocument:Ve,docHash:b,pdfTextContent:p,setRiskBadges:qe}),onTranslateToPlainEnglish:()=>U({selectedDocument:Ve,docHash:b,pdfTextContent:p}),onSummarizeKeyPoints:()=>M({selectedDocument:Ve,docHash:b,pdfTextContent:p}),onSuggestImprovements:()=>G({selectedDocument:Ve,docHash:b,pdfTextContent:p}),isLoading:xl,isAuthenticated:o.status==="authenticated",hasDocument:!!Ve,selectedDocument:Ve,analysisResults:E,textSelection:z})]})]})]})},fl={select:{label:"Select",tooltip:"Select & Move â€” click placed items to select, drag to reposition",hint:"Click on any placed element to select it. Drag to move."},text:{label:"Text",tooltip:"Add Text â€” click to insert a text annotation; then edit or move it",hint:"Click on the document where you want to insert text. After placement you can click to edit or drag to reposition."},signature:{label:"Sign",tooltip:"Create Signature â€” draw or type your signature, then place it",hint:"Click on the document to place your signature. After placement click and drag to adjust."},date:{label:"Date",tooltip:"Insert Date â€” click to place today's date; then reposition if needed",hint:"Click where you want the date. After placing it you can click and drag to move it."},image:{label:"Image",tooltip:"Insert Image â€” add a photo or image to the document",hint:"Click on the document where you want to place the image. Drag to reposition after placing."},shape:{label:"Shapes",tooltip:"Add Shapes â€” insert rectangles, lines, or other shapes",hint:"Click on the document to place a shape. Drag to reposition after placing."}},Sp={select:Tn,text:Ma,signature:Fi,date:La,image:kn,shape:Ql},qt=({active:o,toolId:e,onClick:t})=>{const s=fl[e]||{label:e,tooltip:e},n=Sp[e]||Tn;return u.jsxs("div",{className:"relative group/etool",children:[u.jsx("button",{onClick:t,title:s.tooltip,"data-testid":`editor-tool-${e}`,"aria-label":s.tooltip,className:`flex items-center justify-center p-2.5 rounded-lg transition-all relative ${o?"bg-slate-200/80 text-slate-800":"bg-transparent text-slate-500 hover:bg-slate-200/50 hover:text-slate-800"}`,children:u.jsx(n,{className:"w-5 h-5"})}),u.jsxs("div",{role:"tooltip","data-testid":`editor-tool-tooltip-${e}`,className:"pointer-events-none absolute z-[300] top-full left-1/2 -translate-x-1/2 mt-2 w-52 origin-top opacity-0 scale-95 group-hover/etool:opacity-100 group-hover/etool:scale-100 transition-all duration-150 bg-slate-800 text-white rounded-lg shadow-xl",children:[u.jsxs("div",{className:"px-3 py-2.5",children:[u.jsx("p",{className:"font-semibold text-xs leading-tight",children:s.label}),u.jsx("p",{className:"text-slate-300 text-[11px] leading-snug mt-1",children:s.hint})]}),u.jsx("div",{className:"absolute bottom-full left-1/2 -translate-x-1/2 border-[5px] border-transparent border-b-slate-800"})]})]})},_p=({activeTool:o})=>{if(o==="select")return null;const e=fl[o];return e?u.jsxs("div",{"data-testid":"editor-tool-hint-bar",className:"h-8 px-4 flex items-center bg-blue-50 border-b border-blue-100 text-xs text-blue-700 gap-2 transition-all",children:[u.jsxs("span",{className:"font-semibold",children:[e.label,":"]}),u.jsx("span",{children:e.hint})]}):null},Ep=({fileName:o,activeTool:e,setActiveTool:t,onShare:s,onUpload:n,onCancel:i,onView:r,onDownload:a,canUndo:l=!1,canRedo:c=!1,hasSelection:d=!1,onUndo:h,onRedo:f,onDelete:p})=>u.jsxs("div",{className:"flex flex-col bg-white border-b border-slate-200 z-20 relative font-sans",children:[u.jsxs("div",{className:"h-14 px-4 flex items-center justify-between border-b border-slate-100",children:[u.jsx("div",{className:"flex items-center gap-3 min-w-0",children:u.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[u.jsx("span",{className:"font-bold text-slate-800 text-base truncate max-w-[250px]",children:o||"Untitled Document"}),u.jsxs("div",{className:"flex items-center gap-1 ml-1",children:[u.jsx("button",{type:"button",onClick:h,disabled:!l,title:"Undo (Ctrl/âŒ˜+Z)","aria-label":"Undo",className:"p-1.5 rounded-md text-slate-400 hover:text-slate-700 hover:bg-slate-100 transition-colors disabled:opacity-40 disabled:hover:bg-transparent",children:u.jsx(Da,{className:"w-4 h-4"})}),u.jsx("button",{type:"button",onClick:f,disabled:!c,title:"Redo (Ctrl/âŒ˜+Shift+Z)","aria-label":"Redo",className:"p-1.5 rounded-md text-slate-400 hover:text-slate-700 hover:bg-slate-100 transition-colors disabled:opacity-40 disabled:hover:bg-transparent",children:u.jsx(bi,{className:"w-4 h-4"})}),u.jsx("button",{type:"button",onClick:p,disabled:!d,title:"Delete selected (Del/Backspace)","aria-label":"Delete selected",className:"p-1.5 rounded-md text-slate-400 hover:text-rose-600 hover:bg-rose-50 transition-colors disabled:opacity-40 disabled:hover:bg-transparent",children:u.jsx(Cn,{className:"w-4 h-4"})})]}),u.jsxs("div",{className:"flex items-center gap-1 ml-2",children:[u.jsxs("button",{onClick:s,title:"Share â€” send this document to others for review or signing",className:"flex items-center gap-1.5 px-2.5 py-1 text-xs font-semibold text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-lg transition-colors border border-blue-100",children:[u.jsx(Ia,{className:"w-3.5 h-3.5"})," Share"]}),u.jsxs("button",{onClick:n,title:"Upload â€” replace the current document with a new PDF",className:"flex items-center gap-1.5 px-2.5 py-1 text-xs font-semibold text-slate-600 bg-slate-50 hover:bg-slate-100 rounded-lg transition-colors border border-slate-200",children:[u.jsx(Li,{className:"w-3.5 h-3.5"})," Upload"]})]})]})}),u.jsxs("div",{className:"flex items-center gap-3",children:[u.jsxs("button",{type:"button",onClick:r,title:"View â€” switch to view mode",className:"flex items-center gap-2 px-3 py-1.5 text-slate-600 text-sm font-semibold hover:bg-slate-100 rounded-lg transition-colors",children:[u.jsx(Jl,{className:"w-4 h-4"}),"View"]}),u.jsx("button",{onClick:i,title:"Cancel â€” discard changes and go back",className:"px-3 py-1.5 text-slate-600 text-sm font-semibold hover:bg-slate-100 rounded-lg transition-colors",children:"Cancel"}),u.jsxs("button",{onClick:a,title:"Download â€” save the edited document as a PDF",className:"flex items-center gap-2 px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg transition-all shadow-sm",children:["Download ",u.jsx(ja,{className:"w-4 h-4"})]})]})]}),u.jsxs("div",{className:"h-12 flex items-center justify-center gap-1 bg-slate-50/50",children:[u.jsx(qt,{active:e==="select",toolId:"select",onClick:()=>t("select")}),u.jsx("div",{className:"w-px h-5 bg-slate-300 mx-1"}),u.jsx(qt,{active:e==="text",toolId:"text",onClick:()=>t("text")}),u.jsx(qt,{active:e==="signature",toolId:"signature",onClick:()=>t("signature")}),u.jsx(qt,{active:e==="date",toolId:"date",onClick:()=>t("date")}),u.jsx(qt,{active:e==="image",toolId:"image",onClick:()=>t("image")}),u.jsx(qt,{active:e==="shape",toolId:"shape",onClick:()=>t("shape")})]}),u.jsx(_p,{activeTool:e})]}),kp=({annotation:o})=>{Number(o?.width)>0&&Number(o.width),Number(o?.height)>0&&Number(o.height);const e=o?.dataUrl||"";return u.jsx("div",{className:"w-full h-full flex items-center justify-center bg-white/60",children:e?u.jsx("img",{src:e,alt:o?.text||"Image",className:"w-full h-full object-contain pointer-events-none select-none",draggable:!1}):u.jsx("span",{className:"text-purple-700 text-xs font-semibold pointer-events-none",children:"Image"})})},Cp=({pageNum:o,signatures:e,annotations:t,selectedItemId:s,onStartDrag:n,onSelect:i})=>u.jsxs(u.Fragment,{children:[e.filter(r=>r.pageNum===o).map(r=>u.jsx("div",{"data-testid":`overlay-signature-${r.id}`,className:`absolute border-2 ${s===r.id?"border-blue-500 ring-2 ring-blue-300":"border-blue-500/40"} bg-blue-50/20 flex items-center justify-center cursor-move rounded select-none`,style:{left:r.x,top:r.y,width:r.width,height:r.height,zIndex:50,touchAction:"none"},onClick:a=>{a.stopPropagation(),i&&i(r.id)},onMouseDown:a=>{typeof window<"u"&&"PointerEvent"in window||n&&n(a,r,"signature")},onPointerDown:a=>n&&n(a,r,"signature"),children:u.jsx("span",{className:"text-blue-700 font-script text-xl font-bold pointer-events-none",children:r.text})},r.id)),t.filter(r=>r.pageNum===o).map(r=>u.jsx("div",{"data-testid":`overlay-annotation-${r.id}`,className:`absolute shadow-sm cursor-move rounded select-none overflow-hidden ${s===r.id?"ring-2 ring-blue-400":""} ${r.type==="checkmark"?"px-2 py-1 text-green-700 text-2xl font-bold":r.type==="date"?"px-2 py-1 bg-amber-50 border border-amber-300 text-amber-800":r.type==="image"?"border border-purple-300 bg-purple-50/30":"px-2 py-1 bg-yellow-100 border border-yellow-300 text-slate-800"}`,style:{left:r.x,top:r.y,zIndex:50,touchAction:"none",width:r.type==="image"?r.width||180:void 0,height:r.type==="image"?r.height||120:void 0},onClick:a=>{a.stopPropagation(),i&&i(r.id)},onMouseDown:a=>{typeof window<"u"&&"PointerEvent"in window||n&&n(a,r,"annotation")},onPointerDown:a=>n&&n(a,r,"annotation"),children:r.type==="image"?u.jsx(kp,{annotation:r}):r.text},r.id))]}),Tp=(o,e=50)=>Array.isArray(o)?o.length<=e?o:o.slice(o.length-e):[],ba=({signatures:o,annotations:e,selectedItemId:t})=>({signatures:Array.isArray(o)?o.map(s=>({...s})):[],annotations:Array.isArray(e)?e.map(s=>({...s})):[],selectedItemId:t||null}),Np=({initialSignatures:o=[],initialAnnotations:e=[]}={})=>{const[t,s]=T.useState("select"),[n,i]=T.useState(()=>Array.isArray(o)?o:[]),[r,a]=T.useState(()=>Array.isArray(e)?e:[]),[l,c]=T.useState(null),d=T.useRef(null),h={width:150,height:50},f=T.useRef(n),p=T.useRef(r),b=T.useRef(l);T.useEffect(()=>{f.current=n},[n]),T.useEffect(()=>{p.current=r},[r]),T.useEffect(()=>{b.current=l},[l]);const m=T.useRef(null),[y,g]=T.useState(0);if(!m.current){const O=ba({signatures:Array.isArray(o)?o:[],annotations:Array.isArray(e)?e:[],selectedItemId:null});m.current={stack:[O],index:0}}const x=y>0,w=T.useMemo(()=>{const O=m.current?.stack?.length||0;return y<O-1},[y]),v=T.useCallback(O=>{const U=m.current;if(!U)return;const M=ba(O),G=U.stack.slice(0,U.index+1),z=Tp([...G,M],60);U.stack=z,U.index=z.length-1,g(U.index)},[]),_=T.useCallback(()=>{const O=m.current;if(!O||O.index<=0)return;const U=O.index-1,M=O.stack[U];M&&(O.index=U,g(U),i(M.signatures),a(M.annotations),c(M.selectedItemId))},[]),E=T.useCallback(()=>{const O=m.current;if(!O||O.index>=O.stack.length-1)return;const U=O.index+1,M=O.stack[U];M&&(O.index=U,g(U),i(M.signatures),a(M.annotations),c(M.selectedItemId))},[]),k=(O,U)=>{if(!O||!U)return null;const M=O.querySelector?.(`#pdf-page-${U}`)||null;return M||(typeof document<"u"?document.getElementById(`pdf-page-${U}`):null)||null},D=T.useCallback((O,U,M)=>{a(G=>G.map(z=>z.id===O?{...z,x:U,y:M}:z))},[]),N=T.useCallback((O,U,M)=>{i(G=>G.map(z=>z.id===O?{...z,x:U,y:M}:z))},[]),R=T.useCallback((O,U,M)=>{if(d.current)return;O.stopPropagation();const G=O.currentTarget||O.target,z=Number.isFinite(Number(O.pointerId))?Number(O.pointerId):null,$=U?.pageNum||null,L=($&&typeof document<"u"?document.getElementById(`pdf-page-${$}`):null)||O.target.closest?.("#pdf-page-1")||O.target.closest?.('[id^="pdf-page-"]')||O.target.closest?.("[data-page-num]")||null;if(!L||!$)return;const F=L.getBoundingClientRect(),Y=O.clientX-F.left-U.x,K=O.clientY-F.top-U.y;c(U.id),d.current={id:U.id,kind:M,offsetX:Y,offsetY:K,pageEl:L,hasMoved:!1};const X=ae=>{if(!d.current)return;d.current.hasMoved=!0;const ie=d.current.pageEl.getBoundingClientRect(),le=ae.clientX-ie.left-d.current.offsetX,ce=ae.clientY-ie.top-d.current.offsetY;d.current.kind==="annotation"?D(d.current.id,le,ce):N(d.current.id,le,ce)},te=()=>{const ae=!!d.current?.hasMoved;d.current=null,document.removeEventListener("mousemove",X,!0),document.removeEventListener("mouseup",te,!0),document.removeEventListener("pointermove",X,!0),document.removeEventListener("pointerup",te,!0),G?.removeEventListener&&(G.removeEventListener("pointermove",X,!0),G.removeEventListener("pointerup",te,!0),G.removeEventListener("pointercancel",te,!0)),ae&&v({signatures:f.current,annotations:p.current,selectedItemId:b.current})};if(z!==null&&G?.setPointerCapture)try{G.setPointerCapture(z)}catch{}document.addEventListener("mousemove",X,!0),document.addEventListener("mouseup",te,!0),document.addEventListener("pointermove",X,!0),document.addEventListener("pointerup",te,!0),G?.addEventListener&&(G.addEventListener("pointermove",X,!0),G.addEventListener("pointerup",te,!0),G.addEventListener("pointercancel",te,!0))},[v,D,N]),j=T.useRef(!1),C=T.useCallback(async()=>typeof document>"u"?null:await new Promise(O=>{const U=document.createElement("input");U.type="file",U.accept="image/*",U.multiple=!1;const M=()=>{U.onchange=null;try{U.remove()}catch{}};U.onchange=async()=>{try{const G=U.files?.[0]||null;if(!G){M(),O(null);return}const z=await new Promise((L,F)=>{const Y=new FileReader;Y.onload=()=>L(String(Y.result||"")),Y.onerror=()=>F(new Error("Failed to read image file")),Y.readAsDataURL(G)}),$=new Image;$.onload=()=>{const L={dataUrl:z,width:$.naturalWidth||$.width||0,height:$.naturalHeight||$.height||0,mimeType:G.type||"",name:G.name||""};M(),O(L)},$.onerror=()=>{M(),O({dataUrl:z,width:0,height:0,mimeType:G.type||"",name:G.name||""})},$.src=z}catch{M(),O(null)}},U.style.position="fixed",U.style.left="-9999px",document.body.appendChild(U),U.click()}),[]),B=O=>{if(O?.target?.closest?.('[data-testid^="overlay-"]'))return;if(t==="select"){c(null);return}const U=O.target,M=U?.closest?.("[data-page-num]")||null,G=U?.closest?.('[id^="pdf-page-"]')||null;let z=(M?parseInt(M.getAttribute("data-page-num"),10):NaN)||(G?.id?parseInt(String(G.id).replace("pdf-page-",""),10):NaN),$=k(M||G,z)||G||M;if((!$||!z||Number.isNaN(z))&&typeof document<"u"){const te=Array.from(document.querySelectorAll('[id^="pdf-page-"]')).find(ae=>{const ie=ae.getBoundingClientRect();return O.clientX>=ie.left&&O.clientX<=ie.right&&O.clientY>=ie.top&&O.clientY<=ie.bottom})||null;if(te?.id){const ae=parseInt(String(te.id).replace("pdf-page-",""),10);!Number.isNaN(ae)&&ae>0&&(z=ae,$=te)}}if(!$||!z||Number.isNaN(z))return;const L=$.getBoundingClientRect(),F=O.clientX-L.left,Y=O.clientY-L.top,K={signatures:f.current,annotations:p.current,selectedItemId:null};if(t==="signature"){const X={id:Date.now(),pageNum:z,x:F,y:Y,width:h.width,height:h.height,text:"John Doe",type:"signature"},te=[...K.signatures,X];i(te),c(X.id),v({...K,signatures:te,selectedItemId:X.id}),s("select");return}if(t==="text"){const X={id:Date.now(),pageNum:z,x:F,y:Y,text:"Type something...",type:"text"},te=[...K.annotations,X];a(te),c(X.id),v({...K,annotations:te,selectedItemId:X.id}),s("select");return}if(t==="date"){const X={id:Date.now(),pageNum:z,x:F,y:Y,text:new Date().toLocaleDateString(),type:"date"},te=[...K.annotations,X];a(te),c(X.id),v({...K,annotations:te,selectedItemId:X.id}),s("select");return}if(t==="image"){if(j.current)return;j.current=!0,(async()=>{try{const X=await C();if(!X?.dataUrl)return;const te=240,ae=240,ie=Number(X.width)||0,le=Number(X.height)||0,ce=ie>0&&le>0?Math.min(1,te/ie,ae/le):1,oe=Math.max(48,Math.round((ie||220)*ce)),be=Math.max(48,Math.round((le||120)*ce)),_e=Math.max(0,Math.min(F-oe/2,L.width-oe)),A=Math.max(0,Math.min(Y-be/2,L.height-be)),q={id:Date.now(),pageNum:z,x:_e,y:A,type:"image",text:X.name||"Image",dataUrl:X.dataUrl,width:oe,height:be},V=[...p.current,q];a(V),c(q.id),v({...K,annotations:V,selectedItemId:q.id}),s("select")}finally{j.current=!1}})();return}if(t==="checkmark"){const X={id:Date.now(),pageNum:z,x:F,y:Y,text:"âœ“",type:"checkmark"},te=[...K.annotations,X];a(te),c(X.id),v({...K,annotations:te,selectedItemId:X.id}),s("select")}},S=T.useCallback(()=>{if(!l)return;const O=p.current.filter(M=>M.id!==l),U=f.current.filter(M=>M.id!==l);a(O),i(U),c(null),v({signatures:U,annotations:O,selectedItemId:null})},[v,l]);return{activeTool:t,setActiveTool:s,signatures:n,annotations:r,signatureDimensions:h,selectedItemId:l,setSelectedItemId:c,handleCanvasClick:B,startDrag:R,deleteSelectedItem:S,canUndo:x,canRedo:w,undo:_,redo:E}},ya=()=>{const{documentId:o}=zi(),e=Ge(),t=Rt(),s=T.useRef(null),{pdfLibLoaded:n,pdfDoc:i,numPages:r,pageNumber:a,pageScale:l,isLoading:c,loadingMessage:d,loadPdfFromBlob:h,loadTestPdf:f,navigation:p}=fr(),[b,m]=T.useState(null),[y,g]=T.useState(null),{activeTool:x,setActiveTool:w,signatures:v,annotations:_,selectedItemId:E,setSelectedItemId:k,handleCanvasClick:D,startDrag:N,deleteSelectedItem:R,canUndo:j,canRedo:C,undo:B,redo:S}=Np({initialSignatures:e.state?.overlays?.signatures,initialAnnotations:e.state?.overlays?.annotations});ul({enabled:!0,canUndo:j,canRedo:C,hasSelection:!!E,onUndo:B,onRedo:S,onDelete:R}),T.useEffect(()=>{if(e.state?.document&&!i&&n){const z=e.state.document;m(z),z.file&&h(z.file).catch(console.error);return}if(e.pathname.includes("test-docs")&&n&&!i){const z=e.pathname.split("/").pop();z?.endsWith(".pdf")&&f(z).then($=>{$&&m({name:z,id:"test-doc",type:"application/pdf"})});return}o&&n&&!i&&!e.pathname.includes("test-docs")&&m({id:o,name:`Document_${o}.pdf`,type:"application/pdf",file:null})},[e,o,n,i,h,f]),T.useEffect(()=>{const z=$=>{const L=$?.detail||{};g({title:L.title||"Notice",message:L.message||"",primaryLabel:L.primaryLabel||"OK",primaryTo:L.primaryTo||null,secondaryLabel:L.secondaryLabel||null,secondaryTo:L.secondaryTo||null})};return window.addEventListener("decodocs:show-gate",z),()=>window.removeEventListener("decodocs:show-gate",z)},[]);const O=z=>{const L=Array.from(z.target.files).filter(K=>K.type==="application/pdf");if(L.length===0)return;const F=L[0],Y={id:Date.now(),name:F.name,size:F.size,type:F.type,file:F};m(Y),h(F)},U=async()=>{if(!i){g({title:"No PDF open",message:"Open a PDF first.",primaryLabel:"OK",primaryTo:null});return}try{const z=await i.getData(),$=await hl({pdfBytes:z,pageScale:l,signatures:v,annotations:_}),L=new Blob([$],{type:"application/pdf"}),F=(b?.name||"document.pdf").replace(/\\.pdf$/i,""),Y=document.createElement("a");Y.href=URL.createObjectURL(L),Y.download=`${F}-edited.pdf`,Y.click()}catch(z){console.error("Failed to export edited PDF:",z),g({title:"Export failed",message:z?.message||"Unable to export edited PDF.",primaryLabel:"OK",primaryTo:null})}},M=z=>{p.setPageNumber(z);const $=document.getElementById(`pdf-page-${z}`);$&&$.scrollIntoView({behavior:"smooth"})},G=z=>u.jsx(Cp,{pageNum:z,signatures:v,annotations:_,selectedItemId:E,onStartDrag:N,onSelect:k});return u.jsxs("div",{className:"contents",children:[u.jsx(Yi,{dialog:y,onCancel:()=>g(null),onConfirm:()=>{y?.primaryTo&&(y.primaryTo==="/pricing"||y.primaryTo.startsWith("http")?window.location.assign(y.primaryTo):t(y.primaryTo)),g(null)}}),u.jsxs("div",{className:"flex flex-col h-full bg-slate-100",children:[u.jsx(Ep,{fileName:b?.name,activeTool:x,setActiveTool:w,onShare:()=>{g({title:"Pro required",message:"Upgrade to Pro to share links.",primaryLabel:"Upgrade to Pro",primaryTo:"/pricing",secondaryLabel:"Cancel",secondaryTo:null})},onUpload:()=>{g({title:"Pro required",message:"Upgrade to Pro to upload to cloud.",primaryLabel:"Upgrade to Pro",primaryTo:"/pricing",secondaryLabel:"Cancel",secondaryTo:null})},onView:()=>{const z={signatures:v,annotations:_};if(e.pathname.includes("/edit/test-docs/")&&b?.name){t(`/view/test-docs/${b.name}`,{state:{overlays:z}});return}t("/view",{state:{document:b,overlays:z}})},onCancel:()=>t("/view"),onDownload:U,canUndo:j,canRedo:C,hasSelection:!!E,onUndo:B,onRedo:S,onDelete:R}),u.jsxs("div",{className:"flex-1 flex overflow-hidden relative",children:[i&&u.jsx(go,{pdfDoc:i,numPages:r,currentPage:a,onPageClick:M}),u.jsx("div",{className:"flex-1 overflow-auto p-8 flex justify-center relative bg-slate-100/50",children:i?u.jsx("div",{className:`w-full flex justify-center ${x!=="select"?"cursor-crosshair":""}`,style:{minHeight:"100%"},onClickCapture:D,children:u.jsx(po,{pdfDoc:i,numPages:r,pageScale:l,isLoading:c,loadingMessage:d,onPageVisible:z=>p.setPageNumber(z),renderPageOverlay:G})}):u.jsx("div",{className:"flex-1 flex items-center justify-center w-full",children:u.jsx(mo,{onFileSelect:O})})}),u.jsx(fo,{onFileSelect:O,onEdit:()=>{},pageNumber:a,numPages:r,pageScale:l,onPreviousPage:p.goToPreviousPage,onNextPage:p.goToNextPage,onZoomIn:p.zoomIn,onZoomOut:p.zoomOut,fileInputRef:s})]})]})]})},Pp=()=>u.jsx("section",{className:"about-page",children:u.jsx("div",{className:"about-main",children:u.jsxs("div",{className:"about-container",children:[u.jsxs("section",{className:"about-header",children:[u.jsx("h1",{children:"About DecoDocs"}),u.jsx("p",{children:"DecoDocs is a document intelligence product designed to help people understand what they are about to sign. Before any signature, DecoDocs explains documents in plain language, highlights caveats and unfair conditions, flags logical inconsistencies, and provides translations when needed. Our focus is clarity before commitment."})]}),u.jsxs("section",{className:"product-philosophy",children:[u.jsx("h2",{children:"What We Believe"}),u.jsxs("ul",{className:"philosophy-list",children:[u.jsx("li",{children:"Documents should be understood before being signed"}),u.jsx("li",{children:"AI should reduce information asymmetry, not introduce new ones"}),u.jsx("li",{children:"Free users deserve real value, not crippled features"}),u.jsx("li",{children:"We charge only for real costs: deeper analysis and storage"}),u.jsx("li",{children:"Documents belong to users, not platforms"})]})]}),u.jsxs("section",{className:"scope-definition",children:[u.jsx("h2",{children:"What DecoDocs Is â€” and Is Not"}),u.jsxs("div",{className:"scope-columns",children:[u.jsxs("div",{className:"scope-column",children:[u.jsx("h3",{children:"Is"}),u.jsxs("ul",{children:[u.jsx("li",{children:"Pre-signature document analysis"}),u.jsx("li",{children:"Plain-language explanation"}),u.jsx("li",{children:"Caveat and unfair-condition detection"}),u.jsx("li",{children:"Logical inconsistency checks"}),u.jsx("li",{children:"Ephemeral processing by default"})]})]}),u.jsxs("div",{className:"scope-column",children:[u.jsx("h3",{children:"Is Not"}),u.jsxs("ul",{children:[u.jsx("li",{children:"A document editor"}),u.jsx("li",{children:"A document management system"}),u.jsx("li",{children:'A "sign now, think later" tool'}),u.jsx("li",{children:"A storage-first SaaS"}),u.jsx("li",{children:"A replacement for legal advice"})]})]})]}),u.jsx("p",{className:"legal-disclaimer",children:"DecoDocs provides informational analysis and is not legal advice. For legal decisions, consult a qualified professional."})]}),u.jsxs("section",{className:"decodocs-clarification",children:[u.jsx("h2",{children:"How It Relates To Snap Sign"}),u.jsx("p",{children:"Snap Sign Pty Ltd builds DecoDocs. Snap Sign is the company brand and broader product family; DecoDocs is the document understanding and analysis product in that family."})]}),u.jsxs("section",{className:"team-company",children:[u.jsx("h2",{children:"Company"}),u.jsx("p",{children:"Snap Sign is built by a small, focused team with backgrounds in software engineering, automation, and privacy-first systems. We prioritize correctness, transparency, and long-term maintainability."}),u.jsxs("div",{className:"legal-block",children:[u.jsx("p",{children:"Snap Sign Pty Ltd"}),u.jsx("p",{children:"ABN 72 679 570 757"}),u.jsx("p",{children:"Australia"})]})]}),u.jsxs("section",{className:"collaboration-contact",children:[u.jsx("h2",{children:"Collaboration"}),u.jsx("p",{children:"We welcome serious collaboration and partnership enquiries. For certain discussions, a Non-Disclosure Agreement (NDA) may be required before sharing internal details."}),u.jsx("div",{className:"contact-info",children:u.jsxs("p",{children:["Email: ",u.jsx("a",{href:"mailto:partnerships@snapsign.com.au",children:"partnerships@snapsign.com.au"})]})})]})]})})}),Rp=()=>{const o="mailto:team@snapsign.com.au?subject="+encodeURIComponent("DecoDocs account or sign-in support"),e="mailto:team@snapsign.com.au?subject="+encodeURIComponent("DecoDocs integration request");return u.jsxs("section",{className:"mx-auto w-full max-w-3xl px-6 py-16",children:[u.jsx("h1",{className:"text-3xl font-semibold text-slate-900",children:"Contact"}),u.jsxs("p",{className:"mt-4 text-slate-700",children:["For support, partnerships, account help, or product feedback, email us at"," ",u.jsx("a",{className:"underline",href:"mailto:team@snapsign.com.au",children:"team@snapsign.com.au"}),"."]}),u.jsxs("div",{className:"mt-10 rounded-2xl border border-slate-200 bg-white p-6",children:[u.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Account and OAuth support"}),u.jsx("p",{className:"mt-2 text-slate-700",children:"Need help with account creation, sign-in, provider linking, or provider access issues? We currently support Email/Password plus Google, Microsoft, and Apple sign-in where available."}),u.jsxs("p",{className:"mt-4 text-slate-700",children:["Support email: ",u.jsx("a",{className:"underline",href:o,children:"team@snapsign.com.au"}),u.jsx("span",{className:"ml-2 text-xs text-slate-500",children:"(mailto)"})]}),u.jsxs("div",{className:"mt-4 rounded-md bg-slate-50 p-3 border border-slate-100 text-sm text-slate-700",children:[u.jsx("p",{className:"font-medium",children:"Existing address"}),u.jsx("p",{children:u.jsx("code",{children:"team@snapsign.com.au"})}),u.jsx("p",{className:"font-medium mt-3",children:"Forwarding address"}),u.jsx("p",{children:u.jsx("code",{children:"us11-d77f8d54a3-485b264cff@inbound.mailchimpapp.net"})}),u.jsx("p",{className:"font-medium mt-3",children:"Domain verified"}),u.jsxs("p",{children:["Verified â€” You have permission to send email from a ",u.jsx("code",{children:"snapsign.com.au"})," address."]})]})]}),u.jsxs("div",{className:"mt-6 rounded-2xl border border-slate-200 bg-white p-6",children:[u.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Integration requests"}),u.jsx("p",{className:"mt-2 text-slate-700",children:"Want a specific integration? Tell us your workflow. Planned roadmap integrations include Google Drive, OneDrive, and iCloud Drive import flows."}),u.jsx("a",{className:"mt-4 inline-flex rounded-full border border-slate-300 bg-white px-5 py-2 text-sm font-semibold text-slate-800",href:e,children:"Request an integration"})]})]})},xa={md:"dd-page-md",lg:"dd-page-lg",xl:"dd-page-xl"},Nt=({children:o,size:e="lg",className:t=""})=>{const s=xa[e]||xa.lg;return u.jsx("section",{className:`dd-page ${s} ${t}`,children:o})},wa={info:"border-sky-200 bg-sky-50 text-sky-900",warning:"border-amber-200 bg-amber-50 text-amber-800",success:"border-emerald-200 bg-emerald-50 text-emerald-800",error:"border-rose-200 bg-rose-50 text-rose-800",neutral:"border-slate-200 bg-slate-50 text-slate-700"},Ht=({children:o,tone:e="neutral",className:t=""})=>{const s=wa[e]||wa.neutral;return u.jsx("div",{className:`dd-notice ${s} ${t}`,children:o})},As=o=>{try{return new Intl.NumberFormat("en-AU",{style:"currency",currency:"AUD",maximumFractionDigits:0}).format(o)}catch{return`$${o} AUD`}},hi="dd-btn dd-btn-solid mt-2 w-full",va=o=>["dd-pill",o?"dd-pill-active":""].join(" "),ui=({items:o})=>u.jsx("ul",{className:"m-0 list-disc pl-5 text-slate-900 leading-7",children:o.map(e=>u.jsx("li",{className:"mb-1.5",children:e},e))});function Dp(){const e="test".toLowerCase()!=="live",t=Rt(),s=Ge(),{authState:n,app:i}=lt(),r=T.useMemo(()=>new URLSearchParams(s.search),[s.search]),a=r.get("billing")==="annual"?"annual":"monthly",[l,c]=T.useState(a),[d,h]=T.useState(null),[f,p]=T.useState(null),b=T.useRef(!1),m=T.useMemo(()=>{const x=l==="annual"?{label:As(60),suffix:"/year"}:{label:As(5),suffix:"/month"},w=l==="annual"?{label:As(600),suffix:"/year"}:{label:As(50),suffix:"/month"};return{pro:x,business:w}},[l]),y=async(x,w=l)=>{if(p(null),h(x),!n?.user||n?.user?.isAnonymous){const v=new URLSearchParams({intent:"upgrade",plan:x,billing:w});e&&v.set("sandbox","1"),t(`/sign-in?${v.toString()}`),h(null);return}try{const{getFunctions:v,httpsCallable:_}=await Nn(async()=>{const{getFunctions:R,httpsCallable:j}=await Promise.resolve().then(()=>uo);return{getFunctions:R,httpsCallable:j}},void 0),E=i?v(i):null;if(!E)throw new Error("Checkout unavailable (Firebase not ready).");const N=(await _(E,"stripeCreateCheckoutSession")({billing:w,plan:x}))?.data?.url;if(!N)throw new Error("No checkout URL returned");window.location.assign(N)}catch(v){p(`Could not start Stripe checkout: ${v?.message||v}`),h(null)}};T.useEffect(()=>{const x=r.get("stripe");if(x==="cancel"){p("Stripe checkout was canceled. Your account was not charged.");return}if(x==="success"){p("Stripe checkout completed. We are finalizing your subscription status from webhook events.");return}if(e||r.get("sandbox")==="1"){p("Sandbox mode is active. Use Stripe test cards only.");return}p(null)},[e,r]),T.useEffect(()=>{if(b.current||r.get("autoCheckout")!=="1")return;const x=r.get("plan")==="business"?"business":"pro",w=r.get("billing")==="annual"?"annual":"monthly";l!==w&&c(w),b.current=!0,y(x,w)},[n?.user,l,r]);const g=()=>t("/sign-in");return u.jsxs(Nt,{size:"xl",children:[u.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-3",children:[u.jsxs("div",{children:[u.jsx("h1",{className:"dd-title",children:"Pricing"}),u.jsx("p",{className:"dd-lead mb-0",children:"Compare Free, Pro, and Business plans. Enterprise is available for larger teams."})]}),u.jsxs("div",{className:"flex items-center gap-2.5",children:[u.jsx("button",{type:"button",onClick:()=>c("monthly"),className:va(l==="monthly"),children:"Monthly"}),u.jsx("button",{type:"button",onClick:()=>c("annual"),className:va(l==="annual"),children:"Annual"})]})]}),u.jsx(Ht,{tone:"info",className:"mt-4 text-base",children:"DecoDocs is publicly available for anonymous trial use. You can open a PDF and test the core experience instantly, then create a free account when you want higher daily limits and cross-device continuity."}),f?u.jsx(Ht,{tone:"warning",className:"mt-4",children:f}):null,u.jsxs("div",{className:"mt-5 grid grid-cols-1 gap-3.5 md:grid-cols-2 xl:grid-cols-3",children:[u.jsxs(Ye,{children:[u.jsxs("div",{className:"flex items-baseline justify-between",children:[u.jsx("div",{className:"text-base font-extrabold",children:"Free"}),u.jsxs("div",{className:"text-lg font-extrabold",children:[As(0),u.jsx("span",{className:"ml-0.5 text-xs font-semibold text-slate-500",children:"/forever"})]})]}),u.jsx("p",{className:"mt-2.5 leading-relaxed text-slate-600",children:"Create an account to get a bigger daily budget and manage linked sign-in methods."}),u.jsx("button",{type:"button",onClick:g,className:hi,children:"Continue for free"}),u.jsx("div",{className:"mt-3.5",children:u.jsx(ui,{items:["AI analysis budget: 40k tokens/day per uid","Text-only PDFs (no OCR)","No storage with us (browser-only)","Link providers (Google/Email/Apple/Microsoft)"]})})]}),u.jsxs(Ye,{className:"border-slate-900",children:[u.jsxs("div",{className:"flex items-baseline justify-between",children:[u.jsx("div",{className:"text-base font-black",children:"Pro"}),u.jsxs("div",{className:"text-lg font-black",children:[m.pro.label,u.jsx("span",{className:"ml-0.5 text-xs font-semibold text-slate-500",children:m.pro.suffix})]})]}),u.jsx("p",{className:"mt-2.5 leading-relaxed text-slate-600",children:"OCR for scanned PDFs, no token cap enforced today (fair use), better model, and 5GB storage."}),u.jsx("button",{type:"button",onClick:()=>y("pro",l),disabled:d!==null,className:hi,children:d==="pro"?"Opening checkout...":"Upgrade to Pro"}),u.jsx("div",{className:"mt-3.5",children:u.jsx(ui,{items:["No token cap enforced today (fair use)","OCR / vision model for scanned PDFs","5GB storage (Contabo VPS)","Receipts + subscription management in /profile"]})})]}),u.jsxs(Ye,{children:[u.jsxs("div",{className:"flex items-baseline justify-between",children:[u.jsx("div",{className:"text-base font-black",children:"Business"}),u.jsxs("div",{className:"text-lg font-black",children:[m.business.label,u.jsx("span",{className:"ml-0.5 text-xs font-semibold text-slate-500",children:m.business.suffix})]})]}),u.jsx("p",{className:"mt-2.5 leading-relaxed text-slate-600",children:"Team plan for up to 5 worker accounts with shared billing and team visibility."}),u.jsx("button",{type:"button",onClick:()=>y("business",l),disabled:d!==null,className:hi,children:d==="business"?"Opening checkout...":"Start Business"}),u.jsx("div",{className:"mt-3.5",children:u.jsx(ui,{items:["Everything in Pro","Up to 5 worker accounts","Shared billing + seat management","Admin visibility across team docs"]})})]})]}),u.jsxs(Ye,{className:"mt-4 bg-slate-50",children:[u.jsx("div",{className:"mb-2 font-black",children:"Enterprise"}),u.jsxs("div",{className:"leading-7 text-slate-600",children:["Need more than ",u.jsx("strong",{children:"5 worker accounts"}),"? Enterprise is for larger teams that need custom security, controls, and contracting. Contact us for seat-based pricing."]}),u.jsx("div",{className:"mt-2",children:u.jsx(ye,{to:"/contact",className:"dd-link-strong",children:"Contact sales"})})]}),u.jsxs("div",{className:"mt-5 flex flex-wrap gap-3",children:[u.jsx(ye,{to:"/view",className:"dd-link-strong",children:"Start anonymous trial"}),u.jsx(ye,{to:"/profile",className:"dd-link-strong",children:"Go to profile"}),u.jsx("a",{href:"/terms",className:"dd-link-muted",children:"Terms"}),u.jsx("a",{href:"/privacy",className:"dd-link-muted",children:"Privacy"})]}),u.jsxs(Ye,{className:"mt-5 bg-slate-50",children:[u.jsx("div",{className:"mb-2 font-black",children:"Notes"}),u.jsxs("div",{className:"leading-7 text-slate-600",children:["Anonymous trial use is limited to 20k tokens per uid (total). Free accounts have a 40k tokens/day budget. Limits are token-based (not per-click). Larger documents consume more of your budget, so the number of full analyses you can run varies by size. We'll prompt you to upgrade when you hit limits or when a scanned/OCR document is detected. Paid checkout requires a non-anonymous account, and account linking is handled via"," ",u.jsx("code",{children:"/sign-in"}),"."]})]})]})}function pl(o){return Pt({attr:{version:"1.1",x:"0px",y:"0px",viewBox:"0 0 48 48",enableBackground:"new 0 0 48 48"},child:[{tag:"path",attr:{fill:"#FFC107",d:`M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12\r
	c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24\r
	c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z`},child:[]},{tag:"path",attr:{fill:"#FF3D00",d:`M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657\r
	C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z`},child:[]},{tag:"path",attr:{fill:"#4CAF50",d:`M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36\r
	c-5.202,0-9.619-3.317-11.283-7.946l-6.522,5.025C9.505,39.556,16.227,44,24,44z`},child:[]},{tag:"path",attr:{fill:"#1976D2",d:`M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571\r
	c0.001-0.001,0.002-0.001,0.003-0.002l6.19,5.238C36.971,39.205,44,34,44,24C44,22.659,43.862,21.35,43.611,20.083z`},child:[]}]})(o)}function ml(o){return Pt({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M747.4 535.7c-.4-68.2 30.5-119.6 92.9-157.5-34.9-50-87.7-77.5-157.3-82.8-65.9-5.2-138 38.4-164.4 38.4-27.9 0-91.7-36.6-141.9-36.6C273.1 298.8 163 379.8 163 544.6c0 48.7 8.9 99 26.7 150.8 23.8 68.2 109.6 235.3 199.1 232.6 46.8-1.1 79.9-33.2 140.8-33.2 59.1 0 89.7 33.2 141.9 33.2 90.3-1.3 167.9-153.2 190.5-221.6-121.1-57.1-114.6-167.2-114.6-170.7zm-105.1-305c50.7-60.2 46.1-115 44.6-134.7-44.8 2.6-96.6 30.5-126.1 64.8-32.5 36.8-51.6 82.3-47.5 133.6 48.4 3.7 92.6-21.2 129-63.7z"},child:[]}]})(o)}function gl(o){return Pt({attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 32h214.6v214.6H0V32zm233.4 0H448v214.6H233.4V32zM0 265.4h214.6V480H0V265.4zm233.4 0H448V480H233.4V265.4z"},child:[]}]})(o)}const Aa={"auth/account-exists-with-different-credential":"This email is already linked to another sign-in method. Use that method first, then link providers in Profile.","auth/credential-already-in-use":"This credential is already attached to another account. Sign in to that account, then link providers in Profile.","auth/email-already-in-use":"This email is already in use. Sign in instead, then link providers in Profile.","auth/invalid-email":"Enter a valid email address.","auth/invalid-credential":"That sign-in attempt failed. Check your credentials and try again.","auth/missing-password":"Enter your password to continue.","auth/network-request-failed":"Network error. Check your connection and try again.","auth/operation-not-allowed":"This sign-in method is not enabled in Firebase Auth yet.","auth/popup-blocked":"Your browser blocked the sign-in popup. Allow popups and try again.","auth/popup-closed-by-user":"Sign-in popup was closed before completion.","auth/too-many-requests":"Too many attempts. Wait a moment and try again.","auth/user-not-found":"No account exists for this email. Create an account first.","auth/wrong-password":"Incorrect password. Try again or reset your password."},Ms=(o,e="Authentication failed. Please try again.")=>{const t=o?.code;return typeof t=="string"&&Aa[t]?Aa[t]:o instanceof Error&&typeof o.message=="string"&&o.message.trim()?o.message:e},fi="dd-btn dd-btn-provider w-full justify-start",Sa="dd-input",Ip="dd-btn dd-btn-solid w-full",jp="bg-transparent text-sm font-semibold text-slate-900 underline decoration-slate-400 underline-offset-2 hover:text-slate-700",Lp=()=>{const{search:o}=Ge();return T.useMemo(()=>new URLSearchParams(o),[o])};function Mp(){const{authState:o,auth:e,signInWithGoogle:t,signInWithMicrosoft:s,signInWithApple:n,signInWithEmail:i}=lt(),r=Rt(),a=Lp(),[l,c]=T.useState(""),[d,h]=T.useState(""),[f,p]=T.useState({kind:"idle",message:""}),b=o?.user||null,m=!!b?.isAnonymous,y=a.get("intent"),g=a.get("plan")==="business"?"business":"pro",x=a.get("billing")==="annual"?"annual":"monthly",w=a.get("sandbox")==="1"?"1":null,v=T.useMemo(()=>{if(y!=="upgrade")return"/profile";const j=new URLSearchParams({autoCheckout:"1",plan:g,billing:x});return w&&j.set("sandbox",w),`/pricing?${j.toString()}`},[y,w,x,g]),_=()=>{const j=new Fa;return j.setCustomParameters({prompt:"select_account"}),j},E=()=>{const j=new mn("apple.com");return j.addScope("email"),j.addScope("name"),j},k=()=>{const j=new mn("microsoft.com");return j.addScope("openid"),j.addScope("email"),j.addScope("profile"),j.setCustomParameters({prompt:"select_account"}),j},D=async(j,C,B)=>{p({kind:"loading",message:"Opening sign-inâ€¦"}),j==="google"&&ss("auth_google_click");try{if(!e)throw new Error("Auth is not available");if(e.currentUser)await Oa(e.currentUser,C);else if(B)await B();else throw new Error("No active session. Refresh and try again.");j==="google"&&ss("auth_google_success"),p({kind:"ok",message:"Signed in. Your accounts are linked."}),r(v)}catch(S){const O=S?.code||"";if(O==="auth/credential-already-in-use"||O==="auth/email-already-in-use"){p({kind:"error",message:"That account is already used elsewhere. Please sign out and sign in with that provider, then link the others from your profile."});return}j==="google"&&ss("auth_google_error",{auth_error_code:typeof O=="string"?O:"unknown"}),p({kind:"error",message:Ms(S,"Provider sign-in failed.")})}},N=async()=>{p({kind:"loading",message:"Signing inâ€¦"});try{if(!l||!d)throw new Error("Email and password are required.");if(e.currentUser&&m){const j=Ba.credential(l,d);await Ua(e.currentUser,j),p({kind:"ok",message:"Email linked and signed in."})}else await i(l,d),p({kind:"ok",message:"Signed in."});r(v)}catch(j){const C=j?.code||"";if(C==="auth/email-already-in-use"||C==="auth/account-exists-with-different-credential"||C==="auth/credential-already-in-use"){p({kind:"error",message:"This email already has an account. Sign in with the existing method, then link providers in Profile."});return}p({kind:"error",message:Ms(j,"Email sign-in failed.")})}},R=y==="upgrade"?"Sign in to upgrade":"Sign in";return T.useEffect(()=>{o.status==="authenticated"&&!m&&r(v,{replace:!0})},[o.status,m,r,v]),o.status==="authenticated"&&!m?u.jsx(Nt,{size:"lg",children:"Redirecting..."}):u.jsxs(Nt,{size:"lg",children:[u.jsx("h1",{className:"dd-title",children:R}),u.jsx("p",{className:"dd-lead",children:"We support Google, Email, Apple, and Microsoft. Linking is universal, you can attach multiple providers to one account."}),y==="upgrade"?u.jsxs("p",{className:"mt-2 leading-relaxed text-blue-800",children:["Next step after sign-in: start ",g==="business"?"Business":"Pro"," checkout (",x," ","billing)."]}):null,f.kind!=="idle"?u.jsx(Ht,{tone:f.kind==="error"?"error":f.kind==="ok"?"success":"neutral",className:"mt-3.5",children:f.message}):null,u.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-3.5 md:grid-cols-2",children:[u.jsxs(Ye,{children:[u.jsx("div",{className:"font-black",children:"Continue with a provider"}),u.jsxs("div",{className:"mt-3 grid gap-2.5",children:[u.jsxs("button",{type:"button",onClick:()=>D("google",_(),t),className:fi,children:[u.jsx(pl,{size:20}),"Continue with Google"]}),u.jsxs("button",{type:"button",onClick:()=>D("apple",E(),n),className:fi,children:[u.jsx(ml,{size:20}),"Continue with Apple"]}),u.jsxs("button",{type:"button",onClick:()=>D("microsoft",k(),s),className:fi,children:[u.jsx(gl,{size:20}),"Continue with Microsoft"]})]})]}),u.jsxs(Ye,{children:[u.jsx("div",{className:"font-black",children:"Sign in with email"}),u.jsxs("div",{className:"mt-2.5 grid gap-2.5",children:[u.jsx("input",{value:l,onChange:j=>c(j.target.value),placeholder:"Email",className:Sa}),u.jsx("input",{value:d,onChange:j=>h(j.target.value),placeholder:"Password",type:"password",className:Sa}),u.jsxs("div",{className:"grid gap-2.5",children:[u.jsx("button",{type:"button",onClick:N,className:Ip,children:"Sign In"}),u.jsx("div",{className:"flex justify-end text-sm",children:u.jsx("button",{type:"button",onClick:()=>r("/reset-password"),className:jp,children:"Reset password"})})]})]})]})]}),u.jsxs("div",{className:"mt-4 flex flex-wrap gap-3",children:[u.jsx(ye,{to:"/pricing",className:"dd-link-strong",children:"Back to pricing"}),u.jsx(ye,{to:"/",className:"dd-link-muted",children:"Home"})]}),u.jsx(Ye,{className:"mt-4 bg-slate-50",children:u.jsxs("details",{children:[u.jsx("summary",{className:"cursor-pointer font-black text-slate-900",children:"Debug info"}),u.jsxs("div",{className:"mt-2 leading-7 text-slate-600",children:["Status: ",u.jsx("strong",{children:o?.status}),u.jsx("br",{}),"UID: ",u.jsx("code",{children:b?.uid||"n/a"}),u.jsx("br",{}),"Anonymous: ",u.jsx("strong",{children:String(m)})]})]})})]})}const pi="dd-btn dd-btn-provider w-full justify-start",mi="dd-input",Fp="dd-btn dd-btn-solid w-full",Op=()=>{const{search:o}=Ge();return T.useMemo(()=>new URLSearchParams(o),[o])};function Bp(){const{authState:o,auth:e,signInWithGoogle:t,signInWithMicrosoft:s,signInWithApple:n,signUpWithEmail:i}=lt(),r=Rt(),a=Op(),[l,c]=T.useState(""),[d,h]=T.useState(""),[f,p]=T.useState(""),[b,m]=T.useState({kind:"idle",message:""}),y=o?.user||null,g=!!y?.isAnonymous,x=a.get("intent"),w=a.get("plan")==="business"?"business":"pro",v=a.get("billing")==="annual"?"annual":"monthly",_=a.get("sandbox")==="1"?"1":null,E=T.useMemo(()=>{if(x!=="upgrade")return"/profile";const C=new URLSearchParams({autoCheckout:"1",plan:w,billing:v});return _&&C.set("sandbox",_),`/pricing?${C.toString()}`},[x,_,v,w]),k=()=>{const C=new Fa;return C.setCustomParameters({prompt:"select_account"}),C},D=()=>{const C=new mn("apple.com");return C.addScope("email"),C.addScope("name"),C},N=()=>{const C=new mn("microsoft.com");return C.addScope("openid"),C.addScope("email"),C.addScope("profile"),C.setCustomParameters({prompt:"select_account"}),C},R=async(C,B,S)=>{m({kind:"loading",message:"Opening sign-inâ€¦"}),C==="google"&&ss("auth_google_click");try{if(!e)throw new Error("Auth is not available");if(e.currentUser)await Oa(e.currentUser,B);else if(S)await S();else throw new Error("No active session. Refresh and try again.");C==="google"&&ss("auth_google_success"),m({kind:"ok",message:"Signed in. Your accounts are linked."}),r(E)}catch(O){const U=O?.code||"";if(U==="auth/credential-already-in-use"||U==="auth/email-already-in-use"){m({kind:"error",message:"That account is already used elsewhere. Please sign out and sign in with that provider, then link the others from your profile."});return}C==="google"&&ss("auth_google_error",{auth_error_code:typeof U=="string"?U:"unknown"}),m({kind:"error",message:Ms(O,"Provider sign-in failed.")})}};if(T.useEffect(()=>{o.status==="authenticated"&&!g&&r(E,{replace:!0})},[o.status,g,r,E]),o.status==="authenticated"&&!g)return u.jsx(Nt,{size:"lg",children:"Redirecting..."});const j=async()=>{m({kind:"loading",message:"Creating accountâ€¦"});try{if(!l||!d||!f)throw new Error("Email and passwords are required.");if(d!==f)throw new Error("Passwords do not match.");if(String(d).length<10)throw new Error("Password must be at least 10 characters.");if(e.currentUser&&g){const C=Ba.credential(l,d);await Ua(e.currentUser,C),m({kind:"ok",message:"Account created and linked."})}else await i(l,d),m({kind:"ok",message:"Account created."});r(E)}catch(C){m({kind:"error",message:Ms(C,"Account creation failed.")})}};return u.jsxs(Nt,{size:"lg",children:[u.jsx("h1",{className:"dd-title",children:"Sign up"}),u.jsx("p",{className:"dd-lead",children:"Create your DecoDocs account to get started."}),x==="upgrade"?u.jsxs("p",{className:"mt-2 leading-relaxed text-blue-800",children:["Next step after sign-up: start ",w==="business"?"Business":"Pro"," checkout (",v," ","billing)."]}):null,u.jsxs("div",{className:"mt-4 grid grid-cols-1 gap-3.5 md:grid-cols-2",children:[u.jsxs(Ye,{children:[u.jsx("div",{className:"font-black",children:"Continue with a provider"}),u.jsxs("div",{className:"mt-3 grid gap-2.5",children:[u.jsxs("button",{type:"button",onClick:()=>R("google",k(),t),className:pi,children:[u.jsx(pl,{size:20}),"Continue with Google"]}),u.jsxs("button",{type:"button",onClick:()=>R("apple",D(),n),className:pi,children:[u.jsx(ml,{size:20}),"Continue with Apple"]}),u.jsxs("button",{type:"button",onClick:()=>R("microsoft",N(),s),className:pi,children:[u.jsx(gl,{size:20}),"Continue with Microsoft"]})]})]}),u.jsxs(Ye,{children:[u.jsx("div",{className:"font-black",children:"Create account"}),u.jsxs("div",{className:"mt-2.5 grid gap-2.5",children:[u.jsx("input",{value:l,onChange:C=>c(C.target.value),placeholder:"Email",className:mi}),u.jsx("input",{value:d,onChange:C=>h(C.target.value),placeholder:"Password",type:"password",className:mi}),u.jsx("input",{value:f,onChange:C=>p(C.target.value),placeholder:"Confirm password",type:"password",className:mi}),u.jsx("button",{type:"button",onClick:j,className:Fp,children:"Create account"})]}),u.jsx("p",{className:"mt-2.5 text-sm leading-relaxed text-slate-500",children:"Recommended password minimum: 10 chars. If an email already exists and linking fails, sign out then sign in using that email."})]})]}),b.kind!=="idle"?u.jsx(Ht,{tone:b.kind==="error"?"error":b.kind==="ok"?"success":"neutral",className:"mt-3.5",children:b.message}):null,u.jsxs("div",{className:"mt-4 flex flex-wrap gap-3",children:[u.jsx(ye,{to:"/pricing",className:"dd-link-strong",children:"Back to pricing"}),u.jsx(ye,{to:"/",className:"dd-link-muted",children:"Home"})]}),u.jsxs(Ye,{className:"mt-4 bg-slate-50",children:[u.jsx("div",{className:"mb-1.5 font-black",children:"Current session"}),u.jsxs("div",{className:"leading-7 text-slate-600",children:["Status: ",u.jsx("strong",{children:o?.status}),u.jsx("br",{}),"UID: ",u.jsx("code",{children:y?.uid||"n/a"}),u.jsx("br",{}),"Anonymous: ",u.jsx("strong",{children:String(g)})]})]})]})}const Up="dd-input",zp="dd-btn dd-btn-solid w-full";function Hp(){const{resetPassword:o}=lt(),[e,t]=T.useState(""),[s,n]=T.useState({kind:"idle",message:""}),i=async()=>{n({kind:"loading",message:"Sending reset emailâ€¦"});try{if(!e)throw new Error("Enter your email first.");await o(e),n({kind:"ok",message:"Password reset email sent (if the account exists)."})}catch(r){n({kind:"error",message:Ms(r,"Password reset failed.")})}};return u.jsxs(Nt,{size:"lg",children:[u.jsx("h1",{className:"dd-title",children:"Reset password"}),u.jsx("p",{className:"dd-lead",children:"Enter your account email and we will send a reset link."}),s.kind!=="idle"?u.jsx(Ht,{tone:s.kind==="error"?"error":s.kind==="ok"?"success":"neutral",className:"mt-3.5",children:s.message}):null,u.jsx("div",{className:"mt-4 max-w-xl",children:u.jsxs(Ye,{children:[u.jsx("div",{className:"font-black",children:"Email"}),u.jsxs("div",{className:"mt-2.5 grid gap-2.5",children:[u.jsx("input",{value:e,onChange:r=>t(r.target.value),placeholder:"Email",className:Up}),u.jsx("button",{type:"button",onClick:i,className:zp,children:"Send reset email"})]})]})}),u.jsxs("div",{className:"mt-4 flex flex-wrap gap-3",children:[u.jsx(ye,{to:"/sign-in",className:"dd-link-strong",children:"Back to sign in"}),u.jsx(ye,{to:"/",className:"dd-link-muted",children:"Home"})]})]})}const $p="dd-btn dd-btn-solid",Wp="dd-btn dd-btn-outline",Gp="dd-btn dd-btn-subtle";function Vp(){const{authState:o,auth:e,app:t}=lt(),s=Rt(),n=Ge(),i=T.useMemo(()=>new URLSearchParams(n.search),[n.search]),r=o?.user,[a,l]=T.useState(null);T.useEffect(()=>{const h=i.get("stripe");if(h==="success"){l("Stripe checkout completed. If billing status does not update yet, wait a few seconds for webhook sync and refresh.");return}if(h==="cancel"){l("Stripe checkout was canceled.");return}l(null)},[i]);const c=async()=>{e&&(await ec(e),window.location.reload())},d=async()=>{l(null);try{const{getFunctions:h,httpsCallable:f}=await Nn(async()=>{const{getFunctions:g,httpsCallable:x}=await Promise.resolve().then(()=>uo);return{getFunctions:g,httpsCallable:x}},void 0),p=t?h(t):null;if(!p)throw new Error("Billing portal unavailable (Firebase not ready).");const y=(await f(p,"stripeCreatePortalSession")({}))?.data?.url;if(!y)throw new Error("No portal URL returned");window.location.assign(y)}catch(h){l(`Could not open Stripe portal: ${h?.message||h}`)}};return u.jsxs(Nt,{size:"lg",children:[u.jsx("h1",{className:"dd-title",children:"Profile"}),u.jsx("p",{className:"dd-lead",children:"Manage linked accounts and subscription. Receipts and subscription management use Stripe Customer Portal."}),a?u.jsx(Ht,{tone:"warning",className:"mt-4",children:a}):null,u.jsxs(Ye,{className:"mt-4",children:[u.jsx("div",{className:"font-black",children:"Session"}),u.jsxs("div",{className:"mt-2.5 leading-7 text-slate-900",children:["Status: ",u.jsx("strong",{children:o?.status}),u.jsx("br",{}),"UID: ",u.jsx("code",{children:r?.uid||"n/a"}),u.jsx("br",{}),"Anonymous: ",u.jsx("strong",{children:String(!!r?.isAnonymous)})]}),u.jsxs("div",{className:"mt-3 text-slate-600",children:["Linked providers:"," ",r?.providerData?.length?u.jsx("ul",{className:"mb-0 mt-1.5 list-disc pl-5",children:r.providerData.map(h=>u.jsxs("li",{children:[u.jsx("code",{children:h.providerId}),h.email?` â€” ${h.email}`:""]},h.providerId))}):u.jsx("span",{children:"none (anonymous)"})]}),u.jsxs("div",{className:"mt-3.5 flex flex-wrap gap-2.5",children:[u.jsx("button",{type:"button",onClick:()=>s("/sign-in"),className:$p,children:"Link accounts"}),u.jsx("button",{type:"button",onClick:d,className:Wp,children:"Billing & receipts"}),u.jsx("button",{type:"button",onClick:c,className:Gp,children:"Sign out"})]})]}),u.jsxs("div",{className:"mt-4 flex flex-wrap gap-3",children:[u.jsx(ye,{to:"/pricing",className:"dd-link-strong",children:"Pricing"}),u.jsx(ye,{to:"/view",className:"dd-link-muted",children:"Analyze a PDF"})]})]})}const _a=o=>{const e=document.createElement("a");e.href=URL.createObjectURL(o),e.download=o.name||"envelope.snapsign",e.click(),URL.revokeObjectURL(e.href)},Xp=()=>{const o=Ge(),{authState:e}=lt(),t=T.useRef(null),{numPages:s,pdfTextContent:n,isLoading:i,loadingMessage:r,loadPdfFromBlob:a}=fr(),[l,c]=T.useState(null),[d,h]=T.useState(null),[f,p]=T.useState(null),[b,m]=T.useState(null),[y,g]=T.useState(null),[x,w]=T.useState(""),[v,_]=T.useState(""),[E,k]=T.useState(""),[D,N]=T.useState(""),[R,j]=T.useState(""),[C,B]=T.useState(""),S=T.useMemo(()=>l?.name||"document.pdf",[l]),O=async G=>{const z=G?.target?.files?.[0];if(z){w(""),_(""),m(null),g(null);try{const $=await gr(z);c(z),h($.source),p($.envelope||null),await a($.pdfFile),R||j(`Please review and sign: ${$.pdfFile.name}`),C||B("Please review and sign this document. I have attached the .snapsign envelope.")}catch($){w($?.message||"Unsupported file. Please upload a valid .pdf or .snapsign file.")}finally{G.target.value=""}}};T.useEffect(()=>{const G=o.state?.document?.file||null;G&&O({target:{files:[G],value:""}})},[o.state]);const U=async()=>{if(!l){w("Choose a PDF or .snapsign file first.");return}if(!s||i){w("Please wait until PDF parsing is complete.");return}w(""),_("Preparing envelope..."),m(null);try{const G={title:S,senderUid:e?.user?.uid||null,recipient:{name:E||null,email:D||null},draftEmail:{subject:R||null,message:C||null}},z=await xp({inputFile:l,extractedText:n||"",pageCount:s,analyzeFn:null,metadata:G});if(g(z.preflight||null),z.status==="success"&&z.envelopeFile){m(z.envelopeFile),_("Envelope ready. Download it and send it manually by email."),_a(z.envelopeFile);return}const $=z.preflight?.reasons?.map(L=>L.message).join(" ")||"Envelope preflight failed.";_(""),w($)}catch(G){_(""),w(G?.message||"Failed to prepare envelope.")}},M=()=>{if(!b){w("Prepare and download the envelope first.");return}if(!D){w("Recipient email is required to prepare an email draft.");return}const G=R||`Please review and sign: ${S}`,z=[E?`Hi ${E},`:"Hi,","",C||"Please review and sign this document.","",`Attachment to include manually: ${b.name}`,"Open the attachment in DecoDocs, sign in the client, then reply with the updated file.","","This email draft does not attach files automatically. Please attach the downloaded .snapsign file yourself."],$=`mailto:${encodeURIComponent(D)}?subject=${encodeURIComponent(G)}&body=${encodeURIComponent(z.join(`
`))}`;window.location.href=$};return u.jsxs("div",{className:"max-w-4xl mx-auto w-full p-6 md:p-8",children:[u.jsx("h1",{className:"text-2xl md:text-3xl font-black text-slate-900",children:"Send for Signature"}),u.jsxs("p",{className:"mt-2 text-slate-600",children:["Frontend-only workflow: prepare a ",u.jsx("code",{children:".snapsign"})," envelope, download it, then send it manually using your own email client."]}),u.jsxs("div",{className:"mt-6 bg-white border border-slate-200 rounded-xl p-5",children:[u.jsx("div",{className:"text-sm font-semibold text-slate-700",children:"1. Choose document"}),u.jsx("p",{className:"mt-1 text-sm text-slate-500",children:"Accepts PDF and existing .snapsign files."}),u.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-3",children:[u.jsx("button",{type:"button",className:"px-4 py-2 rounded-lg border border-slate-900 bg-slate-900 text-white font-semibold hover:bg-slate-800 transition-colors",onClick:()=>t.current?.click(),children:"Choose file"}),u.jsx("input",{ref:t,type:"file",accept:".pdf,.snapsign,application/pdf,application/zip",className:"hidden",onChange:O}),u.jsx("span",{className:"text-sm text-slate-600",children:l?`${l.name} (${d||"pdf"})`:"No file selected"})]}),f?.manifest?.document?.sha256&&u.jsxs("p",{className:"mt-2 text-xs text-slate-500",children:["Existing envelope hash: ",u.jsx("code",{children:f.manifest.document.sha256})]}),i&&u.jsx("p",{className:"mt-2 text-sm text-blue-700",children:r||"Parsing PDF..."})]}),u.jsxs("div",{className:"mt-4 bg-white border border-slate-200 rounded-xl p-5",children:[u.jsx("div",{className:"text-sm font-semibold text-slate-700",children:"2. Recipient details (optional metadata)"}),u.jsxs("div",{className:"mt-3 grid grid-cols-1 md:grid-cols-2 gap-3",children:[u.jsx("input",{type:"text",value:E,onChange:G=>k(G.target.value),className:"px-3 py-2 rounded-lg border border-slate-200",placeholder:"Recipient name"}),u.jsx("input",{type:"email",value:D,onChange:G=>N(G.target.value),className:"px-3 py-2 rounded-lg border border-slate-200",placeholder:"Recipient email"})]})]}),u.jsxs("div",{className:"mt-4 bg-white border border-slate-200 rounded-xl p-5",children:[u.jsx("div",{className:"text-sm font-semibold text-slate-700",children:"3. Manual email draft"}),u.jsxs("div",{className:"mt-3 grid grid-cols-1 gap-3",children:[u.jsx("input",{type:"text",value:R,onChange:G=>j(G.target.value),className:"px-3 py-2 rounded-lg border border-slate-200",placeholder:"Email subject"}),u.jsx("textarea",{value:C,onChange:G=>B(G.target.value),rows:4,className:"px-3 py-2 rounded-lg border border-slate-200",placeholder:"Email message"})]})]}),y&&u.jsxs("div",{className:"mt-4 bg-slate-50 border border-slate-200 rounded-xl p-4 text-sm",children:[u.jsxs("div",{className:"font-semibold text-slate-700",children:["Preflight: ",y.classification]}),y.reasons?.length>0&&u.jsx("ul",{className:"mt-2 list-disc pl-5 text-slate-600",children:y.reasons.map(G=>u.jsx("li",{children:G.message},G.code))})]}),x&&u.jsx("p",{className:"mt-4 text-sm text-red-700",children:x}),v&&u.jsx("p",{className:"mt-4 text-sm text-emerald-700",children:v}),u.jsxs("div",{className:"mt-6 flex flex-wrap gap-3",children:[u.jsx("button",{type:"button",onClick:U,className:"px-4 py-2 rounded-lg border border-blue-700 bg-blue-700 text-white font-semibold hover:bg-blue-600 transition-colors disabled:opacity-50",disabled:!l||i,children:"Export .snapsign"}),u.jsx("button",{type:"button",onClick:()=>b&&_a(b),className:"px-4 py-2 rounded-lg border border-slate-300 bg-white text-slate-800 font-semibold hover:bg-slate-50 transition-colors disabled:opacity-50",disabled:!b,children:"Download Envelope Again"}),u.jsx("button",{type:"button",onClick:M,className:"px-4 py-2 rounded-lg border border-slate-900 bg-slate-900 text-white font-semibold hover:bg-slate-800 transition-colors disabled:opacity-50",disabled:!b||!D,children:"Open Email Draft"})]})]})},Ea=({onOpenPdf:o=()=>{},children:e})=>u.jsx(jt,{showOneTap:!0,showDecor:!0,onOpenPdf:o,children:e}),Yp=()=>{const{slug:o}=zi(),e=un.find(s=>{const n=s.title.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"");return s.slug===o||n===o}),t=un.filter(s=>s.slug!==e?.slug).slice(0,3);return e?u.jsx(Ea,{children:u.jsxs("div",{className:"relative overflow-hidden px-6 pb-20 pt-12",children:[u.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[u.jsx("div",{className:"absolute -right-20 -top-24 h-64 w-64 rounded-full bg-amber-200/40 blur-3xl"}),u.jsx("div",{className:"absolute -left-24 top-56 h-72 w-72 rounded-full bg-blue-200/30 blur-3xl"})]}),u.jsxs("div",{className:"relative mx-auto flex w-full max-w-6xl flex-col gap-16",children:[u.jsxs("section",{className:"grid gap-8 rounded-3xl border border-slate-200/80 bg-white/85 p-8 shadow-xl shadow-slate-900/5 backdrop-blur-sm lg:grid-cols-[1.2fr_0.8fr] lg:p-12",children:[u.jsxs("div",{children:[u.jsx("p",{className:"text-xs font-bold uppercase tracking-[0.25em] text-slate-500",children:e.audience}),u.jsx("h1",{className:"mt-4 text-4xl font-bold leading-tight text-slate-900 lg:text-5xl",children:e.heroTitle||e.title}),u.jsx("p",{className:"mt-5 max-w-2xl text-lg leading-relaxed text-slate-600",children:e.heroDescription||e.description}),u.jsxs("div",{className:"mt-8 flex flex-wrap gap-3",children:[u.jsx(_t,{size:"md",to:e.cta?.primaryTo||"/view",children:e.cta?.primaryLabel||"Open viewer"}),u.jsx(_t,{variant:"outline",size:"md",to:e.cta?.secondaryTo||"/contact",children:e.cta?.secondaryLabel||"Contact us"})]})]}),u.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-6",children:[u.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-slate-800",children:[u.jsx(En,{className:"h-5 w-5 text-slate-500"}),"Best document fit"]}),u.jsx("ul",{className:"mt-4 space-y-3 list-none p-0",children:e.documentTypes.map(s=>u.jsxs("li",{className:"flex items-start gap-2 text-sm text-slate-700",children:[u.jsx(pn,{className:"mt-0.5 h-4 w-4 shrink-0 text-emerald-500"}),u.jsx("span",{children:s})]},s))})]})]}),u.jsx("section",{className:"grid gap-4 md:grid-cols-3",children:e.highlights.map(s=>u.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-5",children:[u.jsx("p",{className:"text-xs font-semibold uppercase tracking-wider text-slate-500",children:s.label}),u.jsx("p",{className:"mt-2 text-lg font-semibold text-slate-900",children:s.value})]},s.label))}),u.jsxs("section",{children:[u.jsxs("div",{className:"mb-6 flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500",children:[u.jsx(Mi,{className:"h-5 w-5 text-amber-500"}),"Where teams get blocked"]}),u.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:e.painPoints.map(s=>u.jsx("div",{className:"rounded-2xl border border-slate-200 bg-white p-5 text-slate-700 shadow-sm",children:s},s))})]}),u.jsxs("section",{children:[u.jsxs("div",{className:"mb-6 flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500",children:[u.jsx(Cs,{className:"h-5 w-5 text-indigo-500"}),"Recommended workflow"]}),u.jsx("div",{className:"grid gap-4 lg:grid-cols-3",children:e.workflow.map((s,n)=>u.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-white p-6 shadow-sm",children:[u.jsxs("p",{className:"text-xs font-semibold uppercase tracking-[0.2em] text-slate-400",children:["Step ",n+1]}),u.jsx("h3",{className:"mt-3 text-lg font-semibold text-slate-900",children:s.step}),u.jsx("p",{className:"mt-3 text-sm leading-relaxed text-slate-600",children:s.detail})]},s.step))})]}),u.jsxs("section",{className:"grid gap-6 rounded-3xl border border-slate-200 bg-white p-8 lg:grid-cols-[1fr_1fr]",children:[u.jsxs("div",{children:[u.jsxs("div",{className:"flex items-center gap-2 text-sm font-bold uppercase tracking-wider text-slate-500",children:[u.jsx(Ca,{className:"h-5 w-5 text-emerald-600"}),"What your team delivers"]}),u.jsx("ul",{className:"mt-5 space-y-3 list-none p-0",children:e.deliverables.map(s=>u.jsxs("li",{className:"flex items-start gap-2 text-sm text-slate-700",children:[u.jsx(pn,{className:"mt-0.5 h-4 w-4 shrink-0 text-emerald-500"}),u.jsx("span",{children:s})]},s))})]}),u.jsxs("div",{className:"rounded-2xl border border-slate-200 bg-slate-50 p-6",children:[u.jsx("p",{className:"text-sm font-semibold text-slate-900",children:"Need this workflow adapted to your team?"}),u.jsx("p",{className:"mt-3 text-sm leading-relaxed text-slate-600",children:"We can help shape your review flow around your real document mix and approval process."}),u.jsxs("div",{className:"mt-5 flex flex-wrap gap-3",children:[u.jsx(_t,{size:"sm",to:"/contact",children:"Talk to us"}),u.jsx(_t,{variant:"outline",size:"sm",to:"/pricing",children:"View pricing"})]})]})]}),u.jsxs("section",{children:[u.jsx("p",{className:"text-sm font-bold uppercase tracking-wider text-slate-500",children:"Related use cases"}),u.jsx("div",{className:"mt-5 grid gap-4 md:grid-cols-3",children:t.map(s=>u.jsxs(ye,{to:`/use-cases/${s.slug||s.title.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")}`,className:"rounded-2xl border border-slate-200 bg-white p-5 no-underline transition hover:border-slate-300 hover:shadow-lg",children:[u.jsx("p",{className:"text-xs font-semibold uppercase tracking-wide text-slate-400",children:s.audience||"Use case"}),u.jsx("p",{className:"mt-2 text-lg font-semibold text-slate-900",children:s.title}),u.jsx("p",{className:"mt-2 text-sm text-slate-600",children:s.description})]},s.slug||s.title))})]})]})]})}):u.jsx(Ea,{children:u.jsx("div",{className:"px-6 py-20",children:u.jsxs("div",{className:"mx-auto max-w-4xl text-center",children:[u.jsx("h1",{className:"text-4xl font-bold text-slate-900 mb-4",children:"Use Case Not Found"}),u.jsx("p",{className:"text-lg text-slate-600",children:"The requested use case could not be found."}),u.jsx("div",{className:"mt-10 grid gap-4 text-left sm:grid-cols-2",children:un.map(s=>u.jsxs(ye,{to:`/use-cases/${s.slug||s.title.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")}`,className:"rounded-2xl border border-slate-200 bg-white p-5 no-underline transition hover:border-slate-300 hover:shadow-lg",children:[u.jsx("p",{className:"text-sm font-semibold uppercase tracking-wide text-slate-400",children:s.audience||"Use case"}),u.jsx("p",{className:"mt-1 text-lg font-semibold text-slate-900",children:s.title}),u.jsx("p",{className:"mt-2 text-sm text-slate-600",children:s.description})]},s.slug||s.title))})]})})})};function qp(){return u.jsx(Nt,{size:"md",children:u.jsxs(Ye,{children:[u.jsx("p",{className:"text-xs font-bold uppercase tracking-[0.22em] text-slate-500",children:"Error 404"}),u.jsx("h1",{className:"dd-title mt-3",children:"Page not found"}),u.jsx("p",{className:"dd-lead",children:"The page you requested does not exist or has been moved. Use one of the links below to continue."}),u.jsxs("div",{className:"mt-5 flex flex-wrap gap-2.5",children:[u.jsx(ye,{to:"/",className:"dd-btn dd-btn-solid no-underline",children:"Go to home"}),u.jsx(ye,{to:"/view",className:"dd-btn dd-btn-outline no-underline",children:"Open viewer"})]})]})})}const Kp=!!import.meta?.env?.DEV;function bl({error:o=null,errorInfo:e=null}){return u.jsx(Nt,{size:"md",children:u.jsxs(Ye,{children:[u.jsx("p",{className:"text-xs font-bold uppercase tracking-[0.22em] text-slate-500",children:"Error 500"}),u.jsx("h1",{className:"dd-title mt-3",children:"Something went wrong"}),u.jsx("p",{className:"dd-lead",children:"We hit an unexpected application error. Try refreshing the page or return to the homepage."}),u.jsxs("div",{className:"mt-5 flex flex-wrap gap-2.5",children:[u.jsx("a",{href:"/",className:"dd-btn dd-btn-solid no-underline",children:"Go to home"}),u.jsx("a",{href:"/view",className:"dd-btn dd-btn-outline no-underline",children:"Open viewer"})]}),Kp?u.jsx(Ht,{tone:"error",className:"mt-5",children:u.jsxs("details",{children:[u.jsx("summary",{className:"cursor-pointer font-semibold",children:"Technical details (development only)"}),u.jsx("div",{className:"mt-2 whitespace-pre-wrap font-mono text-xs leading-6",children:o?String(o):"No error payload available."}),e?.componentStack?u.jsx("pre",{className:"mt-2 overflow-auto rounded-md bg-white/70 p-2 text-[11px] leading-5 text-slate-800",children:e.componentStack}):null]})}):null]})})}const gi=({children:o})=>u.jsx(Xi,{variant:"marketing",showHeader:!0,showFooter:!0,children:o}),yl=({children:o,showFooter:e=!0})=>u.jsx(Xi,{variant:"app",showHeader:!0,showFooter:e,children:o}),Ss=({children:o})=>u.jsx(yl,{showFooter:!1,children:o});class Zp{constructor(){this.functions=null,this.source="web",this.installed=!1,this.queue=[],this.lastSentByKey=new Map}configure({functions:e,source:t="web"}={}){e&&(this.functions=e),this.source=t||this.source,this.flushQueue()}installGlobalHandlers(){this.installed||typeof window>"u"||(this.installed=!0,window.addEventListener("error",e=>{this.report({eventType:"window_error",message:e?.message||"Unhandled window error",error:e?.error||null,extra:{filename:e?.filename||null,lineno:e?.lineno||null,colno:e?.colno||null}})}),window.addEventListener("unhandledrejection",e=>{const t=e?.reason,s=t instanceof Error;this.report({eventType:"unhandled_rejection",message:s?t.message:String(t||"Unhandled promise rejection"),error:s?t:null,extra:{reason:s?null:String(t||"")}})}))}reportReactError(e,t){return this.report({eventType:"react_error_boundary",message:e?.message||"React error boundary caught an error",error:e,extra:{componentStack:t?.componentStack||null}})}async flushQueue(){if(!this.functions||this.queue.length===0)return;const e=[...this.queue];this.queue=[];for(const t of e)await this.send(t)}async report({eventType:e,message:t,error:s=null,extra:n=null}){const i={source:this.source,eventType:String(e||"unknown").slice(0,80),message:String(t||"Unknown client error").slice(0,5e3),errorName:s?.name||null,stack:s?.stack||null,pageUrl:typeof window<"u"?window.location.href:null,userAgent:typeof navigator<"u"?navigator.userAgent:null,extra:n||null};if(!this.isDuplicate(i)){if(!this.functions){this.queue.push(i),this.queue.length>20&&this.queue.shift();return}await this.send(i)}}isDuplicate(e){const t=`${e.eventType}|${e.message}|${e.pageUrl||""}`,s=Date.now(),n=this.lastSentByKey.get(t)||0;return s-n<5e3?!0:(this.lastSentByKey.set(t,s),!1)}async send(e){try{await dh(this.functions,e)}catch(t){console.error("Crash reporter failed to submit",t)}}}const ji=new Zp;class Jp extends ls.Component{constructor(e){super(e),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t),ji.reportReactError(e,t),this.setState({error:e,errorInfo:t})}render(){return this.state.hasError?u.jsx(bl,{error:this.state.error,errorInfo:this.state.errorInfo}):this.props.children}}const Qp=()=>{const{authState:o}=lt(),[e,t]=ls.useState(!1);return o.status!=="error"||e?null:u.jsx("div",{style:{position:"fixed",top:"20px",right:"20px",backgroundColor:"#fff3cd",border:"1px solid #ffc107",borderRadius:"4px",padding:"1rem",maxWidth:"400px",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)",zIndex:1e3,fontFamily:"sans-serif"},role:"alert",children:u.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[u.jsxs("div",{children:[u.jsx("h4",{style:{margin:"0 0 0.5rem 0",color:"#856404"},children:"Authentication Unavailable"}),u.jsxs("div",{style:{margin:0,color:"#856404",fontSize:"0.9rem",lineHeight:1.4},children:[u.jsx("div",{children:"Some features may be limited, but you can still view documents."}),!1]})]}),u.jsx("button",{onClick:()=>t(!0),style:{background:"none",border:"none",fontSize:"1.5rem",cursor:"pointer",color:"#856404",padding:0,marginLeft:"1rem",flexShrink:0},"aria-label":"Dismiss notification",children:"Ã—"})]})})};class em{constructor(){this.installed=!1}resolveEnabled(){if(typeof window>"u")return!1;const t=new URLSearchParams(window.location.search).get("debugClicks");if(t==="1")return window.localStorage.setItem("dd:debugClicks","1"),!0;if(t==="0")return window.localStorage.setItem("dd:debugClicks","0"),!1;const s=window.localStorage.getItem("dd:debugClicks");return s!=="0"}install(){this.installed||typeof window>"u"||typeof document>"u"||this.resolveEnabled()&&(this.installed=!0,document.addEventListener("click",e=>{const t=e.target;t instanceof Element&&this.logEvent("click",t)},{capture:!0}),document.addEventListener("submit",e=>{const t=e.target;t instanceof Element&&this.logEvent("submit",t)},{capture:!0}))}logEvent(e,t){const s=t.getAttribute("aria-label")||t.getAttribute("data-testid")||t.getAttribute("name")||t.textContent||"",n={kind:e,tag:t.tagName.toLowerCase(),id:t.id||null,className:(t.className||"").toString().slice(0,180)||null,label:String(s).replace(/\s+/g," ").trim().slice(0,160)||null,href:t instanceof HTMLAnchorElement?t.href:null,path:window.location.pathname+window.location.search+window.location.hash,ts:new Date().toISOString()};console.log("[action-log]",n)}}const tm=new em,cn=({children:o})=>{const{authState:e}=lt();return e.status==="pending"?u.jsx("div",{children:"Loading..."}):e.status!=="authenticated"?u.jsx(xi,{to:"/sign-in",replace:!0}):o},sm=()=>u.jsxs(td,{children:[u.jsx(Fe,{path:"/",element:u.jsx(Nh,{})}),u.jsx(Fe,{path:"/pricing",element:u.jsx(jt,{children:u.jsx(Dp,{})})}),u.jsx(Fe,{path:"/about",element:u.jsx(jt,{children:u.jsx(Pp,{})})}),u.jsx(Fe,{path:"/contact",element:u.jsx(jt,{children:u.jsx(Rp,{})})}),u.jsx(Fe,{path:"/use-cases/:slug",element:u.jsx(Yp,{})}),u.jsx(Fe,{path:"/sign-in",element:u.jsx(gi,{children:u.jsx(Mp,{})})}),u.jsx(Fe,{path:"/sign-up",element:u.jsx(gi,{children:u.jsx(Bp,{})})}),u.jsx(Fe,{path:"/reset-password",element:u.jsx(gi,{children:u.jsx(Hp,{})})}),u.jsx(Fe,{path:"/view",element:u.jsx(Ss,{children:u.jsx(di,{})})}),u.jsx(Fe,{path:"/view/:documentId",element:u.jsx(Ss,{children:u.jsx(di,{})})}),u.jsx(Fe,{path:"/view/test-docs/:fileName",element:u.jsx(Ss,{children:u.jsx(di,{})})}),u.jsx(Fe,{path:"/profile",element:u.jsx(cn,{children:u.jsx(yl,{children:u.jsx(Vp,{})})})}),u.jsx(Fe,{path:"/edit",element:u.jsx(cn,{children:u.jsx(xi,{to:"/edit/test-docs/offer.pdf",replace:!0})})}),u.jsx(Fe,{path:"/edit/:documentId",element:u.jsx(cn,{children:u.jsx(Ss,{children:u.jsx(ya,{})})})}),u.jsx(Fe,{path:"/edit/test-docs/:fileName",element:u.jsx(cn,{children:u.jsx(Ss,{children:u.jsx(ya,{})})})}),u.jsx(Fe,{path:"/sign",element:u.jsx(jt,{children:u.jsx(Xp,{})})}),u.jsx(Fe,{path:"/500",element:u.jsx(jt,{children:u.jsx(bl,{})})}),u.jsx(Fe,{path:"/app",element:u.jsx(xi,{to:"/view",replace:!0})}),u.jsx(Fe,{path:"*",element:u.jsx(jt,{children:u.jsx(qp,{})})})]}),nm=()=>{const{app:o}=lt();return T.useEffect(()=>{ji.installGlobalHandlers(),tm.install()},[]),T.useEffect(()=>{o&&ji.configure({functions:Dn(o),source:"web"})},[o]),null},im=({basename:o="/"})=>u.jsxs(ah,{children:[u.jsx(nm,{}),u.jsxs(Jp,{children:[u.jsx(Qp,{}),u.jsx(Ed,{basename:o,children:u.jsx(sm,{})})]})]}),um=({basename:o="/"})=>u.jsx(im,{basename:o});export{um as default};
